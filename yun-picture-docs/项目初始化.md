# é¡¹ç›®åˆå§‹åŒ–

# åç«¯åˆå§‹åŒ–

## ç¯å¢ƒå‡†å¤‡

1. å®‰è£…çš„JDKç‰ˆæœ¬å¿…é¡»æ˜¯8ã€11æˆ–17ï¼Œä¸èƒ½è¶…è¿‡17!

æ¨èä½¿ç”¨11ç‰ˆæœ¬ï¼Œå› ä¸ºåç»­å¯èƒ½è¦ç”¨åˆ°çš„ç¼“å­˜åº“Caffeineè¦æ±‚ä½¿ç”¨11ç‰ˆæœ¬ã€‚

1. MySQLæ•°æ®åº“æœ€å¥½å®‰è£…8.xç‰ˆæœ¬ï¼Œæˆ–è€… 5.7ç‰ˆæœ¬ã€‚

## æ–°å»ºé¡¹ç›®

åœ¨IDEAä¸­æ–°å»ºé¡¹ç›®ï¼Œé€‰æ‹©Spring Initializræ¨¡æ¿ï¼Œè€ƒè™‘åˆ°ç¨³å®šæ€§ï¼Œæ­¤å¤„é€‰æ‹©åˆ›å»ºJava 8ç‰ˆæœ¬çš„é¡¹ç›®ã€‚

æ³¨æ„éœ€è¦æ›¿æ¢ Server URL ä¸º https://start.aliyun.com/ï¼Œå› ä¸ºå®˜æ–¹çš„ Server URL ä¸æ”¯æŒé€‰æ‹© Java 8ã€‚

é…ç½®å¦‚å›¾ï¼š

![](assets/AnJmb8UAVodvj7xYkjfcqToJnmc.png)

é€‰æ‹© Spring Boot 2.7.6 ç‰ˆæœ¬ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ·»åŠ ä¸€äº›ä¾èµ–ï¼Œæ¯”å¦‚ Spring Webã€MyBatisã€MySQLã€Lombok:

![](assets/XL8zbMgqhoevDlxdCV7cdiatnPg.png)

æ¥ä¸‹æ¥é…ç½®æˆ‘ä»¬éœ€è¦è¿æ¥çš„æ•°æ®åº“ï¼Œåœ¨springbootçš„é…ç½®æ–‡ä»¶application.ymlä¸­å¡«å†™:


```YAML
server:
  port: 8123
  servlet:
    context-path: /api
spring:
  application:
    name: yu-picture-backend
  # æ•°æ®åº“é…ç½®
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/yu_picture
    username: root
    password: 123456
```

é¡¹ç›®æ­£å¸¸å¯åŠ¨æˆåŠŸ

![](assets/LEB5b1uagoM8zMxcZNZccJq8njf.png)

## æ•´åˆä¾èµ–

æ¥ä¸‹æ¥æˆ‘ä»¬è¦æ•´åˆä¸€äº›å¼€å‘é¡¹ç›®å¸¸ç”¨çš„ä¾èµ–ã€‚

### MyBatis Plus æ•°æ®åº“æ“ä½œ

MyBatis Plusæ˜¯MyBatisçš„å¢å¼ºå·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ–å¼€å‘æµç¨‹ã€‚å®ƒæä¾›äº†å¼€ç®±å³ç”¨çš„CRUDæ–¹æ³•ã€åŠ¨æ€æŸ¥è¯¢æ„é€ å™¨ã€åˆ†é¡µæ’ä»¶å’Œä»£ç ç”Ÿæˆå™¨ç­‰åŠŸèƒ½ï¼Œå¤§å¹…å‡å°‘é‡å¤ä»£ç ï¼ŒåŒæ—¶ä¿æŒä¸MyBatisåŸç”ŸåŠŸèƒ½çš„å…¼å®¹æ€§ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡è°ƒç”¨baseMapper.selectById(id)ï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­çš„è®°å½•ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™SQLã€‚

å‚è€ƒå®˜æ–¹æ–‡æ¡£å¼•å…¥:https://baomidou.com/getting-started/#spring-boot2

åœ¨ Maven çš„ pom.xml ä¸­æ·»åŠ ä¾èµ–:


```XML
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.9</version>
</dependency>
```

**å¼•å…¥Mybatis-Plusåéœ€è¦å°†Mybatisçš„ä¾èµ–åˆ é™¤ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™**

åœ¨é¡¹ç›®ä¸­æ–°å»ºmapperåŒ…ï¼Œåç»­ç”¨äºå­˜æ”¾æ“ä½œæ•°æ®åº“çš„Mapperç±»ï¼Œç„¶ååœ¨é¡¹ç›®å¯åŠ¨ç±»ä¸­æ·»åŠ æ‰«æMapperçš„@Mapperscan æ³¨è§£:


```Java
@SpringBootApplication
@MapperScan("com.chengfu.yunpictureapi.mapper")
@EnableAspectJAutoProxy(exposeProxy = true)
public class YunPictureApiApplication {
    public static void main(String[] args) {
        SpringApplication.*run*(YunPictureApiApplication.class, args);
    }

}
```

åœ¨ applicationä¸­è¿½åŠ é…ç½®ï¼Œå¼€å¯æ—¥å¿—å’Œé€»è¾‘åˆ é™¤åŠŸèƒ½ï¼š


```YAML
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: false
    # ä»…åœ¨å¼€å‘ç¯å¢ƒå¼€å¯æ—¥å¿—
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-field: isDelete # å…¨å±€é€»è¾‘åˆ é™¤çš„å®ä½“å­—æ®µå
      logic-delete-value: 1 # é€»è¾‘å·²åˆ é™¤å€¼ï¼ˆé»˜è®¤ä¸º 1ï¼‰
      logic-not-delete-value: 0 # é€»è¾‘æœªåˆ é™¤å€¼ï¼ˆé»˜è®¤ä¸º 0ï¼‰
```

### Hutool å·¥å…·åº“

Hutool æ˜¯ä¸»æµçš„ Java å·¥å…·ç±»åº“ï¼Œé›†åˆäº†ä¸°å¯Œçš„å·¥å…·ç±»ï¼Œæ¶µç›–å­—ç¬¦ä¸²å¤„ç†ã€æ—¥æœŸæ“ä½œã€æ–‡ä»¶å¤„ç†ã€åŠ è§£å¯†ã€åå°„ã€æ­£åˆ™åŒ¹é…ç­‰å¸¸è§åŠŸèƒ½ã€‚å®ƒçš„è½»é‡åŒ–å’Œæ— ä¾µå…¥æ€§è®©å¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€Œä¸å¿…ç¼–å†™é‡å¤çš„å·¥å…·ä»£ç ã€‚ä¾‹å¦‚ï¼Œ`DateUtil.formatDate(new Date())` å¯ä»¥å¿«é€Ÿå°†å½“å‰æ—¥æœŸæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚

å‚è€ƒå®˜æ–¹æ–‡æ¡£å¼•å…¥ï¼šhttps://doc.hutool.cn/pages/index/#%F0%9F%8D%8A

åœ¨ Maven çš„ `pom.xml` ä¸­æ·»åŠ ä¾èµ–ï¼š


```XML
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.8.26</version>
</dependency>
```



### Knife4j æ¥å£æ–‡æ¡£

Knife4j æ˜¯åŸºäº Swagger æ¥å£æ–‡æ¡£çš„å¢å¼ºå·¥å…·ï¼Œæä¾›äº†æ›´åŠ å‹å¥½çš„ API æ–‡æ¡£ç•Œé¢å’ŒåŠŸèƒ½æ‰©å±•ï¼Œä¾‹å¦‚åŠ¨æ€å‚æ•°è°ƒè¯•ã€åˆ†ç»„æ–‡æ¡£ç­‰ã€‚å®ƒé€‚åˆç”¨äº Spring Boot é¡¹ç›®ä¸­ï¼Œèƒ½å¤Ÿé€šè¿‡ç®€å•çš„é…ç½®è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œè®©å¼€å‘è€…å’Œå‰ç«¯å¿«é€Ÿäº†è§£å’Œè°ƒè¯•æ¥å£ï¼Œæé«˜åä½œæ•ˆç‡ã€‚

å‚è€ƒå®˜æ–¹æ–‡æ¡£å¼•å…¥ï¼šhttps://doc.xiaominfo.com/docs/quick-start#spring-boot-2

ç”±äºä½¿ç”¨çš„æ˜¯ Spring Boot 2.xï¼Œæ³¨æ„è¦é€‰æ‹© OpenAPI 2 çš„ç‰ˆæœ¬ã€‚

åœ¨ Maven çš„ `pom.xml` ä¸­æ·»åŠ ä¾èµ–ï¼š


```XML
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi2-spring-boot-starter</artifactId>
    <version>4.4.8</version>
</dependency>
```

### å…¶ä»–ä¾èµ–

å¯ä»¥æŒ‰éœ€å¼•å…¥å…¶ä»–ä¾èµ–ï¼Œæ¯”å¦‚ AOP åˆ‡é¢ç¼–ç¨‹ï¼š


```XML
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-aop</artifactId>
</dependency>
```

ç»™å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ï¼ˆå¯é€‰ï¼‰ï¼š




```Java
@EnableAspectJAutoProxy(exposeProxy = true)
```

è§£é‡Šä¸€ä¸‹ `exposeProxy = true` çš„ä½œç”¨ï¼šé€šè¿‡ Spring AOP æä¾›å¯¹å½“å‰ä»£ç†å¯¹è±¡çš„è®¿é—®ï¼Œä½¿å¾—å¯ä»¥åœ¨ä¸šåŠ¡é€»è¾‘ä¸­è®¿é—®åˆ°å½“å‰çš„ä»£ç†å¯¹è±¡ã€‚ä½ å¯ä»¥åœ¨æ–¹æ³•æ‰§è¡Œæ—¶é€šè¿‡ `AopContext.currentProxy()` è·å–å½“å‰çš„ä»£ç†å¯¹è±¡ã€‚ 

è¿˜æœ‰æ›´å¤šçš„ä¾èµ–ï¼Œåç»­æˆ‘ä»¬éšç”¨éšè£…ã€‚

## é€šç”¨åŸºç¡€ä»£ç 

é€šç”¨åŸºç¡€ä»£ç æ˜¯æŒ‡ï¼šæ— è®ºåœ¨ä»»ä½•åç«¯é¡¹ç›®ä¸­ï¼Œéƒ½å¯ä»¥å¤ç”¨çš„ä»£ç ã€‚è¿™ç§ä»£ç ä¸€èˆ¬â€œä¸€è¾ˆå­åªç”¨å†™ä¸€æ¬¡â€ï¼Œäº†è§£ä½œç”¨ä¹‹åå¤åˆ¶ç²˜è´´å³å¯ï¼Œæ— éœ€è®°å¿†ã€‚

![](assets/XgBSbmasfoSV6oxdKZ0c5wSPnBh.png)

### è‡ªå®šä¹‰å¼‚å¸¸

è‡ªå®šä¹‰é”™è¯¯ç ï¼Œå¯¹é”™è¯¯è¿›è¡Œæ”¶æ•›ï¼Œä¾¿äºå‰ç«¯ç»Ÿä¸€å¤„ç†ã€‚  

ğŸ’¡ è¿™é‡Œæœ‰ 2 ä¸ªå°æŠ€å·§ï¼š  

1. è‡ªå®šä¹‰é”™è¯¯ç æ—¶ï¼Œå»ºè®®è·Ÿä¸»æµçš„é”™è¯¯ç ï¼ˆæ¯”å¦‚ HTTP é”™è¯¯ç ï¼‰çš„å«ä¹‰ä¿æŒä¸€è‡´ï¼Œæ¯”å¦‚â€œæœªç™»å½•â€å®šä¹‰ä¸º 40100ï¼Œå’Œ HTTP 401 é”™è¯¯ï¼ˆç”¨æˆ·éœ€è¦è¿›è¡Œèº«ä»½è®¤è¯ï¼‰ä¿æŒä¸€è‡´ï¼Œä¼šæ›´å®¹æ˜“ç†è§£ã€‚  
2. é”™è¯¯ç ä¸è¦å®Œå…¨è¿ç»­ï¼Œé¢„ç•™ä¸€äº›é—´éš”ï¼Œä¾¿äºåç»­æ‰©å±•ã€‚  

åœ¨ `exception` åŒ…ä¸‹æ–°å»ºé”™è¯¯ç æšä¸¾ç±»ï¼š 


```C++
@Getter
public enum ErrorCode {

    SUCCESS(0, "ok"),
    PARAMS_ERROR(40000, "è¯·æ±‚å‚æ•°é”™è¯¯"),
    NOT_LOGIN_ERROR(40100, "æœªç™»å½•"),
    NO_AUTH_ERROR(40101, "æ— æƒé™"),
    NOT_FOUND_ERROR(40400, "è¯·æ±‚æ•°æ®ä¸å­˜åœ¨"),
    FORBIDDEN_ERROR(40300, "ç¦æ­¢è®¿é—®"),
    SYSTEM_ERROR(50000, "ç³»ç»Ÿå†…éƒ¨å¼‚å¸¸"),
    OPERATION_ERROR(50001, "æ“ä½œå¤±è´¥");

    /**
     * çŠ¶æ€ç 
     */
    private final int code;

    /**
     * ä¿¡æ¯
     */
    private final String message;

    ErrorCode(int code, String message) {
        this.code = code;
        this.message = message;
    }

}
```

ä¸€èˆ¬ä¸å»ºè®®ç›´æ¥æŠ›å‡ºJavaå†…ç½®çš„RuntimeExceptionï¼Œè€Œæ˜¯è‡ªå®šä¹‰ä¸€ä¸ªä¸šåŠ¡å¼‚å¸¸ï¼Œå’Œå†…ç½®çš„å¼‚å¸¸ç±»åŒºåˆ†å¼€ï¼Œä¾¿äºå®šåˆ¶åŒ–è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼š


```Java
@Getter
public class BusinessException extends RuntimeException {

    /**
     * é”™è¯¯ç 
     */
    private final int code;

    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }

    public BusinessException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.code = errorCode.getCode();
    }

    public BusinessException(ErrorCode errorCode, String message) {
        super(message);
        this.code = errorCode.getCode();
    }

}
```

ä¸ºäº†æ›´æ–¹ä¾¿åœ°æ ¹æ®æƒ…å†µæŠ›å‡ºå¼‚å¸¸ï¼Œå¯ä»¥å°è£…ä¸€ä¸ªThrowUtilsï¼Œç±»ä¼¼æ–­è¨€ç±»ï¼Œç®€åŒ–æŠ›å¼‚å¸¸çš„ä»£ç ï¼š


```TypeScript
public class ThrowUtils {

    /**
     * æ¡ä»¶æˆç«‹åˆ™æŠ›å¼‚å¸¸
     *
     * @param condition        æ¡ä»¶
     * @param runtimeException å¼‚å¸¸
     */
    public static void throwIf(boolean condition, RuntimeException runtimeException) {
        if (condition) {
            throw runtimeException;
        }
    }

    /**
     * æ¡ä»¶æˆç«‹åˆ™æŠ›å¼‚å¸¸
     *
     * @param condition æ¡ä»¶
     * @param errorCode é”™è¯¯ç 
     */
    public static void throwIf(boolean condition, ErrorCode errorCode) {
        throwIf(condition, new BusinessException(errorCode));
    }

    /**
     * æ¡ä»¶æˆç«‹åˆ™æŠ›å¼‚å¸¸
     *
     * @param condition æ¡ä»¶
     * @param errorCode é”™è¯¯ç 
     * @param message   é”™è¯¯ä¿¡æ¯
     */
    public static void throwIf(boolean condition, ErrorCode errorCode, String message) {
        throwIf(condition, new BusinessException(errorCode, message));
    }
}
```

### å“åº”åŒ…è£…ç±»

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåç«¯æ¥å£éƒ½è¦è¿”å›è°ƒç”¨ç ã€æ•°æ®ã€è°ƒç”¨ä¿¡æ¯ç­‰ï¼Œå‰ç«¯å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥å°è£…ç»Ÿä¸€çš„å“åº”ç»“æœç±»ï¼Œä¾¿äºå‰ç«¯ç»Ÿä¸€è·å–è¿™äº›ä¿¡æ¯ã€‚

é€šç”¨å“åº”ç±»ï¼š


```Java
@Data
public class BaseResponse<T> implements Serializable {

    private int code;

    private T data;

    private String message;

    public BaseResponse(int code, T data, String message) {
        this.code = code;
        this.data = data;
        this.message = message;
    }

    public BaseResponse(int code, T data) {
        this(code, data, "");
    }

    public BaseResponse(ErrorCode errorCode) {
        this(errorCode.getCode(), null, errorCode.getMessage());
    }
}
```

ä½†ä¹‹åæ¯æ¬¡æ¥å£è¿”å›å€¼æ—¶ï¼Œéƒ½è¦æ‰‹åŠ¨newä¸€ä¸ªBaseResponseå¯¹è±¡å¹¶ä¼ å…¥å‚æ•°ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªå·¥å…·ç±»ï¼Œæä¾›æˆåŠŸè°ƒç”¨å’Œå¤±è´¥è°ƒç”¨çš„æ–¹æ³•ï¼Œæ”¯æŒçµæ´»åœ°ä¼ å‚ï¼Œç®€åŒ–è°ƒç”¨ã€‚


```TypeScript
public class ResultUtils {

    /**
     * æˆåŠŸ
     *
     * @param data æ•°æ®
     * @param <T>  æ•°æ®ç±»å‹
     * @return å“åº”
     */
    public static <T> BaseResponse<T> success(T data) {
        return new BaseResponse<>(0, data, "ok");
    }

    /**
     * å¤±è´¥
     *
     * @param errorCode é”™è¯¯ç 
     * @return å“åº”
     */
    public static BaseResponse<?> error(ErrorCode errorCode) {
        return new BaseResponse<>(errorCode);
    }

    /**
     * å¤±è´¥
     *
     * @param code    é”™è¯¯ç 
     * @param message é”™è¯¯ä¿¡æ¯
     * @return å“åº”
     */
    public static BaseResponse<?> error(int code, String message) {
        return new BaseResponse<>(code, null, message);
    }

    /**
     * å¤±è´¥
     *
     * @param errorCode é”™è¯¯ç 
     * @return å“åº”
     */
    public static BaseResponse<?> error(ErrorCode errorCode, String message) {
        return new BaseResponse<>(errorCode.getCode(), null, message);
    }
}
```

### å…¨å±€å¼‚å¸¸å¤„ç†å™¨

ä¸ºäº†é˜²æ­¢æ„æ–™ä¹‹å¤–çš„å¼‚å¸¸ï¼Œåˆ©ç”¨AOPåˆ‡é¢å…¨å±€å¯¹ä¸šåŠ¡å¼‚å¸¸å’ŒRuntimeExceptionè¿›è¡Œæ•è·:


```TypeScript
@RestControllerAdvice
@Slf4j
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public BaseResponse<?> businessExceptionHandler(BusinessException e) {
        log.error("BusinessException", e);
        return ResultUtils.error(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(RuntimeException.class)
    public BaseResponse<?> runtimeExceptionHandler(RuntimeException e) {
        log.error("RuntimeException", e);
        return ResultUtils.error(ErrorCode.SYSTEM_ERROR, "ç³»ç»Ÿé”™è¯¯");
    }
}
```

### è¯·æ±‚åŒ…è£…ç±»

å¯¹äºâ€œåˆ†é¡µâ€ã€â€œåˆ é™¤æŸæ¡æ•°æ®â€è¿™ç±»é€šç”¨çš„è¯·æ±‚ï¼Œå¯ä»¥å°è£…ç»Ÿä¸€çš„è¯·æ±‚åŒ…è£…ç±»ï¼Œç”¨äºæ¥å—å‰ç«¯ä¼ æ¥çš„å‚æ•°ï¼Œä¹‹åç›¸åŒå‚æ•°çš„è¯·æ±‚å°±ä¸ç”¨ä¸“é—¨å†æ–°å»ºä¸€ä¸ªç±»äº†ã€‚

åˆ†é¡µè¯·æ±‚åŒ…è£…ç±»ï¼Œæ¥å—é¡µå·ã€é¡µé¢å¤§å°ã€æ’åºå­—æ®µã€æ’åºé¡ºåºå‚æ•°ï¼š


```Java
@Data
public class PageRequest {

    /**
     * å½“å‰é¡µå·
     */
    private int current = 1;

    /**
     * é¡µé¢å¤§å°
     */
    private int pageSize = 10;

    /**
     * æ’åºå­—æ®µ
     */
    private String sortField;

    /**
     * æ’åºé¡ºåºï¼ˆé»˜è®¤é™åºï¼‰
     */
    private String sortOrder = "descend";
}
```

åˆ é™¤è¯·æ±‚åŒ…è£…ç±»ï¼Œæ¥å—è¦åˆ é™¤æ•°æ®çš„idä½œä¸ºå‚æ•°ï¼š


```Java
@Data
public class DeleteRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    private static final long serialVersionUID = 1L;
}
```

### å…¨å±€è·¨åŸŸé…ç½®

è·¨åŸŸæ˜¯æŒ‡æµè§ˆå™¨è®¿é—®çš„URLï¼ˆå‰ç«¯åœ°å€ï¼‰å’Œåç«¯æ¥å£åœ°å€çš„åŸŸåï¼ˆæˆ–ç«¯å£å·ï¼‰ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œæµè§ˆå™¨ä¸ºäº†å®‰å…¨ï¼Œé»˜è®¤ç¦æ­¢è·¨åŸŸè¯·æ±‚è®¿é—®ã€‚

ä¸ºäº†å¼€å‘è°ƒè¯•æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…¨å±€è·¨åŸŸé…ç½®ï¼Œè®©æ•´ä¸ªé¡¹ç›®æ‰€æœ‰çš„æ¥å£æ”¯æŒè·¨åŸŸï¼Œè§£å†³è·¨åŸŸæŠ¥é”™ã€‚

æ–°å»ºconfigåŒ…ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„é…ç½®ç›¸å…³ä»£ç ã€‚å…¨å±€è·¨åŸŸé…ç½®ä»£ç å¦‚ä¸‹ï¼š


```TypeScript
@Configuration
public class CorsConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        // è¦†ç›–æ‰€æœ‰è¯·æ±‚
        registry.addMapping("/**")
                // å…è®¸å‘é€ Cookie
                .allowCredentials(true)
                // æ”¾è¡Œå“ªäº›åŸŸåï¼ˆå¿…é¡»ç”¨ patternsï¼Œå¦åˆ™ * ä¼šå’Œ allowCredentials å†²çªï¼‰
                .allowedOriginPatterns("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .exposedHeaders("*");
    }
}
```

# å‰ç«¯é¡¹ç›®åˆå§‹åŒ–

## ç¯å¢ƒå‡†å¤‡

å‰ç«¯Node.jsç‰ˆæœ¬å¿…é¡»>=18.12ï¼Œè¿™é‡Œæ¨è20ç‰ˆæœ¬ã€‚åœ¨å®˜ç½‘å®‰è£…å¥½Nodeåä¼šè‡ªåŠ¨å®‰è£…NPMå‰ç«¯åŒ…ç®¡ç†å™¨ã€‚

## æ–°å»ºé¡¹ç›®

ä½¿ç”¨Vueå®˜æ–¹æ¨èçš„è„šæ‰‹æ¶create-vueå¿«é€Ÿåˆ›å»ºVue3çš„é¡¹ç›®ï¼šhttps://cn.vuejs.org/guide/quick-start.html

Vue æä¾›äº†åœ¨çº¿ç¼–ç æµ‹è¯•ï¼Œå¯ä»¥é€šè¿‡ Playground æ¥å­¦ä¹ Vue:https://play.vuejs.org/

åœ¨ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤ï¼š


```Java
npm create vue@latest
```

NPMä¼šè‡ªåŠ¨å®‰è£… create-vue å·¥å…·:

![](assets/IrQcbRHE7ooA86xDdR2cUI11nAe.png)

æ¥ä¸‹æ¥æŒ‰ç…§å¦‚ä¸‹é€‰é¡¹åˆ›å»ºé¡¹ç›®ï¼Œè„šæ‰‹æ¶ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å®‰è£…VueRouterè·¯ç”±ã€Piniaå…¨å±€çŠ¶æ€ç®¡ç†ç­‰å®ç”¨ç±»åº“

![](assets/FP19bLYyaopsRWxmmSkcME2SnkB.png)

ç„¶åç”¨WebStormæ‰“å¼€é¡¹ç›®ï¼Œå…ˆåœ¨ç»ˆç«¯æ‰§è¡Œnpm installå®‰è£…ä¾èµ–ï¼Œç„¶åæ‰§è¡Œnpmrundevèƒ½è®¿é—®ç½‘é¡µå°±æˆåŠŸäº†ã€‚

## å‰ç«¯å·¥ç¨‹åŒ–

è„šæ‰‹æ¶å·²ç»å¸®æˆ‘ä»¬æ•´åˆäº†Prettierä»£ç ç¾åŒ–ã€ESLintè‡ªåŠ¨æ ¡éªŒã€TypeScriptç±»å‹æ ¡éªŒï¼Œæ— éœ€å†è‡ªè¡Œæ•´åˆã€‚

ä½†æ˜¯éœ€è¦åœ¨webstormé‡Œå¼€å¯ä»£ç ç¾åŒ–æ’ä»¶ï¼š

![](assets/HJq7blgIIoxg40xQzjLcEqtsnje.png)

åœ¨vueæ–‡ä»¶ä¸­æ‰§è¡Œæ ¼å¼åŒ–å¿«æ·é”®ï¼Œä¸æŠ¥é”™ï¼Œè¡¨ç¤ºé…ç½®å·¥ç¨‹åŒ–æˆåŠŸã€‚

ä¿®æ”¹ eslint.config.jsã€.prettierrc.jsonã€tsconfig.jsonæ–‡ä»¶å¯ä»¥æ”¹å˜æ ¡éªŒè§„åˆ™ã€‚

å¦‚æœä¸ä½¿ç”¨è„šæ‰‹æ¶ï¼Œå°±éœ€è¦è‡ªå·±æ•´åˆè¿™äº›å·¥å…·ï¼š

* ä»£ç è§„èŒƒ:https://eslint.org/docs/latest/use/getting-started
* ä»£ç ç¾åŒ–:https://prettier.io/docs/en/install.html
* ç›´æ¥æ•´åˆ:https://github.com/prettier/eslint-plugin-prettier#recommended-configuration(åŒ…æ‹¬äº†https://github.com/prettier/eslint-config-prettier#installation)

å¯¹äºå‰ç«¯æ–°æ‰‹æ¥è¯´ï¼Œä½ ä¸éœ€è¦æ·±å…¥äº†è§£è¿™äº›ï¼Œçº¯å½“å·¥å…·å»ä½¿ç”¨å³å¯ï¼Œåº”è¯¥å°½å¿«ä¸Šæ‰‹é¡¹ç›®ã€‚

## å¼•å…¥ç»„ä»¶åº“

å¼•å…¥ant-designç»„ä»¶åº“ï¼Œå¯ä»¥æ ¹æ®[å®˜æ–¹æ–‡æ¡£](https://antdv.com/docs/vue/getting-started-cn)å¿«é€Ÿä¸Šæ‰‹

![](assets/GcDobPnbBo8bJ0xqNmEcF6XUnhb.png)

å®‰è£…ç»„ä»¶åº“


```Java
npm i --save ant-design-vue@4.x
```

æ›´æ”¹å…¨å±€å…¥å£æ–‡ä»¶main.tsï¼Œå…¨å±€æ³¨å†Œç»„ä»¶


```JavaScript
import App from './App.vue'
import router from './router'
import Antd from "ant-design-vue";
import "ant-design-vue/dist/reset.css";

const app = createApp(App)
app.use(Antd);
app.use(createPinia())
app.use(router)

app.mount('#app')
```

## å¼€å‘è§„èŒƒ

å»ºè®®éµå¾ªVue3çš„ç»„åˆå¼API(Composition AP)ï¼Œè€Œä¸æ˜¯é€‰é¡¹å¼APIï¼Œå¼€å‘æ›´è‡ªç”±é«˜æ•ˆä¸€äº›ã€‚

ç¤ºä¾‹ä»£ç 


```XML
<template>
  <div id="xxPage">

  </div>
</template>

<script setup lang="ts">

</script>

<style scoped>
#xxPage {
}

</style>
```

## é¡µé¢åŸºæœ¬ä¿¡æ¯

å¯ä»¥ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `index.html` æ–‡ä»¶ï¼Œæ¥å®šä¹‰é¡µé¢çš„å…ƒä¿¡æ¯ï¼Œæ¯”å¦‚ä¿®æ”¹æ ‡é¢˜ï¼š


```HTML
<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä¿®æ”¹åçš„æ ‡é¢˜</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
```

è¿˜å¯ä»¥æ›¿æ¢ `public` ç›®å½•ä¸‹é»˜è®¤çš„ `favicon` å›¾æ ‡ä¸ºè‡ªå·±çš„ï¼Œæœ‰å¾ˆå¤šç°æˆçš„ç½‘ç«™å¯ä»¥åˆ¶ä½œ `favicon` å›¾æ ‡ã€‚  

## å…¨å±€é€šç”¨å¸ƒå±€

### åŸºç¡€å¸ƒå±€ç»“æ„

åœ¨ `layouts` ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªå¸ƒå±€ `BasicLayout.vue` ï¼Œåœ¨ `App.vue` å…¨å±€å…¥å£æ–‡ä»¶ä¸­å¼•å…¥ã€‚  

`App.vue` ä»£ç å¦‚ä¸‹ï¼š


```TypeScript
<template>
  <div id="app">
    <BasicLayout />
  </div>
</template>

<script setup lang="ts">
import BasicLayout from '@/layouts/BasicLayout.vue';
</script>
```

å¯ä»¥ä¿®æ”¹é¡µé¢å†…çš„é»˜è®¤æ ·å¼ï¼Œå¹¶ä¸”ç§»é™¤ `main.ts` ä¸­é»˜è®¤å¼•å…¥çš„ `main.css` ï¼Œé˜²æ­¢æ ·å¼æ±¡æŸ“ï¼š  


```CSS
<style>
#app {
  /* æ ·å¼å†…å®¹ */
}
</style>
```

ä½¿ç”¨ `Ant Design Vue` ç»„ä»¶åº“çš„ `Layout` ç»„ä»¶ï¼Œå…ˆæŠŠã€ä¸Š+ä¸­ã€‘å¸ƒå±€æ­å»ºå¥½ï¼Œç„¶åå†å¡«å……å†…å®¹ï¼š  

![](assets/Y54tbcj5sooaQvxPyroc8F5CnRc.png)

ä»¥ä¸‹æ˜¯æŒ‰æŠ€æœ¯æ–‡æ¡£é£æ ¼æ•´ç†çš„ Markdown å†…å®¹ï¼Œä¿ç•™ä»£ç å—ã€æ ‡é¢˜å±‚çº§å’Œé€»è¾‘ç»“æ„ï¼š

ä»£ç å¦‚ä¸‹ï¼š


```PlainText
<template>
  <div id="BasicLayout">
    <a-layout style="min-height: 100vh">
      <a-layout-header>Header</a-layout-header>
      <a-layout-content>Content</a-layout-content>
      <a-layout-footer>Footer</a-layout-footer>
    </a-layout>
  </div>
</template>

<script setup lang="ts"></script>
```

**æ ·å¼**ï¼š  


```TypeScript
<style scoped>
.BasicLayout {
}
</style>
```

### å…¨å±€åº•éƒ¨æ 

é€šå¸¸ç”¨äºå±•ç¤ºç‰ˆæƒä¿¡æ¯ï¼š  


```TypeScript
<a-layout-footer class="footer">
  <a href="https://github.com/chengfushi" target="_blank"> Github By ChengFu </a>
</a-layout-footer>
```

**æ ·å¼**ï¼š  


```TypeScript
<style scoped>
.BasicLayout .footer {
  background: #effeff;
  padding: 16px;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  text-align: center;
}
</style>
```

### åŠ¨æ€æ›¿æ¢å†…å®¹

é¡¹ç›®ä½¿ç”¨äº† Vue Router è·¯ç”±åº“ï¼Œå¯ä»¥åœ¨ `router/index.ts` é…ç½®è·¯ç”±ï¼Œèƒ½æ ¹æ®ä¸åŒçš„è®¿é—®åœ°å€æ˜ å°„åˆ°ä¸åŒçš„æ–‡ä»¶å¹¶åŠ è½½æ¸²æŸ“ã€‚  

ä¿®æ”¹ `BasicLayout` å†…éƒ¨å†…å®¹çš„ä»£ç å¦‚ä¸‹ï¼š  


```TypeScript
<a-layout-content class="content">
  <RouterView />
</a-layout-content>
```

**ä¿®æ”¹æ ·å¼**ï¼šè¦å’Œåº•éƒ¨æ ä¿æŒä¸€å®šçš„å¤–è¾¹è·ï¼Œå¦åˆ™å†…å®¹ä¼šè¢«é®ä½ï¼š  


```TypeScript
<style scoped>
.BasicLayout .content {
  background: linear-gradient(to right, #effeff, #fff);
  margin-bottom: 28px; 
  padding: 20px;
}
</style>
```

ä»¥ä¸‹æ˜¯æ•´åˆå¹¶è½¬æ¢ä¸º Markdown æ ¼å¼çš„å†…å®¹ï¼ŒæŒ‰æŠ€æœ¯æ–‡æ¡£é€»è¾‘æ¢³ç†ï¼Œä¿ç•™ä»£ç ã€æ­¥éª¤å’Œæ•ˆæœè¯´æ˜ï¼š  

### å…¨å±€é¡¶éƒ¨æ 

ç”±äºé¡¹ç›®çš„å¼€å‘ç›¸å¯¹å¤æ‚ï¼Œå¯ä»¥åŸºäº **Ant Design** çš„èœå•ç»„ä»¶ï¼Œå°è£… `GlobalHeader` å…¨å±€é¡¶éƒ¨æ ç»„ä»¶ï¼Œç»„ä»¶ç»Ÿä¸€æ”¾åœ¨ `components` ç›®å½•ä¸­ã€‚  

å…ˆç›´æ¥å¤åˆ¶ç°æˆçš„ç»„ä»¶ç¤ºä¾‹ä»£ç åˆ° `GlobalHeader.vue` ä¸­å³å¯ã€‚  

ä»£ç æ¼”ç¤º


```HTML
<template>
  <a-menu
    v-model:selectedKeys="current"
    mode="horizontal"
    :items="items"
  />
</template>

<script setup>
import { ref } from 'vue';
import { Menu } from 'ant-design-vue';
const { SubMenu } = Menu;

const current = ref<string[]>(['1']);
const items: MenuItems[] = [
  {
    key: '1',
    label: 'Navigation One',
  },
  {
    key: '2',
    label: 'Navigation Two',
  },
  {
    key: '3',
    label: 'Navigation Three - Submenu',
    children: [
      {
        key: '3-1',
        label: 'Option 1',
      },
      {
        key: '3-2',
        label: 'Option 2',
      },
    ],
  },
  {
    key: '4',
    label: 'Navigation Four - Link',
    href: 'https://www.antdv.com',
  },
];
</script>
```

åœ¨åŸºç¡€å¸ƒå±€ä¸­å¼•å…¥é¡¶éƒ¨æ ç»„ä»¶


```PlainText
<template>
  <a-layout-header class="header">
    <GlobalHeader />
  </a-layout-header>
</template>

<script setup lang="ts">
import GlobalHeader from '@/components/GlobalHeader.vue';
</script>
```

ä¿®æ”¹é¡¶éƒ¨ Header æ ·å¼

æ¸…é™¤ä¸€äº›é»˜è®¤æ ·å¼ï¼ˆæ¯”å¦‚èƒŒæ™¯è‰²ï¼‰ï¼Œæ ·å¼ä»£ç å¦‚ä¸‹ï¼š  


```CSS
.BasicLayout .header {
  padding: 0;
  margin-bottom: 8px;
  color: unset;
  background: unset;
}
```

å®Œå–„ GlobalHeader ç»„ä»¶ï¼Œè¡¥å……æ›´å¤šå†…å®¹

1. ç»™èœå•å¤–åŒ…è£¹ä¸€å±‚å…ƒç´ ï¼Œç”¨äºæ•´ä½“æ§åˆ¶æ ·å¼


```PlainText
<template>
  <div class="global-header">
    <a-menu
      v-model:selectedKeys="current"
      mode="horizontal"
      :items="items"
    />
  </div>
</template>
```

1. æ ¹æ®éœ€æ±‚ä¿®æ”¹èœå•é…ç½®ï¼ˆ`key` ä¸ºè¦è·³è½¬çš„ URL è·¯å¾„ï¼‰


```PlainText
<script setup lang="ts">
import { ref } from 'vue';
import { Menu } from 'ant-design-vue';
import { HomeOutlined, UserOutlined } from '@ant-design/icons-vue';
import router from '@/router'; 

const current = ref<string[]>([router.currentRoute.value.name as string]);
const items: Menu.MenuItem[] = [
  {
    key: 'home',
    icon: () => <HomeOutlined />,
    label: 'ä¸»é¡µ',
    title: 'ä¸»é¡µ',
  },
  {
    key: 'about',
    icon: () => <UserOutlined />,
    label: 'å…³äº',
    title: 'å…³äº',
  },
  {
    key: 'others',
    label: (
      <a href="https://www.codefather.cn" target="_blank">
        ç¼–ç¨‹å¯¼èˆª
      </a>
    ),
    title: 'ç¼–ç¨‹å¯¼èˆª',
  },
];
</script>
```

1. å®Œå–„å…¨å±€é¡¶éƒ¨æ ï¼Œå·¦ä¾§è¡¥å……ç½‘ç«™å›¾æ ‡å’Œæ ‡é¢˜

* æŠŠ `logo.png` æ”¾åˆ° `src/assets` ç›®å½•ä¸‹ï¼Œæ›¿æ¢æ‰åŸæœ¬çš„é»˜è®¤ Logoã€‚  
* ä¿®æ”¹ `GlobalHeader` ä»£ç ï¼Œè¡¥å…… HTML ç»“æ„ï¼š  


```PlainText
<template>
  <div class="title-bar">
    <div class="logo" to="/">
      <img class="logo-img" src="@/assets/logo.png" alt="Logo" />
    </div>
    <div class="title">zæ™ºå›¾äº‘é“¾</div>
  </div>
  <a-menu
    v-model:selectedKeys="current"
    mode="horizontal"
    :items="items"
  />
</template>
```

å…¶ä¸­ï¼Œ`RouterLink` ç»„ä»¶çš„ä½œç”¨æ˜¯ä¿æŒè·¯ç”±è·³è½¬ï¼ˆä¸åˆ·æ–°é¡µé¢ï¼‰ã€‚  

è¡¥å…… CSS æ ·å¼


```CSS
<style scoped>
.title-bar {
  display: flex;
  align-items: center;
}

.title {
  color: black;
  font-size: 20px;
  margin-left: 10px;
}

.logo-img {
  height: 40px;
}
</style>
```

1. å®Œå–„å…¨å±€å¯¼èˆªæ ï¼Œå³ä¾§å±•ç¤ºå½“å‰ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼ˆä¸´æ—¶ç”¨ç™»å½•æŒ‰é’®æ›¿ä»£ï¼‰


```PlainText
<template>
  <div class="user-login-status">
    <a-button type="primary" href="/user/login">ç™»å½•</a-button>
  </div>
</template>
```

1. ä¼˜åŒ–å¯¼èˆªæ å¸ƒå±€ï¼Œé‡‡ç”¨æ …æ ¼ç»„ä»¶çš„è‡ªé€‚åº”å¸ƒå±€ï¼ˆå·¦ä¸­å³ç»“æ„ï¼šå·¦ä¾§æœ‰ Logo æ ‡é¢˜ã€ä¸­é—´æ”¾èœå•ã€å³ä¾§æ”¾ç™»å½•æŒ‰é’®ï¼‰


```PlainText
<template>
  <a-row>
    <a-col flex="200px">
      <div class="title-bar">
        <img class="logo-img" src="@/assets/logo.png" alt="Logo" />
        <div class="title">æ™ºå›¾äº‘é“¾</div>
      </div>
    </a-col>
    <a-col flex="auto">
      <a-menu
        v-model:selectedKeys="current"
        mode="horizontal"
        :items="items"
      />
    </a-col>
    <a-col flex="120px">
      <div class="user-login-status">
        <a-button type="primary" href="/user/login">ç™»å½•</a-button>
      </div>
    </a-col>
  </a-row>
</template>
```

æ•ˆæœè¯´æ˜

å¯ä»¥é€šè¿‡ç¼©å°æµè§ˆå™¨çª—å£ï¼Œè§‚å¯Ÿå¯¼èˆªæ¡çš„å“åº”å¼å˜åŒ–ï¼ˆå¦‚ï¼šå°å±å¹•ä¸‹å¸ƒå±€è‡ªåŠ¨è°ƒæ•´ ï¼‰ã€‚  

ä»¥ä¸Šæ˜¯å®Œæ•´çš„å…¨å±€é¡¶éƒ¨æ ç»„ä»¶å°è£…å’Œå¸ƒå±€ä¼˜åŒ–æµç¨‹ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ ·å¼ã€èœå•é…ç½®å’Œäº¤äº’é€»è¾‘~



## è·¯ç”±

ç›®æ ‡ï¼šç‚¹å‡»èœå•é¡¹ç›®åï¼Œå¯ä»¥è·³è½¬åˆ°å¯¹åº”çš„é¡µé¢ï¼›å¹¶ä¸”æ–°é¡µé¢åŠ è½½åï¼Œå¯¹åº”çš„èœå•è‡ªåŠ¨é«˜äº®ã€‚

### ä¿®æ”¹è·¯ç”±é…ç½®

ä¿®æ”¹`router/index.ts`æ–‡ä»¶çš„`routes`é…ç½®ï¼Œå®šä¹‰æˆ‘ä»¬éœ€è¦çš„é¡µé¢è·¯ç”±ï¼Œæ¯ä¸ª`path`å¯¹åº”ä¸€ä¸ª`component`ï¼ˆè¦åŠ è½½çš„ç»„ä»¶ï¼‰ï¼š


```TypeScript
routes: [
  {
    path: '/',
    name: 'home',
    component: HomeView,
  },
  {
    path: '/about',
    // route level code-splitting
    // this generates a separate chunk (About.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import('../views/AboutView.vue'),
  },
];
```

è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œä¼šå‘ç°`component`æ”¯æŒç›´æ¥å†™å…¥ç»„ä»¶ã€æˆ–è€…ä½¿ç”¨`import`æŒ‰éœ€åŠ è½½ç»„ä»¶ï¼ŒæŒ‰éœ€åŠ è½½æ˜¯ä¸€ç§ä¼˜åŒ–é¦–æ¬¡æ‰“å¼€ç«™ç‚¹åŠ è½½è€—æ—¶çš„æ–¹å¼ã€‚

### è·¯ç”±è·³è½¬

ç»™`GlobalHeader`çš„èœå•ç»„ä»¶ç»‘å®šè·³è½¬äº‹ä»¶ï¼š


```TypeScript
import { useRouter } from 'vue-router';
const router = useRouter();

// ç‚¹å‡»è·³è½¬äº‹ä»¶
const defaultClick = ({ key }: { key: string }) => {
  router.push({
    path: key,
  });
};
```

**ä¿®æ”¹ HTML æ¨¡æ¿ï¼Œç»‘å®šäº‹ä»¶**


```PlainText
<a-menu
  v-model:selectedKeys="current"
  mode="horizontal"
  @click="defaultClick"
>
  <a-menu-item key="/">Home</a-menu-item>
  <a-menu-item key="/about">About</a-menu-item>
</a-menu>
```

### é«˜äº®åŒæ­¥

åˆ·æ–°é¡µé¢åï¼Œä½ ä¼šå‘ç°å½“å‰çš„èœå•å¹¶æ²¡æœ‰é«˜äº®ï¼Œæ‰€ä»¥éœ€è¦åŒæ­¥è·¯ç”±çš„æ›´æ–°åˆ°èœå•çš„é«˜äº®ã€‚

**åŒæ­¥é«˜äº®åŸç†**ï¼š

1. ç‚¹å‡»èœå•æ—¶ï¼ŒAnt Design ç»„ä»¶å·²ç»é€šè¿‡`v-model`ç»‘å®š`current`å˜é‡å®ç°äº†é«˜äº®ã€‚
2. åˆ·æ–°é¡µé¢æ—¶ï¼Œéœ€è¦è·å–åˆ°å½“å‰ URL çš„è·¯å¾„ï¼Œç„¶åä¿®æ”¹`current`å˜é‡çš„å€¼ï¼Œä»è€Œå®ç°åŒæ­¥ã€‚

ä½¿ç”¨ Vue Router çš„`afterEach`è·¯ç”±é’©å­å®ç°ï¼Œæ¯æ¬¡æ”¹å˜è·¯ç”±æˆ–åˆ·æ–°é¡µé¢æ—¶éƒ½ä¼šè‡ªåŠ¨æ›´æ–°`current`çš„å€¼ï¼Œä»è€Œå®ç°é«˜äº®ï¼š


```TypeScript
const router = useRouter();
const current = ref<string[]>([]);

// ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œæ›´æ–°å½“å‰é€‰ä¸­çš„èœå•
router.afterEach((to, from, next) => {
  current.value = [to.path];
});
```

## è¯·æ±‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‰ç«¯ä¸»è¦è´Ÿè´£é¡µé¢å±•ç¤ºå’ŒåŠ¨æ•ˆäº¤äº’ï¼Œå°½é‡é¿å…å†™å¤æ‚çš„é€»è¾‘ï¼›å½“éœ€è¦è·å–æ•°æ®æ—¶ï¼Œé€šå¸¸å‘åç«¯æä¾›çš„æ¥å£å‘é€è¯·æ±‚ï¼Œå†æ ¹æ®æ‰§è¡Œæ“ä½œï¼ˆæ¯”å¦‚ä¿å­˜æ•°æ®ï¼‰å¹¶å“åº”æ•°æ®çš„æ¸²æŸ“ã€‚

å‰ç«¯å¦‚ä½•å‘åç«¯å‘é€è¯·æ±‚å‘¢ï¼Ÿæœ€ä¼ ç»Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨ AJAX æŠ€æœ¯ï¼Œä½†å…¶ä»£ç æœ‰äº›å¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å°è£…åº“ï¼Œæ¥ç®€åŒ–å‘é€è¯·æ±‚çš„ä»£ç ï¼Œæ¯”å¦‚ä¸»æµçš„è¯·æ±‚å·¥å…·åº“ Axiosã€‚

### è¯·æ±‚å·¥å…·åº“

å®‰è£…è¯·æ±‚å·¥å…·ç±» Axiosï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://axios-http.com/docs/intro


```Shell
npm install axios
```

### å…¨å±€è‡ªå®šä¹‰è¯·æ±‚

éœ€è¦è‡ªå®šä¹‰å…¨å±€è¯·æ±‚çš„æ‹¦æˆªå™¨ï¼Œå‚è€ƒ Axios å®˜æ–¹æ–‡æ¡£ï¼Œç¼–å†™è¯·æ±‚é…ç½®æ–‡ä»¶ `request.ts`ï¼ŒåŒ…å«å…¨å±€æ¥å£è¯·æ±‚åœ°å€ã€è¶…æ—¶æ—¶é—´ã€è‡ªå®šä¹‰è¯·æ±‚å¤´æºå¸¦å‚æ•°ç­‰ã€‚

**å“åº”æ‹¦æˆªå™¨çš„åº”ç”¨åœºæ™¯**ï¼šæˆ‘ä»¬éœ€è¦å¯¹æ¥å£çš„**é€šç”¨å“åº”** è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚ä» response ä¸­å–å‡º dataï¼›æˆ–è€…æ ¹æ® code å»é›†ä¸­å¤„ç†é”™è¯¯ï¼Œè¿™æ ·ä¸ç”¨åœ¨æ¯ä¸ªæ¥å£è¯·æ±‚ä¸­éƒ½å†™ç›¸åŒçš„é€»è¾‘ã€‚

æ¯”å¦‚å¯ä»¥åœ¨å…¨å±€å“åº”æ‹¦æˆªå™¨ä¸­ï¼Œè¯»å–ç»“æœé‡Œçš„ dataï¼Œå¹¶æ ¡éªŒ code æ˜¯å¦åˆæ³•ï¼Œå¦‚æœæ˜¯æœªç™»å½•çŠ¶æ€ï¼Œåˆ™è‡ªåŠ¨è·³è½¬ã€‚

**ç¤ºä¾‹ä»£ç **ï¼ˆå…¶ä¸­ `withCredentials: true` ä¸€å®šè¦å†™ï¼Œå¦åˆ™æ— æ³•åœ¨å‘é€è¯·æ±‚æ—¶æºå¸¦ Cookieï¼Œå°±æ— æ³•å®Œæˆç™»å½•ï¼‰ï¼š


```TypeScript
import axios from 'axios'
import { message } from 'ant-design-vue'

// åˆ›å»º Axios å®ä¾‹
const myAxios = axios.create({
  baseURL: 'http://localhost:8822',
  timeout: 60000,
  withCredentials: true,
})

// å…¨å±€è¯·æ±‚æ‹¦æˆªå™¨
myAxios.interceptors.request.use(
  function (config) {
    // Do something before request is sent
    return config
  },
  function (error) {
    // Do something with request error
    return Promise.reject(error)
  },
)

// å…¨å±€å“åº”æ‹¦æˆªå™¨
myAxios.interceptors.response.use(
  function (response) {
    const { data } = response
    // æœªç™»å½•æ—¶ï¼Œåç«¯è¿”å› 40300 å¹¶ä¸”ç”¨æˆ·æ“ä½œä¸æ˜¯è®¿é—®ç”¨æˆ·ç™»å½•é¡µé¢ï¼Œåˆ™è·³è½¬ç™»å½•é¡µé¢
    if (data.code === 40300) {
      if (
        response.request.responseURL.includes('user/getUserLogin') &&
        window.location.pathname !== '/user/login'
      ) {
        message.warning('è¯·å…ˆç™»å½•')
        window.location.href = `/user/login?redirect=${window.location.href}`
      }
    }
    return response
  },
  function (error) {
    // Any status codes that falls outside the range of 2xx cause this function to trigger
    // Do something with response error
    return Promise.reject(error)
  },
)

export default myAxios
```

### è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚ä»£ç 

å¦‚æœé‡‡ç”¨ä¼ ç»Ÿå¼€å‘æ–¹å¼ï¼Œé’ˆå¯¹æ¯ä¸ªè¯·æ±‚éƒ½è¦å•ç‹¬ç¼–å†™ä»£ç ï¼Œå¾ˆéº»çƒ¦ã€‚

æ¨èä½¿ç”¨ **OpenAPI** å·¥å…·ï¼Œç›´æ¥è‡ªåŠ¨ç”Ÿæˆæ¥å£ï¼šhttps://www.npmjs.com/package/@umijs/openapi

**æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„æ­¥éª¤ï¼Œå…ˆå®‰è£…**ï¼š


```Shell
npm i --save-dev @umijs/openapi
```

**åœ¨ â€œé¡¹ç›®æ ¹ç›®å½•â€ æ–°å»º**`**openapi.config.ts**` ï¼Œ**æ ¹æ®è‡ªå·±çš„éœ€è¦å®šåˆ¶ç”Ÿæˆçš„ä»£ç ** ï¼š


```TypeScript
import { generateService } from '@umijs/openapi'

generateService({
  requestLibPath: "import request from '@/request'",
  schemaPath: 'http://localhost:8822/api/v2/api-docs',
  serversPath: './src',
})
```

**æ³¨æ„**ï¼šè¦å°† `schemaPath` æ”¹ä¸ºè‡ªå·±åç«¯æœåŠ¡æä¾›çš„ Swagger æ¥å£æ–‡æ¡£çš„åœ°å€ã€‚

æ‰§è¡Œ OpenAPI çš„è„šæœ¬ï¼ˆå¦‚ `openapi: "openapi:generate openapi.config.ts"`ï¼‰ï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚ä»£ç ï¼Œè¿˜åŒ…æ‹¬ TypeScript ç±»å‹ã€‚

ä»¥åæ¯æ¬¡åç«¯æ¥å£å˜æ›´æ—¶ï¼Œåªè¦é‡æ–°ç”Ÿæˆä¸€éå°±å¥½ï¼Œéå¸¸æ–¹ä¾¿~ 

## å…¨å±€çŠ¶æ€ç®¡ç†

ä»€ä¹ˆæ˜¯å…¨å±€çŠ¶æ€ç®¡ç†ï¼Ÿ

ç­”ï¼šæ‰€æœ‰é¡µé¢å…¨å±€å…±äº«çš„å˜é‡ï¼Œè€Œä¸æ˜¯å±€é™åœ¨æŸä¸€ä¸ªé¡µé¢ä¸­ã€‚

é€‚åˆä½œä¸ºå…¨å±€çŠ¶æ€çš„æ•°æ®ï¼šå·²ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆæ¯ä¸ªé¡µé¢å‡ ä¹éƒ½è¦ç”¨ï¼‰ 

Pinia æ˜¯ä¸€ä¸ªä¸»æµçš„çŠ¶æ€ç®¡ç†å™¨ï¼Œç›¸æ¯”äº Vuex æ¥è¯´ä½¿ç”¨æ›´ç®€å•ï¼Œå¯å‚è€ƒ [æ–‡æ¡£](https://pinia.vuejs.org/introduction.html) è¿›è¡Œå¼•å…¥ã€‚

### å¼•å…¥ Pinia

æ­¤é¡¹ç›®ç”± `create-vue` è„šæ‰‹æ¶å·²ç»å¸®æˆ‘ä»¬æ•´åˆäº† Piniaï¼Œæ— éœ€æ‰‹åŠ¨å¼•å…¥ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚

### å®šä¹‰çŠ¶æ€

åœ¨ `src/stores` ç›®å½•ä¸‹å®šä¹‰ `user` æ¨¡å—ï¼Œå®šä¹‰äº†ç”¨æˆ·çš„å­˜å‚¨ã€ç»„ç»‡è·å–ã€ä¿®æ”¹é€»è¾‘ï¼š


```TypeScript
import { defineStore } from 'pinia';
import { ref } from 'vue';

export const useLoginUserStore = defineStore('loginUser', () => {
  const loginUser = ref<any>({
    username: 'æœªç™»å½•',
  });

  async function fetchLoginUser() {
    // todo åé¢æ¼”ç¤ºè·å–æ¥å£åï¼Œä¿®æ”¹æ•°æ®
    // const res = await getCurrentUser();
    // if (res.data.code === 0 && res.data.data) {
    //   loginUser.value = res.data.data;
    // }
  }

  function setLoginUser(newLoginUser: any) {
    loginUser.value = newLoginUser;
  }

  return { loginUser, setLoginUser, fetchLoginUser };
});
```

### ä½¿ç”¨çŠ¶æ€

å¯ä»¥ç›´æ¥ä½¿ç”¨ `store` ä¸­å¯¼å‡ºçš„çŠ¶æ€å˜é‡å’Œå‡½æ•°ã€‚

åœ¨é¦–æ¬¡è¿›å…¥é¡¹ç›®æ—¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šå…ˆè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œä¿®æ”¹ `App.vue`ï¼Œç¼–å†™è¿œç¨‹è·å–æ•°æ®ä»£ç ï¼š


```TypeScript
const loginUserStore = useLoginUserStore()
loginUserStore.fetchLoginUser()
```

åœ¨ä»»æ„é¡µé¢ä¸­éƒ½å¯ä»¥ä½¿ç”¨çŠ¶æ€ï¼Œæ¯”å¦‚ `GlobalHeader` å…¨å±€é¡¶éƒ¨ç»„ä»¶ä¸­ç›´æ¥å±•ç¤ºï¼š


```TypeScript
{{ JSON.stringify(loginUserStore.loginUser) }}
```

ä¿®æ”¹å…¨å±€é¡¶éƒ¨ç»„ä»¶ï¼Œåœ¨å³ä¾§å±•ç¤ºç™»å½•çŠ¶æ€ï¼š


```PlainText
<div class="user-info-stats">
  <div v-if="loginUserStore.loginUser.id">
    {{ loginUserStore.loginUser.username }} æ¬¢è¿æ‚¨ï¼
  </div>
  <div v-else>
    <a-button type="primary" href="/user/login">ç™»å½•</a-button>
  </div>
</div>
```

## é¡µé¢å¼€å‘æµç¨‹

æˆ‘ä»¬é€šè¿‡å¼€å‘ä¸€ä¸ªç®€æ˜“çš„ç¤ºä¾‹é¡µé¢ï¼Œæ¥äº†è§£é¡µé¢å¼€å‘çš„æµç¨‹ã€‚

1. æ–°å»ºsrc/pagesç›®å½•ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„é¡µé¢æ–‡ä»¶ã€‚

ç„¶ååœ¨pagesç›®å½•ä¸‹æ–°å»ºé¡µé¢æ–‡ä»¶ï¼Œå°†æ‰€æœ‰é¡µé¢æŒ‰ç…§urlå±‚çº§è¿›è¡Œåˆ›å»ºï¼Œå¹¶ä¸”é¡µé¢åç§°å°½é‡åšåˆ°â€œè§åçŸ¥æ„â€ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

![](assets/MHmHbIDEoocQUUxV5BgcclQDnbd.png)

å…¶ä¸­ï¼Œ/user/login åœ°å€å°±å¯¹åº”äº†UserLoginPage

æ­¤å¤„æˆ‘ä»¬æ–°å»º HomePage.vue å³å¯ã€‚

1. æ¯æ¬¡æ–°å»ºé¡µé¢æ—¶ï¼Œéœ€è¦åœ¨router/index.tsä¸­é…ç½®è·¯ç”±ï¼Œæ¯”å¦‚æ¬¢è¿é¡µçš„è·¯ç”±ä¸ºï¼š


```Java
const routes: Array<RouteRecordRaw> = [
  {
    path: "/",
    name: "home",
    component: HomeView,
  },
  ...
]
```

ç„¶ååœ¨è·¯ç”±æ–‡ä»¶ä¸­ï¼Œå¼•å…¥é¡µé¢ HomePage:


```JavaScript
import HomePage from "@/pages/HomePage.vue";

const routes: Array<RouteRecordRaw> = [
  {
    path: "/",
    name: "home",
    component: HomePage,
  },
  ...
]
```

ä»»æ„ä¿®æ”¹ç•Œé¢ä»£ç 


```XML
<template>
  <div id="homePage">
    <h1>æ¬¢è¿æ¥åˆ°æ™ºå›¾è¿é“¾äº‘å›¾åº“ï¼Œé¡¹ç›®åº”ç”¨åœºæ™¯å¹¿æ³›ï¼Œå¯ä½œä¸ºè¡¨æƒ…åŒ…ç½‘ç«™ã€è®¾è®¡ç´ æç½‘ç«™ã€å£çº¸ç½‘ç«™ã€ä¸ªäººäº‘ç›˜ã€ä¼ä¸šæ´»åŠ¨ç›¸å†Œç­‰</h1>
  </div>
</template>
<script setup lang="ts"></script>
<style scoped></style>
```

æ•´ä½“æ•ˆæœ

![](assets/Xry9b4sHdoBc6VxPLfkcFeaUnKf.png)

---




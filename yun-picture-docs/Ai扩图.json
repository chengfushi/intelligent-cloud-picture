{"nodes":[{"block_id":"OiQxdajVToxizbxzvYpcIQuin8e","block_type":1,"children":["DDLodio1LoHfynxRyI5cBwmgnMc","KVHhdetf0oIGSMxoGA3cdOflnMc","Hwv5dqABBomK7yxvf7lcFRWEnnd","WwiWdXXMloUqWtxrz82c43CmnKg","CmJJd06ztoLHJJxkSjqcNwuvnlh","JwuLdy5zToAPZjxytJZcg0Xcn3f","HMwxdO5I5owS0fxq3Sscm5dTnVA","PyAed280IoX7qAxDKA6clPlPnbb","TwY0d0AnEowZsjxc2FecjmvHn1g","Dd1NdVprmogdtJxADARcX0ujnef","DDuZdYbc3oer9TxluIccyHrenCe","RvSJdV7fmoXj43x8CNGcJD9EnSd","BL2idHyVCo1mr6xEZKjc62srnIh","FMWtdrpYQoqOGgxM9CocwX8Cnnc","CHF7dELdBo9V4hxLcAUc6eEPnxh","WL0odk59noJYqfxTmzlcxhKEnHg","LGmadxpORoFDgnxOJwjc33xinjC","JiimdcjSNov1HXxpJlpcsE1XnCc","CVSRdYsJ6o5znbxZVSscXik4nIg","V61VdUmX2oXT7GxOBgic6kvunFg","XsWEdWp1do4A4xxO8m6cXWuJnNc","Cp3hdgSpuoGNGnxSuuOcVSRQnRf","SVUZdrOsSoSQ7uxnkG6cTAluntd","LPztd0LLUo5IhAxpGPEcah1Pnfe","W3e9dQJIIo2lvMxE2aec8VIunSc","GDEhdvX5oot7fuxBOl5cZZL2nEf","MEksdvBhKoVF8bx3BUScfgzinpg","CspmdCpgmovE85xTE1xcPfkJnWe","YBK6d3rEkoar5zxMPyYc9GA5nof","BBlBdHKiboTehtxbsUvcoHcenYf","EeI5dwfIMo0pGBxx9Koc1vUunjg","C8UgdZxo9oWpJkxurCicv91znqh","ErvudjtUzoO8NZxpcB6cIbjNnUd","B5oKdNfn7oIgOKxGU3WcEo6Wnug","A9pJdEdJzoIcZDxQpkNcJgLynic","IqtFdkRRrov8A8xMUKocSKVQnug","ZPb3dPdnAoZAWVxVm0vcKlLCnph","OOosdWHyTo9rBExaypOcuHWBnee","WhlfdvFPNoRaVIxsaphcZxDmnGh","SfPDdSZdZooyqoxMdG5cFGWfnGe","AUeKdpRDCo9TvIxBe9jcpy40nYf","B9qTdsBhUoi0qTxN4QLchFsNn5f","H18ddoREXo3fkbxvLYec9wDhnmG","OcwBdnwYEor7wAx6Px9cGdTOnuh","P7f9d23mjouK9AxINwKcVDF2nAc","NttYdvUpjovp7FxAaErc6h0nnWh","GemVdMd5aoqwsoxlZJVcPNXVnAh","ShGRdLeOyo0OJUxT7jpcO5Q1nQb","OZuadXRo1oJTUnx9NwTcunxVnld","Xk3EdYZJxoWO6YxdZD4c3md0nzd","KtMxdgnO6oHDi4xAHT9c6Uvhnid","Wv7fdolDWoNLtjxpCFPcB3PKnjf","DcjydIJHLoKUjLxwZ08cQv9enae","X3gjd4kV9oNxRCxBHz9cwNqEnDf","YrWkdDIFroDldHxTuq0cjLMcndg","NBamdFewEoGtZYxnPPIch38gnwb","VXV7dRqSjopCrExm2pkcQW8Wnmd","SSjrdLq6EoBmnqxc3hUci5AVnpg","TTjVdo6Dfo0RWOxxwf7cii27nQf","OVYpdasuFoJN6Sxr5DhcBX6tnMc","JpTvdHQ5qoqqmpxH7f5cFCqYnye","XSFXdQpLjojRRexpYGgcPEdLnXf","NfU4duOY4oH69nxaUM7cHjN8nwg","QLftd7Cjxo0D4NxltuAcEv4dnOb","RIyRddgsNov9FNxgShScnXchnld","LjhqdAkGAol1Pfx9rmEcTErZnMb","Mg0LdGdeyojhBMxDfQ3cckWVnpb","WZK7d27FUoBomPx7ocPcFSLynGb","Fu5Fdy6gnoun5Ex8xkzcIDksnjd","BERcdtnu5omwCpxpMEyc2V6knGI","JIb6dbBEYo0txExYmKccTLeAnSh","G5efdsiIWoYMu3xWxw8cCbqanCb","VP4mdfdZYozvkTxuuZgcYpNmnYb","TEk3dwoPuoT4lpxnrOXc5ZgknRc","DP1hdoXuooGnBMxoOEzc1NPKn5c","DrYndPUV6ocuuAxxtbOcktY4nzb","MzYgdegDVoB0GqxWI1icyljDnxg","QfFcdzMLzodl8jxP6YIczXr8nZf","UtETd8QnDoO28jxdQQ6cKS7snfc","BJ5hdVu6PoWVRuxYnXVc5N29nie","Gbajdu9UnoQCZCxywr2coN84nUg","RI3tdFBiaoN9MXx4659cJ1gEnqg","XktNdofYko5GbNxtdE2cEehHn6d","D5cZdlYDooNdBBx3JdvcQgH7n4g","B8oDdeXHSo1KI7xMVIRcd1qSn3b","Szo7dEdAIodqNcxfbbIcccCinMe","TTa8dQaN9o2AtRxZgwzcpkNsnVf","URUCd4Zl7o0tCxxW0ZTcRnkWnBO","Uag9dWG6eoGXwVx3PVlcFVFinDb","DcOMduw2KomW0FxR08scCjqinoh","BkiqdSxUbo3V5VxePEXcp1ZPnzg","Yp9SdJU2EoECl6x9BetcHhdHnae","EObtdPdc2ofKaIxmFgScMOJ0nGc","A0krdEcHFoMLwDxTQa7creZ9neg","BLM3dqDvTomdzvx6dYncwAmBnQh","RWV5dowhSoo0u7xnPKZcXry5nS1","WX3cdGCoboKPsExD5HjcBLiWn7b","VYEWdJsFKoPs4ux5JvVcYR7bnHc","HJoHd2dRdoNzyZxgW4bcrEEbnJc","X0GJdXZI5oZ9uMx20cEciAnanZt","C6eYdePl3oT2q8xqWbFc7UsTnzf","E6OxdYeTsouWIrxkUD0cSINmnPf","LbLXdMDKzogeJPxTScIc1eFlnld","Aw3Sd0be3oTZVUx8pBCcGqlwnRb","I8g2dKBKhoeCmBxyXmscnvHBnGf"],"page":{"elements":[{"text_run":{"content":"Ai扩图","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1}},"parent_id":""},{"block_id":"DDLodio1LoHfynxRyI5cBwmgnMc","block_type":3,"heading1":{"elements":[{"text_run":{"content":"需求分析","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"KVHhdetf0oIGSMxoGA3cdOflnMc","block_type":5,"heading3":{"elements":[{"text_run":{"content":"需求分析","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Hwv5dqABBomK7yxvf7lcFRWEnnd","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"随着 AI؜ 的高速发展，AI 几乎可以应用到任何传统业务中，增强应用的功能，带给用户更好的体验。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WwiWdXXMloUqWtxrz82c43CmnKg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"对于图库网站؜来说，AI 也有非常多的应用空间，比如可以利用 AI 绘图大模型来编辑图片，实现扩图、擦除补全、图配文、去水印等功能。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CmJJd06ztoLHJJxkSjqcNwuvnlh","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"以 AI 扩图功؜能为例，让我们来学习如何在项目中快速接入 AI 绘图大模型。用户可以选择一张已上传的图片，通过 AI 编辑得到新的图片，并根据情况自行选择是否保存。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JwuLdy5zToAPZjxytJZcg0Xcn3f","block_type":3,"heading1":{"elements":[{"text_run":{"content":"方案设计","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"HMwxdO5I5owS0fxq3Sscm5dTnVA","block_type":4,"heading2":{"elements":[{"text_run":{"content":"Ai绘图大模型选择","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"PyAed280IoX7qAxDKA6clPlPnbb","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"AI 绘图؜大模型我们自己是搞不来的，可以选择一个市面上支持 AI 绘图的大模型。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"TwY0d0AnEowZsjxc2FecjmvHn1g","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"选择 AI ؜大模型时，我们最关注的应该是生成效果、生成速度还有价格了吧？当然，对我们学习来说，最关注的还是价格，毕竟绘画大模型的费用不低。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Dd1NdVprmogdtJxADARcX0ujnef","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"国外比较知名的就是 Midjourney，不过不仅开发对接麻烦，价格也比较贵。国内的 AI 绘图大模型比较推荐 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"阿里云百炼","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fclick.aliyun.com%2Fm%2F1000400273%2F"},"strikethrough":false,"underline":false}}},{"text_run":{"content":" ，它是一站式的大模型开发及应用构建平台，可以通过简单的界面操作，在 5 分钟内开发出一款大模型应用，并在线体验效果。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DDuZdYbc3oer9TxluIccyHrenCe","block_type":27,"image":{"align":2,"height":1316,"token":"NZlmbuAVyokyXkxdQsLcq6hfnxc","width":2519},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"RvSJdV7fmoXj43x8CNGcJD9EnSd","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"创建好应用؜后，利用官方提供的 API 或 SDK，直接通过几行代码，就能在项目中使用大模型应用：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BL2idHyVCo1mr6xEZKjc62srnIh","block_type":27,"image":{"align":2,"height":1361,"token":"EcJJb0bEvoM8eTx7MzmcBgY5ngc","width":2461},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"FMWtdrpYQoqOGgxM9CocwX8Cnnc","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"通过阅读文档发现，是支持ai扩图的，免费额度只有500张，不过用于学习是够用了","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CHF7dELdBo9V4hxLcAUc6eEPnxh","block_type":27,"image":{"align":2,"height":1341,"token":"ROZrbUvgWowxSTx3cIKcuVhenDc","width":2551},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"WL0odk59noJYqfxTmzlcxhKEnHg","block_type":4,"heading2":{"elements":[{"text_run":{"content":"调用方式","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"LGmadxpORoFDgnxOJwjc33xinjC","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"通过阅读 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"AI 图像扩展的官方文档","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fclick.aliyun.com%2Fm%2F1000400274%2F"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"，我们发现，API 只支持异步方式调用。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JiimdcjSNov1HXxpJlpcsE1XnCc","block_type":27,"image":{"align":2,"height":1161,"token":"MGr2bYcqUolixCxqFUfclLw8nPh","width":1756},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"CVSRdYsJ6o5znbxZVSscXik4nIg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"这是因为 AI 绘画任务计؜算量大且耗时长，同步调用会导致服务器线程长时间被单个任务占用，限制了并发处理能力，增加了超时和系统崩溃的风险。通过异步调用，服务器可以将任务放入队列中，合理调度资源，避免阻塞主线程，从而更高效地服务多个用户请求，提升整体系统的稳定性和可扩展性。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"V61VdUmX2oXT7GxOBgic6kvunFg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"由于 AI 接口؜已经选择了异步调用，所以我们作为要调用 AI 接口的客户端，要使用轮询的方式来检查任务状态是否为 “已完成”，如果完成了，才可以获取到生成的图片。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XsWEdWp1do4A4xxO8m6cXWuJnNc","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"那么是前端轮询还是后端轮询呢？","text_element_style":{"bold":true,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Cp3hdgSpuoGNGnxSuuOcVSRQnRf","block_type":13,"ordered":{"elements":[{"text_run":{"content":"前端轮询","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"SVUZdrOsSoSQ7uxnkG6cTAluntd","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"前端调用后؜端提交任务后得到任务 ID，然后通过定时器轮询请求查询任务状态接口，直到任务完成或失败。示例代码：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LPztd0LLUo5IhAxpGPEcah1Pnfe","block_type":14,"code":{"elements":[{"text_run":{"content":"// 提交任务\nasync function submitTask() {\n  const response = await fetch('/api/createTask', { method: 'POST' });\n  const { taskId } = await response.json();\n  checkTaskStatus(taskId);\n}\n\n// 调用\nsubmitTask();\n\n// 检查任务状态\nasync function checkTaskStatus(taskId) {\n  const intervalId = setInterval(async () => {\n    const response = await fetch(`/api/taskStatus?taskId=${taskId}`);\n    const { status, result } = await response.json();\n\n    if (status === 'success') {\n      console.log('Task completed:', result);\n      clearInterval(intervalId); // 停止轮询\n    } else if (status === 'failed') {\n      console.error('Task failed');\n      clearInterval(intervalId); // 停止轮询\n    }\n  }, 2000); // 每隔 2 秒轮询\n}\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":30,"wrap":true}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"W3e9dQJIIo2lvMxE2aec8VIunSc","block_type":13,"ordered":{"elements":[{"text_run":{"content":"后端轮询","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"GDEhdvX5oot7fuxBOl5cZZL2nEf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"后端通过循؜环或定时任务检测任务状态，接口保持阻塞，直到任务完成或失败，直接返回结果给前端。示例代码：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MEksdvBhKoVF8bx3BUScfgzinpg","block_type":14,"code":{"elements":[{"text_run":{"content":"@RestController\npublic class TaskController {\n\n    @PostMapping(\"/createTask\")\n    public String createTask() {\n        String taskId = taskService.submitTask();\n        return taskId;\n    }\n\n    @GetMapping(\"/waitForTask\")\n    public ResponseEntity<String> waitForTask(@RequestParam String taskId) {\n        while (true) {\n            String status = taskService.checkTaskStatus(taskId);\n\n            if (\"success\".equals(status)) {\n                return ResponseEntity.ok(\"Task completed\");\n            } else if (\"failed\".equals(status)) {\n                return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(\"Task failed\");\n            }\n\n            try {\n                Thread.sleep(2000); // 等待 2 秒后重试\n            } catch (InterruptedException e) {\n                return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(\"Error occurred\");\n            }\n        }\n    }\n}\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":true}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"CspmdCpgmovE85xTE1xcPfkJnWe","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"显然，后端轮询容易因为任务阻塞导致资源耗尽，所以通常推荐 前端轮询。除非有明确的需求要求时，才考虑后端轮询，比如任务结果需实时返回且对网络请求数敏感。（或者学习时不想写前端）","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YBK6d3rEkoar5zxMPyYc9GA5nof","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"此处我们也选择前端轮询方案实现。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BBlBdHKiboTehtxbsUvcoHcenYf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"💡 从这个方案设计؜中，我们也能感受到，如果你同时了解前端和后端，可以结合二者设计出更合理的方案，而不是把所有的 “重担” 都交给前端或者后端一方。所以企业中开需求评审会或者讨论方案时，前后端需要紧密协作。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EeI5dwfIMo0pGBxx9Koc1vUunjg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"下面进入开发。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"C8UgdZxo9oWpJkxurCicv91znqh","block_type":3,"heading1":{"elements":[{"text_run":{"content":"后端开发","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"ErvudjtUzoO8NZxpcB6cIbjNnUd","block_type":4,"heading2":{"elements":[{"text_run":{"content":"获取Ai扩图API","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"B5oKdNfn7oIgOKxGU3WcEo6Wnug","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"首先开发业务依赖的基础能力，也就是 AI 扩图 API。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"A9pJdEdJzoIcZDxQpkNcJgLynic","block_type":13,"ordered":{"elements":[{"text_run":{"content":"需要先进入 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"阿里云百炼控制台","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fclick.aliyun.com%2Fm%2F1000400275%2F"},"strikethrough":false,"underline":false}}},{"text_run":{"content":" 开通服务：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"IqtFdkRRrov8A8xMUKocSKVQnug","block_type":27,"image":{"align":2,"height":671,"token":"GCypbTJMPoqwcQxw9gWcs9pWnRd","width":2211},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"ZPb3dPdnAoZAWVxVm0vcKlLCnph","block_type":13,"ordered":{"elements":[{"text_run":{"content":"开通之后，我们要在控制台获取 API Key，可 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"参考文档","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fclick.aliyun.com%2Fm%2F1000400408%2F"},"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"OOosdWHyTo9rBExaypOcuHWBnee","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"能够在控制؜台查看到 API Key，注意，API Key 一定不要对外泄露！","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WhlfdvFPNoRaVIxsaphcZxDmnGh","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"通过阅读文档发现，百炼支持通过 SDK 或 HTTP 调用。虽然官方写的支持 Java SDK，但 AI 扩图功能中对 SDK 的介绍非常少，此处考虑到兼容性，我们还是 使用 HTTP 调用。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"SfPDdSZdZooyqoxMdG5cFGWfnGe","block_type":13,"ordered":{"elements":[{"text_run":{"content":"在配置文件中填写获取到的 apiKey：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"AUeKdpRDCo9TvIxBe9jcpy40nYf","block_type":14,"code":{"elements":[{"text_run":{"content":"# 阿里云 AI 配置\naliYunAi:\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    apiKey: xxxx","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":67,"wrap":true}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"B9qTdsBhUoi0qTxN4QLchFsNn5f","block_type":13,"ordered":{"elements":[{"text_run":{"content":"新建数据模型类","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"H18ddoREXo3fkbxvLYec9wDhnmG","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"api","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 包下新建 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"aliyunai","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 包，存放阿里云 AI 相关代码。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OcwBdnwYEor7wAx6Px9cGdTOnuh","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"aliyunai.model","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 包下新建数据模型类，可以让 AI 根据官方文档中的请求响应信息自动生成，无需自己手动编写。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"P7f9d23mjouK9AxINwKcVDF2nAc","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"由于每个 ؜AI 图片处理操作的请求响应都有一些区别，所以单独给 AI 扩图功能编写具体的请求响应类。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"NttYdvUpjovp7FxAaErc6h0nnWh","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"创建扩图任务请求类：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"GemVdMd5aoqwsoxlZJVcPNXVnAh","block_type":14,"code":{"elements":[{"text_run":{"content":"@Datapublic class CreateOutPaintingTaskRequest implements Serializable {\n\n    /**\n     * 模型，例如 \"image-out-painting\"\n     */private String model = \"image-out-painting\";\n\n    /**\n     * 输入图像信息\n     */private Input input;\n\n    /**\n     * 图像处理参数\n     */private Parameters parameters;\n\n    @Datapublic static class Input {\n        /**\n         * 必选，图像 URL\n         */@Alias(\"image_url\")private String imageUrl;\n    }\n\n    @Datapublic static class Parameters implements Serializable {\n        /**\n         * 可选，逆时针旋转角度，默认值 0，取值范围 [0, 359]\n         */private Integer angle;\n\n        /**\n         * 可选，输出图像的宽高比，默认空字符串，不设置宽高比\n         * 可选值：[\"\", \"1:1\", \"3:4\", \"4:3\", \"9:16\", \"16:9\"]\n         */@Alias(\"output_ratio\")private String outputRatio;\n\n        /**\n         * 可选，图像居中，在水平方向上按比例扩展，默认值 1.0，范围 [1.0, 3.0]\n         */@Alias(\"x_scale\")@JsonProperty(\"xScale\")private Float xScale;\n\n        /**\n         * 可选，图像居中，在垂直方向上按比例扩展，默认值 1.0，范围 [1.0, 3.0]\n         */@Alias(\"y_scale\")@JsonProperty(\"yScale\")private Float yScale;\n\n        /**\n         * 可选，在图像上方添加像素，默认值 0\n         */@Alias(\"top_offset\")private Integer topOffset;\n\n        /**\n         * 可选，在图像下方添加像素，默认值 0\n         */@Alias(\"bottom_offset\")private Integer bottomOffset;\n\n        /**\n         * 可选，在图像左侧添加像素，默认值 0\n         */@Alias(\"left_offset\")private Integer leftOffset;\n\n        /**\n         * 可选，在图像右侧添加像素，默认值 0\n         */@Alias(\"right_offset\")private Integer rightOffset;\n\n        /**\n         * 可选，开启图像最佳质量模式，默认值 false\n         * 若为 true，耗时会成倍增加\n         */@Alias(\"best_quality\")private Boolean bestQuality;\n\n        /**\n         * 可选，限制模型生成的图像文件大小，默认值 true\n         * - 单边长度 <= 10000：输出图像文件大小限制为 5MB 以下\n         * - 单边长度 > 10000：输出图像文件大小限制为 10MB 以下\n         */@Alias(\"limit_image_size\")private Boolean limitImageSize;\n\n        /**\n         * 可选，添加 \"Generated by AI\" 水印，默认值 true\n         */@Alias(\"add_watermark\")private Boolean addWatermark = false;\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"ShGRdLeOyo0OJUxT7jpcO5Q1nQb","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"注意，上述代码中，某些字段打上了 Hutool 工具类的 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"@Alias","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 注解，这个注解仅对 Hutool 的 JSON 转换生效，对 SpringMVC 的 JSON 转换没有任何影响。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OZuadXRo1oJTUnx9NwTcunxVnld","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"💡 这里有一个巨坑的地方！经过测试发现，前端如果传递参数名 xScale，是无法赋值给 xScale 字段的；但是传递参数名 xscale，就可以赋值。这是因为 SpringMVC 对于第二个字母是大写的参数无法映射（和参数类别无关），","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"参考博客","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fblog.csdn.net%2FJokerHH%2Farticle%2Fdetails%2F88729590"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Xk3EdYZJxoWO6YxdZD4c3md0nzd","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"解决方案是，给这些字段增加 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"@JsonProperty","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 注解：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KtMxdgnO6oHDi4xAHT9c6Uvhnid","block_type":14,"code":{"elements":[{"text_run":{"content":"/**\n * 可选，图像居中，在水平方向上按比例扩展，默认值 1.0，范围 [1.0, 3.0]\n */@Alias(\"x_scale\")\n @JsonProperty(\"xScale\")\n private Float xScale;\n\n/**\n * 可选，图像居中，在垂直方向上按比例扩展，默认值 1.0，范围 [1.0, 3.0]\n */\n @Alias(\"y_scale\")\n @JsonProperty(\"yScale\")\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" private Float yScale;","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Wv7fdolDWoNLtjxpCFPcB3PKnjf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"为什么 SpringMVC 要这样设计呢？这是因为 Jackson 在处理字段名与 JSON 属性名映射时，会依赖 Java 的 标准命名规范 和 反射 API。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DcjydIJHLoKUjLxwZ08cQv9enae","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"举个例子，根据 JavaBean 的规范，属性名称与其访问器方法（getter 和 setter）之间的映射规则是：如果属性名以小写字母开头，第二个字母是大写（如 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"eMail","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"），规范仍认为属性名称是 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"eMail","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"，而访问器方法应为 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"geteMail()","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 和 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"seteMail()","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"。但 Jackson 会尝试推断属性名为 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"email","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"（因为 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"eMail","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 不常见），从而导致 JSON 中 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"eMail","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 或 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"email","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 可能无法正确映射。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"X3gjd4kV9oNxRCxBHz9cwNqEnDf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"创建扩图任务响应类：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YrWkdDIFroDldHxTuq0cjLMcndg","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data\n@NoArgsConstructor\n@AllArgsConstructor\npublic class CreateOutPaintingTaskResponse {\n\n    private Output output;\n\n    /**\n     * 表示任务的输出信息\n     */@Datapublic static class Output {\n\n        /**\n         * 任务 ID\n         */private String taskId;\n\n        /**\n         * 任务状态\n         * <ul>\n         *     <li>PENDING：排队中</li>\n         *     <li>RUNNING：处理中</li>\n         *     <li>SUSPENDED：挂起</li>\n         *     <li>SUCCEEDED：执行成功</li>\n         *     <li>FAILED：执行失败</li>\n         *     <li>UNKNOWN：任务不存在或状态未知</li>\n         * </ul>\n         */private String taskStatus;\n    }\n\n    /**\n     * 接口错误码。\n     * <p>接口成功请求不会返回该参数。</p>\n     */private String code;\n\n    /**\n     * 接口错误信息。\n     * <p>接口成功请求不会返回该参数。</p>\n     */private String message;\n\n    /**\n     * 请求唯一标识。\n     * <p>可用于请求明细溯源和问题排查。</p>\n     */private String requestId;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"NBamdFewEoGtZYxnPPIch38gnwb","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"查询任务响应类：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VXV7dRqSjopCrExm2pkcQW8Wnmd","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data\n@NoArgsConstructor\n@AllArgsConstructorpublic \nclass GetOutPaintingTaskResponse {\n\n    /**\n     * 请求唯一标识\n     */private String requestId;\n\n    /**\n     * 输出信息\n     */private Output output;\n\n    /**\n     * 表示任务的输出信息\n     */@Datapublic static class Output {\n\n        /**\n         * 任务 ID\n         */private String taskId;\n\n        /**\n         * 任务状态\n         * <ul>\n         *     <li>PENDING：排队中</li>\n         *     <li>RUNNING：处理中</li>\n         *     <li>SUSPENDED：挂起</li>\n         *     <li>SUCCEEDED：执行成功</li>\n         *     <li>FAILED：执行失败</li>\n         *     <li>UNKNOWN：任务不存在或状态未知</li>\n         * </ul>\n         */private String taskStatus;\n\n        /**\n         * 提交时间\n         * 格式：YYYY-MM-DD HH:mm:ss.SSS\n         */private String submitTime;\n\n        /**\n         * 调度时间\n         * 格式：YYYY-MM-DD HH:mm:ss.SSS\n         */private String scheduledTime;\n\n        /**\n         * 结束时间\n         * 格式：YYYY-MM-DD HH:mm:ss.SSS\n         */private String endTime;\n\n        /**\n         * 输出图像的 URL\n         */private String outputImageUrl;\n\n        /**\n         * 接口错误码\n         * <p>接口成功请求不会返回该参数</p>\n         */private String code;\n\n        /**\n         * 接口错误信息\n         * <p>接口成功请求不会返回该参数</p>\n         */private String message;\n\n        /**\n         * 任务指标信息\n         */private TaskMetrics taskMetrics;\n    }\n\n    /**\n     * 表示任务的统计信息\n     */@Datapublic static class TaskMetrics {\n\n        /**\n         * 总任务数\n         */private Integer total;\n\n        /**\n         * 成功任务数\n         */private Integer succeeded;\n\n        /**\n         * 失败任务数\n         */private Integer failed;\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"SSjrdLq6EoBmnqxc3hUci5AVnpg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"5）开发 ؜API 调用类，通过 Hutool 的 HTTP 请求工具类来调用阿里云百炼的 API：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"TTjVdo6Dfo0RWOxxwf7cii27nQf","block_type":14,"code":{"elements":[{"text_run":{"content":"@Slf4j@Componentpublic class AliYunAiApi {\n    // 读取配置文件@Value(\"${aliYunAi.apiKey}\")private String apiKey;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    // 创建任务地址public static final String CREATE_OUT_PAINTING_TASK_URL = \"","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"https://dashscope.aliyuncs.com/api/v1/services/aigc/image2image/out-painting","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\";\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    // 查询任务状态public static final String GET_OUT_PAINTING_TASK_URL = \"","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"https://dashscope.aliyuncs.com/api/v1/tasks/","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"%s\";\n\n    /**\n     * 创建任务\n     *\n     * @param createOutPaintingTaskRequest\n     * @return\n     */public CreateOutPaintingTaskResponse createOutPaintingTask(CreateOutPaintingTaskRequest createOutPaintingTaskRequest) {\n        if (createOutPaintingTaskRequest == null) {\n            throw new BusinessException(ErrorCode.OPERATION_ERROR, \"扩图参数为空\");\n        }\n        // 发送请求HttpRequest httpRequest = HttpRequest.post(CREATE_OUT_PAINTING_TASK_URL)\n                .header(Header.AUTHORIZATION, \"Bearer \" + apiKey)\n                // 必须开启异步处理，设置为enable。\n                .header(\"X-DashScope-Async\", \"enable\")\n                .header(Header.CONTENT_TYPE, ContentType.JSON.getValue())\n                .body(JSONUtil.toJsonStr(createOutPaintingTaskRequest));\n        try (HttpResponse httpResponse = httpRequest.execute()) {\n            if (!httpResponse.isOk()) {\n                log.error(\"请求异常：{}\", httpResponse.body());\n                throw new BusinessException(ErrorCode.OPERATION_ERROR, \"AI 扩图失败\");\n            }\n            CreateOutPaintingTaskResponse response = JSONUtil.toBean(httpResponse.body(), CreateOutPaintingTaskResponse.class);\n            String errorCode = response.getCode();\n            if (StrUtil.isNotBlank(errorCode)) {\n                String errorMessage = response.getMessage();\n                log.error(\"AI 扩图失败，errorCode:{}, errorMessage:{}\", errorCode, errorMessage);\n                throw new BusinessException(ErrorCode.OPERATION_ERROR, \"AI 扩图接口响应异常\");\n            }\n            return response;\n        }\n    }\n\n    /**\n     * 查询创建的任务\n     *\n     * @param taskId\n     * @return\n     */public GetOutPaintingTaskResponse getOutPaintingTask(String taskId) {\n        if (StrUtil.isBlank(taskId)) {\n            throw new BusinessException(ErrorCode.OPERATION_ERROR, \"任务 id 不能为空\");\n        }\n        try (HttpResponse httpResponse = HttpRequest.get(String.format(GET_OUT_PAINTING_TASK_URL, taskId))\n                .header(Header.AUTHORIZATION, \"Bearer \" + apiKey)\n                .execute()) {\n            if (!httpResponse.isOk()) {\n                throw new BusinessException(ErrorCode.OPERATION_ERROR, \"获取任务失败\");\n            }\n            return JSONUtil.toBean(httpResponse.body(), GetOutPaintingTaskResponse.class);\n        }\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"OVYpdasuFoJN6Sxr5DhcBX6tnMc","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"注意，要按؜照官方文档的要求给请求头增加鉴权信息，拼接配置中写好的 apiKey","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JpTvdHQ5qoqqmpxH7f5cFCqYnye","block_type":4,"heading2":{"elements":[{"text_run":{"content":"扩图服务","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"XSFXdQpLjojRRexpYGgcPEdLnXf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"model.dto.picture","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 包下新建 AI 扩图请求类，用于接受前端传来的参数并传递给 Service 服务层。字段包括图片 id 和扩图参数：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"NfU4duOY4oH69nxaUM7cHjN8nwg","block_type":14,"code":{"elements":[{"text_run":{"content":"@Datapublic class CreatePictureOutPaintingTaskRequest implements Serializable {\n\n    /**\n     * 图片 id\n     */private Long pictureId;\n\n    /**\n     * 扩图参数\n     */private CreateOutPaintingTaskRequest.Parameters parameters;\n\n    private static final long serialVersionUID = 1L;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"QLftd7Cjxo0D4NxltuAcEv4dnOb","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"在图片服务中编写创؜建扩图任务方法，从数据库中获取图片信息和 url 地址，构造请求参数后调用 api 创建扩图任务。注意，如果图片有空间 id，则需要校验权限，直接复用以前的权限校验方法。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RIyRddgsNov9FNxgShScnXchnld","block_type":14,"code":{"elements":[{"text_run":{"content":"@Overridepublic CreateOutPaintingTaskResponse createPictureOutPaintingTask(CreatePictureOutPaintingTaskRequest createPictureOutPaintingTaskRequest, User loginUser) {\n    // 获取图片信息Long pictureId = createPictureOutPaintingTaskRequest.getPictureId();\n    Picture picture = Optional.ofNullable(this.getById(pictureId))\n            .orElseThrow(() -> new BusinessException(ErrorCode.NOT_FOUND_ERROR));\n    // 权限校验\n    checkPictureAuth(loginUser, picture);\n    // 构造请求参数CreateOutPaintingTaskRequest taskRequest = new CreateOutPaintingTaskRequest();\n    CreateOutPaintingTaskRequest.Input input = new CreateOutPaintingTaskRequest.Input();\n    input.setImageUrl(picture.getUrl());\n    taskRequest.setInput(input);\n    BeanUtil.copyProperties(createPictureOutPaintingTaskRequest, taskRequest);\n    // 创建任务return aliYunAiApi.createOutPaintingTask(taskRequest);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"LjhqdAkGAol1Pfx9rmEcTErZnMb","block_type":4,"heading2":{"elements":[{"text_run":{"content":"扩图接口","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Mg0LdGdeyojhBMxDfQ3cckWVnpb","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"在 Pic؜tureController 添加 AI 扩图接口，包括创建任务和查询任务状态接口：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WZK7d27FUoBomPx7ocPcFSLynGb","block_type":14,"code":{"elements":[{"text_run":{"content":"/**\n * 创建 AI 扩图任务\n */@PostMapping(\"/out_painting/create_task\")public BaseResponse<CreateOutPaintingTaskResponse> createPictureOutPaintingTask(\n        @RequestBody CreatePictureOutPaintingTaskRequest createPictureOutPaintingTaskRequest,\n        HttpServletRequest request) {\n    if (createPictureOutPaintingTaskRequest == null || createPictureOutPaintingTaskRequest.getPictureId() == null) {\n        throw new BusinessException(ErrorCode.PARAMS_ERROR);\n    }\n    User loginUser = userService.getLoginUser(request);\n    CreateOutPaintingTaskResponse response = pictureService.createPictureOutPaintingTask(createPictureOutPaintingTaskRequest, loginUser);\n    return ResultUtils.success(response);\n}\n\n/**\n * 查询 AI 扩图任务\n */@GetMapping(\"/out_painting/get_task\")public BaseResponse<GetOutPaintingTaskResponse> getPictureOutPaintingTask(String taskId) {\n    ThrowUtils.throwIf(StrUtil.isBlank(taskId), ErrorCode.PARAMS_ERROR);\n    GetOutPaintingTaskResponse task = aliYunAiApi.getOutPaintingTask(taskId);\n    return ResultUtils.success(task);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Fu5Fdy6gnoun5Ex8xkzcIDksnjd","block_type":3,"heading1":{"elements":[{"text_run":{"content":"前端开发","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"BERcdtnu5omwCpxpMEyc2V6knGI","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"可以参考基؜础编辑图片的交互流程，在编辑图片按钮旁边添加 AI 扩图按钮，点击之后显示弹窗进行 AI 扩图操作。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JIb6dbBEYo0txExYmKccTLeAnSh","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"这样可以将؜ AI 操作的逻辑封装到单独的组件中，让创建图片页面的代码更精简。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"G5efdsiIWoYMu3xWxw8cCbqanCb","block_type":4,"heading2":{"elements":[{"text_run":{"content":"AI 扩图弹窗","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"VP4mdfdZYozvkTxuuZgcYpNmnYb","block_type":13,"ordered":{"elements":[{"text_run":{"content":"先复制؜之前开发好的裁剪图片弹窗，保留控制弹窗显示隐藏的逻辑，修改弹窗的标题：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"TEk3dwoPuoT4lpxnrOXc5ZgknRc","block_type":14,"code":{"elements":[{"text_run":{"content":"<template>\n  <a-modal\n    class=\"image-out-painting\"\n    v-model:visible=\"visible\"\n    title=\"AI 扩图\"\n    :footer=\"false\"\n    @cancel=\"closeModal\"\n  >\n\n  </a-modal>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { uploadPictureUsingPost } from '@/api/pictureController'\nimport { message } from 'ant-design-vue'\n\ninterface Props {\n  picture?: API.PictureVO\n  spaceId?: number\n  onSuccess?: (newPicture: API.PictureVO) => void\n}\n\nconst props = defineProps<Props>()\n\n// 是否可见\nconst visible = ref(false)\n\n// 打开弹窗\nconst openModal = () => {\n  visible.value = true\n}\n\n// 关闭弹窗\nconst closeModal = () => {\n  visible.value = false\n}\n\n// 暴露函数给父组件\ndefineExpose({\n  openModal,\n})\n</script>\n\n<style scoped>\n.image-out-painting {\n  text-align: center;\n}\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</style>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"DP1hdoXuooGnBMxoOEzc1NPKn5c","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"由于 AI؜ 扩图一定是对已有图片进行编辑，所以弹窗的属性可以不需要 spaceId。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DrYndPUV6ocuuAxxtbOcktY4nzb","block_type":13,"ordered":{"elements":[{"text_run":{"content":"开发弹؜窗的内容，采用一行两列栅格布局，左边显示原始图片、右边显示扩图结果，下方展示扩图操作按钮。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"MzYgdegDVoB0GqxWI1icyljDnxg","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-row gutter=\"16\">\n  <a-col span=\"12\">\n    <h4>原始图片</h4>\n    <img :src=\"picture?.url\" :alt=\"picture?.name\" style=\"max-width: 100%\" />\n  </a-col>\n  <a-col span=\"12\">\n    <h4>扩图结果</h4>\n    <img\n      v-if=\"resultImageUrl\"\n      :src=\"resultImageUrl\"\n      :alt=\"picture?.name\"\n      style=\"max-width: 100%\"\n    />\n  </a-col>\n</a-row>\n<div style=\"margin-bottom: 16px\" />\n<a-flex gap=\"16\" justify=\"center\">\n  <a-button type=\"primary\" ghost @click=\"createTask\">生成图片</a-button>\n  <a-button type=\"primary\" @click=\"handleUpload\">应用结果</a-button>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-flex>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"QfFcdzMLzodl8jxP6YIczXr8nZf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"定义变量，用于存储图片结果：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"UtETd8QnDoO28jxdQQ6cKS7snfc","block_type":14,"code":{"elements":[{"text_run":{"content":"const resultImageUrl = ref<string>()","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"BJ5hdVu6PoWVRuxYnXVc5N29nie","block_type":13,"ordered":{"elements":[{"text_run":{"content":"编写创建任务函数：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Gbajdu9UnoQCZCxywr2coN84nUg","block_type":14,"code":{"elements":[{"text_run":{"content":"// 任务 idlet taskId = ref<string>()\n\n/**\n * 创建任务\n */const createTask = async () => {\n  if (!props.picture?.id) {\n    return\n  }\n  const res = await createPictureOutPaintingTaskUsingPost({\n    pictureId: props.picture.id,\n    // 可以根据需要设置扩图参数parameters: {\n      xScale: 2,\n      yScale: 2,\n    },\n  })\n  if (res.data.code === 0 && res.data.data) {\n    message.success('创建任务成功，请耐心等待，不要退出界面')\n    console.log(res.data.data.output.taskId)\n    taskId.value = res.data.data.output.taskId// 开启轮询startPolling()\n  } else {\n    message.error('创建任务失败，' + res.data.message)\n  }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"RI3tdFBiaoN9MXx4659cJ1gEnqg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"任务创建成؜功后，要开启轮询。         ‌         ﻿         ‍     ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XktNdofYko5GbNxtdE2cEehHn6d","block_type":13,"ordered":{"elements":[{"text_run":{"content":"编写轮؜询逻辑。注意无论任务执行成功或失败、还是退出当前页面时，都需要执行清理逻辑，包括：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"D5cZdlYDooNdBBx3JdvcQgH7n4g","block_type":12,"bullet":{"elements":[{"text_run":{"content":"清理定时器","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"B8oDdeXHSo1KI7xMVIRcd1qSn3b","block_type":12,"bullet":{"elements":[{"text_run":{"content":"将定时器变量设置为 null","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Szo7dEdAIodqNcxfbbIcccCinMe","block_type":12,"bullet":{"elements":[{"text_run":{"content":"将任务 id 设置为 null，这样允许前端多次执行任务","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"TTa8dQaN9o2AtRxZgwzcpkNsnVf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"代码如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"URUCd4Zl7o0tCxxW0ZTcRnkWnBO","block_type":14,"code":{"elements":[{"text_run":{"content":"// 轮询定时器let pollingTimer: NodeJS.Timeout = null// 清理轮询定时器const clearPolling = () => {\n  if (pollingTimer) {\n    clearInterval(pollingTimer)\n    pollingTimer = null\n    taskId.value = null\n  }\n}\n\n// 开始轮询const startPolling = () => {\n  if (!taskId.value) return\n\n  pollingTimer = setInterval(async () => {\n    try {\n      const res = await getPictureOutPaintingTaskUsingGet({\n        taskId: taskId.value,\n      })\n      if (res.data.code === 0 && res.data.data) {\n        const taskResult = res.data.data.outputif (taskResult.taskStatus === 'SUCCEEDED') {\n          message.success('扩图任务成功')\n          resultImageUrl.value = taskResult.outputImageUrlclearPolling()\n        } else if (taskResult.taskStatus === 'FAILED') {\n          message.error('扩图任务失败')\n          clearPolling()\n        }\n      }\n    } catch (error) {\n      console.error('轮询任务状态失败', error)\n      message.error('检测任务状态失败，请稍后重试')\n      clearPolling()\n    }\n  }, 3000) // 每隔 3 秒轮询一次\n}\n\n// 清理定时器，避免内存泄漏onUnmounted(() => {\n  clearPolling()\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"Uag9dWG6eoGXwVx3PVlcFVFinDb","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"5）当任务执行成功؜后，可以得到图片结果，此时就可以点击 “应用结果” 按钮，调用图片 URL 上传接口。这段代码可以直接复制已开发的 URL 图片上传组件，补充 loading 效果：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DcOMduw2KomW0FxR08scCjqinoh","block_type":14,"code":{"elements":[{"text_run":{"content":"const uploadLoading = ref<boolean>(false)\n\nconst handleUpload = async () => {\n  uploadLoading.value = truetry {\n    const params: API.PictureUploadRequest = {\n      fileUrl: resultImageUrl.value,\n      spaceId: props.spaceId,\n    }\n    if (props.picture) {\n      params.id = props.picture.id\n    }\n    const res = await uploadPictureByUrlUsingPost(params)\n    if (res.data.code === 0 && res.data.data) {\n      message.success('图片上传成功')\n      // 将上传成功的图片信息传递给父组件\n      props.onSuccess?.(res.data.data)\n      // 关闭弹窗closeModal()\n    } else {\n      message.error('图片上传失败，' + res.data.message)\n    }\n  } catch (error) {\n    message.error('图片上传失败')\n  } finally {\n    uploadLoading.value = false\n  }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"BkiqdSxUbo3V5VxePEXcp1ZPnzg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"1）适当对页面做一些优化。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Yp9SdJU2EoECl6x9BetcHhdHnae","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"给生成图片按钮؜添加任务执行的 loading 效果，有任务 id 时，禁止按钮点击，可以防止重复提交任务。扩图结束后，会清理 taskId，就可以再次执行。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EObtdPdc2ofKaIxmFgScMOJ0nGc","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-button type=\"primary\" :loading=\"!!taskId\" ghost \n  @click=\"createTask\">\n  生成图片\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-button>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"A0krdEcHFoMLwDxTQa7creZ9neg","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"2）添加应用结果（上传图片时）的 loading 效果：R7zfQ2yjmCwaGmgYTa9cW+7DK0YPbs0kpW2reaJf93o=","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BLM3dqDvTomdzvx6dYncwAmBnQh","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-button type=\"primary\" :loading=\"uploadLoading\" \n  @click=\"handleUpload\">\n  应用结果\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-button>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"RWV5dowhSoo0u7xnPKZcXry5nS1","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"3）有图片结果时才显示 “应用结果” 按钮：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WX3cdGCoboKPsExD5HjcBLiWn7b","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-button type=\"primary\" v-if=\"resultImageUrl\" \n  :loading=\"uploadLoading\" \n  @click=\"handleUpload\">\n  应用结果\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-button>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"VYEWdJsFKoPs4ux5JvVcYR7bnHc","block_type":4,"heading2":{"elements":[{"text_run":{"content":"创建图片页面引入弹窗","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"HJoHd2dRdoNzyZxgW4bcrEEbnJc","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"在创建图片؜页面使用组件，可以在编辑图片按钮右侧增加 “AI 扩图”，点击按钮后打开弹窗：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"X0GJdXZI5oZ9uMx20cEciAnanZt","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-space size=\"middle\">\n  <a-button :icon=\"h(EditOutlined)\" @click=\"doEditPicture\">编辑图片</a-button>\n  <a-button type=\"primary\" ghost :icon=\"h(FullscreenOutlined)\" @click=\"doImagePainting\">\n    AI 扩图\n  </a-button>\n</a-space>\n<ImageOutPainting\n  ref=\"imageOutPaintingRef\"\n  :picture=\"picture\"\n  :spaceId=\"spaceId\"\n  :onSuccess=\"onImageOutPaintingSuccess\"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"C6eYdePl3oT2q8xqWbFc7UsTnzf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"编辑点击按钮后触发的函数，打开弹窗：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"E6OxdYeTsouWIrxkUD0cSINmnPf","block_type":14,"code":{"elements":[{"text_run":{"content":"// AI 扩图弹窗引用const imageOutPaintingRef = ref()\n\n// AI 扩图const doImagePainting = () => {\n  if (imageOutPaintingRef.value) {\n    imageOutPaintingRef.value.openModal()\n  }\n}\n\n// 编辑成功事件const onImageOutPaintingSuccess = (newPicture: API.PictureVO) => {\n  picture.value = newPicture\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"LbLXdMDKzogeJPxTScIc1eFlnld","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"运行效果如图：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Aw3Sd0be3oTZVUx8pBCcGqlwnRb","block_type":27,"image":{"align":2,"height":1271,"token":"VSoEbziWEoEKg1xm5sXcuYBRn8f","width":2057},"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e"},{"block_id":"I8g2dKBKhoeCmBxyXmscnvHBnGf","block_type":2,"parent_id":"OiQxdajVToxizbxzvYpcIQuin8e","text":{"elements":[{"text_run":{"content":"","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}}],"type":"docx"}
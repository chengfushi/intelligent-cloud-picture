# ç©ºé—´æ¨¡å—

ä¹‹å‰æˆ‘ä»¬å·²ç»Øœå®Œæˆäº†å…¬å…±å›¾åº“çš„å¼€å‘ï¼Œä¸ºäº†è¿›ä¸€æ­¥å¢åŠ ç³»ç»Ÿçš„åº”ç”¨ä»·å€¼ï¼Œå¯ä»¥è®©æ¯ä¸ªç”¨æˆ·éƒ½èƒ½åˆ›å»ºè‡ªå·±çš„ç§æœ‰ç©ºé—´ï¼Œæ‰“é€ è‡ªå·±çš„å›¾ç‰‡äº‘ç›˜ã€ä¸ªäººç›¸å†Œã€‚

# éœ€æ±‚åˆ†æ

å¯¹äºç©ºé—´æ¨¡å—ï¼Œé€šå¸¸è¦æœ‰è¿™äº›åŠŸèƒ½ï¼š

* ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç©ºé—´
* ç”¨æˆ·åˆ›å»ºç§æœ‰ç©ºé—´
* ç§æœ‰ç©ºé—´æƒé™æ§åˆ¶
* ç©ºé—´çº§åˆ«å’Œé™é¢æ§åˆ¶

çœ‹èµ·æ¥ç®€å•Øœï¼Œä½†å…¶å®æ¯ä¸ªéœ€æ±‚çš„ç»†èŠ‚éƒ½éå¸¸å¤šï¼Œå…·ä½“åˆ†ææ¯ä¸ªéœ€æ±‚ï¼š

1. ç®¡ç†ç©ºØœé—´ï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿä¸­çš„ç©ºé—´è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚æœç´¢ç©ºé—´ã€ç¼–è¾‘ç©ºé—´ã€åˆ é™¤ç©ºé—´ã€‚
2. ç”¨æˆ·åˆ›å»ºç§æœ‰ç©ºé—´ï¼šç”¨æˆ·å¯ä»¥åˆ›å»º æœ€å¤šä¸€ä¸ª ç§æœ‰ç©ºé—´ï¼Œå¹¶ä¸”åœ¨ç§æœ‰ç©ºé—´å†…è‡ªç”±ä¸Šä¼ å’Œç®¡ç†å›¾ç‰‡ã€‚
3. ç§æœ‰ç©ºé—´Øœæƒé™æ§åˆ¶ï¼šç”¨æˆ·ä»…èƒ½è®¿é—®å’Œç®¡ç†è‡ªå·±çš„ç§æœ‰ç©ºé—´å’Œå…¶ä¸­çš„å›¾ç‰‡ï¼Œç§æœ‰ç©ºé—´çš„å›¾ç‰‡ä¸ä¼šå±•ç¤ºåœ¨å…¬å…±å›¾åº“ï¼Œä¹Ÿä¸éœ€è¦ç®¡ç†å‘˜å®¡æ ¸ã€‚
4. ç©ºé—´çº§åˆ«Øœå’Œé™é¢æ§åˆ¶ï¼šæ¯ä¸ªç©ºé—´æœ‰ä¸åŒçš„çº§åˆ«ï¼ˆå¦‚æ™®é€šç‰ˆå’Œä¸“ä¸šç‰ˆï¼‰ï¼Œå¯¹åº”äº†ä¸åŒçš„å®¹é‡å’Œå›¾ç‰‡æ•°é‡é™åˆ¶ï¼Œå¦‚æœè¶…å‡ºé™åˆ¶åˆ™æ— æ³•ç»§ç»­ä¸Šä¼ å›¾ç‰‡ã€‚

# æ–¹æ¡ˆè®¾è®¡

ä»éœ€æ±‚åˆ†æØœä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ„Ÿå—åˆ°ï¼Œç»†èŠ‚æ¯”è¾ƒå¤šï¼Œä¸ºäº†æ›´å¥½åœ°æŠŠæ§è¿™äº›ç»†èŠ‚ï¼Œéœ€è¦å…ˆå¯¹ç³»ç»Ÿè¿›è¡Œä¸€ä¸ªæ•´ä½“çš„æ–¹æ¡ˆè®¾è®¡ã€‚

æ€è€ƒä¸‹é¢çš„é—®é¢˜ï¼š

1. ä¸ºä»€ä¹ˆè¦æœ‰ â€œç©ºé—´â€ çš„æ¦‚å¿µï¼Ÿ
2. å¦‚ä½•å¯¹ç©ºé—´è¿›è¡Œåº“è¡¨è®¾è®¡ï¼Ÿ
3. å…¬å…±å›¾åº“å’Œç©ºé—´çš„å…³ç³»ï¼Ÿ

### ç©ºé—´çš„å¿…è¦æ€§

å¦‚æœæ²¡æœ‰ Øœâ€œç©ºé—´â€ çš„æ¦‚å¿µï¼Œæ€ä¹ˆå®ç°è®©ç”¨æˆ·è‡ªç”±ç®¡ç†è‡ªå·±çš„ç§æœ‰å›¾ç‰‡å‘¢ï¼Ÿ

Qï¼šè¿™ä¸å°±Øœç›¸å½“äº â€œæŸ¥çœ‹æˆ‘çš„å›¾ç‰‡â€ åŠŸèƒ½å˜›ï¼Œç›´æ¥æ”¯æŒç”¨æˆ·æŸ¥è¯¢è‡ªå·±åˆ›å»ºè¿‡çš„å›¾ç‰‡ä¸å°±å¯ä»¥äº†ï¼Ÿ

Aï¼šå¦‚æœè¿™æ ·åšï¼Œä¼šå­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼šç”¨æˆ·ç§æœ‰å›¾ç‰‡æ˜¯ éœ€è¦éšç§ çš„ï¼Œä¸éœ€è¦è¢«ç®¡ç†å‘˜å®¡æ ¸ï¼Œä¹Ÿä¸èƒ½è¢«å…¶ä»–äººå…¬å¼€æŸ¥çœ‹ã€‚è¿™å’Œç°åœ¨çš„å…¬å…±å›¾åº“å¹³å°çš„é€»è¾‘ä¸ä¸€è‡´ã€‚

æƒ³è±¡ä¸€ä¸‹ï¼ŒØœå›¾ç‰‡è¡¨ä¸­åªæœ‰ userId å­—æ®µï¼Œæ— æ³•åŒºåˆ†å›¾ç‰‡åˆ°åº•æ˜¯ç§æœ‰çš„è¿˜æ˜¯å…¬å¼€çš„ã€‚

Qï¼šé‚£å¦‚æœØœå…è®¸ç”¨æˆ·ä¸Šä¼ ç§æœ‰å›¾ç‰‡å‘¢ï¼Ÿæ¯”å¦‚è®¾ç½®å›¾ç‰‡å¯è§èŒƒå›´ä¸º â€œä»…è‡ªå·±å¯è§â€ï¼Ÿ

Aï¼šè¿™çš„ç¡®æ˜¯å¯è¡Œçš„ï¼Œå¯¹äºå†…å®¹å ç”¨å­˜å‚¨ç©ºé—´ä¸å¤§çš„å¹³å°ï¼Œå¾ˆé€‚åˆé‡‡ç”¨è¿™ç§æ–¹æ¡ˆï¼Œåƒ [ä»£ç å°æŠ„](https://www.codecopy.cn/) å°±æ”¯æŒä¸Šä¼ ä»…è‡ªå·±å¯è§çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¯¹äºå›¾åº“å¹³å°ï¼Œå›¾ç‰‡å ç”¨çš„å­˜å‚¨ç©ºé—´ä¼šç›´æ¥äº§ç”Ÿå­˜å‚¨è´¹ç”¨ï¼Œå› æ­¤éœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡å¤§å°å’Œæ•°é‡è¿›è¡Œé™åˆ¶ã€‚ç±»ä¼¼äºç»™ä½ åˆ†é…äº†ä¸€ä¸ªç”µè„‘ç¡¬ç›˜ï¼Œå®ƒå°±æ˜¯ä½ çš„ï¼Œç”¨æ»¡äº†å°±ä¸èƒ½å†ä¼ å›¾äº†ã€‚æ‰€ä»¥ä½¿ç”¨ â€œç©ºé—´â€ çš„æ¦‚å¿µä¼šæ›´ç¬¦åˆè¿™ç§åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥é’ˆå¯¹ç©ºé—´è¿›è¡Œé™åˆ¶å’Œåˆ†æï¼Œä¹Ÿæ›´ä¾¿äºç®¡ç†ã€‚

æ­¤å¤–ï¼Œä»é¡¹Øœç›®å¯æ‰©å±•æ€§çš„è§’åº¦æ¥è®²ï¼ŒæŠ½è±¡ â€œç©ºé—´â€ çš„æ¦‚å¿µè¿˜æœ‰ 2 ä¸ªä¼˜åŠ¿ï¼š

1. å’Œä¹‹å‰çš„å…¬å…±å›¾åº“å®Œå…¨åˆ†å¼€ï¼Œå°½é‡åªé¢å¤–å¢åŠ ç©ºé—´ç›¸å…³çš„é€»è¾‘å’Œä»£ç ï¼Œå‡å°‘å¯¹ä»£ç çš„ä¿®æ”¹ã€‚
2. ä»¥åæˆ‘ä»¬è¦å¼€å‘å›¢é˜Ÿå…±äº«ç©ºé—´ï¼Œéœ€è¦å¯¹ç©ºé—´è¿›è¡Œæˆå‘˜ç®¡ç†ï¼Œä¹Ÿæ˜¯éœ€è¦ â€œç©ºé—´â€ æ¦‚å¿µçš„ã€‚æ‰€ä»¥ç›®å‰è®¾è®¡çš„ç©ºé—´è¡¨ï¼Œè¦èƒ½å¤Ÿå…¼å®¹ä¹‹åçš„å…±äº«ç©ºé—´ï¼Œä¾¿äºåç»­æ‰©å±•ã€‚

### ç©ºé—´åº“è¡¨è®¾è®¡

#### ç©ºé—´è¡¨


```SQL
-- ç©ºé—´è¡¨
create table if not exists space
(
    id         bigint auto_increment comment 'id' primary key,
    spaceName  varchar(128)                       null comment 'ç©ºé—´åç§°',
    spaceLevel int      default 0                 null comment 'ç©ºé—´çº§åˆ«ï¼š0-æ™®é€šç‰ˆ 1-ä¸“ä¸šç‰ˆ 2-æ——èˆ°ç‰ˆ',
    maxSize    bigint   default 0                 null comment 'ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ€»å¤§å°',
    maxCount   bigint   default 0                 null comment 'ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ•°é‡',
    totalSize  bigint   default 0                 null comment 'å½“å‰ç©ºé—´ä¸‹å›¾ç‰‡çš„æ€»å¤§å°',
    totalCount bigint   default 0                 null comment 'å½“å‰ç©ºé—´ä¸‹çš„å›¾ç‰‡æ•°é‡',
    userId     bigint                             not null comment 'åˆ›å»ºç”¨æˆ· id',
    createTime datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    editTime   datetime default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    -- ç´¢å¼•è®¾è®¡
    index idx_userId (userId),        -- æå‡åŸºäºç”¨æˆ·çš„æŸ¥è¯¢æ•ˆç‡
    index idx_spaceName (spaceName),  -- æå‡åŸºäºç©ºé—´åç§°çš„æŸ¥è¯¢æ•ˆç‡
    index idx_spaceLevel (spaceLevel) -- æå‡æŒ‰ç©ºé—´çº§åˆ«æŸ¥è¯¢çš„æ•ˆç‡
) comment 'ç©ºé—´' collate = utf8mb4_unicode_ci;
```

å‡ ä¸ªè®¾è®¡è¦ç‚¹ï¼š

1. ç©ºé—´çº§åˆ«å­—æ®µï¼šç©ºé—´çº§åˆ«åŒ…æ‹¬æ™®é€šç‰ˆã€ä¸“ä¸šç‰ˆå’Œæ——èˆ°ç‰ˆï¼Œæ˜¯å¯æšä¸¾çš„ï¼Œå› æ­¤ä½¿ç”¨æ•´å‹æ¥èŠ‚çº¦ç©ºé—´ã€æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
2. ç©ºé—´é™é¢å­—æ®µï¼šé™¤äº†çº§åˆ«å­—æ®µå¤–ï¼Œå¢åŠ  `maxSize` å’Œ `maxCount` å­—æ®µç”¨äºé™åˆ¶ç©ºé—´çš„å›¾ç‰‡æ€»å¤§å°ä¸æ•°é‡ï¼Œè€Œä¸æ˜¯åœ¨ä»£ç ä¸­æ ¹æ®çº§åˆ«è¯»å–é™é¢ã€‚è¿™æ ·ç®¡ç†å‘˜å¯ä»¥å•ç‹¬è®¾ç½®é™é¢ï¼Œä¸ç”¨å®Œå…¨å’Œçº§åˆ«ç»‘å®šï¼Œåˆ©äºæ‰©å±•ï¼›è€Œä¸”æŸ¥è¯¢é™é¢æ—¶ä¹Ÿæ›´æ–¹ä¾¿ã€‚
3. ç´¢å¼•è®¾è®¡ï¼šä¸ºé«˜é¢‘æŸ¥è¯¢çš„å­—æ®µï¼ˆå¦‚ç©ºé—´åç§°ã€ç©ºé—´çº§åˆ«ã€ç”¨æˆ· idï¼‰æ·»åŠ ç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

#### å›¾ç‰‡è¡¨

ç”±äºä¸€å¼ å›¾ç‰‡Øœåªèƒ½å±äºä¸€ä¸ªç©ºé—´ï¼Œå¯ä»¥åœ¨å›¾ç‰‡è¡¨ picture ä¸­æ–°å¢å­—æ®µ spaceIdï¼Œå®ç°å›¾ç‰‡ä¸ç©ºé—´çš„å…³è”ï¼ŒåŒæ—¶å¢åŠ ç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚


```SQL
-- æ·»åŠ æ–°åˆ—
ALTER TABLE picture
    ADD COLUMN spaceId  bigint  null comment 'ç©ºé—´ idï¼ˆä¸ºç©ºè¡¨ç¤ºå…¬å…±ç©ºé—´ï¼‰';

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_spaceId ON picture (spaceId);
```

### å…¬å…±å›¾åº“å’Œç©ºé—´çš„å…³ç³»

> Qï¼šå…¬å…±å›¾åº“ä¸å°±æ˜¯ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºçš„ä¸€ä¸ªç©ºé—´ä¹ˆï¼Ÿæ—¢ç„¶æœ‰äº†ç©ºé—´è¡¨ï¼Œè¦ä¸è¦æŠŠå…¬å…±å›¾åº“ä¹Ÿå½“åšä¸€ä¸ªé»˜è®¤çš„ç©ºé—´æ¥è®¾è®¡å‘¢ï¼Ÿæˆ–è€…åœ¨ç©ºé—´è¡¨åˆ›å»ºä¸€æ¡å…¬å…±å›¾åº“çš„è®°å½•ï¼Ÿ

> æ­¤å¤„ä¸ºäº†ç¡®ä¿å…¬å…±å›¾åº“ä¸ç§æœ‰ç©ºé—´çš„ç‹¬ç«‹æ€§ï¼Œå¿…é¡»è¿›è¡Œå•ç‹¬çš„è®¾è®¡ï¼Œå¹¶é¿å…å°†ä¸¤è€…æ··åˆã€‚åŸå› å¦‚ä¸‹ï¼š

> 1. å…¬å…±å›¾åº“çš„è®¿é—®æƒé™ä¸ç§æœ‰ç©ºé—´ä¸åŒ
    > * å…¬å…±å›¾åº“ä¸­çš„å›¾ç‰‡æ— éœ€ç™»å½•å°±èƒ½æŸ¥çœ‹ï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®ï¼Œä¸éœ€è¦è¿›è¡Œç”¨æˆ·è®¤è¯æˆ–æˆå‘˜ç®¡ç†ã€‚
    > * ç§æœ‰ç©ºé—´åˆ™è¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œä¸”è®¿é—®æƒé™ä¸¥æ ¼æ§åˆ¶ï¼Œé€šå¸¸åªæœ‰ç©ºé—´ç®¡ç†å‘˜ï¼ˆæˆ–å›¢é˜Ÿæˆå‘˜ï¼‰æ‰èƒ½æŸ¥çœ‹æˆ–ä¿®æ”¹ç©ºé—´å†…å®¹ã€‚
> 2. å…¬å…±å›¾åº“Øœæ²¡æœ‰é¢åº¦é™åˆ¶ï¼šç§æœ‰ç©ºé—´ä¼šæœ‰å›¾ç‰‡å¤§å°ã€æ•°é‡ç­‰æ–¹é¢çš„é™åˆ¶ï¼Œä»è€Œç®¡ç†ç”¨æˆ·çš„å­˜å‚¨èµ„æºå’Œç©ºé—´é…é¢ï¼›è€Œå…¬å…±å›¾åº“å®Œå…¨ä¸å—è¿™äº›é™åˆ¶ã€‚


å…¬å…±å›¾åº“å’Œç§æœ‰ç©ºé—´åœ¨æ•°æ®ç»“æ„ã€Øœå›¾ç‰‡å­˜å‚¨ã€æƒé™æ§åˆ¶ã€é¢åº¦ç®¡ç†ç­‰æ–¹é¢å­˜åœ¨æœ¬è´¨åŒºåˆ«ï¼Œå¦‚æœæ··åˆè®¾è®¡ï¼Œä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦å¹¶å½±å“ç»´æŠ¤ä¸æ‰©å±•æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå…¬å…±å›¾åº“åº”è¯¥ä¸Šä¼ åˆ°å¯¹è±¡å­˜å‚¨çš„ public ç›®å½•ï¼Œè¯¥ç›®å½•é‡Œçš„æ–‡ä»¶å¯ä»¥å…¬å¼€è®¿é—®ï¼›ä½†ç§æœ‰å›¾ç‰‡åº”è¯¥ä¸Šä¼ åˆ°å•ç‹¬çš„ space ç›®å½•ï¼Œè¯¥ç›®å½•é‡Œçš„æ–‡ä»¶å¯ä»¥è¿›ä¸€æ­¥è®¾ç½®è®¿é—®æƒé™ã€‚

# åç«¯å¼€å‘

## ç©ºé—´ç®¡ç†

å…ˆå¼€å‘ç©ºé—´æ ·æ¿ä»£ç CRUDç­‰ç­‰

### æ•°æ®æ¨¡å‹

1. ä½¿ç”¨MyBatis-Plusæ’ä»¶è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå®ä½“ç±»ï¼Œä¸ºäº†é˜²çˆ¬è™«ï¼Œidéšæœºï¼›å¦å¤–åŠ ä¸Šé€»è¾‘åˆ é™¤å­—æ®µã€‚


```SQL
@TableName(value ="space")
@Data
public class Space {
*/***** id***/*@TableId(type = IdType.*ASSIGN_ID*)
    private Long id;

*/***** ç©ºé—´åç§°***/*private String spaceName;

*/***** ç©ºé—´çº§åˆ«ï¼š0-æ™®é€šç‰ˆ 1-ä¸“ä¸šç‰ˆ 2-æ——èˆ°ç‰ˆ***/*private Integer spaceLevel;

*/***** ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ€»å¤§å°***/*private Long maxSize;

*/***** ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ•°é‡***/*private Long maxCount;

*/***** å½“å‰ç©ºé—´ä¸‹å›¾ç‰‡çš„æ€»å¤§å°***/*private Long totalSize;

*/***** å½“å‰ç©ºé—´ä¸‹çš„å›¾ç‰‡æ•°é‡***/*private Long totalCount;

*/***** åˆ›å»ºç”¨æˆ· id***/*private Long userId;

*/***** åˆ›å»ºæ—¶é—´***/*private Date createTime;

*/***** ç¼–è¾‘æ—¶é—´***/*private Date editTime;

*/***** æ›´æ–°æ—¶é—´***/*private Date updateTime;

*/***** æ˜¯å¦åˆ é™¤***/*@TableLogic
    private Integer isDelete;

*/***** ç©ºé—´ç±»å‹ï¼š0-ç§æœ‰ 1-å›¢é˜Ÿ***/*private Integer spaceType;
}
```

1. æ¯ä¸ªæ“ä½œéœ€è¦ä¸€ä¸ªè¯·æ±‚ç±»ï¼Œåˆ†åˆ«æ˜¯ç©ºé—´åˆ›å»ºã€æ›´æ–°ã€ç¼–è¾‘ã€æŸ¥è¯¢ï¼ˆç”±äºæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ç©ºé—´ï¼Œè¿™é‡Œå°±ä¸éœ€è¦æœ‰åˆ é™¤ç©ºé—´çš„é€»è¾‘â€”â€”åˆ é™¤ç©ºé—´æœ‰ç‚¹é€†å¤©ï¼‰

ç©ºé—´åˆ›å»º


```Java
@Data
public class SpaceAddRequest implements Serializable {

*/***** ç©ºé—´åç§°***/*private String spaceName;

*/***** ç©ºé—´çº§åˆ«ï¼š0-æ™®é€šç‰ˆ 1-ä¸“ä¸šç‰ˆ 2-æ——èˆ°ç‰ˆ***/*private Integer spaceLevel;

    private static final long *serialVersionUID*= 1L;
}
```

ç©ºé—´ç¼–è¾‘è¯·æ±‚ï¼Œç»™ç”¨æˆ·ç”¨ï¼Œæ–¹ä¾¿ç”¨æˆ·æ›´æ”¹ç©ºé—´åç§°


```Java
@Data
public class SpaceEditRequest implements Serializable {

    /**
     * ç©ºé—´ id
     */
    private Long id;

    /**
     * ç©ºé—´åç§°
     */
    private String spaceName;

    private static final long serialVersionUID = 1L;
}
```

ç©ºé—´æ›´æ–°è¯·æ±‚ï¼Œç»™ç®¡ç†å‘˜ç”¨ï¼Œå¯ä»¥æ›´æ”¹ç©ºé—´çº§åˆ«å’Œé™é¢


```Java
@Data
public class SpaceUpdateRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç©ºé—´åç§°
     */
    private String spaceName;

    /**
     * ç©ºé—´çº§åˆ«ï¼š0-æ™®é€šç‰ˆ 1-ä¸“ä¸šç‰ˆ 2-æ——èˆ°ç‰ˆ
     */
    private Integer spaceLevel;

    /**
     * ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ€»å¤§å°
     */
    private Long maxSize;

    /**
     * ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ•°é‡
     */
    private Long maxCount;

    private static final long serialVersionUID = 1L;
}
```

ç©ºé—´æŸ¥è¯¢è¯·æ±‚ï¼Œè¿™é‡Œç»™ç®¡ç†å‘˜ç”¨ï¼Œå› ä¸ºæ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ç©ºé—´


```Java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceQueryRequest extends PageRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ· id
     */
    private Long userId;

    /**
     * ç©ºé—´åç§°
     */
    private String spaceName;

    /**
     * ç©ºé—´çº§åˆ«ï¼š0-æ™®é€šç‰ˆ 1-ä¸“ä¸šç‰ˆ 2-æ——èˆ°ç‰ˆ
     */
    private Integer spaceLevel;

    private static final long serialVersionUID = 1L;
}
```

1. åœ¨ `model.dto.vo` ä¸‹æ–°å»ºç©ºé—´çš„è§†å›¾åŒ…è£…ç±»ï¼Œå¯ä»¥é¢å¤–å…³è”åˆ›å»ºç©ºé—´çš„ç”¨æˆ·ä¿¡æ¯ã€‚è¿˜å¯ä»¥ç¼–å†™ Space å®ä½“ç±»å’Œè¯¥ VO ç±»çš„è½¬æ¢æ–¹æ³•ï¼Œä¾¿äºåç»­å¿«é€Ÿä¼ å€¼ã€‚


```C++
@Data
public class SpaceVO implements Serializable {
    /**
     * id
     */
    private Long id;

    /**
     * ç©ºé—´åç§°
     */
    private String spaceName;

    /**
     * ç©ºé—´çº§åˆ«ï¼š0-æ™®é€šç‰ˆ 1-ä¸“ä¸šç‰ˆ 2-æ——èˆ°ç‰ˆ
     */
    private Integer spaceLevel;

    /**
     * ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ€»å¤§å°
     */
    private Long maxSize;

    /**
     * ç©ºé—´å›¾ç‰‡çš„æœ€å¤§æ•°é‡
     */
    private Long maxCount;

    /**
     * å½“å‰ç©ºé—´ä¸‹å›¾ç‰‡çš„æ€»å¤§å°
     */
    private Long totalSize;

    /**
     * å½“å‰ç©ºé—´ä¸‹çš„å›¾ç‰‡æ•°é‡
     */
    private Long totalCount;

    /**
     * åˆ›å»ºç”¨æˆ· id
     */
    private Long userId;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * ç¼–è¾‘æ—¶é—´
     */
    private Date editTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    /**
     * åˆ›å»ºç”¨æˆ·ä¿¡æ¯
     */
    private UserVO user;

    private static final long serialVersionUID = 1L;

    /**
     * å°è£…ç±»è½¬å¯¹è±¡
     *
     * @param spaceVO
     * @return
     */
    public static Space voToObj(SpaceVO spaceVO) {
        if (spaceVO == null) {
            return null;
        }
        Space space = new Space();
        BeanUtils.copyProperties(spaceVO, space);
        return space;
    }

    /**
     * å¯¹è±¡è½¬å°è£…ç±»
     *
     * @param space
     * @return
     */
    public static SpaceVO objToVo(Space space) {
        if (space == null) {
            return null;
        }
        SpaceVO spaceVO = new SpaceVO();
        BeanUtils.copyProperties(space, spaceVO);
        return spaceVO;
    }
}

```

1. åœ¨ `model.enums` åŒ…ä¸‹æ–°å»ºç©ºé—´çº§åˆ«æšä¸¾ï¼Œå®šä¹‰æ¯ä¸ªçº§åˆ«çš„ç©ºé—´å¯¹åº”çš„é™é¢ï¼š


```Java
@Getter
public enum SpaceLevelEnum {

    COMMON("æ™®é€šç‰ˆ", 0, 100, 100L * 1024 * 1024),
    PROFESSIONAL("ä¸“ä¸šç‰ˆ", 1, 1000, 1000L * 1024 * 1024),
    FLAGSHIP("æ——èˆ°ç‰ˆ", 2, 10000, 10000L * 1024 * 1024);

    private final String text;

    private final int value;

    private final long maxCount;

    private final long maxSize;


    /**
     * @param text æ–‡æœ¬
     * @param value å€¼
     * @param maxSize æœ€å¤§å›¾ç‰‡æ€»å¤§å°
     * @param maxCount æœ€å¤§å›¾ç‰‡æ€»æ•°é‡
     */
    SpaceLevelEnum(String text, int value, long maxCount, long maxSize) {
        this.text = text;
        this.value = value;
        this.maxCount = maxCount;
        this.maxSize = maxSize;
    }

    /**
     * æ ¹æ® value è·å–æšä¸¾
     */
    public static SpaceLevelEnum getEnumByValue(Integer value) {
        if (ObjUtil.isEmpty(value)) {
            return null;
        }
        for (SpaceLevelEnum spaceLevelEnum : SpaceLevelEnum.values()) {
            if (spaceLevelEnum.value == value) {
                return spaceLevelEnum;
            }
        }
        return null;
    }
}
```

### åŸºç¡€æœåŠ¡å¼€å‘

å¯ä»¥å‚è€ƒå›¾Øœç‰‡æœåŠ¡çš„å¼€å‘æ–¹æ³•ï¼Œå®Œæˆ SpaceService å’Œå®ç°ç±»ï¼Œå¤§å¤šæ•°ä»£ç å¯ä»¥ç›´æ¥å¤ç”¨ã€‚

ç”±äºåˆ›å»ºç©ºØœé—´çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥å…ˆå®šä¹‰ä¸ªæ¥å£å å‘ã€‚æˆ‘ä»¬ä¸»è¦å¼€å‘ä¸‹åˆ—æ–¹æ³•

1. éœ€è¦å¼€Øœå‘æ ¡éªŒç©ºé—´æ•°æ®çš„æ–¹æ³•ï¼Œå¢åŠ  add å‚æ•°ç”¨æ¥åŒºåˆ†æ˜¯åˆ›å»ºæ•°æ®æ—¶æ ¡éªŒè¿˜æ˜¯ç¼–è¾‘æ—¶æ ¡éªŒï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯ä¸ä¸€æ ·çš„ï¼š

> 1. æ ¡éªŒå‚æ•°
> 2. å¦‚æœæ˜¯åˆ›å»º,é‚£ä¹ˆåç§°å’Œçº§åˆ«ä¸èƒ½ä¸ºç©º
> 3. å¦‚æœæ˜¯ç¼–è¾‘,åˆ™å“¦æŒ‰æ®µç©ºé—´çº§åˆ«æ˜¯å¦å­˜åœ¨,å†éªŒè¯é•¿åº¦



```Java
@Override
public void validSpace(Space space, boolean add) {
    ThrowUtils.throwIf(space == null, ErrorCode.PARAMS_ERROR);
    // ä»å¯¹è±¡ä¸­å–å€¼
    String spaceName = space.getSpaceName();
    Integer spaceLevel = space.getSpaceLevel();
    SpaceLevelEnum spaceLevelEnum = SpaceLevelEnum.getEnumByValue(spaceLevel);
    // è¦åˆ›å»º
    if (add) {
        if (StrUtil.isBlank(spaceName)) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç©ºé—´åç§°ä¸èƒ½ä¸ºç©º");
        }
        if (spaceLevel == null) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç©ºé—´çº§åˆ«ä¸èƒ½ä¸ºç©º");
        }
    }
    // ä¿®æ”¹æ•°æ®æ—¶ï¼Œå¦‚æœè¦æ”¹ç©ºé—´çº§åˆ«
    if (spaceLevel != null && spaceLevelEnum == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç©ºé—´çº§åˆ«ä¸å­˜åœ¨");
    }
    if (StrUtil.isNotBlank(spaceName) && spaceName.length() > 30) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç©ºé—´åç§°è¿‡é•¿");
    }
}

```

1. åœ¨åˆ›å»ºØœæˆ–æ›´æ–°ç©ºé—´æ—¶ï¼Œéœ€è¦æ ¹æ®ç©ºé—´çº§åˆ«è‡ªåŠ¨å¡«å……é™é¢æ•°æ®ï¼Œå¯ä»¥åœ¨æœåŠ¡ä¸­ç¼–å†™æ–¹æ³•ä¾¿äºå¤ç”¨ï¼š


```Java
@Override
public void fillSpaceBySpaceLevel(Space space) {
    // æ ¹æ®ç©ºé—´çº§åˆ«ï¼Œè‡ªåŠ¨å¡«å……é™é¢
    SpaceLevelEnum spaceLevelEnum = SpaceLevelEnum.getEnumByValue(space.getSpaceLevel());
    if (spaceLevelEnum != null) {
        long maxSize = spaceLevelEnum.getMaxSize();
        if (space.getMaxSize() == null) {
            space.setMaxSize(maxSize);
        }
        long maxCount = spaceLevelEnum.getMaxCount();
        if (space.getMaxCount() == null) {
            space.setMaxCount(maxCount);
        }
    }
}

```

### æ¥å£å¼€å‘

å‚è€ƒå›¾ç‰‡æ¥Øœå£çš„å¼€å‘æ–¹æ³•ï¼Œå®Œæˆ SpaceController ç±»ï¼Œå¤§å¤šæ•°ä»£ç å¯ä»¥ç›´æ¥å¤ç”¨ã€‚

éœ€è¦é‡ç‚¹å…³æ³¨æ¥å£çš„æƒé™ï¼š

* åˆ›å»ºç©ºé—´ï¼šæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨
* åˆ é™¤ç©ºé—´ï¼šä»…å…è®¸ç©ºé—´åˆ›å»ºäººæˆ–ç®¡ç†å‘˜åˆ é™¤
* æ›´æ–°ç©ºé—´ï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå…è®¸æ›´æ–°ç©ºé—´çº§åˆ«
* ç¼–è¾‘ç©ºé—´ï¼šå…è®¸ç©ºé—´åˆ›å»ºäººä½¿ç”¨ï¼Œä½†æ³¨æ„å¯ç¼–è¾‘çš„å­—æ®µï¼ˆä¸èƒ½ç¼–è¾‘ç©ºé—´çº§åˆ«ï¼‰

å¼€å‘æ›´æ–°æ¥å£æ—¶ï¼Œéœ€è¦è°ƒç”¨å¡«å……ç©ºé—´é™é¢æ•°æ®çš„æ–¹æ³•ï¼š


```Java
@PostMapping("/update")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> updateSpace(@RequestBody SpaceUpdateRequest spaceUpdateRequest) {
    if (spaceUpdateRequest == null || spaceUpdateRequest.getId() <= 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    // å°†å®ä½“ç±»å’Œ DTO è¿›è¡Œè½¬æ¢
    Space space = new Space();
    BeanUtils.copyProperties(spaceUpdateRequest, space);
    // è‡ªåŠ¨å¡«å……æ•°æ®
    spaceService.fillSpaceBySpaceLevel(space);
    // æ•°æ®æ ¡éªŒ
    spaceService.validSpace(space, false);
    // åˆ¤æ–­æ˜¯å¦å­˜åœ¨
    long id = spaceUpdateRequest.getId();
    Space oldSpace = spaceService.getById(id);
    ThrowUtils.throwIf(oldSpace == null, ErrorCode.NOT_FOUND_ERROR);
    // æ“ä½œæ•°æ®åº“
    boolean result = spaceService.updateById(space);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(true);
}
```

## ç”¨æˆ·åˆ›å»ºç§æœ‰ç©ºé—´

ç”¨æˆ·å¯ä»¥è‡ªä¸»åˆ›å»ºç§æœ‰ç©ºé—´ï¼Œä½†æ˜¯å¿…é¡»è¦åŠ é™åˆ¶ï¼Œæœ€å¤šåªèƒ½åˆ›å»ºä¸€ä¸ªã€‚

éœ€è¦å¼€å‘åˆ›å»ºç©ºé—´æœåŠ¡ï¼Œè¯¥æœåŠ¡è¾ƒä¸ºå¤æ‚ï¼Œæˆ‘ä»¬è¦å…ˆæ•´ç†ä¸‹æµç¨‹ã€‚

### åˆ›å»ºç©ºé—´æµç¨‹

æµç¨‹å¦‚ä¸‹ï¼š

1. å¡«å……å‚æ•°é»˜è®¤å€¼
2. æ ¡éªŒå‚æ•°
3. æ ¡éªŒæƒé™ï¼Œéç®¡ç†å‘˜åªèƒ½åˆ›å»ºæ™®é€šçº§åˆ«çš„ç©ºé—´
4. æ§åˆ¶åŒä¸€ç”¨æˆ·åªèƒ½åˆ›å»ºä¸€ä¸ªç§æœ‰ç©ºé—´

å¦‚ä½•ä¿è¯åŒä¸€ç”¨æˆ·åªèƒ½åˆ›å»ºä¸€ä¸ªç§æœ‰ç©ºé—´å‘¢ï¼Ÿ

æœ€ç²—æš´çš„æ–¹å¼æ˜¯ç»™ç©ºé—´è¡¨çš„ userId åŠ ä¸Šå”¯ä¸€ç´¢å¼•ï¼Œä½†ç”±äºåç»­ç”¨æˆ·è¿˜å¯ä»¥åˆ›å»ºå›¢é˜Ÿç©ºé—´ï¼Œè¿™ç§æ–¹å¼ä¸åˆ©äºæ‰©å±•ã€‚æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ **åŠ é” + äº‹åŠ¡**  çš„æ–¹å¼å®ç°ã€‚

### åˆ›å»ºç©ºé—´æœåŠ¡

æŒ‰ç…§ä¸Šè¿°æµç¨‹ç¼–å†™ä»£ç ï¼š


```Java
@Resourceprivate TransactionTemplate transactionTemplate;

@Overridepublic long addSpace(SpaceAddRequest spaceAddRequest, User loginUser) {
    // åœ¨æ­¤å¤„å°†å®ä½“ç±»å’Œ DTO è¿›è¡Œè½¬æ¢Space space = new Space();
    BeanUtils.copyProperties(spaceAddRequest, space);
    // é»˜è®¤å€¼if (StrUtil.isBlank(spaceAddRequest.getSpaceName())) {
        space.setSpaceName("é»˜è®¤ç©ºé—´");
    }
    if (spaceAddRequest.getSpaceLevel() == null) {
        space.setSpaceLevel(SpaceLevelEnum.COMMON.getValue());
    }
    // å¡«å……æ•°æ®this.fillSpaceBySpaceLevel(space);
    // æ•°æ®æ ¡éªŒthis.validSpace(space, true);
    Long userId = loginUser.getId();
    space.setUserId(userId);
    // æƒé™æ ¡éªŒif (SpaceLevelEnum.COMMON.getValue() != spaceAddRequest.getSpaceLevel() && !userService.isAdmin(loginUser)) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, "æ— æƒé™åˆ›å»ºæŒ‡å®šçº§åˆ«çš„ç©ºé—´");
    }
    // é’ˆå¯¹ç”¨æˆ·è¿›è¡ŒåŠ é”String lock = String.valueOf(userId).intern();
    synchronized (lock) {
        Long newSpaceId = transactionTemplate.execute(status -> {
            boolean exists = this.lambdaQuery().eq(Space::getUserId, userId).exists();
            ThrowUtils.throwIf(exists, ErrorCode.OPERATION_ERROR, "æ¯ä¸ªç”¨æˆ·ä»…èƒ½æœ‰ä¸€ä¸ªç§æœ‰ç©ºé—´");
            // å†™å…¥æ•°æ®åº“boolean result = this.save(space);
            ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
            // è¿”å›æ–°å†™å…¥çš„æ•°æ® idreturn space.getId();
        });
        // è¿”å›ç»“æœæ˜¯åŒ…è£…ç±»ï¼Œå¯ä»¥åšä¸€äº›å¤„ç†return Optional.ofNullable(newSpaceId).orElse(-1L);
    }
}
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¬åœ° synchronized é”å¯¹ userId è¿›è¡ŒåŠ é”ï¼Œè¿™æ ·ä¸åŒçš„ç”¨æˆ·å¯ä»¥æ‹¿åˆ°ä¸åŒçš„é”ï¼Œå¯¹æ€§èƒ½çš„å½±å“è¾ƒä½ã€‚åœ¨åŠ é”çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Spring çš„ ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å™¨ transactionTemplate å°è£…è·Ÿæ•°æ®åº“æœ‰å…³çš„æŸ¥è¯¢å’Œæ’å…¥æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨ @Transactional æ³¨è§£æ¥æ§åˆ¶äº‹åŠ¡ï¼Œè¿™æ ·å¯ä»¥ä¿è¯äº‹åŠ¡çš„æäº¤åœ¨åŠ é”çš„èŒƒå›´å†…ã€‚

ğŸ’¡ åªè¦Øœæ¶‰åŠåˆ°äº‹åŠ¡æ“ä½œï¼Œå»ºè®®å¤§å®¶æµ‹è¯•æ—¶è‡ªå·± new ä¸ªè¿è¡Œæ—¶å¼‚å¸¸æ¥éªŒè¯æ˜¯å¦ä¼šå›æ»šã€‚

### æ‰©å±•çŸ¥è¯† - æœ¬åœ°é”ä¼˜åŒ–

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯¹å­—ç¬¦ä¸²å¸¸é‡æ± ï¼ˆinternï¼‰è¿›è¡ŒåŠ é”çš„ï¼Œæ•°æ®å¹¶ä¸ä¼šåŠæ—¶é‡Šæ”¾ã€‚å¦‚æœè¿˜è¦ä½¿ç”¨æœ¬åœ°é”ï¼Œå¯ä»¥æŒ‰éœ€é€‰ç”¨å¦ä¸€ç§æ–¹å¼ â€”â€” é‡‡ç”¨ `ConcurrentHashMap` æ¥å­˜å‚¨é”å¯¹è±¡ã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š


```Java
Map<Long, Object> lockMap = new ConcurrentHashMap<>();

public long addSpace(SpaceAddRequest spaceAddRequest, User user) {
    Long userId = user.getId();
    Object lock = lockMap.computeIfAbsent(userId, key -> new Object());
    synchronized (lock) {
        try {
            // æ•°æ®åº“æ“ä½œ
        } finally {
            // é˜²æ­¢å†…å­˜æ³„æ¼
            lockMap.remove(userId);
        }
    }
}
```

### æ‰©å±•

1ï¼‰ç”¨æˆ·æ³¨Øœå†ŒæˆåŠŸæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨åˆ›å»ºç©ºé—´ã€‚å³ä½¿åˆ›å»ºå¤±è´¥äº†ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºä½œä¸ºå…œåº•ã€‚

2ï¼‰ç®¡ç†å‘˜å¯ä»¥ä¸ºæŸä¸ªç”¨æˆ·åˆ›å»ºç©ºé—´ï¼ˆç›®å‰æ²¡å•¥å¿…è¦ï¼‰

3ï¼‰æœ¬åœ°é”æ”¹ä¸ºåˆ†å¸ƒå¼é”ï¼Œå¯ä»¥åŸºäº Redisson å®ç°ã€‚

## ç§æœ‰ç©ºé—´æƒé™æ§åˆ¶

ç§æœ‰ç©ºé—´çš„æƒé™å’Œå…¬å…±å›¾åº“æ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¹‹å‰ æ‰€æœ‰çš„å›¾ç‰‡æ“ä½œ éƒ½æ·»åŠ å’Œç©ºé—´æœ‰å…³çš„æƒé™æ ¡éªŒé€»è¾‘ã€‚

### å›¾ç‰‡è¡¨æ–°å¢å­—æ®µ

å›¾ç‰‡è¡¨å¢åŠ Øœ spaceId å­—æ®µï¼Œé»˜è®¤ä¸º null è¡¨ç¤ºå…¬å…±å›¾åº“ã€‚

åŒæ­¥ä¿®æ”¹ PictureMapper.xmlã€Picture å®ä½“ç±»ã€PictureVO å“åº”è§†å›¾ï¼Œè¡¥å……ç©ºé—´ id å­—æ®µï¼š


```Java
/**
 * ç©ºé—´ id
 */private Long spaceId;
```

ä¸‹é¢æˆ‘ä»¬ä¾æ¬¡ç»™ â€œå¢åˆ æ”¹æŸ¥â€ å›¾ç‰‡æ“ä½œå¢åŠ æƒé™æ ¡éªŒé€»è¾‘ã€‚

### ä¸Šä¼ å’Œæ›´æ–°å›¾ç‰‡

1ï¼‰ä¸Šä¼ å›¾Øœç‰‡æ—¶æ”¯æŒæŒ‡å®šç©ºé—´ idï¼Œè¡¨ç¤ºè¦å°†å›¾ç‰‡ä¸Šä¼ åˆ°å“ªä¸ªç©ºé—´ã€‚

ç»™ PicØœtureUploadRequest è¯·æ±‚å°è£…ç±»è¡¥å…… spaceId å­—æ®µã€‚OTsSx2bzs2C13D2pB4s4on5rzOarAwg0YtGpfccE/pk=

2ï¼‰ä¿®æ”¹ä¸Šä¼ Øœå›¾ç‰‡æ–¹æ³• uploadPictureï¼Œæ ¡éªŒç©ºé—´æ˜¯å¦å­˜åœ¨ï¼›å¦‚æœå­˜åœ¨ï¼Œè¿˜è¦æ ¡éªŒæ˜¯å¦æœ‰ç©ºé—´æƒé™ï¼Œä»…ç©ºé—´çš„ç®¡ç†å‘˜æ‰èƒ½ä¸Šä¼ ã€‚

ç°é˜¶æ®µç©ºé—´çš„ç®¡ç†å‘˜å°±æ˜¯ç©ºé—´çš„åˆ›å»ºäºº


```Java
ThrowUtils.throwIf(loginUser == null, ErrorCode.NO_AUTH_ERROR);
// æ ¡éªŒç©ºé—´æ˜¯å¦å­˜åœ¨Long spaceId = pictureUploadRequest.getSpaceId();
if (spaceId != null) {
    Space space = spaceService.getById(spaceId);
    ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");
    // å¿…é¡»ç©ºé—´åˆ›å»ºäººï¼ˆç®¡ç†å‘˜ï¼‰æ‰èƒ½ä¸Šä¼ if (!loginUser.getId().equals(space.getUserId())) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, "æ²¡æœ‰ç©ºé—´æƒé™");
    }
}
```

3ï¼‰å¦‚æœæ˜¯æ›´æ–°å›¾Øœç‰‡ï¼Œéœ€è¦æ ¡éªŒæ›´æ–°æ—¶ä¼ é€’çš„ spaceId å’Œå·²æœ‰å›¾ç‰‡çš„ spaceId æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœæ›´æ–°æ—¶æœªä¼ é€’ spaceIdï¼Œåˆ™å¤ç”¨åŸæœ‰å›¾ç‰‡çš„ spaceIdã€‚ä»£ç å¦‚ä¸‹ï¼š


```Java
// å¦‚æœæ˜¯æ›´æ–°å›¾ç‰‡ï¼Œéœ€è¦æ ¡éªŒå›¾ç‰‡æ˜¯å¦å­˜åœ¨if (pictureId != null) {
    Picture oldPicture = this.getById(pictureId);
    ThrowUtils.throwIf(oldPicture == null, ErrorCode.NOT_FOUND_ERROR, "å›¾ç‰‡ä¸å­˜åœ¨");
    // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯ç¼–è¾‘if (!oldPicture.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
    }
    // æ ¡éªŒç©ºé—´æ˜¯å¦ä¸€è‡´// æ²¡ä¼  spaceIdï¼Œåˆ™å¤ç”¨åŸæœ‰å›¾ç‰‡çš„ spaceIdif (spaceId == null) {
        if (oldPicture.getSpaceId() != null) {
            spaceId = oldPicture.getSpaceId();
        }
    } else {
        // ä¼ äº† spaceIdï¼Œå¿…é¡»å’ŒåŸæœ‰å›¾ç‰‡ä¸€è‡´if (ObjUtil.notEqual(spaceId, oldPicture.getSpaceId())) {
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç©ºé—´ id ä¸ä¸€è‡´");
        }
    }
}
```

4ï¼‰ä¹‹å‰æ˜¯ØœæŒ‰ç”¨æˆ·åˆ’åˆ†å›¾ç‰‡ä¸Šä¼ ç›®å½•çš„ï¼Œç°åœ¨å¦‚æœæœ‰ spaceIdï¼Œå¯ä»¥æŒ‰ç…§ç©ºé—´æ¥åˆ’åˆ†å›¾ç‰‡ä¸Šä¼ ç›®å½•ã€‚


```Java
// æŒ‰ç…§ç”¨æˆ· id åˆ’åˆ†ç›®å½• => æŒ‰ç…§ç©ºé—´åˆ’åˆ†ç›®å½•
String uploadPathPrefix;
if (spaceId == null) {
    uploadPathPrefix = String.format("public/%s", loginUser.getId());
} else {
    uploadPathPrefix = String.format("space/%s", spaceId);
}
```

5ï¼‰æ’å…¥ Øœ/ æ›´æ–°æ•°æ®æ—¶ï¼Œå°† spaceId è®¾ç½®åˆ° Picture å¯¹è±¡ä¸­ï¼š


```Java
// æ„é€ è¦å…¥åº“çš„å›¾ç‰‡ä¿¡æ¯Picture picture = new Picture();
// è¡¥å……è®¾ç½® spaceId
picture.setSpaceId(spaceId);
```

### åˆ é™¤å›¾ç‰‡

å¦‚æœè¦åˆ é™¤çš„å›¾Øœç‰‡æœ‰ç©ºé—´ idï¼Œè¡¨ç¤ºæ˜¯ç”¨æˆ·ä¸Šä¼ åˆ°ç§æœ‰ç©ºé—´ä¸­çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆç™»å½•ç”¨æˆ·å¿…é¡»æ˜¯ç©ºé—´çš„ç®¡ç†å‘˜ï¼ˆä¹Ÿå°±æ˜¯åˆ›å»ºè€…ï¼‰ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¹Ÿä¸èƒ½éšæ„åˆ é™¤ç§æœ‰ç©ºé—´çš„å›¾ç‰‡ã€‚

1ï¼‰å› ä¸ºåˆ Øœé™¤å›¾ç‰‡å’Œç¼–è¾‘å›¾ç‰‡çš„æƒé™æ§åˆ¶æ˜¯ä¸€æ ·çš„ï¼ˆæœ‰åˆ é™¤æƒé™å°±æœ‰ç¼–è¾‘æƒé™ï¼‰ï»¿ï¼Œå¯ä»¥å°†è¿™æ®µæƒé™æ ¡éªŒé€»è¾‘å°è£…ä¸ºä¸€ä¸ªæ–¹æ³•ï¼šOTsSx2bzs2C13D2pB4s4on5rzOarAwg0YtGpfccE/pk=


```Java
@Overridepublic void checkPictureAuth(User loginUser, Picture picture) {
    Long spaceId = picture.getSpaceId();
    if (spaceId == null) {
        // å…¬å…±å›¾åº“ï¼Œä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯æ“ä½œif (!picture.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
    } else {
        // ç§æœ‰ç©ºé—´ï¼Œä»…ç©ºé—´ç®¡ç†å‘˜å¯æ“ä½œif (!picture.getUserId().equals(loginUser.getId())) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
    }
}
```

2ï¼‰åŸæœ¬åˆ é™¤å›¾ç‰‡ dØœeletePicture é€»è¾‘å¾ˆç®€å•ï¼Œç›´æ¥å†™åˆ°äº† Controller ä¸­ï¼Œç°åœ¨æœ‰äº†æ›´å¤šé€»è¾‘ï¼Œå»ºè®®å°è£…ä¸º serviceï¼Œå¹¶åŒæ­¥ä¿®æ”¹ Controller æ¥è°ƒç”¨ Serviceã€‚

åˆ é™¤å›¾ç‰‡æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š


```Java
@Overridepublic void deletePicture(long pictureId, User loginUser) {
    ThrowUtils.throwIf(pictureId <= 0, ErrorCode.PARAMS_ERROR);
    ThrowUtils.throwIf(loginUser == null, ErrorCode.NO_AUTH_ERROR);
    // åˆ¤æ–­æ˜¯å¦å­˜åœ¨Picture oldPicture = this.getById(pictureId);
    ThrowUtils.throwIf(oldPicture == null, ErrorCode.NOT_FOUND_ERROR);
    // æ ¡éªŒæƒé™
    checkPictureAuth(loginUser, oldPicture);
    // æ“ä½œæ•°æ®åº“boolean result = this.removeById(pictureId);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    // å¼‚æ­¥æ¸…ç†æ–‡ä»¶this.clearPictureFile(oldPicture);
}
```

### ç¼–è¾‘å›¾ç‰‡

è·Ÿåˆ é™¤å›¾ç‰‡çš„æƒé™æ ¡ØœéªŒé€»è¾‘ä¸€æ ·ï¼Œå¦‚æœè¦ç¼–è¾‘çš„å›¾ç‰‡æœ‰ç©ºé—´ idï¼Œè¡¨ç¤ºæ˜¯ç”¨æˆ·ä¸Šä¼ åˆ°ç§æœ‰ç©ºé—´ä¸­çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆç™»å½•ç”¨æˆ·å¿…é¡»æ˜¯ç©ºé—´çš„ç®¡ç†å‘˜ï¼ˆä¹Ÿå°±æ˜¯åˆ›å»ºè€…ï¼‰ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¹Ÿä¸èƒ½éšæ„ç¼–è¾‘ç§æœ‰ç©ºé—´çš„å›¾ç‰‡ã€‚

å°† editØœPicture æ–¹æ³•æŠ½è±¡åˆ° Service ä¸­ï¼Œå¹¶åŒæ­¥ä¿®æ”¹ Controller æ¥è°ƒç”¨ Serviceã€‚ä»£ç å¦‚ä¸‹ï¼š


```Java
@Overridepublic void editPicture(PictureEditRequest pictureEditRequest, User loginUser) {
    // åœ¨æ­¤å¤„å°†å®ä½“ç±»å’Œ DTO è¿›è¡Œè½¬æ¢Picture picture = new Picture();
    BeanUtils.copyProperties(pictureEditRequest, picture);
    // æ³¨æ„å°† list è½¬ä¸º string
    picture.setTags(JSONUtil.toJsonStr(pictureEditRequest.getTags()));
    // è®¾ç½®ç¼–è¾‘æ—¶é—´
    picture.setEditTime(new Date());
    // æ•°æ®æ ¡éªŒthis.validPicture(picture);
    // åˆ¤æ–­æ˜¯å¦å­˜åœ¨long id = pictureEditRequest.getId();
    Picture oldPicture = this.getById(id);
    ThrowUtils.throwIf(oldPicture == null, ErrorCode.NOT_FOUND_ERROR);
    // æ ¡éªŒæƒé™
    checkPictureAuth(loginUser, oldPicture);
    // è¡¥å……å®¡æ ¸å‚æ•°this.fillReviewParams(picture, loginUser);
    // æ“ä½œæ•°æ®åº“boolean result = this.updateById(picture);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
}
```

ç”±äºæ›´æ–°å›¾ç‰‡æ˜¯ç»™ç®¡ç†å‘˜ä½¿ç”¨çš„æ¥å£ï¼Œå¯ä»¥æš‚æ—¶ä¸ä¿®æ”¹ã€‚

### æŸ¥è¯¢å›¾ç‰‡

ç”¨æˆ·æ— æ³•æŸ¥Øœè¯¢åˆ°ç§æœ‰ç©ºé—´çš„å›¾ç‰‡ï¼Œåªèƒ½æŸ¥è¯¢å…¬å…±å›¾åº“ï¼Œå•æ¡æŸ¥è¯¢å’Œåˆ†é¡µæŸ¥è¯¢éƒ½è¦æ·»åŠ è¿™ä¸ªé€»è¾‘ã€‚

1ï¼‰æ ¹æ® id æŸ¥è¯¢æ¥å£ getPictureVOByIdea

å¦‚æœæŸ¥è¯¢å‡ºØœçš„å›¾ç‰‡æœ‰ spaceIdï¼Œåˆ™è¿ç”¨è·Ÿåˆ é™¤å›¾ç‰‡ä¸€æ ·çš„æ ¡éªŒé€»è¾‘ï¼Œä»…ç©ºé—´ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ï¼š


```Java
// æŸ¥è¯¢æ•°æ®åº“Picture picture = pictureService.getById(id);
ThrowUtils.throwIf(picture == null, ErrorCode.NOT_FOUND_ERROR);
// ç©ºé—´æƒé™æ ¡éªŒLong spaceId = picture.getSpaceId();
if (spaceId != null) {
    User loginUser = userService.getLoginUser(request);
    pictureService.checkPictureAuth(loginUser, picture);
}
```

2ï¼‰åˆ†é¡µæŸ¥è¯¢Øœæ¥å£ listPictureVOByPageâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚ï»¿â€‚â€‚â€‚â€‚â€‰â€‚â€‚â€‚â€‰â€‚â€‰â€â€‚â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‚â€‚

æŸ¥è¯¢è¯·æ±‚å¢åŠ  spaØœceId å‚æ•°ï¼Œä¸ä¼ åˆ™è¡¨ç¤ºæŸ¥å…¬å…±å›¾åº“ï¼›ä¼ å‚åˆ™è¡¨ç¤ºæŸ¥è¯¢ç‰¹å®šç©ºé—´ id ä¸‹çš„å›¾ç‰‡ï¼Œæ­¤æ—¶ç™»å½•ç”¨æˆ·å¿…é¡»æ˜¯ç©ºé—´çš„ç®¡ç†å‘˜ï¼ˆå…¶ä»–ç”¨æˆ·æ— æ³•æŸ¥çœ‹åˆ«äººç©ºé—´çš„å›¾ç‰‡ï¼‰ï¼Œå¹¶ä¸”ä¸éœ€è¦æŒ‡å®šå®¡æ ¸æ¡ä»¶ï¼ˆç§æœ‰ç©ºé—´æ²¡æœ‰å®¡æ ¸æœºåˆ¶ï¼‰ã€‚

å…ˆç»™è¯·æ±‚å°Øœè£…ç±» PictureQueryRequest å’Œ QueryWrapper è¡¥å……ç©ºé—´ id çš„æŸ¥è¯¢æ¡ä»¶ã€‚

PictureQueryRequest æ–°å¢ä»£ç ï¼š


```Java
/**
 * ç©ºé—´ id
 */private Long spaceId;

/**
 * æ˜¯å¦åªæŸ¥è¯¢ spaceId ä¸º null çš„æ•°æ®
 */private boolean nullSpaceId;
```

QueryWrapper æ–°å¢ä»£ç ï¼š


```Java
queryWrapper.eq(ObjUtil.isNotEmpty(spaceId), "spaceId", spaceId);
queryWrapper.isNull(nullSpaceId, "spaceId");
```

ç„¶åç»™æ¥å£Øœå¢åŠ æƒé™æ ¡éªŒï¼Œé’ˆå¯¹å…¬å¼€å›¾åº“å’Œç§æœ‰ç©ºé—´è®¾ç½®ä¸åŒçš„æŸ¥è¯¢æ¡ä»¶ï¼š


```Java
// ç©ºé—´æƒé™æ ¡éªŒLong spaceId = pictureQueryRequest.getSpaceId();
// å…¬å¼€å›¾åº“if (spaceId == null) {
    // æ™®é€šç”¨æˆ·é»˜è®¤åªèƒ½æŸ¥çœ‹å·²è¿‡å®¡çš„å…¬å¼€æ•°æ®
    pictureQueryRequest.setReviewStatus(PictureReviewStatusEnum.PASS.getValue());
    pictureQueryRequest.setNullSpaceId(true);
} else {
    // ç§æœ‰ç©ºé—´User loginUser = userService.getLoginUser(request);
    Space space = spaceService.getById(spaceId);
    ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");
    if (!loginUser.getId().equals(space.getUserId())) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, "æ²¡æœ‰ç©ºé—´æƒé™");
    }
}
```

è€ƒè™‘åˆ°ç§æœ‰ç©ºé—´Øœçš„å›¾ç‰‡æ›´æ–°é¢‘ç‡ä¸å¥½æŠŠæ¡ï¼Œä¹‹å‰ç¼–å†™çš„ç¼“å­˜åˆ†é¡µæŸ¥è¯¢å›¾ç‰‡æ¥å£å¯ä»¥æš‚ä¸ä½¿ç”¨å’Œä¿®æ”¹ï¼Œå¯ä»¥å°†è¯¥æ¥å£æ ‡è®°ä¸º @Deprecated è¡¨ç¤ºå·²åºŸå¼ƒã€‚

## ç©ºé—´çº§åˆ«å’Œé™é¢æ§åˆ¶

éœ€æ±‚ï¼šæ¯æ¬¡Øœä¸Šä¼ å›¾ç‰‡å‰ï¼Œéƒ½è¦æ ¡éªŒç©ºé—´å‰©ä½™é¢åº¦æ˜¯å¦è¶³å¤Ÿï¼›æ¯æ¬¡ä¸Šä¼ å’Œåˆ é™¤å›¾ç‰‡æ—¶ï¼Œéƒ½è¦æ›´æ–°å·²ä½¿ç”¨çš„é¢åº¦ã€‚

### ä¸Šä¼ å›¾ç‰‡æ—¶æ ¡éªŒå’Œæ›´æ–°é¢åº¦

æˆ‘ä»¬å‘ç°ï¼Œç›®å‰ä¸ŠØœä¼ å›¾ç‰‡çš„ä»£ç å·²ç»æ¯”è¾ƒå¤æ‚äº†ï¼Œå¦‚æœæƒ³è¦å†å¢åŠ éå¸¸ä¸¥æ ¼ç²¾ç¡®çš„æ ¡éªŒé€»è¾‘ï¼Œéœ€è¦åœ¨ä¸Šä¼ å›¾ç‰‡åˆ°å¯¹è±¡å­˜å‚¨å‰è‡ªå·±è§£ææ–‡ä»¶çš„å¤§å°ã€å†è®¡ç®—æ˜¯å¦è¶…é¢ï¼Œå¯èƒ½è¿˜è¦åŠ é”ï¼Œæƒ³æƒ³éƒ½å¤´ç–¼ï¼

è¿™æ—¶ä½ ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ

å½“æŠ€æœ¯å®ç°æ¯”è¾ƒå¤æ‚æ—¶ï¼Œæˆ‘ä»¬ä¸å¦¨æ€è€ƒä¸€ä¸‹èƒ½å¦å¯¹ä¸šåŠ¡è¿›è¡Œä¼˜åŒ–ã€‚

æ¯”å¦‚ï¼š

* å•å¼ å›¾ç‰‡æœ€å¤§æ‰ 2Mï¼Œé‚£ä¹ˆå³ä½¿ç©ºé—´æ»¡äº†å†å…è®¸ä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œå½±å“ä¹Ÿä¸å¤§
* å³ä½¿æœ‰ç”¨æˆ·åœ¨è¶…é¢å‰çš„ç¬é—´å¤§é‡ä¸Šä¼ å›¾ç‰‡ï¼Œå¯¹ç³»ç»Ÿçš„å½±å“ä¹Ÿå¹¶ä¸å¤§ã€‚åç»­å¯ä»¥é€šè¿‡é™æµ + å®šæ—¶ä»»åŠ¡æ£€æµ‹ç©ºé—´ç­‰ç­–ç•¥ï¼Œå°½æ—©å‘ç°è¿™äº›ç‰¹æ®Šæƒ…å†µå†è¿›è¡Œå®šåˆ¶å¤„ç†ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå°±åˆ©ç”¨ä¸šåŠ¡è®¾è®¡å·§å¦™èŠ‚çº¦äº†å¼€å‘æˆæœ¬ã€‚

1ï¼‰ä¿®æ”¹ ØœuploadPicture æ–¹æ³•ï¼Œç¼–å†™æ ¡éªŒä»£ç ï¼Œåªéœ€è¦å¢åŠ  2 ä¸ªåˆ¤æ–­æ¡ä»¶ï¼š


```Java
// ç©ºé—´æƒé™æ ¡éªŒLong spaceId = pictureUploadRequest.getSpaceId();
if (spaceId != null) {
    Space space = spaceService.getById(spaceId);
    ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");
    // å¿…é¡»ç©ºé—´åˆ›å»ºäººï¼ˆç®¡ç†å‘˜ï¼‰æ‰èƒ½ä¸Šä¼ if (!loginUser.getId().equals(space.getUserId())) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, "æ²¡æœ‰ç©ºé—´æƒé™");
    }
    // æ ¡éªŒé¢åº¦if (space.getTotalCount() >= space.getMaxCount()) {
        throw new BusinessException(ErrorCode.OPERATION_ERROR, "ç©ºé—´æ¡æ•°ä¸è¶³");
    }
    if (space.getTotalSize() >= space.getMaxSize()) {
        throw new BusinessException(ErrorCode.OPERATION_ERROR, "ç©ºé—´å¤§å°ä¸è¶³");
    }
}
```

2ï¼‰ä¿å­˜å›¾Øœç‰‡è®°å½•æ—¶ï¼Œéœ€è¦ä½¿ç”¨äº‹åŠ¡æ›´æ–°é¢åº¦ï¼Œå¦‚æœé¢åº¦æ›´æ–°å¤±è´¥ï¼Œä¹Ÿä¸ç”¨å°†å›¾ç‰‡è®°å½•ä¿å­˜ã€‚

ä¾ç„¶æ˜¯ä½¿ç”¨Øœ transactionTemplate äº‹åŠ¡ç®¡ç†å™¨ï¼Œå°†æ‰€æœ‰æ•°æ®åº“æ“ä½œåˆ°ä¸€èµ·å³å¯ï¼š


```Java
// å¼€å¯äº‹åŠ¡Long finalSpaceId = spaceId;
transactionTemplate.execute(status -> {
    boolean result = this.saveOrUpdate(picture);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR, "å›¾ç‰‡ä¸Šä¼ å¤±è´¥");
    if (finalSpaceId != null) {
        boolean update = spaceService.lambdaUpdate()
                .eq(Space::getId, finalSpaceId)
                .setSql("totalSize = totalSize + " + picture.getPicSize())
                .setSql("totalCount = totalCount + 1")
                .update();
        ThrowUtils.throwIf(!update, ErrorCode.OPERATION_ERROR, "é¢åº¦æ›´æ–°å¤±è´¥");
    }
    return picture;
});
```

### åˆ é™¤å›¾ç‰‡åæ›´æ–°é¢åº¦

åˆ é™¤å›¾ç‰‡æ—¶ï¼Œè¦é‡ŠØœæ”¾é¢åº¦ã€‚åŒæ ·ä½¿ç”¨ transactionTemplate äº‹åŠ¡ç®¡ç†å™¨ï¼Œå°†åˆ é™¤å›¾ç‰‡å’Œæ›´æ–°é¢åº¦çš„æ•°æ®åº“æ“ä½œè§†ä¸ºä¸€ä¸ªæ•´ä½“ï¼Œé¿å…åˆ é™¤å›¾ç‰‡åæ²¡é‡Šæ”¾é¢åº¦çš„æƒ…å†µã€‚


```Java
// æ ¡éªŒæƒé™
checkPictureAuth(loginUser, oldPicture);
// å¼€å¯äº‹åŠ¡
transactionTemplate.execute(status -> {
    // æ“ä½œæ•°æ®åº“boolean result = this.removeById(pictureId);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    // é‡Šæ”¾é¢åº¦Long spaceId = oldPicture.getSpaceId();
    if (spaceId != null) {
        boolean update = spaceService.lambdaUpdate()
                .eq(Space::getId, spaceId)
                .setSql("totalSize = totalSize - " + oldPicture.getPicSize())
                .setSql("totalCount = totalCount - 1")
                .update();
        ThrowUtils.throwIf(!update, ErrorCode.OPERATION_ERROR, "é¢åº¦æ›´æ–°å¤±è´¥");
    }
    return true;
});
// å¼‚æ­¥æ¸…ç†æ–‡ä»¶this.clearPictureFile(oldPicture);
```

æ³¨æ„ï¼Œè¿™é‡Œæœ‰å¯èƒ½å‡ºØœç°å¯¹è±¡å­˜å‚¨ä¸Šçš„å›¾ç‰‡æ–‡ä»¶å®é™…æ²¡è¢«æ¸…ç†çš„æƒ…å†µã€‚ä½†æ˜¯å¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä¸åº”è¯¥æ„Ÿå—åˆ° â€œåˆ äº†å›¾ç‰‡ç©ºé—´å´æ²¡æœ‰å¢åŠ â€ï¼Œæ‰€ä»¥æ²¡æœ‰å°†è¿™ä¸€æ­¥æ·»åŠ åˆ°äº‹åŠ¡ä¸­ã€‚å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡æ£€æµ‹ä½œä¸ºè¡¥å¿æªæ–½ã€‚R7zfQ2yjmCwaGmgYTa9cW+7DK0YPbs0kpW2reaJf93o=

### æŸ¥è¯¢ç©ºé—´çº§åˆ«åˆ—è¡¨

æœ€åï¼Œæˆ‘ä»¬Øœå†ç¼–å†™ä¸€ä¸ªæ¥å£ï¼Œç”¨äºç»™å‰ç«¯å±•ç¤ºæ‰€æœ‰çš„ç©ºé—´çº§åˆ«ä¿¡æ¯ã€‚

1ï¼‰æ–°å»º SpaceLevel å°è£…ç±»ï¼š


```Java
@Data@AllArgsConstructorpublic class SpaceLevel {

    private int value;

    private String text;

    private long maxCount;

    private long maxSize;
}
```

2ï¼‰åœ¨ SØœpaceController ä¸­ç¼–å†™æ¥å£ï¼Œå°†æšä¸¾è½¬æ¢ä¸ºç©ºé—´çº§åˆ«å¯¹è±¡åˆ—è¡¨ï¼š


```Java
@GetMapping("/list/level")public BaseResponse<List<SpaceLevel>> listSpaceLevel() {
    List<SpaceLevel> spaceLevelList = Arrays.stream(SpaceLevelEnum.values()) // è·å–æ‰€æœ‰æšä¸¾
            .map(spaceLevelEnum -> new SpaceLevel(
                    spaceLevelEnum.getValue(),
                    spaceLevelEnum.getText(),
                    spaceLevelEnum.getMaxCount(),
                    spaceLevelEnum.getMaxSize()))
            .collect(Collectors.toList());
    return ResultUtils.success(spaceLevelList);
}
```

## æ‰©å±•

1ï¼‰åˆ é™¤ç©ºé—´æ—¶ï¼Œå…³è”åˆ é™¤ç©ºé—´å†…çš„å›¾ç‰‡

2ï¼‰ç®¡ç†å‘˜åˆ›å»ºØœç©ºé—´ï¼šç®¡ç†å‘˜å¯ä»¥ä¸ºæŒ‡å®šç”¨æˆ·åˆ›å»ºç©ºé—´ã€‚å¯ä»¥åœ¨åˆ›å»ºç©ºé—´æ—¶å¤šä¼ ä¸€ä¸ª userId å‚æ•°ï¼Œä½†æ˜¯è¦æ³¨æ„åšå¥½æƒé™æ§åˆ¶ï¼Œä»…ç®¡ç†å‘˜å¯ä»¥ä¸ºåˆ«äººåˆ›å»ºç©ºé—´ã€‚

3ï¼‰ç›®å‰æ›´æ–°ä¸Šä¼ Øœå›¾ç‰‡çš„é€»è¾‘è¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜çš„ã€‚æ¯”å¦‚æ›´æ–°å›¾ç‰‡æ—¶ï¼Œå¹¶æ²¡æœ‰åˆ é™¤åŸæœ‰å›¾ç‰‡ã€ä¹Ÿæ²¡æœ‰å‡å°‘åŸæœ‰å›¾ç‰‡å ç”¨çš„ç©ºé—´å’Œé¢åº¦ï¼Œå¯ä»¥é€šè¿‡äº‹åŠ¡ä¸­è¡¥å……é€»è¾‘æˆ–è€…é€šè¿‡å®šæ—¶ä»»åŠ¡æ‰«æåˆ é™¤ã€‚

---

# å‰ç«¯å¼€å‘

## ç©ºé—´ç®¡ç†é¡µé¢

é¦–å…ˆä»æœ€å¥½Øœå¼€å‘çš„ç®¡ç†é¡µé¢åšèµ·ï¼Œæµç¨‹å’Œå…¶ä»–çš„ç®¡ç†é¡µé¢å®Œå…¨ä¸€è‡´ã€‚

### æ–°å»ºè·¯ç”±å’Œèœå•

é¦–å…ˆæ–°å»º `admin/SpaceManagePage.vue` é¡µé¢æ–‡ä»¶ï¼Œåœ¨ `router/index.ts` ä¸­å®šä¹‰è·¯ç”±ï¼š


```TypeScript
{
  path: '/admin/spaceManage',
  name: 'ç©ºé—´ç®¡ç†',
  component: SpaceManagePage,
},
```

åœ¨ GlobalHeader ç»„ä»¶ä¸­è¡¥å……èœå•ï¼š


```TypeScript
{
  key: '/admin/spaceManage',
  label: 'ç©ºé—´ç®¡ç†',
  title: 'ç©ºé—´ç®¡ç†',
},
```

ç”±äºä¹‹å‰å·²ç»Øœç¼–å†™äº†æƒé™æ ¡éªŒé€»è¾‘ï¼Œåœ°å€ä»¥ /admin å¼€å¤´çš„é¡µé¢éƒ½ä¼šé™åˆ¶ä¸ºä»…ç®¡ç†å‘˜å¯è§å’Œå¯ç”¨ï¼Œæ‰€ä»¥æ— éœ€å†ç¼–å†™é¢å¤–çš„æƒé™æ ¡éªŒä»£ç ã€‚

### å®šä¹‰ç©ºé—´å¸¸é‡

å’Œåç«¯ä¸€æ ·Øœï¼Œå‰ç«¯ä¹Ÿæœ‰å¾ˆå¤šåœ°æ–¹è¦ç”¨åˆ°ç©ºé—´çº§åˆ«ä¿¡æ¯ï¼Œå¯ä»¥å®šä¹‰ä¸ºä¸€ä¸ªå¸¸é‡ã€‚

åœ¨ `constants` ç›®å½•ä¸‹æ–°å»º space.ts å¸¸é‡æ–‡ä»¶ï¼Œå®šä¹‰æšä¸¾ä¿¡æ¯ã€å¯¹åº”çš„ä¸­æ–‡æ˜ å°„ã€ä»¥åŠåç»­ç­›é€‰ç©ºé—´çº§åˆ«æ—¶è¦ç”¨åˆ°çš„é€‰é¡¹æ•°ç»„ï¼š


```TypeScript
// ç©ºé—´çº§åˆ«æšä¸¾export const SPACE_LEVEL_ENUM = {
  COMMON: 0,
  PROFESSIONAL: 1,
  FLAGSHIP: 2,
} as const;

// ç©ºé—´çº§åˆ«æ–‡æœ¬æ˜ å°„export const SPACE_LEVEL_MAP: Record<number, string> = {
  0: 'æ™®é€šç‰ˆ',
  1: 'ä¸“ä¸šç‰ˆ',
  2: 'æ——èˆ°ç‰ˆ',
};

// ç©ºé—´çº§åˆ«é€‰é¡¹æ˜ å°„export const SPACE_LEVEL_OPTIONS = Object.keys(SPACE_LEVEL_MAP).map((key) => {
  const value = Number(key); // Convert string key to numberreturn {
    label: SPACE_LEVEL_MAP[value],
    value,
  };
});
```

ğŸ’¡ è¿™ç§ä»£ç å®Œå…¨å¯ä»¥åˆ©ç”¨ AI ç”Ÿæˆã€‚

### å¼€å‘ç®¡ç†é¡µé¢

è·Ÿç”¨æˆ·ç®¡ç†Øœé¡µé¢ç±»ä¼¼ï¼Œé¡µé¢çš„ä¸Šæ–¹æ˜¯æœç´¢æ ï¼Œä¸‹æ–¹æ˜¯è¡¨æ ¼ï¼Œè¡¨æ ¼éœ€è¦æ”¯æŒåˆ†é¡µã€‚

å¤§å¤šæ•°çš„å†…Øœå®¹å¯ä»¥ç›´æ¥å¤ç”¨å…¶ä»–ç®¡ç†é¡µé¢çš„ä»£ç ï¼Œå¯ä»¥å…ˆå¤åˆ¶è¿‡æ¥ï¼Œå†è¿›è¡Œä¿®æ”¹ã€‚

1ï¼‰ç»™è¡¨æ ¼å®šä¹‰å±•ç¤ºçš„åˆ—ï¼š


```TypeScript
const columns = [
  {
    title: 'id',
    dataIndex: 'id',
    width: 80,
  },
  {
    title: 'ç©ºé—´åç§°',
    dataIndex: 'spaceName',
  },
  {
    title: 'ç©ºé—´çº§åˆ«',
    dataIndex: 'spaceLevel',
  },
  {
    title: 'ä½¿ç”¨æƒ…å†µ',
    dataIndex: 'spaceUseInfo',
  },
  {
    title: 'ç”¨æˆ· id',
    dataIndex: 'userId',
    width: 80,
  },
  {
    title: 'åˆ›å»ºæ—¶é—´',
    dataIndex: 'createTime',
  },
  {
    title: 'ç¼–è¾‘æ—¶é—´',
    dataIndex: 'editTime',
  },
  {
    title: 'æ“ä½œ',
    key: 'action',
  },
]
```

2ï¼‰ä»åç«¯è·å–æ•°æ®ï¼Œå¹¶æ”¯æŒæœç´¢å’Œåˆ†é¡µï¼š


```TypeScript
// æ•°æ®const dataList = ref([])
const total = ref(0)

// æœç´¢æ¡ä»¶const searchParams = reactive<API.SpaceQueryRequest>({
  current: 1,
  pageSize: 10,
  sortField: 'createTime',
  sortOrder: 'descend',
})

// åˆ†é¡µå‚æ•°const pagination = computed(() => {
  return {
    current: searchParams.current ?? 1,
    pageSize: searchParams.pageSize ?? 10,
    total: total.value,
    showSizeChanger: true,
    showTotal: (total) => `å…± ${total} æ¡`,
  }
})

// è·å–æ•°æ®const fetchData = async () => {
  const res = await listSpaceByPageUsingPost({
    ...searchParams,
  })
  if (res.data.data) {
    dataList.value = res.data.data.records ?? []
    total.value = res.data.data.total ?? 0
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
}

// é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡onMounted(() => {
  fetchData()
})

// è·å–æ•°æ®const doSearch = () => {
  // é‡ç½®æœç´¢æ¡ä»¶
  searchParams.current = 1fetchData()
}

// è¡¨æ ¼å˜åŒ–å¤„ç†const doTableChange = (page: any) => {
  searchParams.current = page.current
  searchParams.pageSize = page.pageSizefetchData()
}
```

æ³¨æ„ï¼šè·å–æ•°Øœæ®æ—¶ï¼Œè°ƒç”¨çš„æ˜¯ä»…ç®¡ç†å‘˜å¯ç”¨çš„æŸ¥è¯¢æ¥å£ listSpaceByPageUsingPostï¼Œä¸æ˜¯ç»™ç”¨æˆ·ä½¿ç”¨çš„æŸ¥è¯¢åŒ…è£…ç±»æ¥å£ã€‚

3ï¼‰è‡ªå®šä¹‰Øœåˆ—çš„å±•ç¤ºï¼Œæ¯”å¦‚ç©ºé—´çº§åˆ«ã€ä½¿ç”¨æƒ…å†µã€åˆ›å»ºæ—¶é—´ã€ç¼–è¾‘æ—¶é—´ç­‰ï¼š


```PlainText
<template #bodyCell="{ column, record }">
  <!-- ç©ºé—´çº§åˆ« -->
  <template v-if="column.dataIndex === 'spaceLevel'">
    <a-tag>{{ SPACE_LEVEL_MAP[record.spaceLevel] }}</a-tag>
  </template>
  <!-- ä½¿ç”¨æƒ…å†µ -->
  <template v-if="column.dataIndex === 'spaceUseInfo'">
    <div>å¤§å°ï¼š{{ formatSize(record.totalSize) }} / {{ formatSize(record.maxSize) }}</div>
    <div>æ•°é‡ï¼š{{ record.totalCount }} / {{ record.maxCount }}</div>
  </template>
  <template v-else-if="column.dataIndex === 'createTime'">
    {{ dayjs(record.createTime).format('YYYY-MM-DD HH:mm:ss') }}
  </template>
  <template v-else-if="column.dataIndex === 'editTime'">
    {{ dayjs(record.editTime).format('YYYY-MM-DD HH:mm:ss') }}
  </template>
  <template v-else-if="column.key === 'action'">
    <a-space wrap>
      <a-button type="link" :href="`/add_space?id=${record.id}`" target="_blank">
        ç¼–è¾‘
      </a-button>
      <a-button type="link" danger @click="doDelete(record.id)">åˆ é™¤</a-button>
    </a-space>
  </template>
</template>
```

4ï¼‰å¼€å‘æœØœç´¢è¡¨å•ï¼Œæ”¯æŒæŒ‰ç…§ç©ºé—´åç§°ã€ç©ºé—´çº§åˆ«ã€ç”¨æˆ· id æœç´¢ï¼š


```PlainText
<a-form layout="inline" :model="searchParams" @finish="doSearch">
  <a-form-item label="ç©ºé—´åç§°" name="spaceName">
    <a-input v-model:value="searchParams.spaceName" placeholder="è¯·è¾“å…¥ç©ºé—´åç§°" allow-clear />
  </a-form-item>
  <a-form-item label="ç©ºé—´çº§åˆ«" name="spaceLevel">
    <a-select
      v-model:value="searchParams.spaceLevel"
      :options="SPACE_LEVEL_OPTIONS"
      placeholder="è¯·è¾“å…¥ç©ºé—´çº§åˆ«"
      style="min-width: 180px"
      allow-clear
    />
  </a-form-item>
  <a-form-item label="ç”¨æˆ· id" name="userId">
    <a-input v-model:value="searchParams.userId" placeholder="è¯·è¾“å…¥ç”¨æˆ· id" allow-clear />
  </a-form-item>
  <a-form-item>
    <a-button type="primary" html-type="submit">æœç´¢</a-button>
  </a-form-item>
</a-form>
```

5ï¼‰è¡¥å……æ“ä½œæŒ‰é’®ã€‚

å¯ä»¥åœ¨æœç´¢Øœè¡¨å•ä¸Šæ–°å¢ä¸€è¡Œï¼Œå±•ç¤ºæ ‡é¢˜å’Œåˆ›å»ºç©ºé—´æŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®ä¼šæ‰“å¼€åˆ›å»ºç©ºé—´é¡µé¢ï¼š


```PlainText
<a-flex justify="space-between">
  <h2>ç©ºé—´ç®¡ç†</h2>
  <a-space>
    <a-button type="primary" href="/add_space" target="_blank">+ åˆ›å»ºç©ºé—´</a-button>
  </a-space>
</a-flex>
```

åœ¨è¡¨æ ¼æ“ä½œåˆ—ä¸­ï¼Œä¹Ÿè¦è¡¥å……ç¼–è¾‘æŒ‰é’®ï¼Œç‚¹å‡»åæ‰“å¼€ç¼–è¾‘ç©ºé—´é¡µé¢ï¼š


```PlainText
<a-space wrap>
  <a-button type="link" :href="`/add_space?id=${record.id}`" target="_blank">
    ç¼–è¾‘
  </a-button>
  <a-button type="link" danger @click="doDelete(record.id)">åˆ é™¤</a-button>
</a-space>
```

æœ€ç»ˆé¡µé¢æ•ˆæœå¦‚å›¾ï¼š

![](assets/ODrNbryUGoRVwqxR5Ovcy6G1n1e.png)

## åˆ›Øœå»ºç©ºé—´é¡µé¢â€‚â€‚â€‚â€‚â€Œâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€Œâ€‚â€‚â€‰â€‚â€‚â€‚â€‰â€‚â€‰ï»¿â€‚â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‚â€â€‚

### 1ã€æ–°å»ºè·¯ç”±

é¦–å…ˆæ–°å»º `AddSpacePage.vue` é¡µé¢æ–‡ä»¶ï¼Œåœ¨ `router/index.ts` ä¸­å®šä¹‰è·¯ç”±ï¼š


```TypeScript
{
  path: '/add_space',
  name: 'åˆ›å»ºç©ºé—´',
  component: AddSpacePage,
},
```

### 2ã€å¼€å‘è¡¨å•

è¯¥é¡µé¢çš„ä¸»Øœä½“æ˜¯è¡¨å•ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶æ‰¹é‡åˆ›å»ºå›¾ç‰‡é¡µé¢ï¼Œç•¥ä½œä¿®æ”¹å³å¯ã€‚

1ï¼‰å…ˆä¿®æ”¹è¡¨å•é¡¹ï¼Œå…è®¸å¡«å†™ç©ºé—´åç§°ã€ç©ºé—´çº§åˆ«ï¼š


```PlainText
<a-form layout="vertical" :model="formData" @finish="handleSubmit">
  <a-form-item label="ç©ºé—´åç§°" name="spaceName">
    <a-input v-model:value="formData.spaceName" placeholder="è¯·è¾“å…¥ç©ºé—´åç§°" allow-clear />
  </a-form-item>
  <a-form-item label="ç©ºé—´çº§åˆ«" name="spaceLevel">
    <a-select
      v-model:value="formData.spaceLevel"
      :options="SPACE_LEVEL_OPTIONS"
      placeholder="è¯·è¾“å…¥ç©ºé—´çº§åˆ«"
      style="min-width: 180px"
      allow-clear
    />
  </a-form-item>
  <a-form-item>
    <a-button type="primary" html-type="submit" style="width: 100%" :loading="loading">
      æäº¤
    </a-button>
  </a-form-item>
</a-form>
```

2ï¼‰å®šä¹‰è¡¨å•é¡¹ç»“æ„å’Œ loading å˜é‡ï¼š


```TypeScript
const formData = reactive<API.SpaceAddRequest | API.SpaceUpdateRequest>({
  spaceName: '',
  spaceLevel: SPACE_LEVEL_ENUM.COMMON,
})
const loading = ref(false)
```

3ï¼‰ç¼–å†™æØœäº¤å‡½æ•°ï¼Œåˆ›å»ºæˆåŠŸåä¼šè¾“å‡ºä¿¡æ¯å¹¶è·³è½¬åˆ°æ–°åˆ›å»ºçš„ç©ºé—´è¯¦æƒ…é¡µï¼š


```TypeScript
const handleSubmit = async (values: any) => {
  loading.value = true;
  const res = await addSpaceUsingPost({
    ...formData,
  })
  if (res.data.code === 0 && res.data.data) {
    message.success("åˆ›å»ºæˆåŠŸ")
    router.push({
      path: `/space/${res.data.data}`,
    })
  } else {
    message.error('åˆ›å»ºå¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false;
}
```

### 3ã€å±•ç¤ºç©ºé—´çº§åˆ«ä¿¡æ¯

æ— è®ºæ˜¯ç”¨æˆ·å’Œç®¡ç†Øœå‘˜ï¼Œéƒ½éœ€è¦äº†è§£ç©ºé—´çº§åˆ«ä¿¡æ¯ï¼›è€Œä¸”ç›®å‰ç”¨æˆ·åªèƒ½å¼€é€šæ™®é€šç‰ˆç©ºé—´ï¼Œè¿™ä¸ªä¿¡æ¯ä¹Ÿè¦åŒæ­¥ç»™ç”¨æˆ·ã€‚ç”±äºç³»ç»Ÿä¸æ”¯æŒæ”¯ä»˜ï¼Œå¯ä»¥å…ˆè®©æœ‰éœ€æ±‚çš„ç”¨æˆ·ä¸»åŠ¨è”ç³»ç®¡ç†å‘˜ï¼Œè¿™æ˜¯æœ€å¿«çš„ç›ˆåˆ©æ–¹å¼ã€‚

æ‰€ä»¥å¯ä»¥åœ¨è¡¨å•ä¸‹æ–°å¢å±•ç¤ºè¿™äº›ä¿¡æ¯çš„å¡ç‰‡ã€‚

1ï¼‰å…ˆåˆ©ç”¨ç»„ä»¶åº“çš„ [å¡ç‰‡ç»„ä»¶](https://antdv.com/components/card-cn) å¼€å‘é¡µé¢å†…å®¹ï¼š


```JavaScript
<a-card title="ç©ºé—´çº§åˆ«ä»‹ç»">
  <a-typography-paragraph>
    * ç›®å‰ä»…æ”¯æŒå¼€é€šæ™®é€šç‰ˆï¼Œå¦‚éœ€å‡çº§ç©ºé—´ï¼Œè¯·è”ç³»
    <a href="https://chengfushi.blog.csdn.net" target="_blank">è€„è€„çˆ±å“ˆæ°”</a>ã€‚
  </a-typography-paragraph>
  <a-typography-paragraph v-for="spaceLevel in spaceLevelList">
    {{ spaceLevel.text }}ï¼š å¤§å° {{ formatSize(spaceLevel.maxSize) }}ï¼Œ æ•°é‡
    {{ spaceLevel.maxCount }}
  </a-typography-paragraph>
</a-card>
```

2ï¼‰è¯·æ±‚åç«¯è·å–ç©ºé—´çº§åˆ«åˆ—è¡¨ï¼š


```TypeScript
const spaceLevelList = ref<API.SpaceLevel[]>([])

// è·å–ç©ºé—´çº§åˆ«const fetchSpaceLevelList = async () => {
  const res = await listSpaceLevelUsingGet()
  if (res.data.code === 0 && res.data.data) {
    spaceLevelList.value = res.data.data
  } else {
    message.error('åŠ è½½ç©ºé—´çº§åˆ«å¤±è´¥ï¼Œ' + res.data.message)
  }
}

onMounted(() => {
  fetchSpaceLevelList()
})
```

æ•ˆæœå¦‚å›¾ï¼š

![](assets/Ke6abcnSoooBPCxrArGcqCPIn3e.png)

#### 4ã€æ›´æ–°ç©ºé—´é¡µé¢

ä»…ç®¡ç†å‘˜å¯ä»¥Øœæ›´æ–°ç©ºé—´ï¼Œä»ç©ºé—´ç®¡ç†é¡µé¢å¯ä»¥è·³è½¬åˆ°ç¼–è¾‘ç©ºé—´é¡µé¢ã€‚ç”±äºç¼–è¾‘é¡µé¢å’Œåˆ›å»ºé¡µé¢éƒ½æ˜¯è¡¨å•é¡¹ï¼Œç»“æ„ä¸€è‡´ï¼Œå¯ä»¥å¤ç”¨åˆ›å»ºé¡µé¢ã€‚

1ï¼‰è·Ÿä¹‹å‰å¼€å‘Øœçš„ä¸Šä¼ å›¾ç‰‡é¡µé¢ç±»ä¼¼ï¼Œå¯ä»¥åˆ©ç”¨ url çš„ querystring ä¼ é€’è¦ä¿®æ”¹çš„ spaceId å‚æ•°ï¼Œåœ¨é¡µé¢ä¸­è·å–åˆ°å·²æœ‰ç©ºé—´æ•°æ®å¹¶å¡«å……è¡¨å•é¡¹ã€‚


```TypeScript
const route = useRoute()
const oldSpace = ref<API.SpaceVO>()

// è·å–è€æ•°æ®const getOldSpace = async () => {
  // è·å–æ•°æ®const id = route.query?.idif (id) {
    const res = await getSpaceVoByIdUsingGet({
      id: id,
    })
    if (res.data.code === 0 && res.data.data) {
      const data = res.data.data
      oldSpace.value = data
      formData.spaceName = data.spaceName
      formData.spaceLevel = data.spaceLevel
    }
  }
}

// é¡µé¢åŠ è½½æ—¶ï¼Œè¯·æ±‚è€æ•°æ®onMounted(() => {
  getOldSpace()
})
```

2ï¼‰ä¿®æ”¹æØœäº¤å‡½æ•°ï¼Œæ ¹æ®æ˜¯å¦æœ‰ spaceId å†³å®šæ˜¯è°ƒç”¨æ›´æ–°æ¥å£è¿˜æ˜¯åˆ›å»ºæ¥å£ï¼š


```TypeScript
const handleSubmit = async (values: any) => {
  const spaceId = oldSpace.value?.id
  loading.value = truelet res
  // æ›´æ–°if (spaceId) {
    res = await updateSpaceUsingPost({
      id: spaceId,
      ...formData,
    })
  } else {
    // åˆ›å»º
    res = await addSpaceUsingPost({
      ...formData,
    })
  }
  if (res.data.code === 0 && res.data.data) {
    message.success('æ“ä½œæˆåŠŸ')
    let path = `/space/${spaceId ?? res.data.data}`
    router.push({
      path,
    })
  } else {
    message.error('æ“ä½œå¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}
```

#### æ‰©å±•

1ï¼‰æ”¯æŒç®¡Øœç†å‘˜å¡«å†™ç©ºé—´å¤§å°ã€ç©ºé—´æ¡æ•°ï¼Œä»è€Œå®ç°ç±»ä¼¼ â€œèµ„æºæ‰©å®¹åŒ…â€ çš„åŠŸèƒ½ã€‚

2ï¼‰é€‰æ‹©ç©ºé—´çº§åˆ«æ—¶è‡ªåŠ¨å¡«å……ç©ºé—´å¤§å°ã€ç©ºé—´æ¡æ•°è¿™ä¸¤ä¸ªè¡¨å•é¡¹ã€‚

## ç”¨æˆ·åˆ›å»ºç§æœ‰ç©ºé—´

ç°åœ¨å·²ç»æœ‰Øœäº†åˆ›å»ºç©ºé—´çš„é¡µé¢ï¼Œåªéœ€è¦è¡¥å……è¿›å…¥åˆ°è¯¥é¡µé¢çš„å…¥å£å³å¯ã€‚

### 1ã€å±•ç¤ºç§æœ‰ç©ºé—´å…¥å£

é¢„æœŸæ•ˆæœæ˜¯ï¼šå·¦Øœä¾§æ–°å¢ç›®å½•æ ï¼Œå±•ç¤º â€œå…¬å…±å›¾åº“â€ å’Œ â€œæˆ‘çš„ç©ºé—´â€ èœå•é¡¹ï¼Œç‚¹å‡» â€œæˆ‘çš„ç©ºé—´â€ åï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºè¿‡ç©ºé—´ï¼Œåˆ™è‡ªåŠ¨è·³è½¬åˆ°åˆ›å»ºç©ºé—´é¡µé¢ã€‚

1ï¼‰å¯ä»¥åŸºäºç»„ä»¶åº“çš„ [Layout Sider ç»„ä»¶](https://antdv.com/components/layout-cn#components-layout-demo-top-side-2) å®ç° â€œé¡¶éƒ¨ - ä¾§è¾¹å¸ƒå±€â€ï¼š

è·Ÿ GlobalHeader å…¨å±€é¡¶éƒ¨æ ç»„ä»¶ä¸€æ ·ï¼Œæˆ‘ä»¬å•ç‹¬å°è£…ä¸€ä¸ª GlobalSider å…¨å±€ä¾§è¾¹æ ç»„ä»¶ï¼Œåœ¨ Sider ç»„ä»¶å†…ä½¿ç”¨ [å†…åµŒèœå•ç»„ä»¶](https://antdv.com/components/menu-cn#components-menu-demo-inline)ï¼Œå…ˆåˆ©ç”¨ Demo æŠŠé¡µé¢ç»“æ„æ’‘èµ·æ¥ï¼š


```PlainText
<div id="globalSider">
  <a-layout-sider class="sider" width="200">
    <a-menu
      mode="inline"
      v-model:selectedKeys="current"
      :items="menuItems"
      @click="doMenuClick"
    />
  </a-layout-sider>
</div>
```

åœ¨ BasicLayout å…¨å±€å¸ƒå±€ä¸­å¼•å…¥ä¾§è¾¹æ ç»„ä»¶ï¼š


```PlainText
<a-layout>
  <GlobalSider class="sider" />
  <a-layout-content class="content">
    <router-view />
  </a-layout-content>
</a-layout>
```

ä¼˜åŒ–ä¸€ä¸‹æ ·Øœå¼ï¼Œéšè—å¤šä½™çš„è¾¹æ¡†ï¼Œä¸‹åˆ—ä»£ç ä»…å±•ç¤ºäº†æ–°å¢æˆ–ä¿®æ”¹çš„æ ·å¼ï¼š1jGyT1jdedQgDNFYA8T3BC8Rpod+tQXglYFmkZuCZXA=Dlfw8NwnEDAWu8E/AQcY7dm3A98behgssP1uNM9pOf8=


```CSS
#basicLayout .header {
  margin-bottom: 1px;
}

#basicLayout .content {
  padding: 28px;
}

#basicLayout .sider {
  background: #fff;
  padding-top: 20px;
  border-right: 0.5px solid #eee;
}

#basicLayout :deep(.ant-menu-root) {
  border-bottom: none !important;
  border-inline-end: none !important;
}
```

2ï¼‰å¼€å‘ GØœlobalSider ç»„ä»¶ã€‚è·Ÿ GlobalHeader ç»„ä»¶ä¸€æ ·ï¼Œéœ€è¦å®šä¹‰èœå•é¡¹ã€å®ç°ç‚¹å‡»è·³è½¬ã€æ ¹æ®è·¯ç”±è‡ªåŠ¨é«˜äº®ã€‚


```TypeScript
// èœå•åˆ—è¡¨const menuItems = [
  {
    key: '/',
    label: 'å…¬å…±å›¾åº“',
    icon: () => h(PictureOutlined),
  },
  {
    key: '/my_space',
    label: 'æˆ‘çš„ç©ºé—´',
    icon: () => h(UserOutlined),
  },
]

const router = useRouter()

// å½“å‰é€‰ä¸­èœå•const current = ref<string[]>([])
// ç›‘å¬è·¯ç”±å˜åŒ–ï¼Œæ›´æ–°å½“å‰é€‰ä¸­èœå•
router.afterEach((to, from, failure) => {
  current.value = [to.path]
})

// è·¯ç”±è·³è½¬äº‹ä»¶const doMenuClick = ({ key }: { key: string }) => {
  router.push({
    path: key,
  })
}
```

3ï¼‰ä¼˜åŒ–ä¾§è¾¹æ çš„å±•ç¤º

å¯ä»¥ç»™ç»„ä»¶å¢åŠ æ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™ä¸ç”¨æ˜¾ç¤ºä¾§è¾¹æ ï¼š


```PlainText
<a-layout-sider v-if="loginUserStore.loginUser.id" class="sider" width="200">
</a-layout-sider>
```


```TypeScript
const loginUserStore = useLoginUserStore()
```

è¿˜å¯ä»¥ä½¿ç”¨ [å“åº”å¼å¸ƒå±€](https://antdv.com/components/layout-cn#components-layout-demo-responsive)ï¼Œå±å¹•å°ºå¯¸å°äº `lg` æ—¶ï¼Œè‡ªåŠ¨æŠ˜å ä¾§è¾¹æ ï¼š


```PlainText
<a-layout-sider v-if="loginUserStore.loginUser.id" 
  class="sider"
  width="200" 
  breakpoint="lg"
  collapsed-width="0"
>
</a-layout-sider>
```

æ•ˆæœå¦‚å›¾ï¼š

![](assets/GoZob7MN8oWMedxcOLMceGAPnod.png)

4ï¼‰å¯ä»¥åœ¨Øœ GlobalHeader å³è¾¹å¤´åƒçš„ä¸‹æ‹‰èœå•ä¸­ä¹Ÿæ·»åŠ  â€œæˆ‘çš„ç©ºé—´â€ è·³è½¬ï¼š


```PlainText
<a-menu-item>
  <router-link to="/my_space">
    <UserOutlined />
    æˆ‘çš„ç©ºé—´
  </router-link>
</a-menu-item>
```

### 2ã€æˆ‘çš„ç©ºé—´é¡µé¢

æˆ‘çš„ç©ºé—´é¡µé¢æ˜¯ä¸€ä¸ª â€œä¸­é—´é¡µâ€ï¼Œä½œç”¨æ˜¯æ ¹æ®ç”¨æˆ·æ˜¯å¦å·²æœ‰ç©ºé—´ï¼Œé‡å®šå‘ åˆ°å¯¹åº”çš„é¡µé¢ã€‚

å…ˆæ¢³ç†ä¸šåŠ¡æµç¨‹ï¼Œè·³è½¬åˆ°è¯¥é¡µé¢æ—¶ï¼š

* ç”¨æˆ·æœªç™»å½•ï¼Œåˆ™ç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢
* å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œä¼šè·å–è¯¥ç”¨æˆ·å·²åˆ›å»ºçš„ç©ºé—´
* å¦‚æœæœ‰ï¼Œåˆ™è¿›å…¥ç¬¬ä¸€ä¸ªç©ºé—´
* å¦‚æœæ²¡æœ‰ï¼Œåˆ™è·³è½¬åˆ°åˆ›å»ºç©ºé—´é¡µé¢

1ï¼‰æ–°å»ºæ–‡ä»¶å’Œè·¯ç”±ï¼š


```TypeScript
{
  path: '/my_space',
  name: 'æˆ‘çš„ç©ºé—´',
  component: MySpacePage,
},
```

2ï¼‰ç¼–å†™é¡µé¢ï¼š


```PlainText
<template>
  <div id="mySpace">
    <p>æ­£åœ¨è·³è½¬ï¼Œè¯·ç¨å€™...</p>
  </div>
</template>

<script setup lang="ts">
import { onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { listSpaceVoByPageUsingPost } from '@/api/spaceController'
import { message } from 'ant-design-vue'
import { useLoginUserStore } from '@/stores/useLoginUserStore'

const router = useRouter()
const loginUserStore = useLoginUserStore()

// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ä¸ªäººç©ºé—´
const checkUserSpace = async () => {
  const loginUser = loginUserStore.loginUser
  if (!loginUser?.id) {
    router.replace('/user/login')
    return
  }
  // è·å–ç”¨æˆ·ç©ºé—´ä¿¡æ¯
  const res = await listSpaceVoByPageUsingPost({
    userId: loginUser.id,
    current: 1,
    pageSize: 1,
  })
  if (res.data.code === 0) {
    if (res.data.data?.records?.length > 0) {
      const space = res.data.data.records[0]
      router.replace(`/space/${space.id}`)
    } else {
      router.replace('/add_space')
      message.warn('è¯·å…ˆåˆ›å»ºç©ºé—´')
    }
  } else {
    message.error('åŠ è½½æˆ‘çš„ç©ºé—´å¤±è´¥ï¼Œ' + res.data.message)
  }
}

// åœ¨é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç”¨æˆ·ç©ºé—´
onMounted(() => {
  checkUserSpace()
})
</script>
```

ä¸Šè¿°ä»£ç çš„æ ¸å¿ƒæ˜¯ checkUserSpace å‡½æ•°ï¼Œåœ¨é¡µé¢åŠ è½½æ—¶ä¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•ã€æ˜¯å¦å·²æœ‰ç©ºé—´ï¼Œå¹¶ä½¿ç”¨ `router.replace` é‡å®šå‘é¡µé¢ï¼Œè¿™æ ·ç‚¹å‡»æµè§ˆå™¨çš„åé€€æŒ‰é’®æ—¶ï¼Œä¸ä¼šå›åˆ°ä¸­é—´é¡µã€‚

### æ‰©å±•

å‚è€ƒ [ç»„ä»¶åº“çš„ Demo](https://antdv.com/components/layout-cn#components-layout-demo-fixed-sider)ï¼Œå›ºå®šå…¨å±€ä¾§è¾¹æ å’Œå…¨å±€é¡¶éƒ¨æ ï¼š

![](assets/O6wKbdu2XoU7Q3xa18jcFRThn0e.png)

## ç”¨æˆ·ä½¿ç”¨ç§æœ‰ç©ºé—´ï¼ˆç©ºé—´è¯¦æƒ…é¡µï¼‰

ç©ºé—´è¯¦æƒ…é¡µØœä¸»è¦æ˜¯å±•ç¤ºç©ºé—´ä¿¡æ¯ã€å¹¶å±•ç¤ºç©ºé—´å†…çš„å›¾ç‰‡åˆ—è¡¨ï¼Œå…¶ç»“æ„å’Œå…¬å¼€å›¾åº“çš„ä¸»é¡µéå¸¸ç›¸ä¼¼ï¼Œå¯ä»¥å¤ç”¨ç»„ä»¶ã€‚

### 1ã€å°è£…å›¾ç‰‡åˆ—è¡¨ç»„ä»¶

å…ˆå°è£…å›¾ç‰‡Øœåˆ—è¡¨ç»„ä»¶ PictureListï¼Œè¯¥ç»„ä»¶åªè´Ÿè´£æ•°æ®çš„å±•ç¤ºã€ä¸è´Ÿè´£æ•°æ®çš„æŸ¥è¯¢ï¼Œå› æ­¤è¦æŠŠåˆ†é¡µç»„ä»¶å•ç‹¬æ‹‰å‡ºæ¥ã€‚

1ï¼‰å¼€å‘å›¾ç‰‡Øœåˆ—è¡¨ç»„ä»¶ï¼Œå¤§å¤šæ•°çš„ä»£ç éƒ½æ˜¯ä»ä¸»é¡µå¤åˆ¶æ¥çš„ï¼Œå…³é”®æ˜¯å®šä¹‰å±æ€§ï¼Œæ¥å— dataList æ•°æ®åˆ—è¡¨å’Œ loading åŠ è½½çŠ¶æ€ï¼š


```PlainText
<template>
  <div class="picture-list">
    <!-- å›¾ç‰‡åˆ—è¡¨ -->
    <a-list
      :grid="{ gutter: 16, xs: 1, sm: 2, md: 3, lg: 4, xl: 5, xxl: 6 }"
      :data-source="dataList"
      :loading="loading"
    >
      <template #renderItem="{ item: picture }">
        <a-list-item style="padding: 0">
          <!-- å•å¼ å›¾ç‰‡ -->
          <a-card hoverable @click="doClickPicture(picture)">
            <template #cover>
              <img
                style="height: 180px; object-fit: cover"
                :alt="picture.name"
                :src="picture.thumbnailUrl ?? picture.url"
                loading="lazy"
              />
            </template>
            <a-card-meta :title="picture.name">
              <template #description>
                <a-flex>
                  <a-tag color="green">
                    {{ picture.category ?? 'é»˜è®¤' }}
                  </a-tag>
                  <a-tag v-for="tag in picture.tags" :key="tag">
                    {{ tag }}
                  </a-tag>
                </a-flex>
              </template>
            </a-card-meta>
          </a-card>
        </a-list-item>
      </template>
    </a-list>
  </div>
</template>

<script setup lang="ts">
import { useRouter } from 'vue-router'

interface Props {
  dataList?: API.PictureVO[]
  loading?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  dataList: () => [],
  loading: false,
})

// è·³è½¬è‡³å›¾ç‰‡è¯¦æƒ…
const router = useRouter()
const doClickPicture = (picture) => {
  router.push({
    path: `/picture/${picture.id}`,
  })
}
</script>

<style scoped></style>
```

2ï¼‰ä¿®æ”¹ä¸»é¡µçš„å›¾ç‰‡åˆ—è¡¨ä»£ç ï¼Œä½¿ç”¨å›¾ç‰‡åˆ—è¡¨ç»„ä»¶ï¼Œå¹¶è¡¥å…… [åˆ†é¡µç»„ä»¶](https://antdv.com/components/pagination-cn)ï¼š


```PlainText
<!-- å›¾ç‰‡åˆ—è¡¨ -->
<PictureList :dataList="dataList" :loading="loading" />
<a-pagination
  style="text-align: right"
  v-model:current="searchParams.current"
  v-model:pageSize="searchParams.pageSize"
  :total="total"
  @change="onPageChange"
/>
```

### 2ã€å¼€å‘ç©ºé—´è¯¦æƒ…é¡µ

è¯¥é¡µé¢çš„ç»“æ„æ˜¯ï¼šç©ºé—´ä¿¡æ¯ + å±•ç¤ºç©ºé—´ä¸‹çš„å›¾ç‰‡åˆ—è¡¨

1ï¼‰æ–°å»º `SpaceDetailPage.vue` å’Œè·¯ç”±ï¼Œè·Ÿå›¾ç‰‡è¯¦æƒ…é¡µç±»ä¼¼ï¼Œè·¯ç”±è¦èƒ½æ¥å—åŠ¨æ€å‚æ•°ï¼Œè¡¨ç¤ºè¦åŠ è½½çš„ç©ºé—´ idï¼š


```TypeScript
{
  path: '/space/:id',
  name: 'ç©ºé—´è¯¦æƒ…',
  component: SpaceDetailPage,
  props: true,
},
```

2ï¼‰ç¼–å†™é¡µØœé¢è„šæœ¬ï¼Œä¸»è¦æ˜¯è·å–ç©ºé—´è¯¦æƒ…æ•°æ®å’Œè·å–ç©ºé—´ä¸‹çš„å›¾ç‰‡åˆ—è¡¨æ•°æ®ï¼š


```TypeScript
const props = defineProps<{
  id: string | number
}>()
const space = ref<API.SpaceVO>({})

// è·å–ç©ºé—´è¯¦æƒ…const fetchSpaceDetail = async () => {
  try {
    const res = await getSpaceVoByIdUsingGet({
      id: props.id,
    })
    if (res.data.code === 0 && res.data.data) {
      space.value = res.data.data
    } else {
      message.error('è·å–ç©ºé—´è¯¦æƒ…å¤±è´¥ï¼Œ' + res.data.message)
    }
  } catch (e: any) {
    message.error('è·å–ç©ºé—´è¯¦æƒ…å¤±è´¥ï¼š' + e.message)
  }
}

onMounted(() => {
  fetchSpaceDetail()
})

// æ•°æ®const dataList = ref([])
const total = ref(0)
const loading = ref(true)

// æœç´¢æ¡ä»¶const searchParams = reactive<API.PictureQueryRequest>({
  current: 1,
  pageSize: 12,
  sortField: 'createTime',
  sortOrder: 'descend',
})

// åˆ†é¡µå‚æ•°const onPageChange = (page, pageSize) => {
  searchParams.current = page
  searchParams.pageSize = pageSize
  fetchData()
}

// è·å–æ•°æ®const fetchData = async () => {
  loading.value = true// è½¬æ¢æœç´¢å‚æ•°const params = {
    spaceId: props.id,
    ...searchParams,
  }
  const res = await listPictureVoByPageUsingPost(params)
  if (res.data.data) {
    dataList.value = res.data.data.records ?? []
    total.value = res.data.data.total ?? 0
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}

// é¡µé¢åŠ è½½æ—¶è¯·æ±‚ä¸€æ¬¡onMounted(() => {
  fetchData()
})
```

3ï¼‰å¼€å‘ç©ºé—´ä¿¡æ¯å±•ç¤ºæ ï¼Œå±•ç¤ºç©ºé—´åç§°ï¼Œå¹¶ä½¿ç”¨ [è¿›åº¦æ¡ç»„ä»¶](https://antdv.com/components/progress-cn/#components-progress-demo-circle-mini) å±•ç¤ºç©ºé—´é™é¢ï¼š


```PlainText
<!-- ç©ºé—´ä¿¡æ¯ -->
<a-flex justify="space-between">
  <h2>{{ space.spaceName }}ï¼ˆç§æœ‰ç©ºé—´ï¼‰</h2>
  <a-space size="middle">
    <a-button type="primary" :href="`/add_picture?spaceId=${id}`" target="_blank">
      + åˆ›å»ºå›¾ç‰‡
    </a-button>
    <a-tooltip
      :title="`å ç”¨ç©ºé—´ ${formatSize(space.totalSize)} / ${formatSize(space.maxSize)}`"
    >
      <a-progress
        type="circle"
        :percent="((space.totalSize * 100) / space.maxSize).toFixed(1)"
        :size="42"
      />
    </a-tooltip>
  </a-space>
</a-flex>
```

4ï¼‰å¼€å‘å›¾ç‰‡åˆ—è¡¨å’Œåˆ†é¡µï¼Œç›´æ¥ä½¿ç”¨å·²å°è£…çš„ç»„ä»¶ï¼š


```PlainText
<!-- å›¾ç‰‡åˆ—è¡¨ -->
<PictureList :dataList="dataList" :loading="loading" />
<a-pagination
  style="text-align: right"
  v-model:current="searchParams.current"
  v-model:pageSize="searchParams.pageSize"
  :total="total"
  :show-total="() => `å›¾ç‰‡æ€»æ•° ${total} / ${space.maxCount}`"
  @change="onPageChange"
/>
```

åœ¨åˆ†é¡µç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬è¦å±•ç¤ºå›¾ç‰‡æ€»æ•°å’Œæœ€å¤§æ•°é‡ï¼Œè®©ç”¨æˆ·çŸ¥æ™“ã€‚

æ•ˆæœå¦‚å›¾ï¼š

![](assets/TVRUbpDIcoZL00xcV4Pc1v0jnSE.png)

å·²ç»èƒ½å¤ŸæŸ¥Øœçœ‹ç§æœ‰ç©ºé—´è¯¦æƒ…äº†ï¼Œæˆ‘ä»¬å†ä¾æ¬¡å¼€å‘å¯¹ç©ºé—´å†…å›¾ç‰‡çš„ â€œå¢åˆ æ”¹æŸ¥â€ æ“ä½œã€‚

### 3ã€ä¸Šä¼ å›¾ç‰‡åˆ°ç§æœ‰ç©ºé—´

1ï¼‰ä¿®æ”¹åˆ›Øœå»ºå›¾ç‰‡é¡µé¢ï¼Œæ”¯æŒé€šè¿‡ url æŸ¥è¯¢å‚æ•°ä¸­çš„ spaceId ä¼ å‚ï¼Œåœ¨é¡µé¢ä¸­å¯ä»¥è·å–åˆ° spaceIdï¼š


```TypeScript
// ç©ºé—´ idconst spaceId = computed(() => {
  return route.query?.spaceId
})
```

2ï¼‰æäº¤æ—¶ï¼Œè¡¥å…… spaceId å‚æ•°ï¼š


```TypeScript
const res = await editPictureUsingPost({
  id: pictureId,
  spaceId: spaceId.value,
  ...values,
})
```

3ï¼‰åœ¨é¡µé¢ä¸­å±•ç¤ºå½“å‰çš„ spaceIdï¼š


```PlainText
<a-typography-paragraph v-if="spaceId" type="secondary">
  ä¿å­˜è‡³ç©ºé—´ï¼š<a :href="`/space/${spaceId}`" target="_blank">{{ spaceId }}</a>
</a-typography-paragraph>
```

4ï¼‰ä¿®æ”¹å›¾ç‰‡ä¸Šä¼ ç»„ä»¶**ï¼ˆåŒ…æ‹¬æœ¬åœ°æ–‡ä»¶ä¸Šä¼ å’Œ URL ä¸Šä¼ ï¼‰** ï¼Œæ”¯æŒä¸Šä¼ æ—¶ä¼ é€’ spaceIdï¼š


```TypeScript
interface Props {
  picture?: API.PictureVO
  spaceId?: number
  onSuccess?: (newPicture: API.PictureVO) => void
}

// ä¸Šä¼ æ—¶ä¼ é€’ spaceIdconst params: API.PictureUploadRequest = props.picture ? { id: props.picture.id } : {}
params.spaceId = props.spaceId;
const res = await uploadPictureUsingPost(params, {}, file)
```

æ•ˆæœå¦‚å›¾ï¼š

![](assets/I5pQbeQEaoRPYtxPVJ3cIK47nte.png)

### 4ã€å›¾ç‰‡ç»„ä»¶å¢åŠ å¿«æ·æ“ä½œ

å¯ä»¥ç»™ç©ºé—´è¯¦æƒ…é¡µçš„å›¾ç‰‡å¡ç‰‡çš„ä¸‹æ–¹å¢åŠ å¿«æ·æ“ä½œæ ï¼Œæé«˜ç®¡ç†æ•ˆç‡ï¼Œå‚è€ƒ [å¡ç‰‡ç»„ä»¶ç¤ºä¾‹](https://antdv.com/components/card-cn#components-card-demo-meta)ã€‚

1ï¼‰ä¿®æ”¹å›¾ç‰‡åˆ—è¡¨ç»„ä»¶ï¼Œè¡¥å……æ“ä½œæ ã€‚


```PlainText
<template #actions>
  <a-space @click="e => doEdit(picture, e)">
    <edit-outlined />
    ç¼–è¾‘
  </a-space>
  <a-space @click="e => doDelete(picture, e)">
    <delete-outlined />
    åˆ é™¤
  </a-space>
</template>
```

2ï¼‰ç”±äºè¯¥Øœç»„ä»¶æ˜¯ä¸»é¡µå’Œç©ºé—´è¯¦æƒ…é¡µå…¬ç”¨çš„ï¼Œä¸»é¡µä¸éœ€è¦å±•ç¤ºæ“ä½œæ ã€ç§æœ‰ç©ºé—´æ‰å±•ç¤ºï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ showOp å±æ€§æ¥æ§åˆ¶ï¼š


```TypeScript
interface Props {
  dataList?: API.PictureVO[]
  loading?: boolean
  showOp?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  dataList: () => [],
  loading: false,
  showOp: false,
})
```

é¡µé¢ç»“æ„å¢åŠ æ¡ä»¶ï¼š


```PlainText
<template v-if="showOp" #actions>
</template>
```

3ï¼‰è¡¥å……ç¼–è¾‘å’Œåˆ é™¤å‡½æ•°ï¼ŒdoEditã€doDelete çš„ä»£ç å¯ä»¥ç›´æ¥ä»å›¾ç‰‡è¯¦æƒ…é¡µå¤åˆ¶è¿‡æ¥ï¼Œä½†æ˜¯éœ€è¦ç”¨ `e.stopPropagation` é˜»æ­¢äº‹ä»¶ä¼ æ’­ï¼Œå¦åˆ™ä¼šåŒæ—¶è§¦å‘å¡ç‰‡ç‚¹å‡»äº‹ä»¶ï¼Œè·³è½¬åˆ°å›¾ç‰‡è¯¦æƒ…é¡µã€‚


```TypeScript
// ç¼–è¾‘const doEdit = (picture, e) => {
  e.stopPropagation()
  router.push({
    path: '/add_picture',
    query: {
      id: picture.id,
      spaceId: picture.spaceId,
    },
  })
}

// åˆ é™¤const doDelete = async (picture, e) => {
  e.stopPropagation()
  const id = picture.idif (!id) {
    return
  }
  const res = await deletePictureUsingPost({ id })
  if (res.data.code === 0) {
    message.success('åˆ é™¤æˆåŠŸ')
    // è®©å¤–å±‚åˆ·æ–°
    props?.onReload()
  } else {
    message.error('åˆ é™¤å¤±è´¥')
  }
}
```

4ï¼‰æ³¨æ„ï¼ŒØœåˆ é™¤å›¾ç‰‡ä¹‹åï¼Œå¯ä»¥ reload é‡æ–°è§¦å‘æ•°æ®çš„åŠ è½½ã€‚ç»™å›¾ç‰‡åˆ—è¡¨ç»„ä»¶å¢åŠ  onReload å±æ€§ï¼š


```TypeScript
interface Props {
  dataList?: API.PictureVO[]
  loading?: boolean
  showOp?: boolean
  onReload?: () => void
}
```

ç©ºé—´è¯¦æƒ…é¡µä¼ é€’å±æ€§ï¼š


```PlainText
<!-- å›¾ç‰‡åˆ—è¡¨ -->
<PictureList :dataList="dataList"
  :loading="loading"
  showOp 
  :onReload="fetchData"
/>
```

### 5ã€æŸ¥çœ‹ç§æœ‰ç©ºé—´çš„å›¾ç‰‡

ç›´æ¥å¤ç”¨å›¾Øœç‰‡è¯¦æƒ…é¡µ + åç«¯æ¥å£çš„æƒé™æ ¡éªŒï¼Œå°±å·²ç»å®ç°äº†ï¼Œæ— éœ€å¼€å‘ã€‚

### 6ã€ç¼–è¾‘ç§æœ‰ç©ºé—´çš„å›¾ç‰‡

ä¹‹å‰æˆ‘ä»¬å·²ç»å®Œæˆäº†æ›´Øœæ–°å›¾ç‰‡é¡µé¢çš„å¼€å‘ï¼ˆå…¶å®æ˜¯å¤ç”¨äº†å›¾ç‰‡åˆ›å»ºé¡µï¼‰ã€‚ä»ç©ºé—´è¯¦æƒ…é¡µæˆ–å›¾ç‰‡è¯¦æƒ…é¡µè¿›å…¥å›¾ç‰‡åˆ›å»ºé¡µæ—¶ï¼Œåªè¦ç»™ url æŸ¥è¯¢å‚æ•°æºå¸¦ spaceIdï¼Œå›¾ç‰‡åˆ›å»ºé¡µå°±èƒ½è‡ªåŠ¨è¯†åˆ«å‡º spaceId å¹¶å°†å›¾ç‰‡ä¿å­˜åˆ°ç©ºé—´ã€‚

ä¿®æ”¹å›¾ç‰‡è¯¦Øœæƒ…é¡µçš„ç¼–è¾‘å›¾ç‰‡å‡½æ•°ï¼Œè·³è½¬é¡µé¢æ—¶æºå¸¦ spaceIdï¼š


```TypeScript
// ç¼–è¾‘const doEdit = () => {
  router.push({
    path: '/add_picture',
    query: {
      id: picture.value.id,
      spaceId: picture.value.spaceId
    }
  })
}
```

### 7ã€åˆ é™¤ç§æœ‰ç©ºé—´çš„å›¾ç‰‡

é€šè¿‡åç«¯æ¥å£å·²ç»å®ç°äº†æƒé™æ ¡éªŒé€»è¾‘ï¼Œæ— éœ€å‰ç«¯å¼€å‘ã€‚

### 8ã€ç§æœ‰å›¾ç‰‡çš„æƒé™æ§åˆ¶

å¤§å¤šæ•°æƒé™æ ¡éªŒØœå·²ç»é€šè¿‡åç«¯å®ç°ï¼Œæ¯”å¦‚ä¸»é¡µä¸ä¼  spaceId é»˜è®¤å°±æŸ¥çš„æ˜¯å…¬å…±å›¾åº“ï¼Œæ— éœ€ä¿®æ”¹å‰ç«¯ä»£ç ï¼›è®¿é—®å›¾ç‰‡è¯¦æƒ…é¡µæ—¶ï¼Œä¹Ÿä¼šé€šè¿‡åç«¯è¿›è¡Œæƒé™æ ¡éªŒã€‚

ä½†å›¾ç‰‡ç®¡ç†é¡µé¢ç”±äºè°ƒç”¨çš„æ˜¯ä»…ç®¡ç†å‘˜å¯ç”¨çš„è·å–å›¾ç‰‡åˆ—è¡¨æ¥å£ï¼ˆlistPictureByPageï¼‰ï¼Œçœ‹åˆ°çš„æ˜¯å…¨éƒ¨çš„å›¾ç‰‡ï¼Œå…¶å®åªéœ€è¦çœ‹å…¬å…±ç©ºé—´çš„è¿›è¡Œå®¡æ ¸ï¼Œå¯ä»¥ç»™æŸ¥è¯¢æ¡ä»¶å¢åŠ å‚æ•° `nullSpaceId: true`ï¼š


```TypeScript
const res = await listPictureByPageUsingPost({
  ...searchParams,
  nullSpaceId: true,
})
```

### æ‰©å±•

1ï¼‰ç©ºé—´è¯¦Øœæƒ…é¡µå¢åŠ ç©ºé—´æ ‡å¿—çš„å±•ç¤ºï¼Œæ¯”å¦‚å°Šè´µçš„æ——èˆ°ç‰ˆå±•ç¤ºä¸ªé’»çŸ³ ğŸ’ã€‚

2ï¼‰åœ¨ç©ºé—´Øœå†…ä¸Šä¼ å›¾ç‰‡æ—¶å¯ä»¥ä½¿ç”¨å¼¹çª—ç»„ä»¶ï¼Œè€Œä¸æ˜¯æ‰“å¼€æ–°é¡µé¢ï¼Œæ›´è½»é‡ã€‚

3ï¼‰ä¸Šä¼ å›¾Øœç‰‡åˆ°ç©ºé—´æ—¶ï¼Œä¸Šä¼ é¡µé¢å¯ä»¥å±•ç¤ºå‡ºç©ºé—´åç§°ã€å®¹é‡ç­‰ä¿¡æ¯ï¼Œå¹¶ä¸”å‰ç«¯ä¹Ÿå¯ä»¥åˆ¤æ–­æ˜¯å¦å…·æœ‰æƒé™ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚

4ï¼‰é™¤äº†å›¾Øœç‰‡åˆ—è¡¨ç»„ä»¶å¤–ï¼Œè¿˜å¯ä»¥å°è£…å•ä¸ªå›¾ç‰‡çš„ç»„ä»¶ï¼Œå¤ç”¨æ›´çµæ´»ã€‚

5ï¼‰å›¾ç‰‡è¯¦Øœæƒ…é¡µã€ç©ºé—´è¯¦æƒ…é¡µå‰ç«¯å¢åŠ æƒé™åˆ¤æ–­é€»è¾‘ï¼Œç›¸æ¯”å•çº¯é åç«¯è¿›è¡Œæƒé™æ ¡éªŒï¼Œå¯ä»¥ç»™ç”¨æˆ·æ›´å¥½çš„ä½“éªŒã€‚


# å›¾åº“åˆ†æâ€”â€”å¯è§†åŒ–

ä¸ºè¿›ä¸€æ­¥æØœå‡ç”¨æˆ· / ç®¡ç†å‘˜åœ¨å¹³å°ä¸Šå¯¹ç©ºé—´å›¾åº“çš„ç®¡ç†ä¸åˆ†æèƒ½åŠ›ï¼Œæˆ‘ä»¬æœ¬èŠ‚å°†é‡ç‚¹æ‰©å±•ç©ºé—´å›¾åº“åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

* ç”¨æˆ·ç©ºé—´å›¾åº“åˆ†æ
* ç®¡ç†å‘˜å…¨ç©ºé—´åˆ†æ

é€šè¿‡è¿™äº›åˆ†ØœæåŠŸèƒ½ï¼Œç”¨æˆ·å’Œç®¡ç†å‘˜èƒ½å¤Ÿå¿«é€ŸæŒæ¡ç©ºé—´çš„ä½¿ç”¨æƒ…å†µï¼Œæå‡ç®¡ç†æ•ˆç‡ã€‚

---

# éœ€æ±‚åˆ†æ

æ ¹æ®æˆ‘ä»¬ç©ºØœé—´è¡¨å’Œå›¾ç‰‡è¡¨çš„å·²æœ‰å­—æ®µï¼Œå¯ä»¥æŒ–æ˜å‡ºå¾ˆå¤šåˆ†æéœ€æ±‚ï¼Œæ•´ä½“åˆ†ä¸ºç”¨æˆ·ç©ºé—´å›¾åº“åˆ†æå’Œç®¡ç†å‘˜å…¨ç©ºé—´åˆ†æä¸¤ç±»ã€‚

## ç”¨æˆ·ç©ºé—´å›¾åº“åˆ†æ

ç”¨æˆ·å¯ä»¥å¯¹è‡ªØœå·±çš„ç©ºé—´å›¾åº“è¿›è¡Œåˆ†æï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé‡ç‚¹åŠŸèƒ½ï¼šâ€Œâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚ï»¿â€‚â€‚â€‚â€‚â€‰â€‚â€‚â€‚â€‰â€‚â€‰â€â€‚â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‚â€‚

1ï¼‰ç©ºé—´èµ„æºä½¿ç”¨åˆ†æï¼šé€šè¿‡ç»Ÿè®¡å½“å‰ç©ºé—´å·²ä½¿ç”¨å¤§å°ä¸æ€»é…é¢çš„æ¯”ä¾‹ï¼Œä»¥åŠå›¾ç‰‡æ•°é‡ä¸æœ€å¤§å…è®¸æ•°é‡çš„å æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·ç›´è§‚äº†è§£ç©ºé—´ä½¿ç”¨çŠ¶æ€ï¼ŒåŠæ—¶æ¸…ç†æˆ–å‡çº§ç©ºé—´ã€‚å›¾è¡¨å½¢å¼æ¨èä½¿ç”¨ **ä»ªè¡¨ç›˜**ï¼Œç±»ä¼¼è¿›åº¦æ¡ï¼Œå¯ä»¥æ›´ç›´è§‚åœ°äº†è§£æ¯”ä¾‹ã€‚

2ï¼‰ç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æï¼šç»Ÿè®¡ä¸åŒåˆ†ç±»ä¸‹å›¾ç‰‡çš„æ•°é‡å’Œæ€»å¤§å°å æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·æ¸…æ™°äº†è§£å„åˆ†ç±»çš„èµ„æºåˆ†å¸ƒï¼Œä¼˜åŒ–å­˜å‚¨ç­–ç•¥ã€‚ç”±äºåŒä¸€ä¸ªåˆ†ç±»è¦å±•ç¤ºå¤šä¸ªä¿¡æ¯ï¼Œå¯ä»¥é€‰æ‹© **åˆ†ç»„æ¡å½¢å›¾** æ¥å±•ç¤ºã€‚

3ï¼‰ç©ºé—´å›¾ç‰‡æ ‡ç­¾åˆ†æï¼šè§£æç”¨æˆ·å›¾åº“ä¸­çš„æ ‡ç­¾ï¼Œç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„å…³è”å›¾ç‰‡æ•°é‡ã€‚ç”±äºæ ‡ç­¾æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç”¨ **è¯äº‘å›¾** å±•ç¤ºæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå¹¶çªå‡ºå¸¸ç”¨æ ‡ç­¾ï¼Œä¾¿äºä¼˜åŒ–ç®¡ç†å’Œå›¾ç‰‡æœç´¢ã€‚

4ï¼‰ç©ºé—´å›¾ç‰‡å¤§å°åˆ†æï¼šæŒ‰å›¾ç‰‡å¤§å°ï¼ˆå¦‚ <100 KBã€100 KB-1 MBã€>1 MBï¼‰åˆ†æ®µç»Ÿè®¡å›¾ç‰‡æ•°é‡ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«å¤§ä½“ç§¯å›¾ç‰‡ï¼Œåˆç†åˆ†é…å­˜å‚¨èµ„æºã€‚ç”±äºæŒ‰å›¾ç‰‡å¤§å°åˆ†ç±»çš„æ•°é‡ä¸å¤šï¼Œå¯ä»¥ä½¿ç”¨ **é¥¼å›¾**å±•ç¤ºï¼Œèƒ½å¤Ÿä½“ç°æ¯ç±»å¤§å°å›¾ç‰‡çš„æ•°é‡å æ¯”ã€‚

5ï¼‰ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æï¼šç»Ÿè®¡ç”¨æˆ·æ¯æœˆã€æ¯å‘¨ã€æ¯æ—¥ä¸Šä¼ å›¾ç‰‡çš„æ•°é‡è¶‹åŠ¿ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«ä¸Šä¼ é«˜å³°æœŸå¹¶ä¼˜åŒ–ç®¡ç†ç­–ç•¥ï¼ˆè™½ç„¶å¯¹ç›®å‰è¿™ä¸ªé˜¶æ®µæ²¡æœ‰ç”¨ï¼Œä½†ä¹‹åæˆ‘ä»¬è¦å¼€å‘å›¢é˜Ÿç©ºé—´ï¼Œå¯ä»¥ç»™å›¢é˜Ÿç®¡ç†å‘˜ä½¿ç”¨ï¼‰ã€‚æ¨èä½¿ç”¨ **æŠ˜çº¿å›¾** å‘ˆç°æ—¶é—´åºåˆ—è¶‹åŠ¿ã€‚

## ç®¡ç†å‘˜å…¨ç©ºé—´åˆ†æ

ç®¡ç†å‘˜å…¨ç©ºØœé—´åˆ†æçš„æ ¸å¿ƒæ˜¯é¢å‘å…¬å…±å›¾åº“ã€ä»¥åŠæ‰€æœ‰ç”¨æˆ·ç©ºé—´çš„ç»Ÿè®¡å’Œç®¡ç†ï¼š

1ï¼‰å…¨ç©ºé—´èµ„æºä½¿ç”¨åˆ†æï¼šØœç»Ÿè®¡å…¬å…±å›¾åº“ã€ä»¥åŠç³»ç»Ÿå†…æ‰€æœ‰ç©ºé—´çš„æ€»å­˜å‚¨é‡å’Œæ€»å›¾ç‰‡æ•°ï¼Œå¹¶ä¸”ä¹Ÿæ”¯æŒä»»æ„ç©ºé—´çš„å›¾ç‰‡åˆ†ç±»ã€å›¾ç‰‡æ ‡ç­¾ã€å›¾ç‰‡å¤§å°ã€ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºçš„åˆ†æï¼Œä¾¿äºç®¡ç†å‘˜äº†è§£ç³»ç»Ÿèµ„æºåˆ†é…å’Œåˆ©ç”¨æƒ…å†µã€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€â€‰â€‚â€‚â€‚â€‰â€‚â€‰â€‚â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‚â€‚

2ï¼‰ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æï¼šæŒ‰å­˜å‚¨ä½¿ç”¨é‡æ’åºï¼Œç»Ÿè®¡å ç”¨å­˜å‚¨æœ€å¤šçš„å‰ N ä¸ªç©ºé—´ï¼Œå¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿå®šä½é«˜å ç”¨ç©ºé—´ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„èµ„æºæ»¥ç”¨æˆ–å¼‚å¸¸æƒ…å†µã€‚å¯ä»¥é€‰ç”¨ æŸ±çŠ¶å›¾ï¼Œç›´è§‚åœ°å±•ç¤ºæ’åå’Œå­˜å‚¨ä½¿ç”¨é‡ã€‚

# æ–¹æ¡ˆè®¾è®¡

## åˆ†æç±»éœ€æ±‚çš„å®ç°æµç¨‹

å¯¹äºåˆ†æç±»éœ€æ±‚ï¼Œå®ç°æµç¨‹å‡ ä¹éƒ½æ˜¯ä¸€è‡´çš„ï¼ŒåŒ…æ‹¬ï¼š

1ï¼‰æ•°æ®é‡‡é›†Øœï¼šä»æ•°æ®æºï¼ˆæ¯”å¦‚ MySQL æ•°æ®åº“æˆ–è€…å¤§æ•°æ®ä»“åº“ï¼‰è·å–åŸå§‹æ•°æ®ã€‚è¦æå‰æ˜ç¡®æ¶‰åŠçš„è¡¨å’Œå­—æ®µï¼Œå¿…è¦æ—¶é‡‡ç”¨åˆ†é¡µæŸ¥è¯¢å¤„ç†å¤§æ•°æ®é‡ã€‚

2ï¼‰æ•°æ®é¢„å¤„ç†ï¼šØœå¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€åŠ å·¥å’Œæ ¼å¼åŒ–ï¼ŒåŒ…æ‹¬è¿‡æ»¤æ— æ•ˆæ•°æ®ï¼ˆæ¯”å¦‚é€»è¾‘åˆ é™¤æˆ–å®¡æ ¸æœªé€šè¿‡ï¼‰ã€è§£æå¤æ‚å­—æ®µï¼ˆæ¯”å¦‚ JSON æ ¼å¼çš„ tagsï¼‰ï¼Œä»¥åŠé€šè¿‡å­—æ®µå…³è”è¡¥å……ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

3ï¼‰æ•°æ®è®¡ç®—ï¼šæ ¹æ®éœ€æ±‚è¿›è¡Œåˆ†Øœç»„ã€èšåˆã€æ’åºç­‰ï¼Œä»è€Œè®¡ç®—å…³é”®æŒ‡æ ‡ï¼Œæ¯”å¦‚è®¡ç®—ç©ºé—´å„åˆ†ç±»å›¾ç‰‡çš„å ç”¨æ¯”ä¾‹ã€ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„æ—¶é—´è¶‹åŠ¿ã€‚å¯ä»¥æ ¹æ®åœºæ™¯è°ƒæ•´è®¡ç®—æ–¹æ¡ˆï¼Œæ¯”å¦‚å¯¹äºå¤§æ•°æ®é‡çš„è®¡ç®—ï¼Œå¯ä»¥é‡‡ç”¨ Spark ä¹‹ç±»çš„å¤§æ•°æ®è®¡ç®—ç»„ä»¶åšç¦»çº¿è®¡ç®—ï¼›å¯¹äºæ•°æ®å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„å®æ—¶åˆ†æåœºæ™¯ï¼Œå¯ä»¥ç”¨ Flink åšæµå¼å¤„ç†ã€‚

4ï¼‰æ•°æ®å­˜Øœå‚¨ï¼ˆå¯é€‰ï¼‰ï¼šé’ˆå¯¹é¢‘ç¹æŸ¥è¯¢çš„åˆ†æç»“æœï¼Œå¯å°†ç»“æœæ•°æ®å­˜å‚¨ä¸ºå•ç‹¬çš„è¡¨æˆ–ç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚

5ï¼‰æ•°æ®æ¥å£è®¾Øœè®¡ï¼šä¸ºå‰ç«¯æä¾›ç»Ÿä¸€æ¥å£ï¼Œä»è€Œæ”¯æŒæŸ¥è¯¢å’Œå±•ç¤ºã€‚éœ€è¦è€ƒè™‘åˆ°æ•°æ®é‡è¾ƒå¤§å¯¼è‡´å‰ç«¯æ¸²æŸ“å¡é¡¿çš„æƒ…å†µï¼Œå¯ä»¥æŒ‰éœ€ç²¾ç®€è¿”å›çš„å­—ç¬¦ä¸²ã€åˆ†é¡µæŸ¥è¯¢ç­‰ã€‚

6ï¼‰æ•°æ®å¯è§†åŒ–ï¼šé€šè¿‡å›¾è¡¨ç›´è§‚å±•ç¤ºåˆ†æç»“æœï¼Œå‰ç«¯å¯ä»¥ä½¿ç”¨ [Apache ECharts](https://echarts.apache.org/) ç­‰å¯è§†åŒ–åº“æ¸²æŸ“ã€‚å½“ç„¶ä¹Ÿå¯ä»¥è®©åç«¯ç”Ÿæˆå›¾è¡¨å›¾ç‰‡å¹¶è¿”å›ï¼Œä½†è¿™ç§å®ç°æ–¹æ³•çš„çµæ´»åº¦æœ‰é™ã€‚

åç»­è¿˜å¯ä»¥Øœæ ¹æ®ç”¨æˆ·çš„åé¦ˆæŒç»­ä¼˜åŒ–åˆ†æé€»è¾‘ã€å¢åŠ æŒ‡æ ‡æˆ–æ”¹è¿›æ€§èƒ½ã€‚

## æœ¬é¡¹ç›®å®ç°æ–¹æ¡ˆ

é€šè¿‡éœ€æ±‚åˆ†æï¼Œæˆ‘ä»¬å‘ç°ï¼Œç®¡ç†å‘˜å¯¹å…¬å…±å›¾åº“åŠå…¨ç©ºé—´çš„åˆ†æéœ€æ±‚ï¼Œä¸ç”¨æˆ·å¯¹è‡ªå·±ç©ºé—´çš„åˆ†æéœ€æ±‚åœ¨æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºå›¾ç‰‡èŒƒå›´çš„é€‰æ‹©ã€‚

ä¸‹é¢ä»¥ â€œç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æâ€ ä¸ºä¾‹ã€‚

1ï¼‰ç”¨æˆ·åˆ†æè‡ªå·±çš„ç©ºé—´ï¼ŒSQL ç¤ºä¾‹ï¼š


```SQL
SELECT category, SUM(picSize) AS totalSize
FROM picture 
WHERE spaceId = xxx
GROUP BY category;
```

2ï¼‰ç®¡ç†å‘˜åˆ†æå…¬å…±å›¾åº“ï¼ŒSQL ç¤ºä¾‹ï¼š


```SQL
SELECT category, SUM(picSize) AS totalSize
FROM picture 
WHERE spaceId IS NULLGROUP BY category;
```

3ï¼‰ç®¡ç†å‘˜åˆ†æå…¨éƒ¨ç©ºé—´ï¼ŒSQL ç¤ºä¾‹ï¼š


```SQL
SELECT category, SUM(picSize) AS totalSize
FROM picture 
GROUP BY category;
```

ä½ ä¼šå‘ç°ï¼ŒØœé™¤äº† where æŸ¥è¯¢æ¡ä»¶ä¸åŒä¹‹å¤–ï¼Œå…¶ä»–çš„è®¡ç®—æ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯Øœä»¥è®¾è®¡ç»Ÿä¸€çš„æ¥å£ï¼Œé€šè¿‡ä¼ é€’ä¸åŒçš„è¯·æ±‚å‚æ•°ï¼ŒåŒæ—¶æ»¡è¶³ä¸Šè¿°éœ€æ±‚ã€‚å‚æ•°å«ä¹‰å’Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š

1. queryAll å­—æ®µï¼šä¸º true æ—¶è¡¨ç¤ºæŸ¥è¯¢å…¨ç©ºé—´ï¼Œä»…ç®¡ç†å‘˜å¯ä½¿ç”¨ã€‚
2. queryPublic å­—æ®µï¼šä¸º true æ—¶è¡¨ç¤ºæŸ¥è¯¢å…¬å…±å›¾åº“ï¼Œä»…ç®¡ç†å‘˜å¯ä½¿ç”¨ã€‚
3. spaceId å­—æ®µï¼šä»…åœ¨ queryAll å’Œ queryPublic å‡ä¸º false æ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºå¯¹ç‰¹å®šç©ºé—´è¿›è¡Œåˆ†æï¼Œä»…ç©ºé—´åˆ›å»ºè€…å’Œç®¡ç†å‘˜å¯ä½¿ç”¨ã€‚

å¯¹åº”çš„åç«¯ä¼ªä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥å°†è¿™æ®µé€»è¾‘å°è£…ä¸ºå•ç‹¬çš„æ–¹æ³•ï¼š


```Java
// å…ˆæƒé™æ ¡éªŒ// å°è£…æŸ¥è¯¢æ¡ä»¶
QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
if (queryAll) {
    // ç®¡ç†å‘˜æŸ¥è¯¢å…¨ç©ºé—´ï¼Œä¸æ·»åŠ è¿‡æ»¤æ¡ä»¶
} else if (queryPublic) {
    // ç®¡ç†å‘˜æŸ¥è¯¢å…¬å…±å›¾åº“
    queryWrapper.isNull("spaceId");
} else if (spaceId != null) {
    // ç”¨æˆ·æˆ–ç®¡ç†å‘˜æŸ¥è¯¢ç‰¹å®šç©ºé—´
    queryWrapper.eq("spaceId", spaceId);
} else {
    throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªæŒ‡å®šæŸ¥è¯¢èŒƒå›´");
}
```

é€šè¿‡è¿™ç§æ–¹Øœå¼ï¼Œå°±ä¸ç”¨å¤šé’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢èŒƒå›´ç¼–å†™ä¸€å¥—æ¥å£äº†ï¼Œå¯ä»¥å¤§å¹…å‡å°‘é‡å¤ä»£ç ã€‚

# åç«¯å¼€å‘

ä¸‹é¢æˆ‘ä»¬ä¾æ¬¡å¼€å‘æ¯ä¸ªå…·ä½“çš„åˆ†æéœ€æ±‚ï¼Œç”±äºåˆ†æç±»éœ€æ±‚è¾ƒå¤šï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å•ç‹¬çš„ç©ºé—´åˆ†ææœåŠ¡ç±»ï¼ˆServiceï¼‰ã€å•ç‹¬çš„ç©ºé—´åˆ†ææ¥å£ï¼ˆController)ï¼Œå¹¶ä¸”ç»Ÿä¸€å°†åˆ†æéœ€æ±‚ç›¸å…³çš„ DTO å’Œ VO æ•°æ®æ¨¡å‹æ”¾åˆ° `analyze` åŒ…ä¸‹ã€‚

## é€šç”¨åˆ†æè¯·æ±‚

1ï¼‰ç”±äºæˆ‘Øœä»¬çš„å¾ˆå¤šåˆ†æéœ€æ±‚éƒ½éœ€è¦ä¼ é€’ç©ºé—´æŸ¥è¯¢èŒƒå›´ï¼Œå¯ä»¥å…ˆå†™ä¸€ä¸ªå…¬å…±çš„å›¾ç‰‡åˆ†æè¯·æ±‚å°è£…ç±»ï¼š


```Java
@Datapublic class SpaceAnalyzeRequest implements Serializable {

    /**
     * ç©ºé—´ ID
     */private Long spaceId;

    /**
     * æ˜¯å¦æŸ¥è¯¢å…¬å…±å›¾åº“
     */private boolean queryPublic;

    /**
     * å…¨ç©ºé—´åˆ†æ
     */private boolean queryAll;

    private static final long serialVersionUID = 1L;
}
```

ç„¶åå„ä¸ªå…·Øœä½“çš„åˆ†æè¯·æ±‚å°è£…ç±»å°±èƒ½ç›´æ¥ç»§æ‰¿äº†ï¼Œè¿™æ ·ä¹Ÿä¾¿äºåç»­ç¼–å†™é€šç”¨çš„åˆ†æè¯·æ±‚å¤„ç†æ–¹æ³•ã€‚

2ï¼‰æˆ‘ä»¬å¯ä»¥æ–°Øœå»º SpaceAnalyzeService å’Œå¯¹åº”å®ç°ç±»ï¼Œå¼€å‘æ ¡éªŒç©ºé—´åˆ†ææƒé™ã€æ ¹æ®åˆ†æèŒƒå›´å¡«å……æŸ¥è¯¢å¯¹è±¡è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåç»­çš„éœ€æ±‚ä¹Ÿéƒ½ä¼šç”¨åˆ°ã€‚

æ ¡éªŒç©ºé—´åˆ†ææƒé™ï¼š


```Java
private void checkSpaceAnalyzeAuth(SpaceAnalyzeRequest spaceAnalyzeRequest, User loginUser) {
    // æ£€æŸ¥æƒé™if (spaceAnalyzeRequest.isQueryAll() || spaceAnalyzeRequest.isQueryPublic()) {
        // å…¨ç©ºé—´åˆ†ææˆ–è€…å…¬å…±å›¾åº“æƒé™æ ¡éªŒï¼šä»…ç®¡ç†å‘˜å¯è®¿é—®
        ThrowUtils.throwIf(!userService.isAdmin(loginUser), ErrorCode.NO_AUTH_ERROR, "æ— æƒè®¿é—®å…¬å…±å›¾åº“");
    } else {
        // ç§æœ‰ç©ºé—´æƒé™æ ¡éªŒLong spaceId = spaceAnalyzeRequest.getSpaceId();
        ThrowUtils.throwIf(spaceId == null || spaceId <= 0, ErrorCode.PARAMS_ERROR);
        Space space = spaceService.getById(spaceId);
        ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");
        spaceService.checkSpaceAuth(loginUser, space);
    }
}
```

æ ¹æ®åˆ†æèŒƒå›´å¡«å……æŸ¥è¯¢å¯¹è±¡ï¼š


```Java
private static void fillAnalyzeQueryWrapper(SpaceAnalyzeRequest spaceAnalyzeRequest, QueryWrapper<Picture> queryWrapper) {
    if (spaceAnalyzeRequest.isQueryAll()) {
        return;
    }
    if (spaceAnalyzeRequest.isQueryPublic()) {
        queryWrapper.isNull("spaceId");
        return;
    }
    Long spaceId = spaceAnalyzeRequest.getSpaceId();
    if (spaceId != null) {
        queryWrapper.eq("spaceId", spaceId);
        return;
    }
    throw new BusinessException(ErrorCode.PARAMS_ERROR, "æœªæŒ‡å®šæŸ¥è¯¢èŒƒå›´");
```

## éœ€æ±‚å¼€å‘

### ç©ºé—´èµ„æºä½¿ç”¨åˆ†æ

1ï¼‰å¼€å‘è¯·Øœæ±‚å°è£…ç±»ï¼Œç”¨äºæ¥æ”¶å‰ç«¯è¯·æ±‚çš„æ•°æ®ã€‚æ­¤å¤„ç›´æ¥ç»§æ‰¿é€šç”¨çš„å›¾ç‰‡åˆ†æè¯·æ±‚å°è£…ç±»å³å¯ï¼Œä¸éœ€è¦ä¼ é€’å…¶ä»–å­—æ®µï¼š


```Java
@EqualsAndHashCode(callSuper = true)
@Datapublic 
class SpaceUsageAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“åº”è§†å›¾ç±»ï¼Œç”¨äºå°†åˆ†æç»“æœè¿”å›ç»™å‰ç«¯ï¼š


```Java
@Data
public class SpaceUsageAnalyzeResponse implements Serializable {

    /**
     * å·²ä½¿ç”¨å¤§å°
     */private Long usedSize;

    /**
     * æ€»å¤§å°
     */private Long maxSize;

    /**
     * ç©ºé—´ä½¿ç”¨æ¯”ä¾‹
     */private Double sizeUsageRatio;

    /**
     * å½“å‰å›¾ç‰‡æ•°é‡
     */private Long usedCount;

    /**
     * æœ€å¤§å›¾ç‰‡æ•°é‡
     */private Long maxCount;

    /**
     * å›¾ç‰‡æ•°é‡å æ¯”
     */private Double countUsageRatio;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ ØœSpaceAnalyzeService ä¸šåŠ¡é€»è¾‘å±‚ï¼Œç¼–å†™åˆ†æä¸šåŠ¡çš„å®ç°é€»è¾‘ã€‚

æ³¨æ„ï¼Œå¦‚æœæ˜¯åˆ†æå…¨Øœç©ºé—´æˆ–å…¬å…±å›¾åº“çš„ä½¿ç”¨æƒ…å†µï¼Œéœ€è¦ç¼–å†™ â€œä»…ç®¡ç†å‘˜å¯è®¿é—®â€ çš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå¹¶ä¸”æ›´æ”¹æŸ¥è¯¢å›¾ç‰‡è¡¨çš„èŒƒå›´ï¼›å¦‚æœåªæ˜¯åˆ†æå•ä¸ªç©ºé—´çš„ä½¿ç”¨æƒ…å†µï¼Œç›´æ¥ä»ç©ºé—´è¡¨æŸ¥è¯¢å‡ºå•ä¸ªç©ºé—´çš„æ•°æ®å³å¯ã€‚

ä»£ç å¦‚ä¸‹ï¼š


```Java
/**
 * è·å–ç©ºé—´ä½¿ç”¨åˆ†ææ•°æ®
 *
 * @param spaceUsageAnalyzeRequest SpaceUsageAnalyzeRequest è¯·æ±‚å‚æ•°
 * @param loginUser                å½“å‰ç™»å½•ç”¨æˆ·
 * @return SpaceUsageAnalyzeResponse åˆ†æç»“æœ
 */@Overridepublic SpaceUsageAnalyzeResponse getSpaceUsageAnalyze(SpaceUsageAnalyzeRequest spaceUsageAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceUsageAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    if (spaceUsageAnalyzeRequest.isQueryAll() || spaceUsageAnalyzeRequest.isQueryPublic()) {
        // æŸ¥è¯¢å…¨éƒ¨æˆ–å…¬å…±å›¾åº“é€»è¾‘// ä»…ç®¡ç†å‘˜å¯ä»¥è®¿é—®boolean isAdmin = userService.isAdmin(loginUser);
        ThrowUtils.throwIf(!isAdmin, ErrorCode.NO_AUTH_ERROR, "æ— æƒè®¿é—®ç©ºé—´");
        // ç»Ÿè®¡å…¬å…±å›¾åº“çš„èµ„æºä½¿ç”¨
        QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
        queryWrapper.select("picSize");
        if (!spaceUsageAnalyzeRequest.isQueryAll()) {
            queryWrapper.isNull("spaceId");
        }
        List<Object> pictureObjList = pictureService.getBaseMapper().selectObjs(queryWrapper);
        long usedSize = pictureObjList.stream().mapToLong(result -> result instanceof Long ? (Long) result : 0).sum();
        long usedCount = pictureObjList.size();
        // å°è£…è¿”å›ç»“æœSpaceUsageAnalyzeResponse spaceUsageAnalyzeResponse = new SpaceUsageAnalyzeResponse();
        spaceUsageAnalyzeResponse.setUsedSize(usedSize);
        spaceUsageAnalyzeResponse.setUsedCount(usedCount);
        // å…¬å…±å›¾åº“æ— ä¸Šé™ã€æ— æ¯”ä¾‹
        spaceUsageAnalyzeResponse.setMaxSize(null);
        spaceUsageAnalyzeResponse.setSizeUsageRatio(null);
        spaceUsageAnalyzeResponse.setMaxCount(null);
        spaceUsageAnalyzeResponse.setCountUsageRatio(null);
        return spaceUsageAnalyzeResponse;
    } else {
        // æŸ¥è¯¢æŒ‡å®šç©ºé—´Long spaceId = spaceUsageAnalyzeRequest.getSpaceId();
        ThrowUtils.throwIf(spaceId == null || spaceId <= 0, ErrorCode.PARAMS_ERROR);
        // è·å–ç©ºé—´ä¿¡æ¯Space space = spaceService.getById(spaceId);
        ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, "ç©ºé—´ä¸å­˜åœ¨");

        // æƒé™æ ¡éªŒï¼šä»…ç©ºé—´æ‰€æœ‰è€…æˆ–ç®¡ç†å‘˜å¯è®¿é—®
        spaceService.checkSpaceAuth(loginUser, space);

        // æ„é€ è¿”å›ç»“æœSpaceUsageAnalyzeResponse response = new SpaceUsageAnalyzeResponse();
        response.setUsedSize(space.getTotalSize());
        response.setMaxSize(space.getMaxSize());
        // åç«¯ç›´æ¥ç®—å¥½ç™¾åˆ†æ¯”ï¼Œè¿™æ ·å‰ç«¯å¯ä»¥ç›´æ¥å±•ç¤ºdouble sizeUsageRatio = NumberUtil.round(space.getTotalSize() * 100.0 / space.getMaxSize(), 2).doubleValue();
        response.setSizeUsageRatio(sizeUsageRatio);
        response.setUsedCount(space.getTotalCount());
        response.setMaxCount(space.getMaxCount());
        double countUsageRatio = NumberUtil.round(space.getTotalCount() * 100.0 / space.getMaxCount(), 2).doubleValue();
        response.setCountUsageRatio(countUsageRatio);
        return response;
    }
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¼˜åŒ–ç»†èŠ‚ï¼Œç”±äºæˆ‘ä»¬åªéœ€è¦è·å–å›¾ç‰‡å­˜å‚¨å¤§å°ï¼Œä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ—¶è¦æŒ‡å®š åªæŸ¥è¯¢éœ€è¦çš„åˆ—ï¼Œå¹¶ä¸”ä½¿ç”¨ mapper çš„ `selectObjs` æ–¹æ³•ç›´æ¥è¿”å› Object å¯¹è±¡ï¼Œè€Œä¸ç”¨å°è£…ä¸º Picture å¯¹è±¡ï¼Œå¯ä»¥æé«˜æ€§èƒ½å¹¶èŠ‚çº¦å­˜å‚¨ç©ºé—´ã€‚


```Java
QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
queryWrapper.select("picSize");
if (!spaceUsageAnalyzeRequest.isQueryAll()) {
    queryWrapper.isNull("spaceId");
}
List<Object> pictureObjList = pictureService.getBaseMapper().selectObjs(queryWrapper);
long usedSize = pictureObjList.stream().mapToLong(result -> result instanceof Long ? (Long) result : 0).sum();
```

å¯ä»¥åœ¨ SØœpaceService ä¸­å°è£…ç©ºé—´æƒé™æ ¡éªŒæ–¹æ³•ï¼Œå…¶ä»–çš„åˆ†æéœ€æ±‚ä¹Ÿä¼šç”¨åˆ°ï¼š


```Java
/**
 * ç©ºé—´æƒé™æ ¡éªŒ
 *
 * @param loginUser
 * @param space
 */@Overridepublic void checkSpaceAuth(User loginUser, Space space) {
    // ä»…æœ¬äººæˆ–ç®¡ç†å‘˜å¯è®¿é—®if (!space.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {
        throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
    }
}
```

ç„¶åå¯ä»¥å°† ØœSpaceController ä¸­ç¼–è¾‘å’Œåˆ é™¤æ“ä½œçš„æƒé™æ ¡éªŒä»£ç æ›¿æ¢ä¸º checkSpaceAuth æ–¹æ³•ï¼Œç»Ÿä¸€ç©ºé—´æ ¡éªŒé€»è¾‘ã€‚

4ï¼‰å¼€å‘ ØœSpaceAnalyzeController æ¥å£ï¼š


```Java
@RestController@RequestMapping("/space/analyze")public class SpaceAnalyzeController {

    @Resourceprivate SpaceAnalyzeService spaceAnalyzeService;

    @Resourceprivate UserService userService;

    /**
     * è·å–ç©ºé—´ä½¿ç”¨çŠ¶æ€
     */@PostMapping("/usage")public BaseResponse<SpaceUsageAnalyzeResponse> getSpaceUsageAnalyze(
            @RequestBody SpaceUsageAnalyzeRequest spaceUsageAnalyzeRequest,
            HttpServletRequest request
    ) {
        ThrowUtils.throwIf(spaceUsageAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
        User loginUser = userService.getLoginUser(request);
        SpaceUsageAnalyzeResponse spaceUsageAnalyze = spaceAnalyzeService.getSpaceUsageAnalyze(spaceUsageAnalyzeRequest, loginUser);
        return ResultUtils.success(spaceUsageAnalyze);
    }
}
```

### ç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚åˆ†ç±»åˆ†æåªéœ€è¦ä¼ é€’ç©ºé—´èŒƒå›´ç›¸å…³å‚æ•°ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ç»§æ‰¿å…¬å…±çš„ `SpaceAnalyzeRequest`ï¼š


```Java
@EqualsAndHashCode(callSuper = true)@Datapublic class SpaceCategoryAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“Øœåº”è§†å›¾ç±»ã€‚åˆ†ç±»åˆ†æçš„ç»“æœéœ€è¦è¿”å›å›¾ç‰‡åˆ†ç±»ã€åˆ†ç±»å›¾ç‰‡æ•°é‡å’Œåˆ†ç±»å›¾ç‰‡æ€»å¤§å°ï¼š


```Java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceCategoryAnalyzeResponse implements Serializable {

    /**
     * å›¾ç‰‡åˆ†ç±»
     */private String category;

    /**
     * å›¾ç‰‡æ•°é‡
     */private Long count;

    /**
     * åˆ†ç±»å›¾ç‰‡æ€»å¤§å°
     */private Long totalSize;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ ØœService æœåŠ¡ã€‚æŒ‰ç…§åˆ†ç±»åˆ†ç»„æŸ¥è¯¢å›¾ç‰‡è¡¨çš„æ•°æ®ï¼Œæ³¨æ„æŸ¥è¯¢æ•°æ®åº“æ—¶åªè·å–éœ€è¦çš„å­—æ®µå³å¯ï¼š


```Java
@Override
public List<SpaceCategoryAnalyzeResponse> getSpaceCategoryAnalyze(SpaceCategoryAnalyzeRequest spaceCategoryAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceCategoryAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceCategoryAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    // æ ¹æ®åˆ†æèŒƒå›´è¡¥å……æŸ¥è¯¢æ¡ä»¶
    fillAnalyzeQueryWrapper(spaceCategoryAnalyzeRequest, queryWrapper);

    // ä½¿ç”¨ MyBatis-Plus åˆ†ç»„æŸ¥è¯¢
    queryWrapper.select("category AS category",
                    "COUNT(*) AS count",
                    "SUM(picSize) AS totalSize")
            .groupBy("category");

    // æŸ¥è¯¢å¹¶è½¬æ¢ç»“æœreturn pictureService.getBaseMapper().selectMaps(queryWrapper)
            .stream()
            .map(result -> {
                String category = result.get("category") != null ? result.get("category").toString() : "æœªåˆ†ç±»";
                Long count = ((Number) result.get("count")).longValue();
                Long totalSize = ((Number) result.get("totalSize")).longValue();
                return new SpaceCategoryAnalyzeResponse(category, count, totalSize);
            })
            .collect(Collectors.toList());
}
```

ğŸ’¡ å»ºè®®Øœåœ¨ç¼–å†™å…·ä½“çš„ä»£ç å‰ï¼Œå…ˆç¼–å†™ç¤ºä¾‹ SQL è¯­å¥ï¼Œå¹¶é€šè¿‡æ•°æ®åº“æŸ¥è¯¢å®¢æˆ·ç«¯æ¥éªŒè¯ã€‚

4ï¼‰å¼€å‘æ¥å£ï¼š


```Java
@PostMapping("/category")
public BaseResponse<List<SpaceCategoryAnalyzeResponse>> getSpaceCategoryAnalyze(@RequestBody SpaceCategoryAnalyzeRequest spaceCategoryAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceCategoryAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceCategoryAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceCategoryAnalyze(spaceCategoryAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

### ç©ºé—´å›¾ç‰‡æ ‡ç­¾åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ï¼Œæ ‡ç­¾åˆ†æåŒæ ·éœ€è¦ç»§æ‰¿ `SpaceAnalyzeRequest`ï¼š


```Java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceTagAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“Øœåº”è§†å›¾ç±»ã€‚æ ‡ç­¾åˆ†æçš„ç»“æœéœ€è¦è¿”å›æ ‡ç­¾åç§°å’Œå…³è”çš„å›¾ç‰‡æ•°é‡ï¼š


```Java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceTagAnalyzeResponse implements Serializable {

    /**
     * æ ‡ç­¾åç§°
     */private String tag;

    /**
     * ä½¿ç”¨æ¬¡æ•°
     */private Long count;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ ØœService æœåŠ¡ã€‚ä»æ•°æ®åº“è·å–æ ‡ç­¾æ•°æ®ï¼Œç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„å›¾ç‰‡æ•°é‡ï¼Œå¹¶æŒ‰ä½¿ç”¨æ¬¡æ•°é™åºæ’åºï¼š


```Java
@Overridepublic List<SpaceTagAnalyzeResponse> getSpaceTagAnalyze(SpaceTagAnalyzeRequest spaceTagAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceTagAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceTagAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    fillAnalyzeQueryWrapper(spaceTagAnalyzeRequest, queryWrapper);

    // æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾
    queryWrapper.select("tags");
    List<String> tagsJsonList = pictureService.getBaseMapper().selectObjs(queryWrapper)
            .stream()
            .filter(ObjUtil::isNotNull)
            .map(Object::toString)
            .collect(Collectors.toList());

    // åˆå¹¶æ‰€æœ‰æ ‡ç­¾å¹¶ç»Ÿè®¡ä½¿ç”¨æ¬¡æ•°
    Map<String, Long> tagCountMap = tagsJsonList.stream()
            .flatMap(tagsJson -> JSONUtil.toList(tagsJson, String.class).stream())
            .collect(Collectors.groupingBy(tag -> tag, Collectors.counting()));

    // è½¬æ¢ä¸ºå“åº”å¯¹è±¡ï¼ŒæŒ‰ä½¿ç”¨æ¬¡æ•°é™åºæ’åºreturn tagCountMap.entrySet().stream()
            .sorted((e1, e2) -> Long.compare(e2.getValue(), e1.getValue())) // é™åºæ’åˆ—
            .map(entry -> new SpaceTagAnalyzeResponse(entry.getKey(), entry.getValue()))
            .collect(Collectors.toList());
}
```

4ï¼‰å¼€å‘æ¥å£ï¼š


```Java
@PostMapping("/tag")public BaseResponse<List<SpaceTagAnalyzeResponse>> getSpaceTagAnalyze(@RequestBody SpaceTagAnalyzeRequest spaceTagAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceTagAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceTagAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceTagAnalyze(spaceTagAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

### ç©ºé—´å›¾ç‰‡å¤§å°åˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚å›¾ç‰‡å¤§å°åˆ†æä¹Ÿç»§æ‰¿ `SpaceAnalyzeRequest`ï¼š


```Java
@EqualsAndHashCode(callSuper = true)
@Data
public class SpaceSizeAnalyzeRequest extends SpaceAnalyzeRequest {

}
```

2ï¼‰å¼€å‘å“Øœåº”è§†å›¾ç±»ã€‚å¤§å°åˆ†æç»“æœéœ€è¦è¿”å›å›¾ç‰‡å¤§å°èŒƒå›´å’Œå¯¹åº”çš„å›¾ç‰‡æ•°é‡ï¼š


```Java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class SpaceSizeAnalyzeResponse implements Serializable {

    /**
     * å›¾ç‰‡å¤§å°èŒƒå›´
     */private String sizeRange;

    /**
     * å›¾ç‰‡æ•°é‡
     */private Long count;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ Service æœåŠ¡ï¼Œåˆ†æ®µç»Ÿè®¡å›¾ç‰‡å¤§å°ï¼š


```Java
@Override
public List<SpaceSizeAnalyzeResponse> getSpaceSizeAnalyze(SpaceSizeAnalyzeRequest spaceSizeAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceSizeAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceSizeAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    fillAnalyzeQueryWrapper(spaceSizeAnalyzeRequest, queryWrapper);

    // æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å›¾ç‰‡å¤§å°
    queryWrapper.select("picSize");
    List<Long> picSizes = pictureService.getBaseMapper().selectObjs(queryWrapper)
            .stream()
            .map(size -> ((Number) size).longValue())
            .collect(Collectors.toList());

    // å®šä¹‰åˆ†æ®µèŒƒå›´ï¼Œæ³¨æ„ä½¿ç”¨æœ‰åº Map
    Map<String, Long> sizeRanges = new LinkedHashMap<>();
    sizeRanges.put("<100KB", picSizes.stream().filter(size -> size < 100 * 1024).count());
    sizeRanges.put("100KB-500KB", picSizes.stream().filter(size -> size >= 100 * 1024 && size < 500 * 1024).count());
    sizeRanges.put("500KB-1MB", picSizes.stream().filter(size -> size >= 500 * 1024 && size < 1 * 1024 * 1024).count());
    sizeRanges.put(">1MB", picSizes.stream().filter(size -> size >= 1 * 1024 * 1024).count());

    // è½¬æ¢ä¸ºå“åº”å¯¹è±¡return sizeRanges.entrySet().stream()
            .map(entry -> new SpaceSizeAnalyzeResponse(entry.getKey(), entry.getValue()))
            .collect(Collectors.toList());
}
```

ä¸Šè¿°ä»£ç å…¶Øœå®è¿˜å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œåªéœ€è¦éå†ä¸€æ¬¡ picSizes åˆ—è¡¨å°±å¯ä»¥æŒ‰å¤§å°åˆ†åˆ«ç»Ÿè®¡äº†ã€‚

4ï¼‰å¼€å‘æ¥å£ï¼š


```Java
@PostMapping("/size")
public BaseResponse<List<SpaceSizeAnalyzeResponse>> getSpaceSizeAnalyze(@RequestBody SpaceSizeAnalyzeRequest spaceSizeAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceSizeAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceSizeAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceSizeAnalyze(spaceSizeAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

### ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æ

1ï¼‰å¼€å‘è¯·æ±‚Øœå°è£…ç±»ã€‚ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æéœ€è¦å¢åŠ æ—¶é—´ç»´åº¦ï¼ˆæ—¥ã€å‘¨ã€æœˆï¼‰å’Œç”¨æˆ· ID å‚æ•°ï¼Œæ”¯æŒåªåˆ†ææŸä¸ªç”¨æˆ·ä¸Šä¼ å›¾ç‰‡çš„æƒ…å†µã€‚


```Java
@EqualsAndHashCode(callSuper = true)@Datapublic class SpaceUserAnalyzeRequest extends SpaceAnalyzeRequest {

    /**
     * ç”¨æˆ· ID
     */private Long userId;

    /**
     * æ—¶é—´ç»´åº¦ï¼šday / week / month
     */private String timeDimension;
}
```

2ï¼‰å¼€å‘å“Øœåº”è§†å›¾ç±»ã€‚ç”¨æˆ·è¡Œä¸ºåˆ†æç»“æœéœ€è¦è¿”å›æ—¶é—´åŒºé—´å’Œå¯¹åº”çš„å›¾ç‰‡æ•°é‡ï¼š


```Java
@Data@AllArgsConstructor@NoArgsConstructorpublic class SpaceUserAnalyzeResponse implements Serializable {

    /**
     * æ—¶é—´åŒºé—´
     */private String period;

    /**
     * ä¸Šä¼ æ•°é‡
     */private Long count;

    private static final long serialVersionUID = 1L;
}
```

3ï¼‰å¼€å‘ ØœService æœåŠ¡ï¼ŒåŸºäºå›¾ç‰‡çš„åˆ›å»ºæ—¶é—´ç»´åº¦ç»Ÿè®¡ç”¨æˆ·çš„ä¸Šä¼ è¡Œä¸ºï¼Œå¹¶æŒ‰ç…§æ—¶é—´å‡åºæ’åºï¼š


```Java
@Override
public List<SpaceUserAnalyzeResponse> getSpaceUserAnalyze(SpaceUserAnalyzeRequest spaceUserAnalyzeRequest, User loginUser) {
    ThrowUtils.throwIf(spaceUserAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    // æ£€æŸ¥æƒé™
    checkSpaceAnalyzeAuth(spaceUserAnalyzeRequest, loginUser);

    // æ„é€ æŸ¥è¯¢æ¡ä»¶
    QueryWrapper<Picture> queryWrapper = new QueryWrapper<>();
    Long userId = spaceUserAnalyzeRequest.getUserId();
    queryWrapper.eq(ObjUtil.isNotNull(userId), "userId", userId);
    fillAnalyzeQueryWrapper(spaceUserAnalyzeRequest, queryWrapper);

    // åˆ†æç»´åº¦ï¼šæ¯æ—¥ã€æ¯å‘¨ã€æ¯æœˆString timeDimension = spaceUserAnalyzeRequest.getTimeDimension();
    switch (timeDimension) {
        case "day":
            queryWrapper.select("DATE_FORMAT(createTime, '%Y-%m-%d') AS period", "COUNT(*) AS count");
            break;
        case "week":
            queryWrapper.select("YEARWEEK(createTime) AS period", "COUNT(*) AS count");
            break;
        case "month":
            queryWrapper.select("DATE_FORMAT(createTime, '%Y-%m') AS period", "COUNT(*) AS count");
            break;
        default:
            throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸æ”¯æŒçš„æ—¶é—´ç»´åº¦");
    }

    // åˆ†ç»„å’Œæ’åº
    queryWrapper.groupBy("period").orderByAsc("period");

    // æŸ¥è¯¢ç»“æœå¹¶è½¬æ¢
    List<Map<String, Object>> queryResult = pictureService.getBaseMapper().selectMaps(queryWrapper);
    return queryResult.stream()
            .map(result -> {
                String period = result.get("period").toString();
                Long count = ((Number) result.get("count")).longValue();
                return new SpaceUserAnalyzeResponse(period, count);
            })
            .collect(Collectors.toList());
}
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬Øœä½¿ç”¨ MySQL çš„æ—¥æœŸæ—¶é—´å‡½æ•°å¯¹å›¾ç‰‡çš„åˆ›å»ºæ—¶é—´è¿›è¡Œäº†æ ¼å¼åŒ–ï¼Œä½¿å¾—åŒä¸€å¤©ï¼ˆå‘¨ / æœˆï¼‰çš„å€¼ç›¸åŒï¼Œå°±èƒ½å¤Ÿç»Ÿä¸€æŒ‰ç…§ä¸€ä¸ªå­—æ®µï¼ˆperiodï¼‰è¿›è¡Œåˆ†ç»„å’Œæ’åºäº†ã€‚

4ï¼‰å¼€å‘æ¥å£ï¼š


```Java
@PostMapping("/user")public BaseResponse<List<SpaceUserAnalyzeResponse>> getSpaceUserAnalyze(@RequestBody SpaceUserAnalyzeRequest spaceUserAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceUserAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<SpaceUserAnalyzeResponse> resultList = spaceAnalyzeService.getSpaceUserAnalyze(spaceUserAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

ä¸Šè¿°çš„è¿™äº›éœ€æ±‚ï¼Œå¯ä»¥åŒæ—¶ç»™ç”¨æˆ·å’Œç®¡ç†å‘˜ä½¿ç”¨ï¼Œå·²ç»æ»¡è¶³äº†ç®¡ç†å‘˜ â€œå…¨ç©ºé—´èµ„æºä½¿ç”¨åˆ†æâ€ çš„éœ€æ±‚ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦å•ç‹¬å¼€å‘ä¸€ä¸ª ä»…ç®¡ç†å‘˜å¯ä½¿ç”¨çš„åŠŸèƒ½ â€”â€” ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æã€‚

### ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æ

è¯¥åŠŸèƒ½ä»…ç®¡Øœç†å‘˜å¯ä½¿ç”¨ï¼Œè¿”å›å€¼å°±æ˜¯å‰ N ä¸ªç©ºé—´çš„ä¿¡æ¯ã€‚ç”±äºå·²ç»æœ‰ç°æˆçš„ Space ç©ºé—´å¯¹è±¡ï¼Œå°±ä¸ç”¨ç¼–å†™å“åº”è§†å›¾ç±»äº†ã€‚

1ï¼‰å¼€å‘è¯·æ±‚å°è£…ç±»ã€‚ç©ºé—´ä½¿ç”¨æ’è¡Œéœ€è¦æ¥æ”¶ä¸€ä¸ªå‚æ•° `topN`ï¼ŒæŒ‡å®šè¦è¿”å›çš„å‰ N åç©ºé—´ä¿¡æ¯ï¼Œé»˜è®¤å€¼ä¸º 10ï¼š


```Java
@Data
public class SpaceRankAnalyzeRequest implements Serializable {

    /**
     * æ’åå‰ N çš„ç©ºé—´
     */private Integer topN = 10;

    private static final long serialVersionUID = 1L;
}
```

2ï¼‰å¼€å‘ ØœService æœåŠ¡ï¼ŒæŒ‰å­˜å‚¨ä½¿ç”¨é‡æ’åºæŸ¥è¯¢å‰ N ä¸ªç©ºé—´ã€‚æ³¨æ„ï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ç©ºé—´æ’è¡Œï¼š


```Java
@Override
public List<Space> getSpaceRankAnalyze(SpaceRankAnalyzeRequest spaceRankAnalyzeRequest, User loginUser) {
ThrowUtils.throwIf(spaceRankAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);

// ä»…ç®¡ç†å‘˜å¯æŸ¥çœ‹ç©ºé—´æ’è¡Œ
ThrowUtils.throwIf(!userService.isAdmin(loginUser), ErrorCode.NO_AUTH_ERROR, "æ— æƒæŸ¥çœ‹ç©ºé—´æ’è¡Œ");

// æ„é€ æŸ¥è¯¢æ¡ä»¶
QueryWrapper<Space> queryWrapper = new QueryWrapper<>();
queryWrapper.select("id", "spaceName", "userId", "totalSize")
        .orderByDesc("totalSize")
        .last("LIMIT " + spaceRankAnalyzeRequest.getTopN()); // å–å‰ N å// æŸ¥è¯¢ç»“æœreturn spaceService.list(queryWrapper);
}
```

3ï¼‰å¼€å‘æ¥å£ï¼š


```Java
@PostMapping("/rank")
public BaseResponse<List<Space>> getSpaceRankAnalyze(@RequestBody SpaceRankAnalyzeRequest spaceRankAnalyzeRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(spaceRankAnalyzeRequest == null, ErrorCode.PARAMS_ERROR);
    User loginUser = userService.getLoginUser(request);
    List<Space> resultList = spaceAnalyzeService.getSpaceRankAnalyze(spaceRankAnalyzeRequest, loginUser);
    return ResultUtils.success(resultList);
}
```

## æ‰©å±•çŸ¥è¯† - è‡ªå®šä¹‰ SQL

ä¸Šè¿°çš„éœ€æ±‚æˆ‘ä»¬Øœæ˜¯é€šè¿‡ MyBatis Plus æä¾›çš„æ–¹æ³•å®ç°æ•°æ®åº“çš„åˆ†ç»„æ’åºæŸ¥è¯¢ï¼Œå¯¹äºæ›´å¤æ‚å¤šæ ·çš„åˆ†æéœ€æ±‚ï¼Œå…¶å®æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå·±åœ¨ä»£ç ä¸­ç¼–å†™ SQL è¯­å¥ã€‚

å¯èƒ½æœ‰éƒ¨åˆ†åŒå­¦ä¼šå¥½å¥‡ï¼ŒMyBatis è¿˜èƒ½è‡ªå®šä¹‰ SQLï¼Ÿä¸éƒ½æ˜¯ç›´æ¥è°ƒç”¨ `xxx.select` ä¹‹ç±»çš„æ–¹æ³•ä¹ˆï¼Ÿ

è¿™å°±æ˜¯å…¸å‹çš„â€œç”¨æ¡†æ¶ä¹ æƒ¯äº†â€ï¼ŒØœå…¶å®ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ã€é¿å…è‡ªå·±å†™ SQLï¼Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´ä½¿ç”¨çš„æ˜¯ MyBatis Plus æ¡†æ¶ã€‚ä½†åˆ«å¿˜äº†ï¼ŒMyBatis Plus æ˜¯ MyBatis çš„å¢å¼ºç‰ˆï¼Œæœ¬è´¨è¿˜æ˜¯åŸºäº MyBatis çš„ä¸€äº›èƒ½åŠ›è¿›è¡Œçš„ä¸€äº›å°è£…ç®€åŒ–ï¼Œè‡ªå®šä¹‰ SQL å¯æ˜¯ MyBatis æœ€æœ€æœ€åŸºç¡€çš„èƒ½åŠ›ä¹‹ä¸€ã€‚

åœ¨ MyBØœatis ä¸€èˆ¬ä¼šä»¥ä¸¤ç§æ–¹å¼æ¥å®ç°è‡ªå®šä¹‰ SQL ï¼š

### Java æ³¨è§£å®ç°

åŸºäº Java æ³¨è§£å†™åœ¨ xxxMapper.java ä¸­ã€‚

æ³¨è§£ä½¿ç”¨å¾ˆç®€å•ï¼Œ åœ¨ mapper å±‚çš„æ¥å£ç±»æ–¹æ³•åˆ©ç”¨ `@Selectã€@Updateã€@Insertã€@Delete` ç­‰æ³¨è§£ï¼Œåœ¨æ³¨è§£å†…å¡«å†™è‡ªå®šä¹‰ SQL è¯­å¥ï¼Œå³å¯å®ç°æŸ¥è¯¢ã€æ›´æ–°ã€å­˜å‚¨ã€åˆ é™¤ã€‚

ä¾‹å¦‚ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•ï¼š


```Java
public interface SpaceMapper extends BaseMapper<Space> {

    /**
     * è·å–å­˜å‚¨ä½¿ç”¨é‡æ’åå‰ N çš„ç©ºé—´
     * @param topN æ’åå‰ N
     * @return List<Space>
     */@Select("SELECT id, spaceName, userId, totalSize " +
            "FROM space " +
            "ORDER BY totalSize DESC " +
            "LIMIT #{topN}")
    List<Space> getTopNSpaceUsage(int topN);

    /**
     * åˆ é™¤æŸç”¨æˆ·çš„æ‰€æœ‰ç©ºé—´
     *
     * @param userId ç”¨æˆ· ID
     * @return åˆ é™¤çš„è®°å½•æ•°
     */@Delete("DELETE FROM space WHERE userId = #{userId}")int deleteByUserId(Long userId);
}
```

å®Œæ•´è¯­å¥ = SØœQL è¯­å¥æ¨¡æ¿ + è®¾ç½®åŠ¨æ€å‚æ•°ã€‚æ–¹æ³•çš„å‚æ•°å¯ä»¥ä½œä¸ºåŠ¨æ€å‚æ•°è‡ªåŠ¨å¡«å……åˆ° SQL æ¨¡æ¿ä¸­ï¼Œå¾—åˆ°æœ€ç»ˆçš„ SQL è¯­å¥ï¼Œç»“æœä¹Ÿä¼šè‡ªåŠ¨è½¬æˆæ–¹æ³•è¿”å›å€¼çš„ Java ç±»å‹ã€‚

ğŸ’¡ é€šè¿‡ #{} å’Œ ${} éƒ½å¯ä»¥å®ç° SQL å‚æ•°ç»‘å®šï¼Œä½†æ˜¯ä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ã€‚#{} æ˜¯é¢„ç¼–è¯‘å‚æ•°ï¼Œå¯ä»¥é˜²æ­¢ SQL æ³¨å…¥ï¼Œè€Œ ${} æ˜¯ç›´æ¥æ›¿æ¢ï¼Œä¼šå¯¼è‡´ SQL æ³¨å…¥ã€‚

### XML é…ç½®å®ç°

åŸºäº XML é…ç½®æ–‡ä»¶å†™åœ¨ xxxMapper.xml ä¸­ã€‚

ä¹‹å‰é€šè¿‡ä»£ç ç”Ÿæˆå™¨ï¼Œé¡¹ç›®é‡Œé¢å·²ç»æœ‰å¾ˆå¤š xxxMapper.xml é…ç½®æ–‡ä»¶äº†ã€‚æ¯”å¦‚ SpaceMapper.xmlï¼Œé‡Œé¢å®šä¹‰äº†è¡¨å’Œ Java ç±»çš„å­—æ®µæ˜ å°„ã€SQL å­—æ®µåˆ—è¡¨ç‰‡æ®µã€‚


```XML
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapperPUBLIC "-//mybatis.org//DTD Mapper 3.0//EN""http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.yupi.yupicturebackend.mapper.SpaceMapper"><resultMap id="BaseResultMap" type="com.yupi.yupicturebackend.model.entity.Space"><id property="id" column="id" jdbcType="BIGINT"/><result property="spaceName" column="spaceName" jdbcType="VARCHAR"/><result property="spaceLevel" column="spaceLevel" jdbcType="INTEGER"/><result property="maxSize" column="maxSize" jdbcType="BIGINT"/><result property="maxCount" column="maxCount" jdbcType="BIGINT"/><result property="totalSize" column="totalSize" jdbcType="BIGINT"/><result property="totalCount" column="totalCount" jdbcType="BIGINT"/><result property="userId" column="userId" jdbcType="BIGINT"/><result property="createTime" column="createTime" jdbcType="TIMESTAMP"/><result property="editTime" column="editTime" jdbcType="TIMESTAMP"/><result property="updateTime" column="updateTime" jdbcType="TIMESTAMP"/><result property="isDelete" column="isDelete" jdbcType="TINYINT"/></resultMap><sql id="Base_Column_List">
        id,spaceName,spaceLevel,
        maxSize,maxCount,totalSize,
        totalCount,userId,createTime,
        editTime,updateTime,isDelete
    </sql></mapper>
```

ä¸ç”¨è‡ªå·±æ–°å»ºï¼Œä»…éœ€åœ¨é‡Œé¢æ·»åŠ è‡ªå®šä¹‰çš„ SQL ä»£ç å³å¯ã€‚

è·Ÿæ³¨è§£ç±»ä¼¼ï¼ŒMyBatis XML ä¸­æä¾›äº† `<select>`ã€`<update>`ã€`<insert>`ã€`<delete>` ç­‰è¯­æ³•ï¼Œåœ¨å†…éƒ¨æ·»åŠ è‡ªå®šä¹‰ SQL ï¼Œå³å¯å®ç°æŸ¥è¯¢ã€æ›´æ–°ã€å­˜å‚¨ã€åˆ é™¤ã€‚

ç§»é™¤ä¸Šè¿° ØœMapper çš„ SQL æ³¨è§£ï¼Œç„¶ååœ¨ XML æ–‡ä»¶ä¸­ç¼–å†™ SQL ç‰‡æ®µï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š


```XML
<!-- è·å–å­˜å‚¨ä½¿ç”¨é‡æ’åå‰ N çš„ç©ºé—´ --><select id="getTopNSpaceUsage" resultType="com.yupi.Space">
  SELECT id, spaceName, userId, totalSize
  FROM space
  ORDER BY totalSize DESC
  LIMIT #{topN}
</select><!-- åˆ é™¤æŸç”¨æˆ·çš„æ‰€æœ‰ç©ºé—´ --><delete id="deleteByUserId">
  DELETE FROM space WHERE userId = #{userId}
</delete>
```

éœ€è¦æ³¨æ„ 2 ç‚¹ï¼š

1. Mapper æ¥å£ä¸­çš„æ–¹æ³•åç§°å¿…é¡»ä¸ XML æ–‡ä»¶ä¸­å®šä¹‰çš„ SQL ç‰‡æ®µçš„ id å¯¹åº”ï¼ŒMyBatis æ‰èƒ½æ­£ç¡®è§£æå’ŒåŒ¹é…æ–¹æ³•ã€‚
2. Mapper æ¥å£æ–¹æ³•çš„è¿”å›ç±»å‹éœ€è¦ä¸ XML æ–‡ä»¶ä¸­ resultTypeï¼ˆæˆ– resultMapï¼‰çš„å®šä¹‰ä¿æŒä¸€è‡´ï¼Œä»¥ç¡®ä¿æŸ¥è¯¢ç»“æœèƒ½å¤Ÿæ­£ç¡®æ˜ å°„åˆ°è¿”å›å¯¹è±¡ã€‚

è¿™æ ·ä¸€æ¥ï¼ŒMyØœBatis åœ¨è¿è¡Œæ—¶ä¼šæ ¹æ® Mapper æ¥å£è§£æå¯¹åº”çš„ XML æ–‡ä»¶ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå°†æ¥å£æ–¹æ³•ä¸ SQL æ‰§è¡Œé€»è¾‘å…³è”èµ·æ¥ã€‚

# å‰ç«¯å¼€å‘

## æ•°æ®å¯è§†åŒ–ç»„ä»¶

[Apache ECharts](https://echarts.apache.org/zh/index.html) æ˜¯ä¸»æµçš„å¼€æºå›¾è¡¨åº“ï¼Œvue-echarts æ˜¯åŸºäº Echarts çš„å°è£…ï¼Œç®€åŒ–äº†åœ¨ Vue é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ [vue-echarts](https://github.com/ecomfe/vue-echarts) å®ç°æ•°æ®å¯è§†åŒ–ã€‚

å¼•å…¥ç±»åº“ï¼Œæ³¨æ„å¿…é¡»åŒæ—¶å¼•å…¥ Echartsï¼š


```Java
npm i echarts vue-echarts
```

åœ¨éœ€è¦ä½¿ç”¨å›¾è¡¨çš„é¡µé¢ JS å¼•å…¥ï¼š


```JavaScript
import VChart from "vue-echarts";
import "echarts";
```

ç„¶åå°±å¯ä»¥ä½¿ç”¨ç»„ä»¶äº†ï¼Œç¤ºä¾‹ä»£ç ï¼š


```JavaScript
<v-chart :option="options" style="height: 300px" />
```

## å¼€å‘åˆ†æç»„ä»¶

ç”±äºåˆ†æéœ€æ±‚è¾ƒå¤šï¼Œå¦‚æœéƒ½åœ¨ä¸€ä¸ªé¡µé¢ä¸­ç¼–å†™æ‰€æœ‰çš„åˆ†æç»„ä»¶ä»£ç ï¼Œä¼šè®©é¡µé¢è¿‡äºå¤æ‚ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠæ¯ä¸ªåˆ†æéœ€æ±‚çš„å›¾è¡¨å±•ç¤ºå’Œæ•°æ®è·å–é€»è¾‘éƒ½å°è£…ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œç»Ÿä¸€æ”¾åœ¨ `components/analyze` ç›®å½•ä¸‹ï¼Œä¹‹ååˆ†æé¡µé¢ï¼ˆçˆ¶é¡µé¢ï¼‰å¼•å…¥è¿™äº›ç»„ä»¶å³å¯ã€‚

æ¯ä¸ªç»„ä»¶çš„å¼€å‘Øœæ¨¡å¼éƒ½æ˜¯ç±»ä¼¼çš„ï¼Œå…ˆå®šä¹‰å±æ€§ï¼Œæ¯ä¸ªç»„ä»¶éƒ½è¦æ¥å—çˆ¶ç»„ä»¶ä¼ æ¥çš„æŸ¥è¯¢èŒƒå›´å‚æ•°ï¼Œè¿™æ ·çˆ¶é¡µé¢å¯ä»¥çµæ´»æŒ‡å®šè¦æŸ¥è¯¢çš„ç©ºé—´èŒƒå›´ï¼Œå¹¶ç»Ÿä¸€è®©æ‰€æœ‰åˆ†æå›¾è¡¨é‡æ–°åŠ è½½ã€‚


```TypeScript
interface Props {
  queryAll?: boolean
  queryPublic?: boolean
  spaceId?: number
}

const props = withDefaults(defineProps<Props>(), {
  queryAll: false,
  queryPublic: false,
})
```

æ¯ä¸ªç»„ä»¶çš„Øœæ ·å¼é£æ ¼å¯ä»¥ç»Ÿä¸€ï¼Œæ¯”å¦‚éƒ½ç”¨å¡ç‰‡è¿›è¡ŒåŒ…è£…ã€æŒ‡å®šæœ€å¤§é«˜åº¦ã€ç»™å›¾è¡¨åº”ç”¨ loading æ•ˆæœï¼š


```PlainText
<template>
  <div class="space-xxx-analyze">
    <a-card title="åˆ†æéœ€æ±‚åç§°">
      <v-chart :option="options" style="height: 320px" :loading="loading" />
    </a-card>
  </div>
</template>
```

æ¯ä¸ªç»„ä»¶ä¹Ÿéƒ½Øœéœ€è¦åœ¨åŠ è½½æ—¶è°ƒç”¨åç«¯æ¥å£è·å–æ•°æ®ï¼Œå¹¶ä¸”è®¡ç®—å±•ç¤ºå›¾è¡¨éœ€è¦çš„ optionï¼Œä¸åŒçš„éœ€æ±‚å¯¹åº”çš„ä»£ç ä¸åŒï¼Œéœ€è¦å®šåˆ¶å¼€å‘ã€‚

### ç©ºé—´èµ„æºä½¿ç”¨åˆ†æ

é€šè¿‡ç»Ÿè®¡å½“å‰ç©ºé—´å·²ä½¿ç”¨å¤§å°ä¸æ€»é…é¢çš„æ¯”ä¾‹ï¼Œä»¥åŠå›¾ç‰‡æ•°é‡ä¸æœ€å¤§å…è®¸æ•°é‡çš„å æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·ç›´è§‚äº†è§£ç©ºé—´ä½¿ç”¨çŠ¶æ€ï¼ŒåŠæ—¶æ¸…ç†æˆ–å‡çº§ç©ºé—´ã€‚å›¾è¡¨å½¢å¼æ¨èä½¿ç”¨ ä»ªè¡¨ç›˜ æ¥å±•ç¤ºæ¯”ä¾‹ï¼Œç±»ä¼¼è¿›åº¦æ¡ï¼Œå¯ä»¥æ›´ç›´è§‚åœ°äº†è§£æ¯”ä¾‹ã€‚

æˆ‘ä»¬ä½¿ç”¨çš„ Ant Design ç»„ä»¶åº“ä¸­å°±è‡ªå¸¦äº† [è¿›åº¦æ¡ç»„ä»¶](https://antdv.com/components/progress-cn)ï¼Œæ”¯æŒä»ªè¡¨ç›˜çš„å±•ç¤ºæ–¹å¼ï¼Œæ— éœ€ä½¿ç”¨ EChartsã€‚

1ï¼‰ç¼–å†™è·å–æ•°æ®çš„é€»è¾‘ï¼š


```TypeScript
// å›¾è¡¨æ•°æ®const data = ref<API.SpaceUsageAnalyzeResponse>({})
const loading = ref(true)

/**
 * åŠ è½½æ•°æ®
 */const fetchData = async () => {
  loading.value = trueconst res = await getSpaceUsageAnalyzeUsingPost({
    queryAll: props.queryAll,
    queryPublic: props.queryPublic,
    spaceId: props.spaceId,
  })
  if (res.data.code === 0 && res.data.data) {
    data.value = res.data.data
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}

/**
 * ç›‘å¬å˜é‡ï¼Œæ”¹å˜æ—¶è§¦å‘æ•°æ®çš„é‡æ–°åŠ è½½
 */watchEffect(() => {
  fetchData()
})
```

å’Œä¹‹å‰ä¸åŒçš„æ˜¯Øœï¼Œä¸ºäº†è®©ç»„ä»¶çš„å±æ€§å˜åŒ–æ—¶é‡æ–°åŠ è½½å›¾è¡¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ watchEffect æ¥ç›‘å¬æ‰€æœ‰åŠ¨æ€å˜é‡ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå€¼å‘ç”Ÿå˜åŒ–ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œå°è£…çš„å‡½æ•°ã€‚

2ï¼‰ç¼–å†™å›¾è¡¨ç»“æ„ã€‚è¯¥ç»„ä»¶è¦å±•ç¤ºå­˜å‚¨ç©ºé—´ä½¿ç”¨æ¯”ä¾‹å’Œå›¾ç‰‡æ•°é‡ä½¿ç”¨æ¯”ä¾‹ï¼Œå› æ­¤é‡‡ç”¨ä¸€è¡Œä¸¤åˆ—çš„ [Flex å¸ƒå±€](https://antdv.com/components/flex-cn)ï¼š


```PlainText
<a-flex gap="middle">
  <a-card title="å­˜å‚¨ç©ºé—´" style="width: 50%">
    <div style="height: 320px; text-align: center">
      <h3>{{ formatSize(data.usedSize) }} / {{ data.maxSize ? formatSize(data.maxSize) : 'æ— é™åˆ¶' }}</h3>
      <a-progress type="dashboard" :percent="data.sizeUsageRatio ?? 0" />
    </div>
  </a-card>
  <a-card title="å›¾ç‰‡æ•°é‡" style="width: 50%">
    <div style="height: 320px; text-align: center">
      <h3>{{ data.usedCount }} / {{ data.maxCount ?? 'æ— é™åˆ¶' }} </h3>
      <a-progress type="dashboard" :percent="data.countUsageRatio ?? 0" />
    </div>
  </a-card>
</a-flex>
```

æ³¨æ„ï¼Œè¦ç»™Øœ percent ç™¾åˆ†æ¯”çš„å€¼è®¾ç½®é»˜è®¤å€¼ï¼Œå¦åˆ™ä¼šå½±å“é¡µé¢çš„åŠ è½½ã€‚

### ç©ºé—´å›¾ç‰‡åˆ†ç±»åˆ†æ

ç»Ÿè®¡ä¸åŒåˆ†ç±»ä¸‹å›¾ç‰‡çš„æ•°é‡å’Œæ€»å¤§å°å æ¯”ï¼Œå¸®åŠ©ç”¨æˆ·æ¸…æ™°äº†è§£å„åˆ†ç±»çš„èµ„æºåˆ†å¸ƒï¼Œä¼˜åŒ–å­˜å‚¨ç­–ç•¥ã€‚ç”±äºåŒä¸€ä¸ªåˆ†ç±»è¦å±•ç¤ºå¤šä¸ªä¿¡æ¯ï¼Œå¯ä»¥é€‰æ‹© åˆ†ç»„æ¡å½¢å›¾ æ¥å±•ç¤ºã€‚

1ï¼‰ç¼–å†™è·å–æ•°æ®çš„é€»è¾‘ï¼š


```TypeScript
// å›¾è¡¨æ•°æ®const dataList = ref<API.SpaceCategoryAnalyzeResponse[]>([])
const loading = ref(true)

/**
 * åŠ è½½æ•°æ®
 */const fetchData = async () => {
  loading.value = trueconst res = await getSpaceCategoryAnalyzeUsingPost({
    queryAll: props.queryAll,
    queryPublic: props.queryPublic,
    spaceId: props.spaceId,
  })
  if (res.data.code === 0) {
    dataList.value = res.data.data ?? []
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}
```

2ï¼‰ç¼–å†™å›¾è¡¨ç»“æ„ï¼š


```PlainText
<div class="space-category-analyze">
  <a-card title="å›¾åº“åˆ†ç±»å ç”¨">
      <v-chart :option="options" style="height: 320px; max-width: 100%;" :loading="loading" />
  </a-card>
</div>
```

3ï¼‰ç¼–å†™å›¾è¡¨é€‰é¡¹ã€‚æ³¨æ„ï¼Œç”±äº dataList æ˜¯æœ‰ä¸€ä¸ªåŠ è½½è¿‡ç¨‹çš„ï¼Œè¦ä½¿ç”¨ `computed` è®¡ç®—å±æ€§ï¼Œå§‹ç»ˆæ ¹æ® dataList çš„å€¼æ¥è®¡ç®—é€‰é¡¹ï¼š


```TypeScript
const options = computed(() => {
  const categories = dataList.value.map((item) => item.category)
  const countData = dataList.value.map((item) => item.count)
  const sizeData = dataList.value.map((item) => (item.totalSize / (1024 * 1024)).toFixed(2)) // è½¬ä¸º MBreturn {
    tooltip: { trigger: 'axis' },
    legend: { data: ['å›¾ç‰‡æ•°é‡', 'å›¾ç‰‡æ€»å¤§å°'], top: 'bottom' },
    xAxis: { type: 'category', data: categories },
    yAxis: [
      {
        type: 'value',
        name: 'å›¾ç‰‡æ•°é‡',
        axisLine: { show: true, lineStyle: { color: '#5470C6' } }, // å·¦è½´é¢œè‰²
      },
      {
        type: 'value',
        name: 'å›¾ç‰‡æ€»å¤§å° (MB)',
        position: 'right',
        axisLine: { show: true, lineStyle: { color: '#91CC75' } }, // å³è½´é¢œè‰²splitLine: {
          lineStyle: {
            color: '#91CC75', // è°ƒæ•´ç½‘æ ¼çº¿é¢œè‰²type: 'dashed', // çº¿æ¡æ ·å¼ï¼šå¯é€‰ 'solid', 'dashed', 'dotted'
          },
        },
      },
    ],
    series: [
      { name: 'å›¾ç‰‡æ•°é‡', type: 'bar', data: countData, yAxisIndex: 0 },
      { name: 'å›¾ç‰‡æ€»å¤§å°', type: 'bar', data: sizeData, yAxisIndex: 1 },
    ],
  }
})
```

ğŸ’¡ è¿™æ®µØœé€‰é¡¹ä»£ç å®Œå…¨å¯ä»¥å…ˆåˆ©ç”¨ AI ç”Ÿæˆï¼Œå†æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¾®è°ƒæ ·å¼ã€‚

### ç©ºé—´å›¾ç‰‡æ ‡ç­¾åˆ†æ

è§£æç”¨æˆ·å›¾åº“ä¸­çš„æ ‡ç­¾ï¼Œç»Ÿè®¡æ¯ä¸ªæ ‡ç­¾çš„å…³è”å›¾ç‰‡æ•°é‡ã€‚ç”±äºæ ‡ç­¾æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç”¨ è¯äº‘å›¾ å±•ç¤ºæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå¹¶çªå‡ºå¸¸ç”¨æ ‡ç­¾ï¼Œä¾¿äºä¼˜åŒ–ç®¡ç†å’Œå›¾ç‰‡æœç´¢ã€‚

æ³¨æ„ï¼ŒApache ECharts é»˜è®¤ä¸ä¼šå¼•å…¥è¯äº‘å›¾ç»„ä»¶ï¼Œéœ€è¦æˆ‘ä»¬å®‰è£… [è¯äº‘å›¾](https://github.com/ecomfe/echarts-wordcloud) ä¾èµ–å¹¶å¼•å…¥ï¼š


```TypeScript
import VChart from 'vue-echarts'
import 'echarts'import 'echarts-wordcloud'
```

1ï¼‰ç¼–å†™è·å–æ•°æ®çš„é€»è¾‘ï¼š


```TypeScript
const fetchData = async () => {
  loading.value = trueconst res = await getSpaceTagAnalyzeUsingPost({
    queryAll: props.queryAll,
    queryPublic: props.queryPublic,
    spaceId: props.spaceId,
  })
  if (res.data.code === 0) {
    dataList.value = res.data.data ?? []
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}
```

2ï¼‰ç¼–å†™å›¾è¡¨ç»“æ„ï¼š


```PlainText
<div class="space-tag-analyze">
  <a-card title="å›¾åº“æ ‡ç­¾è¯äº‘">
    <v-chart :option="options" style="height: 320px; max-width: 100%;" :loading="loading" />
  </a-card>
</div>
```

3ï¼‰ç¼–å†™å›¾è¡¨é€‰é¡¹ï¼š


```TypeScript
const options = computed(() => {
  const tagData = dataList.value.map((item) => ({
    name: item.tag,
    value: item.count,
  }))

  return {
    tooltip: {
      trigger: 'item',
      formatter: (params: any) => `${params.name}: ${params.value} æ¬¡`,
    },
    series: [
      {
        type: 'wordCloud',
        gridSize: 10,
        sizeRange: [12, 50], // å­—ä½“å¤§å°èŒƒå›´rotationRange: [-90, 90],
        shape: 'circle',
        textStyle: {
          color: () =>`rgb(${Math.round(Math.random() * 255)}, ${Math.round(
              Math.random() * 255,
            )}, ${Math.round(Math.random() * 255)})`, // éšæœºé¢œè‰²
        },
        data: tagData,
      },
    ],
  }
})
```

æ•ˆæœå¦‚å›¾ï¼š

### ç©ºé—´å›¾ç‰‡å¤§å°åˆ†æ

æŒ‰å›¾ç‰‡å¤§å°ï¼ˆå¦‚ <100 KBã€100 KB-1 MBã€>1 MBï¼‰åˆ†æ®µç»Ÿè®¡å›¾ç‰‡æ•°é‡ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«å¤§ä½“ç§¯å›¾ç‰‡ï¼Œåˆç†åˆ†é…å­˜å‚¨èµ„æºã€‚ç”±äºæŒ‰å›¾ç‰‡å¤§å°åˆ†ç±»çš„æ•°é‡ä¸å¤šï¼Œå¯ä»¥ä½¿ç”¨ é¥¼å›¾ å±•ç¤ºï¼Œèƒ½å¤Ÿä½“ç°æ¯ç±»å¤§å°å›¾ç‰‡çš„æ•°é‡å æ¯”ã€‚

1ï¼‰ç¼–å†™è·å–æ•°æ®çš„é€»è¾‘ï¼š


```TypeScript
const fetchData = async () => {
  loading.value = trueconst res = await getSpaceSizeAnalyzeUsingPost({
    queryAll: props.queryAll,
    queryPublic: props.queryPublic,
    spaceId: props.spaceId,
  })
  if (res.data.code === 0) {
    dataList.value = res.data.data ?? []
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}
```

2ï¼‰ç¼–å†™å›¾è¡¨ç»“æ„ï¼š


```PlainText
<div class="space-size-analyze">
  <a-card title="ç©ºé—´å›¾ç‰‡å¤§å°åˆ†æ">
    <v-chart :option="options" style="height: 320px; max-width: 100%" :loading="loading" />
  </a-card>
</div>
```

3ï¼‰ç¼–å†™å›¾è¡¨é€‰é¡¹ï¼š


```TypeScript
const options = computed(() => {
  const pieData = dataList.value.map((item) => ({
    name: item.sizeRange,
    value: item.count,
  }))

  return {
    tooltip: {
      trigger: 'item',
      formatter: '{a} <br/>{b}: {c} ({d}%)',
    },
    legend: {
      top: 'bottom',
    },
    series: [
      {
        name: 'å›¾ç‰‡å¤§å°',
        type: 'pie',
        radius: '50%',
        data: pieData,
      },
    ],
  }
})
```

### ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æ

ç»Ÿè®¡ç”¨æˆ·æ¯æœˆã€æ¯å‘¨ã€æ¯æ—¥ä¸Šä¼ å›¾ç‰‡çš„æ•°é‡è¶‹åŠ¿ï¼Œå¸®åŠ©ç”¨æˆ·è¯†åˆ«ä¸Šä¼ é«˜å³°æœŸå¹¶ä¼˜åŒ–ç®¡ç†ç­–ç•¥ï¼Œæ¨èä½¿ç”¨ æŠ˜çº¿å›¾ å‘ˆç°æ—¶é—´åºåˆ—è¶‹åŠ¿ã€‚

1ï¼‰ç¼–å†™è·å–æ•°æ®çš„é€»è¾‘ï¼š


```TypeScript
const fetchData = async () => {
  loading.value = trueconst res = await getSpaceUserAnalyzeUsingPost({
    queryAll: props.queryAll,
    queryPublic: props.queryPublic,
    spaceId: props.spaceId,
    timeDimension: timeDimension.value,
    userId: userId.value,
  })
  if (res.data.code === 0) {
    dataList.value = res.data.data ?? []
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}
```

2ï¼‰ç¼–å†™å›¾è¡¨ç»“æ„ï¼š


```TypeScript
<div class="space-user-analyze">
  <a-card title="ç©ºé—´å›¾ç‰‡ç”¨æˆ·åˆ†æ"><v-chart :option="options" style="height: 320px; max-width: 100%" :loading="loading" /></a-card>
</div>
```

3ï¼‰ç¼–å†™å›¾è¡¨é€‰é¡¹ï¼š


```TypeScript
const options = computed(() => {
  const periods = dataList.value.map((item) => item.period) // æ—¶é—´åŒºé—´const counts = dataList.value.map((item) => item.count) // ä¸Šä¼ æ•°é‡return {
    tooltip: { trigger: 'axis' },
    xAxis: { type: 'category', data: periods, name: 'æ—¶é—´åŒºé—´' },
    yAxis: { type: 'value', name: 'ä¸Šä¼ æ•°é‡' },
    series: [
      {
        name: 'ä¸Šä¼ æ•°é‡',
        type: 'line',
        data: counts,
        smooth: true, // å¹³æ»‘æŠ˜çº¿emphasis: {
          focus: 'series',
        },
      },
    ],
  }
})
```

4ï¼‰æ”¯æŒç”¨Øœæˆ·é€‰æ‹©ç»Ÿè®¡çš„æ—¶é—´èŒƒå›´ï¼ˆæ—¥ / å‘¨ / æœˆï¼‰å¹¶æŒ‰ç…§ç”¨æˆ· id ç­›é€‰ã€‚

å…ˆå¼€å‘é¡µé¢ç»“æ„ï¼Œå¯ä»¥åˆ©ç”¨ [Card ç»„ä»¶](https://antdv.com/components/card-cn) çš„æ’æ§½åŠŸèƒ½ï¼Œåœ¨å¡ç‰‡æ ‡é¢˜çš„å³ä¾§å±•ç¤ºæœç´¢è¡¨å•ï¼š


```PlainText
<a-card title="ç”¨æˆ·ä¸Šä¼ åˆ†æ">
  <v-chart :option="options" style="height: 320px" />
  <template #extra>
    <a-space>
      <a-segmented v-model:value="timeDimension" :options="timeDimensionOptions" />
      <a-input-search placeholder="è¯·è¾“å…¥ç”¨æˆ· id" enter-button="æœç´¢ç”¨æˆ·" @search="doSearch" />
    </a-space>
  </template>
</a-card>
```

å®šä¹‰å˜é‡ï¼ŒØœç”¨äºæ¥å—è¡¨å•é¡¹çš„è¾“å…¥å€¼ï¼Œå¹¶ä¸”ç»™ä¸‹æ‹‰é€‰æ‹©è¡¨å•æä¾›é»˜è®¤é€‰é¡¹ï¼š


```TypeScript
const userId = ref<string>()
const timeDimension = ref<string>('day')
const timeDimensionOptions = [
  {
    label: 'æ—¥',
    value: 'day',
  },
  {
    label: 'å‘¨',
    value: 'week',
  },
  {
    label: 'æœˆ',
    value: 'month',
  },
]
```

ç¼–å†™æäº¤è¡¨å•çš„å‡½æ•°ï¼Œç‚¹å‡»æœç´¢æ—¶æ›´æ”¹ userId çš„å€¼ï¼š


```TypeScript
const doSearch = (value: string) => {
  userId.value = value
}
```

æœ€åï¼Œè¡¥å……Øœæœç´¢æ¡ä»¶åˆ°è·å–æ•°æ®çš„å‡½æ•°ä¸­ï¼Œåªè¦å±æ€§æˆ–è€…é€‰é¡¹çš„å€¼å‘ç”Ÿäº†ä¿®æ”¹ï¼Œç«‹åˆ»å°±ä¼šé‡æ–°åŠ è½½ï¼š1jGyT1jdedQgDNFYA8T3BC8Rpod+tQXglYFmkZuCZXA=


```TypeScript
const res = await getSpaceUserAnalyzeUsingPost({
  queryAll: props.queryAll,
  queryPublic: props.queryPublic,
  spaceId: props.spaceId,
  timeDimension: timeDimension.value,
  userId: userId.value,
})
```

æ•ˆæœå¦‚å›¾ï¼š

### ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æ

æŒ‰å­˜å‚¨ä½¿ç”¨é‡æ’åºï¼Œç»Ÿè®¡å ç”¨å­˜å‚¨æœ€å¤šçš„å‰ N ä¸ªç©ºé—´ï¼Œå¸®åŠ©ç®¡ç†å‘˜å¿«é€Ÿå®šä½é«˜å ç”¨ç©ºé—´ï¼Œå¹¶è¯†åˆ«æ½œåœ¨çš„èµ„æºæ»¥ç”¨æˆ–å¼‚å¸¸æƒ…å†µã€‚å¯ä»¥é€‰ç”¨ æŸ±çŠ¶å›¾ï¼Œç›´è§‚åœ°å±•ç¤ºæ’åå’Œå­˜å‚¨ä½¿ç”¨é‡ã€‚

1ï¼‰ç¼–å†™è·å–æ•°æ®çš„é€»è¾‘ï¼š


```TypeScript
const fetchData = async () => {
  loading.value = trueconst res = await getSpaceRankAnalyzeUsingPost({
    queryAll: props.queryAll,
    queryPublic: props.queryPublic,
    spaceId: props.spaceId,
  })
  if (res.data.code === 0) {
    dataList.value = res.data.data ?? []
  } else {
    message.error('è·å–æ•°æ®å¤±è´¥ï¼Œ' + res.data.message)
  }
  loading.value = false
}
```

å¯ä»¥åƒå¼€å‘ç”¨æˆ·Øœä¸Šä¼ è¡Œä¸ºåˆ†æå›¾è¡¨ä¸€æ ·ï¼Œå¢åŠ ä¸€ä¸ªä¿®æ”¹ topN æŸ¥è¯¢æ¡æ•°çš„è¡¨å•é¡¹ã€‚è¿™é‡Œæˆ‘ä»¬ç®€å•ä¸€ç‚¹ï¼Œå°±å…ˆä¸ä¼  topNï¼Œåç«¯ä¼šå¡«å……é»˜è®¤å€¼ï¼ˆ10 æ¡ï¼‰ã€‚

2ï¼‰ç¼–å†™å›¾è¡¨ç»“æ„ï¼š


```PlainText
<div class="space-rank-analyze">
  <a-card title="ç©ºé—´ä½¿ç”¨æ’è¡Œ">
    <v-chart :option="options" style="height: 320px" />
  </a-card>
</div>
```

3ï¼‰ç¼–å†™å›¾è¡¨é€‰é¡¹ï¼š


```TypeScript
const options = computed(() => {
  const spaceNames = dataList.value.map((item) => item.spaceName)
  const usageData = dataList.value.map((item) => (item.totalSize / (1024 * 1024)).toFixed(2)) // è½¬ä¸º MBreturn {
    tooltip: { trigger: 'axis' },
    xAxis: {
      type: 'category',
      data: spaceNames,
    },
    yAxis: {
      type: 'value',
      name: 'ç©ºé—´ä½¿ç”¨é‡ (MB)',
    },
    series: [
      {
        name: 'ç©ºé—´ä½¿ç”¨é‡ (MB)',
        type: 'bar',
        data: usageData,
        itemStyle: {
          color: '#5470C6', // è‡ªå®šä¹‰æŸ±çŠ¶å›¾é¢œè‰²
        },
      },
    ],
  }
})
```

## å¼€å‘åˆ†æé¡µé¢

æ–°å»ºä¸€ä¸ªåˆ†æé¡µé¢ï¼Œæ‰€æœ‰å›¾è¡¨ç»„ä»¶Øœéƒ½æ”¾åˆ°è¯¥é¡µé¢ä¸­ã€‚å¯ä»¥é€šè¿‡ URL æŸ¥è¯¢å‚æ•°æ¥è§¦å‘ä¸åŒèŒƒå›´çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚åˆ†ææŸä¸ªç‰¹å®šç©ºé—´ï¼ˆspaceId=xxxï¼‰ã€åˆ†æå…¬å…±å›¾åº“ï¼ˆqueryPublic=1ï¼‰ã€åˆ†æå…¨éƒ¨ç©ºé—´ï¼ˆqueryAll=1ï¼‰ã€‚è¿™æ ·æ— è®ºæ˜¯ç®¡ç†å‘˜åˆ†æå…¨ç©ºé—´ / å…¬å…±å›¾åº“ï¼Œè¿˜æ˜¯ç”¨æˆ·åˆ†ææŸä¸ªç©ºé—´ï¼Œéƒ½å¯ä»¥å¤ç”¨è¯¥é¡µé¢ã€‚

1ï¼‰æ–°å»ºé¡µé¢æ–‡ä»¶å’Œè·¯ç”±ï¼š


```TypeScript
{
  path: '/space_analyze',
  name: 'ç©ºé—´åˆ†æ',
  component: SpaceAnalyzePage,
}
```

2ï¼‰å¼€å‘é¡µØœé¢ï¼Œå…ˆå®šä¹‰æŸ¥è¯¢èŒƒå›´å‚æ•°ï¼Œä» URL æŸ¥è¯¢å‚æ•°ä¸­è·å–ï¼š


```TypeScript
const route = useRoute()

// ç©ºé—´ idconst spaceId = computed(() => {
  return route.query?.spaceId as string
})

// æ˜¯å¦æŸ¥è¯¢æ‰€æœ‰ç©ºé—´const queryAll = computed(() => {
  return !!route.query?.queryAll
})

// æ˜¯å¦æŸ¥è¯¢å…¬å…±ç©ºé—´const queryPublic = computed(() => {
  return !!route.query?.queryPublic
})
```

3ï¼‰å¼€å‘é¡µé¢ç»“æ„ï¼Œå¼•å…¥ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨æ …æ ¼ç³»ç»Ÿä¸€è¡Œä¸¤åˆ—å¸ƒå±€ï¼š


```PlainText
<div id="spaceAnalyzePage">
  <h2>
    ç©ºé—´å›¾åº“åˆ†æ -
    <span v-if="queryAll"> å…¨éƒ¨ç©ºé—´ </span>
    <span v-else-if="queryPublic"> å…¬å…±å›¾åº“ </span>
    <span v-else>
      <a :href="`/space/${spaceId}`" target="_blank">idï¼š{{ spaceId }}</a>
    </span>
  </h2>
  <a-row :gutter="[16, 16]">
    <!-- ç©ºé—´ä½¿ç”¨åˆ†æ -->
    <a-col :xs="24" :md="12">
      <SpaceUsageAnalyze :spaceId="spaceId" :queryAll="queryAll" :queryPublic="queryPublic" />
    </a-col>
    <!-- ç©ºé—´åˆ†ç±»åˆ†æ -->
    <a-col :xs="24" :md="12">
      <SpaceCategoryAnalyze :spaceId="spaceId" :queryAll="queryAll" :queryPublic="queryPublic" />
    </a-col>
    <!-- æ ‡ç­¾åˆ†æ -->
    <a-col :xs="24" :md="12">
      <SpaceTagAnalyze :spaceId="spaceId" :queryAll="queryAll" :queryPublic="queryPublic" />
    </a-col>
    <!-- å›¾ç‰‡å¤§å°åˆ†æ®µåˆ†æ -->
    <a-col :xs="24" :md="12">
      <SpaceSizeAnalyze :spaceId="spaceId" :queryAll="queryAll" :queryPublic="queryPublic" />
    </a-col>
    <!-- ç”¨æˆ·ä¸Šä¼ è¡Œä¸ºåˆ†æ -->
    <a-col :xs="24" :md="12">
      <SpaceUserAnalyze :spaceId="spaceId" :queryAll="queryAll" :queryPublic="queryPublic" />
    </a-col>
    <!-- ç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æ -->
    <a-col :xs="24" :md="12">
      <SpaceRankAnalyze :spaceId="spaceId" :queryAll="queryAll" :queryPublic="queryPublic" />
    </a-col>
  </a-row>
</div>
```

4ï¼‰æƒé™æ§åˆ¶ï¼Œä»…ç®¡ç†å‘˜æ‰èƒ½çœ‹åˆ° â€œç©ºé—´ä½¿ç”¨æ’è¡Œåˆ†æâ€ã€‚

å…ˆå®šä¹‰æ˜¯å¦ä¸ºç®¡ç†å‘˜å˜é‡ï¼š


```TypeScript
const loginUserStore = useLoginUserStore()
const loginUser = loginUserStore.loginUserconst isAdmin = computed(() => {
  return loginUser.userRole === 'admin'
})
```

ç»„ä»¶æ·»åŠ  `v-if` å±æ€§ï¼š


```PlainText
<SpaceRankAnalyze v-if="isAdmin" 
  :spaceId="spaceId" 
  :queryAll="queryAll" 
  :queryPublic="queryPublic" 
/>
```

å…¶ä»–çš„æƒé™æ§åˆ¶Øœåœ¨åç«¯å·²ç»å®ç°äº†ï¼Œæ¯”å¦‚æ™®é€šç”¨æˆ·ä¸èƒ½è®¿é—®å…¶ä»–äººçš„ç©ºé—´â€‚â€‚â€‚â€‚â€‚â€‚â€‚ï»¿â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‚â€‚â€‚â€‰â€‚â€â€‰â€‚â€‰â€‰â€‰â€‚â€‰â€‰â€‰â€‚â€‚

## è¡¥å……è·³è½¬å…¥å£

ç»™ç”¨æˆ·ç©ºé—´è¯¦æƒ…é¡µã€ç©ºé—´ç®¡ç†é¡µé¢å¢åŠ è·³è½¬åˆ°åˆ†æé¡µçš„å…¥å£ã€‚

1ï¼‰ç”¨æˆ·ç©ºé—´è¯¦æƒ…é¡µè¡¥å……ç©ºé—´åˆ†ææŒ‰é’®ï¼š


```PlainText
<a-button
  type="primary"
  ghost
  :icon="h(BarChartOutlined)"
  :href="`/space_analyze?spaceId=${id}`"
  target="_blank"
>
  ç©ºé—´åˆ†æ
</a-button>
```

2ï¼‰ç©ºé—´ç®¡Øœç†æ–°å¢å…¬å…±å›¾åº“åˆ†ææŒ‰é’®ã€å…¨ç©ºé—´åˆ†ææŒ‰é’®ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è·³è½¬åˆ°æŸä¸ªç‰¹å®šçš„ç©ºé—´åˆ†æé¡µã€‚


```PlainText
<a-space>
  <a-button type="primary" href="/add_space" target="_blank">+ åˆ›å»ºç©ºé—´</a-button>
  <a-button type="primary" ghost href="/space_analyze?queryPublic=1" target="_blank">
    åˆ†æå…¬å…±å›¾åº“
  </a-button>
  <a-button type="primary" ghost href="/space_analyze?queryAll=1" target="_blank">
    åˆ†æå…¨ç©ºé—´
  </a-button>
</a-space>
```

æ“ä½œæ è¡¥å……ï¼š


```JavaScript
<a-button type="link" :href="`/space_analyze?spaceId=${record.id}`" target="_blank">
  åˆ†æ
</a-button>
```

---






{"nodes":[{"block_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","block_type":1,"children":["TL6CdSvFLo1e92xaFxhcB6ZwnJh","CPjZd4sRRoTqlIxrmL2ciLygn4g","TBuqdGlr9obt2kxW7OVc8I8rnKe","JngbdkpCboKP1ZxZxtec7e6ZnEf","GlSnd5OHdoGHJrxzGRgcuMh2nGe","L5O3dTqxYorFjnxwIVKczgIDnif","Ts6qd4Beeo5FErxk4Kac2jDenif","Vgzfd26tyo7DpZx80AHcHgi3nke","HB59d0b8roB5VcxMbJacUuvdnjc","V8ZZdr6WPo54Kdxy92hc0fnCnOf","QO57dTTrYoYD5rxY3TUcPj84nkd","NzghdiKhXonz29xJFFtclillnrh","F5zAdR4Gvo6UrBxarK9cDlDHnjb","YercdA9rrofTXIxkosScnFI7nrc","YBo9dzsuAoU3ZqxZ1aycdbxinUg","Dj3gdwsewoadVCxFl1NcOAzUnKd","WMaLdX6Avof1BbxU9WccnWCvnc7","Dll9dIjBEo1uxtxRCYtcqKjNnsg","FeYWdQzhFo8sF9xxsGscHCmqnle","EGdXd519YoSIwfxuXBvcPQwVnbc","EzfQdeHzeocijcxAZsfcaSuZnLe","Cc6Dd3O8KoilPsxt8XCcJjkVnhf","UaTIdmPxQo1AYGxHnfTc9eqkn1g","Z2TlddL77obG8pxOkO2cYtRsnNg","CbCrdV3r0oJ2HNx1pDac4gxmnec","Ma0EdA1pvopRmtxv4fHceNEgnjh","VgHcdPnB0ovaQYxFYUic0JZsnbf","RUktdsMcnoeItax2w0gcR3ednkb","E5Cydt7saouXBHxiYQ8c4gWpnKe","K7ypdeAKBopTVFxQK0vcQv4dnMg","MtAIdNU9xo37KwxRwGDcnr1VnUd","JmNQd0MhIo8Fa2xjvTccYIMUnAH","DgardHgrro3p9Sx3QOuc8Olun5d","F4UpdQeK7oAQhmxPLMnc1GSwnFJ","GefrdLRASoh6vkxfcWUcDNSonwh","VLu4deHKYooyeBxihsMcfYdynuh","LDtYdXPUDoYS6mxEJXmczMkZntd","EcO8dRHxMoHb8hxWjDucfGQrn9d","IRJGdLvfAoptOLxcbQwc843Xnch","KWDRdHtOnoepJDx1zQPcVZZSnlh","MycLdWwTYo95cExPHNlc3qnhnyh","RdYSdcQZKojNdWxozrccgyienGd","LHwjdEJyooElTGxeqRvcb2V6nkh","HUq2dy4D6oSTHJx2wszc6Nw0nEc","FkxudcnJXopzCIxcNYgcuVuqnRd","H1gGdDNmDo9OJAxlKmMcCoX9nsg","UgYEdhPZXoJOdKxSK0ecJMCHnSe","B40cdEl7poeHyIxc8YwcrCcfnBh","VJS1dy2GmoLEzZxIg2ccWo00nsc","V3xedyOcjoU89ZxbLfBccEH1nGf","ZZ2fdXhL5oW4Yux9mwucg6Vnn2b","AjMpdaJ2YojlQUxC6qVcmr4cnWh","UhEZdj37LoQEL5xo9HWco60Hncc","X9SldWBZRoaN9vxtI4ycuoygnlb","W4bSdN54uo56GqxqRWKcPophnme","SvCZdms03otiaVxR1g3cmlE3nNH","KcPZdfCXOo8Pkex1Cb1cy3NVnpd","SszvdNbXgowM0Dx2tfxc6zLMnQb","Zhb1dVai2ofZlMxzT6Tcnj6OnCu","ItVxdRpOjoV0jFxGKkDcZa1KnGp","Fw5EdUNHGo42XrxK8ficJVhEnWb","Q2KVdlYa2oo6Cdxxjihcxz6mnJc","XB3wdP2juo10R0x8CyMcvCSmnve","EkaddMdxvoELmzx059Kc6DObn1b","MLsLdMJg3oQsH9xpo3xcVpmdnIe","OYbZdHTBjor9FsxATVpcJ6finXe","Kw5PdicObodMTVxzECSc5sLenMg","DShjdNxsHoIWamxQreac5qKZnqb","NHyTdQMwEo2FWEx8aJacCdTXn6g","PqwbdaqTwo4lPgxyOEkcisPKn7g","UVZsdJuppoAVIixfFdPcDRMknab","DnmXd66jloX6rtxDYN7c2jaUnvd","XQGmdqUHdoUAvSxeYfKc9SCvnkf","IyasdipL0ocb2DxhwHUcotn4nvd","DHeHdldwpo0QXTxHuUicGu2Anig","TVdqd7QYfo4s3IxHt01cWKb6nde","OruEdcGaHo9HEFxVKt4coiR5n4c","DJV3dvELyojAmKxePOYc1kyPni2","TLixdeDREodvccxCacRckSRMn7e","XlfTdKL0YoYdvVxmT5ec0QManvd","QbPEd3VHAojQVZx1nQvcPWKmnIh","M36IdjTA8oULO7xLYmecaCv5nQc","IxAgd1xUzopQJOxO6k7cP7fznVb","DcRgd3LqSo8wdlxKNxFcx4GznMd","COo2dBRf4o2Fa4xE5hBc59oOnL7","HJcddJ2mkonmFlx2OUqcjmfWnVf","IWaMdSidVo9Lg5xn8v9ce3cAnrc","EcFKdXYbmofJhxxkEu2cBKognDb","NEoodObYuoChgRxBufbc2QPSnSe","VhUNdxvs6of1hcxSh9Kctkknnhh","QkWLdoz95oZFz1xnS53cf8sunQb","F3eNd4ydCogVCRxM5Bbcm7Kbn2f","WKDUdveA6ofk38xRcvPcPsSlnOf","Zl0pd1jxZoCq4vxRq0CcXgvknTd","L5EDdBk4Joheuvx4xhOc5Cz7nrh","Ek9Od4vVqoiH63xPpFJcQsXGn2m","YMnadW5UpoCP5cxPhktcAYM7nSd","BnPldfmGXo7sfUxlMJAcGEQSnLf","HdTgdtdchoTQkkxPDyjc6ssVnf1","Jr3bdVwvAozIDcxIEk1cUSSpnGb","P8l6ddqJsoIXWVx4c22ccCTnnyc","F9lMdNuUloa5hWxzQM1cm1cjnld","XS9DdXhF1oXdrXxfXxIcqmqunBe","YJVFdGVcOoK82AxIS2ocpUqGnfg","VS6ud0zaSoQ72vxOXx6cUr8jn7f","BJb4djHBuootGvxOgj8cV89znWh","BvAVdGUAXoOfu9xeE5Yc6l6On5d","WaEYdvdNgoH6IYxUsIicpmlSnpf","WxTEdxUQUoSKecxHHZQcazQpncd","QrDBd54U2o6577xX5QTcMIXcnKc","LGXbdkdsUo4WPdxnak5caAnPnub","Yd59d3TGPoiHX7xMo7Gc3fUrnvf","Ijl4dkXYZo5HqZxHehxcfMXAnaf","CnmWddvwwoLI69xkR6FcRRLKn4T","IlVYdqN8XoFTIOxdCp2c0jcdn4f","Ch4Bd2Vnlom104xE7aIcwDlYnQe","HkOddzAhAo8tOoxxlxncikHGnBb","CllpdHk8aoqRvWxox8hcpXXRnje","TViZdF5KYomVWNxkWERcWQC7npb","VHrjdol6poh8vMxuVgZckS3VnCc","Izq0dN8g4ot8IPxPlSectkNYnch","NqkRd2w7hok1LtxYwtdcbk0ensR","YepDdrMKjoxAvyxSG3WcFD62nUh","GTs9dasR8osSM6xAIIfcMHjLnqb","VHBOdqWhLoeII7xXctrczSa3nge","JRGGdK4prokQHhxQ3A0cjifWnyb","YbRFdqJG5otquDxsbpVchhIHnje","KvBrdaUsboDxLoxbVcDc0JdynLb","XwxrdsWFQoBAcixaOaRcuNpnn4P","CcqEdUdAVo9cvAxRXolcOwpEn6f","KLKYdFrYhodJTGxKl89crysan6c","HB3hdSfyaolOADxDznxcDJt1nog","HZPvd5mj4owonwxzjhGc75P3nsG","UDqXdbEXsokAX2xLId5cFSxrndd","MCZGdBpk1oL5f6xBsIxc4MNanyh","LE6edXgm9o2Al6xSYqUcekzenLf","FqYBd5VUroJVY0xY2wmcb08Bnrc","K2Pbd6nluoBummxgQzEcJ69Xn1u","I9SwdEl4coD62Cx5iRYcW1Q9npa","I891dYf8to1EO9xN1LmcZQskndf","W0CSdBkbooqNuxxxzFrcTiGHnTf","KY17d8UHXoR7YrxPAUwcka0gnig","TOgrdroXEodew9x53stcpfoAnrg","B1FZdKSC8oWjcPxqrXZcC24dnLg","Fng0dlPwEoMRhfxxAqGc9tbFnuT","XANxdvJhIoup6WxFCnScE5TFn7b","Dh48dtF2RoCQGLxtwsOc0sOznKd","FJpfdSkAtoxl3Xx8YTzcSGmUnic","GrU7dEbq0oCKbWxhiEEcX8Tkngb","TfL6dR5jYofFoUxbC99cQ0yJnVh","Lh15dSzjno1H9jxValGchmGuned","G1CsdrSvHoxzkWxMTDjct1B9nNM","H3Zidua70oSEA4xQnKmcEcmHnWb","VWDAdS7P0o5BTuxh9qZc2LhpnMf","LdredS4PdoDmEtxAaTncZPUGnSd","PzZzdVcZ0o01TMxmyRYcNx1Cnud","INOXdTiJUohBG2xz7atcYBVunmk","L3WrdnlovoqXTaxbdKQcbFDynV7","Rj9ldMI15oT8eUxsF3Zc2Q9pnug","DHcfdHlcqorxvmx7q3icolMFn7f","RxcEdZgqRoKSaTxO1jFcz6n7nod","KSE4dt54Vo9o1tx0eeecYCNPndg","BRlYdd8OLoyt8rxdccJcqcGlnjg","YfmsdV6odo6nSzxmR50cK8dWn7c","P9DFdivHHo7DcUx15ULce7Man2g","K7Pnd9tM1o8BRpxsHALcGhLNnhg","Syl1dJgmfo3ZcZxsFZlcSj8in1d","T2lQdL5HFovMIgxuonVc02gqnS1","IfyLdin2bofXEZxZ7SucBtyMnFh","Kw7Pd0UNuo3QPyx8qgSc4Aqun4g","D221d7tC7ozGdrxRePscSuQKnxh","TjwfdBfrdoq7X0xRjPwcf4dynLd","XHeudH8UtovXNex1I2jcvWmintf","XlvrdjOw7oeyTax46HbcFJponfx","MFGJd32Xao6tfKxuSSucIukKnAe","Q4vrdiZdloveh0xw0B6cbpPqnJd","Ja7bdrmcgoiiGpxMgWEc1jxJnpd","SPtsd0QJTodWioxIDgQcDxVFnmc","NtszdKSKlo7cTcxX8EPcpPlZnYB","Zfx8diquaonwQexDArtclTnbn3d","QtOEdXQ1Yonrgyx3iowcGgqqnf9","XaWZdiu6RoU7lnxtK0XcqPU7nHg","FyyKd025toj6CDxNr8FcunS0nyW","SpJ8dFuc7oX4VnxXa5Hc7Bpsnzg","EaKrdqbQporNOtxhyVEcKxR7nrg","ScpEdg5ugoiOIuxTl4YcDU64n6b","OHpBdatpLo2RjvxX0LZcsBICnxb","Dva2dEL9JoTVuJxI02dcpUnTnSb","Tx7td9J8OoPWhTxOPlbcyfOdnbF","V0KidxgDroT4NqxA6cdcPY1bne6","GNOdd4DRKo6EIHxTyKFcljgYnxf","VAfRdHzCjog3wdxL20McGUyAnzg","O1t4dDEzwoC3apx1YVFc7lNvn4e","RDITdASuQoUl41xzNNTcnYz1nRh","DOrwd4aCGoFIoXxf43OcY4uYnKd","Q4kjdDS6Wont3xxFTG7ce3v2nhd","WLQTdk35CoyybNxhTQGcLIS5nQg","DZpedhwVIoLoooxNPvucYSWnnWh","Q6lndxKmAoCUxcxmYfncm8c4nvh","YS45d4R5eoinBDxdLACcKehAn5e","WVHbdVgf8oNA4cx5TCvc6MV7nyf","VBQqdSTIOoyoG6xgTcMcPwconbg","QcZGdiaqqozKtJxkEzOceDb6nRe","YkbMdAC4do7jl8xZvOkcwH2anPg","SmfAdEz9kozjOWxaXTJcyE5dnTc","N4mcde9TooBE5OxFm0pcHqsmn6e","Uj3idmka3o9jb5xBJIFcKij9nHh","NxamdZs46osqUlxjzbqcu58anCd","GJeud5xHroXxtlx5vFNcAZvMnnh","DIFAdPxAYo4leWxiR5RcHJEznuc","XmXQdbsZdopeYGx9KgSc81HgnCb","Ok0sdimYAoiGqfxGxI9cmJE0nQc","FWCpdnZWzoC00yxyi03cGbR4nYc","L1C5d0rhzoEcFkxvjiWcB3ydnOh","LCaZdvUyFoQ0DExvomjct0S3nU0","ElYHdLVaHoeJKwx3TdacN4Xfn1f","YBFhdSu9ro6uI5xGve6cJTXcnQd","X8GedUdr4o3SrMxsWgVcsDuxnag","KjnMdPL01o6YT5xVpaBcx9dcnYf","CZ7bdeZ3YobYvExKkhrczG8TnHe","DixRdCWkLoEzhWxDl9lcd65qnjd","MEC2dqAteos8AnxUudscpzQknae","L6UXdUl0XoX92fxsVOec4wrJn8f","IKtxdeVRCojMLexFsHbcDZOpnAb","LLrAdJ3MhodCckxuAh3ce0Szn9g","NvMfdN0EJoBBNHxHnBZcuoaJnyc","BAU9dzlYsoobolxf9sLcWo35n5c","HHO4dt0NxoUjtbxZ7dIcM3zyn0N","ANJTdfmoUojiwbxGqkucez6qnsb","JM8vd0DaBoj1GqxkySncagQInBc","MOgvdmmMMo2FZwxgeCTcwVarnbf","Po4ldswq5oC8hLx9RShcvFeqnKf","BLtPdWAssocR7mxLTyocXflknve","PuuOdKbvXoUXp8xRb7rc9v16ndw","MggYdOdSzoBBzqxOe1Hcoq0unOe","FBnfd56qioBgKBx0jEecmk1gnUc","HM3IdQVcwo0xCAxPUTmc6EmWnTd","HvzPdX1HpofkJVx13l3cIupOnoh","OBw9dRWnNodJTmxiK6ycWRrxnDN","PT2idC5R2o9WjAx8pk6ckR18njb","BWC2dSANdogB28xdQFQcQfBEnPd","QOMvdlCjSotR1dx3lRdczYKGn5d","VY9cdnUocoSCKFx5ZUbcvRGUnpf","NbVddtFrooEgvdxpO0zccVjanXc","LXjudPVRoopokNxfwOWcVBkynXd","AKQYdEyNAoL6pYx3w0AcNq2wnDb","Arujd3FOxoPA64xStRkc3FJYnke","AjhCdnwpUoUBv6xkchBc9dyunJw","OcrtdIopXoGBt4xXFRrcU4zjn9d","FCRgdxArKomdbFxEC7ycLmTCnQg","H1mKdISpOoXzqdxGmFncX7XMnGe","BpMDd2DlXoko2txRS0wcye91n1e","KlJmdDNhMoSYHrxufOocpOkznkb","Cvxhd9rFSog2Psxwz4Qcg3sSnJd","JjJDdEqyCoksS1xdl25cO6qSnQb","RusydbSsyo3yHAxyBTIcVyAFnQc","COsMd3eSVoFWilxgKPlcgrPOn6f","Z1XQdKCkCoxLorxQeVocjajVnpb","F131d4wl0oUmwoxYksOcJ65nnPf","RKMZdrxkLoCQ4kxkdqhc4QYRnsb","VtmGdwm93oZ3u7x6JqvcBld6nng","FbiBdhAyvo3toIxFk5Uc71YUnVd","RWHYdXOfEokndNxLSLXcgorsnnd","JuZsdi1PGo0FCVxVeuZcYvTgnVe","Fxo1dsZOco4ovsxigyHc9JLYnkb","Ve9sdWc1ooMRQwxo8iWcO5eFn7f","XR5DdwtXto7DPIx8AITcFoU3nfd","RJZmdZOV6ozPKFxghv6c4bEJnjh","Gs8JdG9NUo4Fuhx4wcvcPmeDnmh","AIUgdMaxSoas7Cx0yTrcsrIgnvf","Rtl8d8c2aoZNwDxblwucHW6XnBe","QCkvdiTlCoMzWDxFNEKcpKmgnib","Rof3dAjIHoLGE1xFoSmcdL3Ynih","AIrDdw2VMoaEetxx8J4c3hDenSg","ZKlgdE9fSoKyPsxkYVCcya3fnsf","RMSUduhu5oy8S6xeduHcEFKgnrh","OVyFdCSWCocf24xtzUCc8iCWnyh","NGUjdTIwsoPtQrxXbelcym59nZd","WcnVdLDdjoKVcyxhZEbcMTo0nqL","FK9vdmMEmoBHsKxgLJQcr2ALnAc","M3IedMPKXozWPHxVoT0cWRsOn3y","H1TLdXrBConSAHxZ8Pgc7W2NnYc","BYGPd8KtMoiorzxR6n3cNqvln8e","AniVd5Tp0o1bUuxQIurcjdFtntd","PEtYdrV3uokzeCx6CQUce7wEnlc","GTifdpqdhonL3qxRGZYcEsYindh","MLFHd26LwoDcfox8WEwcIRfUnK5","KU6Zd47J5o3ghlx0B81cf14Enqc","RoU7d3fIvo7eKfxQSygchW0NnOe","HrMhdT4LWoOO78xUoc1cnR2nn0b","EqS0dCfZPovsD1xbXXJcBjxHnzg","GVWSdYfiGoLDYvx5x1AcfVTgnAc","C1E0dRiPzoEgVdxkcGccWZkinlh","H8wNdXEiBod6JQxFNX0cmtcsn0b","Ig1wdDbIjofzGAxqcJ9cKsGYnSh","KfGNdCQrmoVadAxX1l8cnjMunTe","Ytasd7qXAoWiPRxMNoJc6PVbnXe","PV2VdTdhQo6CGVxB5zXcqADinOe","IUcJd7N8DotKwkxaaVxc6cRUn5e","Lf2wdzJkYoYHldxLTORcBCwQnqf","RK4mda0XRoRJ0MxN8wLcjITGn3e","Dds1dSazmoTpm2xl4fccIA6ZnJh","GFr9dqjSZoDCYcxIcJWcC55KnQf","C5eTdxaJIoTBrLxrlB6c5kPwnne","QHcEdjWjNoZCXCxmo3qcQkoanCb","LCB2d0CSDondbjx81oCc7cbHn7b","MfdqdAEDwoZugqxqgqYcDH3Un9b","AlV4dTYhcoytZFxIb8scSI53nJe","KBN4dkhkdojEZGxnEMxcdMl3nyc","YKNodSTTgokgRAxJ28JcJQQcn2b","OFhFd6PfcoEJI0x1gUPcCFjinrf","SVcfdGG2TotKvXxxZiEcgkfanF5","U0Abdn0VhognYUxZ2AicsFIqn4e","IA7Fd6p6JoVp7axQpK6czNJJnXb","KKp8duyQMoIfYDxVJiKcfFErnFh","EJ7RdyguEoOmTLxPkpacfUd0njf","UN42d2nJYoU7pZxQAYvcfjNsnsb","OFJJd8T1voISEuxNbslcBSHWnOc","KO55dFBICoTMApxLTZNc52vPncg","ICtldIoFtotnsZxwimYcz9NNn2e","Uv3ddoM6YoXpYAxFNZTcShiZn3c","M3b8dntE9o1bA4x85uicHKiznGe","QdpYdxVNdoviaSxZaY8c59EanJf","IaehdlGiForxsOxsBznc3Zy6nLg","UlbfdFaYGouZDTxcUsOcn09Pnb3","BXiPdHrgEo1DjkxS4ZacppxVnyc","LgOldK5ITov8M2xUZiUcCmH8njd","MqbSd4PzFoRMrTxeNRWcEGx9nvb","PmvNd2pdRoLeBSxIz0dcrQhqnbW","WjYld9mqco53gOxnEQWc2A65nLh","MuV3dZczOoSzimxGGZrcff68nLe","V8WkduVfVo1uslxqSb2csLJJn2b","Cec2dmukuoIHFrxbvqMcNOQVnaf","Pwt1dF9FUotBBYxcBhJcmvRgnb5","SrkAdRrtPoneo7xOE0UcjzCbnUh","BbqvdgNAloUsJvxqMsjcVmXknTg","VQGudvlwXoYekWx9BfqcyQJfnXe","OiWqdr1BJolceuxPbiMcuOUpnIg","De7Od32Wfo3mhZxedmeca3VvnJe","GFFkds3xeozYhvxRJgmckLW1nHh","H7V3d728ZoSi2ExJbtFcX25PnLd","LW2Ydf2LRosbrKxFBUQcEfYVnWd","UGvVdZbXLonL4UxiSTvcl78Qnvb","M1utd2MDNo7kgVxPXaGcGN1fnNd","Kp5zd8M5QoKIF0xwDhRcnCN0nG3"],"page":{"elements":[{"text_run":{"content":"空间模块","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1}},"parent_id":""},{"block_id":"TL6CdSvFLo1e92xaFxhcB6ZwnJh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"之前我们已经؜完成了公共图库的开发，为了进一步增加系统的应用价值，可以让每个用户都能创建自己的私有空间，打造自己的图片云盘、个人相册。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CPjZd4sRRoTqlIxrmL2ciLygn4g","block_type":3,"heading1":{"elements":[{"text_run":{"content":"需求分析","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"TBuqdGlr9obt2kxW7OVc8I8rnKe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"对于空间模块，通常要有这些功能：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JngbdkpCboKP1ZxZxtec7e6ZnEf","block_type":12,"bullet":{"elements":[{"text_run":{"content":"【管理员】管理空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"GlSnd5OHdoGHJrxzGRgcuMh2nGe","block_type":12,"bullet":{"elements":[{"text_run":{"content":"用户创建私有空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"L5O3dTqxYorFjnxwIVKczgIDnif","block_type":12,"bullet":{"elements":[{"text_run":{"content":"私有空间权限控制","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Ts6qd4Beeo5FErxk4Kac2jDenif","block_type":12,"bullet":{"elements":[{"text_run":{"content":"空间级别和限额控制","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Vgzfd26tyo7DpZx80AHcHgi3nke","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"看起来简单؜，但其实每个需求的细节都非常多，具体分析每个需求：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HB59d0b8roB5VcxMbJacUuvdnjc","block_type":13,"ordered":{"elements":[{"text_run":{"content":"管理空؜间：仅管理员可用，可以对整个系统中的空间进行管理，比如搜索空间、编辑空间、删除空间。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"V8ZZdr6WPo54Kdxy92hc0fnCnOf","block_type":13,"ordered":{"elements":[{"text_run":{"content":"用户创建私有空间：用户可以创建 最多一个 私有空间，并且在私有空间内自由上传和管理图片。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"QO57dTTrYoYD5rxY3TUcPj84nkd","block_type":13,"ordered":{"elements":[{"text_run":{"content":"私有空间؜权限控制：用户仅能访问和管理自己的私有空间和其中的图片，私有空间的图片不会展示在公共图库，也不需要管理员审核。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"NzghdiKhXonz29xJFFtclillnrh","block_type":13,"ordered":{"elements":[{"text_run":{"content":"空间级别؜和限额控制：每个空间有不同的级别（如普通版和专业版），对应了不同的容量和图片数量限制，如果超出限制则无法继续上传图片。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"F5zAdR4Gvo6UrBxarK9cDlDHnjb","block_type":3,"heading1":{"elements":[{"text_run":{"content":"方案设计","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YercdA9rrofTXIxkosScnFI7nrc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"从需求分析؜中，我们也能感受到，细节比较多，为了更好地把控这些细节，需要先对系统进行一个整体的方案设计。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YBo9dzsuAoU3ZqxZ1aycdbxinUg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"思考下面的问题：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Dj3gdwsewoadVCxFl1NcOAzUnKd","block_type":13,"ordered":{"elements":[{"text_run":{"content":"为什么要有 “空间” 的概念？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"WMaLdX6Avof1BbxU9WccnWCvnc7","block_type":13,"ordered":{"elements":[{"text_run":{"content":"如何对空间进行库表设计？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Dll9dIjBEo1uxtxRCYtcqKjNnsg","block_type":13,"ordered":{"elements":[{"text_run":{"content":"公共图库和空间的关系？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"FeYWdQzhFo8sF9xxsGscHCmqnle","block_type":5,"heading3":{"elements":[{"text_run":{"content":"空间的必要性","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"EGdXd519YoSIwfxuXBvcPQwVnbc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"如果没有 ؜“空间” 的概念，怎么实现让用户自由管理自己的私有图片呢？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EzfQdeHzeocijcxAZsfcaSuZnLe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"Q：这不就؜相当于 “查看我的图片” 功能嘛，直接支持用户查询自己创建过的图片不就可以了？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Cc6Dd3O8KoilPsxt8XCcJjkVnhf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"A：如果这样做，会存在一个很大的问题：用户私有图片是 需要隐私 的，不需要被管理员审核，也不能被其他人公开查看。这和现在的公共图库平台的逻辑不一致。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"UaTIdmPxQo1AYGxHnfTc9eqkn1g","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"想象一下，؜图片表中只有 userId 字段，无法区分图片到底是私有的还是公开的。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Z2TlddL77obG8pxOkO2cYtRsnNg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"Q：那如果؜允许用户上传私有图片呢？比如设置图片可见范围为 “仅自己可见”？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CbCrdV3r0oJ2HNx1pDac4gxmnec","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"A：这的确是可行的，对于内容占用存储空间不大的平台，很适合采用这种方案，像 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"代码小抄","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fwww.codecopy.cn%2F"},"strikethrough":false,"underline":false}}},{"text_run":{"content":" 就支持上传仅自己可见的代码。但是，对于图库平台，图片占用的存储空间会直接产生存储费用，因此需要对用户上传的图片大小和数量进行限制。类似于给你分配了一个电脑硬盘，它就是你的，用满了就不能再传图了。所以使用 “空间” 的概念会更符合这种应用场景，可以针对空间进行限制和分析，也更便于管理。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ma0EdA1pvopRmtxv4fHceNEgnjh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"此外，从项؜目可扩展性的角度来讲，抽象 “空间” 的概念还有 2 个优势：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VgHcdPnB0ovaQYxFYUic0JZsnbf","block_type":13,"ordered":{"elements":[{"text_run":{"content":"和之前的公共图库完全分开，尽量只额外增加空间相关的逻辑和代码，减少对代码的修改。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"RUktdsMcnoeItax2w0gcR3ednkb","block_type":13,"ordered":{"elements":[{"text_run":{"content":"以后我们要开发团队共享空间，需要对空间进行成员管理，也是需要 “空间” 概念的。所以目前设计的空间表，要能够兼容之后的共享空间，便于后续扩展。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"E5Cydt7saouXBHxiYQ8c4gWpnKe","block_type":5,"heading3":{"elements":[{"text_run":{"content":"空间库表设计","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"K7ypdeAKBopTVFxQK0vcQv4dnMg","block_type":6,"heading4":{"elements":[{"text_run":{"content":"空间表","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"MtAIdNU9xo37KwxRwGDcnr1VnUd","block_type":14,"code":{"elements":[{"text_run":{"content":"-- 空间表\ncreate table if not exists space\n(\n    id         bigint auto_increment comment 'id' primary key,\n    spaceName  varchar(128)                       null comment '空间名称',\n    spaceLevel int      default 0                 null comment '空间级别：0-普通版 1-专业版 2-旗舰版',\n    maxSize    bigint   default 0                 null comment '空间图片的最大总大小',\n    maxCount   bigint   default 0                 null comment '空间图片的最大数量',\n    totalSize  bigint   default 0                 null comment '当前空间下图片的总大小',\n    totalCount bigint   default 0                 null comment '当前空间下的图片数量',\n    userId     bigint                             not null comment '创建用户 id',\n    createTime datetime default CURRENT_TIMESTAMP not null comment '创建时间',\n    editTime   datetime default CURRENT_TIMESTAMP not null comment '编辑时间',\n    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',\n    isDelete   tinyint  default 0                 not null comment '是否删除',\n    -- 索引设计\n    index idx_userId (userId),        -- 提升基于用户的查询效率\n    index idx_spaceName (spaceName),  -- 提升基于空间名称的查询效率\n    index idx_spaceLevel (spaceLevel) -- 提升按空间级别查询的效率\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":") comment '空间' collate = utf8mb4_unicode_ci;","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":56,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"JmNQd0MhIo8Fa2xjvTccYIMUnAH","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"几个设计要点：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DgardHgrro3p9Sx3QOuc8Olun5d","block_type":13,"ordered":{"elements":[{"text_run":{"content":"空间级别字段：空间级别包括普通版、专业版和旗舰版，是可枚举的，因此使用整型来节约空间、提高查询效率。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"F4UpdQeK7oAQhmxPLMnc1GSwnFJ","block_type":13,"ordered":{"elements":[{"text_run":{"content":"空间限额字段：除了级别字段外，增加 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"maxSize","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 和 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"maxCount","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 字段用于限制空间的图片总大小与数量，而不是在代码中根据级别读取限额。这样管理员可以单独设置限额，不用完全和级别绑定，利于扩展；而且查询限额时也更方便。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"GefrdLRASoh6vkxfcWUcDNSonwh","block_type":13,"ordered":{"elements":[{"text_run":{"content":"索引设计：为高频查询的字段（如空间名称、空间级别、用户 id）添加索引，提高查询效率。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"VLu4deHKYooyeBxihsMcfYdynuh","block_type":6,"heading4":{"elements":[{"text_run":{"content":"图片表","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"LDtYdXPUDoYS6mxEJXmczMkZntd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"由于一张图片؜只能属于一个空间，可以在图片表 picture 中新增字段 spaceId，实现图片与空间的关联，同时增加索引以提高查询性能。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EcO8dRHxMoHb8hxWjDucfGQrn9d","block_type":14,"code":{"elements":[{"text_run":{"content":"-- 添加新列\nALTER TABLE picture\n    ADD COLUMN spaceId  bigint  null comment '空间 id（为空表示公共空间）';\n\n-- 创建索引\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"CREATE INDEX idx_spaceId ON picture (spaceId);","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":56,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"IRJGdLvfAoptOLxcbQwc843Xnch","block_type":5,"heading3":{"elements":[{"text_run":{"content":"公共图库和空间的关系","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"KWDRdHtOnoepJDx1zQPcVZZSnlh","block_type":34,"children":["Sazqd4Rn7oLOW3xVw9Lci50ZnYe"],"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","quote_container":{}},{"block_id":"Sazqd4Rn7oLOW3xVw9Lci50ZnYe","block_type":2,"parent_id":"KWDRdHtOnoepJDx1zQPcVZZSnlh","text":{"elements":[{"text_run":{"content":"Q：公共图库不就是系统管理员创建的一个空间么？既然有了空间表，要不要把公共图库也当做一个默认的空间来设计呢？或者在空间表创建一条公共图库的记录？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MycLdWwTYo95cExPHNlc3qnhnyh","block_type":34,"children":["D9kUdiyyBoItdpxOP4ecveMcnXg"],"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","quote_container":{}},{"block_id":"D9kUdiyyBoItdpxOP4ecveMcnXg","block_type":2,"parent_id":"MycLdWwTYo95cExPHNlc3qnhnyh","text":{"elements":[{"text_run":{"content":"此处为了确保公共图库与私有空间的独立性，必须进行单独的设计，并避免将两者混合。原因如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RdYSdcQZKojNdWxozrccgyienGd","block_type":34,"children":["K5gydiW89ojuVaxFTJrc8HBBnCe","MyRads6n3o7xP8xoVwlcaaMonHe"],"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","quote_container":{}},{"block_id":"K5gydiW89ojuVaxFTJrc8HBBnCe","block_type":13,"children":["E0J4dNUPAog3nOxq2otcbwDonSd","AuDidvw4JocsFqxyR9EcTynpnFh"],"ordered":{"elements":[{"text_run":{"content":"公共图库的访问权限与私有空间不同","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"RdYSdcQZKojNdWxozrccgyienGd"},{"block_id":"E0J4dNUPAog3nOxq2otcbwDonSd","block_type":12,"bullet":{"elements":[{"text_run":{"content":"公共图库中的图片无需登录就能查看，任何人都可以访问，不需要进行用户认证或成员管理。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"K5gydiW89ojuVaxFTJrc8HBBnCe"},{"block_id":"AuDidvw4JocsFqxyR9EcTynpnFh","block_type":12,"bullet":{"elements":[{"text_run":{"content":"私有空间则要求用户登录，且访问权限严格控制，通常只有空间管理员（或团队成员）才能查看或修改空间内容。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"K5gydiW89ojuVaxFTJrc8HBBnCe"},{"block_id":"MyRads6n3o7xP8xoVwlcaaMonHe","block_type":13,"ordered":{"elements":[{"text_run":{"content":"公共图库؜没有额度限制：私有空间会有图片大小、数量等方面的限制，从而管理用户的存储资源和空间配额；而公共图库完全不受这些限制。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"RdYSdcQZKojNdWxozrccgyienGd"},{"block_id":"LHwjdEJyooElTGxeqRvcb2V6nkh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"公共图库和私有空间在数据结构、؜图片存储、权限控制、额度管理等方面存在本质区别，如果混合设计，会增加系统的复杂度并影响维护与扩展性。举个例子：公共图库应该上传到对象存储的 public 目录，该目录里的文件可以公开访问；但私有图片应该上传到单独的 space 目录，该目录里的文件可以进一步设置访问权限。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HUq2dy4D6oSTHJx2wszc6Nw0nEc","block_type":3,"heading1":{"elements":[{"text_run":{"content":"后端开发","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"FkxudcnJXopzCIxcNYgcuVuqnRd","block_type":4,"heading2":{"elements":[{"text_run":{"content":"空间管理","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"H1gGdDNmDo9OJAxlKmMcCoX9nsg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"先开发空间样板代码CRUD等等","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"UgYEdhPZXoJOdKxSK0ecJMCHnSe","block_type":5,"heading3":{"elements":[{"text_run":{"content":"数据模型","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"B40cdEl7poeHyIxc8YwcrCcfnBh","block_type":13,"ordered":{"elements":[{"text_run":{"content":"使用MyBatis-Plus插件自动生成一个实体类，为了防爬虫，id随机；另外加上逻辑删除字段。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"VJS1dy2GmoLEzZxIg2ccWo00nsc","block_type":14,"code":{"elements":[{"text_run":{"content":"@TableName(value =\"space\")\n@Data\npublic class Space {\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * id","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"@TableId(type = IdType.","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"ASSIGN_ID","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":")\n    private Long id;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间名称","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private String spaceName;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间级别：0-普通版 1-专业版 2-旗舰版","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Integer spaceLevel;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间图片的最大总大小","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Long maxSize;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间图片的最大数量","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Long maxCount;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 当前空间下图片的总大小","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Long totalSize;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 当前空间下的图片数量","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Long totalCount;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 创建用户 id","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Long userId;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 创建时间","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Date createTime;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 编辑时间","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Date editTime;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 更新时间","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Date updateTime;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 是否删除","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"@TableLogic\n    private Integer isDelete;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间类型：0-私有 1-团队","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Integer spaceType;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":56,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"V3xedyOcjoU89ZxbLfBccEH1nGf","block_type":13,"ordered":{"elements":[{"text_run":{"content":"每个操作需要一个请求类，分别是空间创建、更新、编辑、查询（由于每个用户都有一个自己的空间，这里就不需要有删除空间的逻辑——删除空间有点逆天）","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"ZZ2fdXhL5oW4Yux9mwucg6Vnn2b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"空间创建","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"AjMpdaJ2YojlQUxC6qVcmr4cnWh","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data\npublic class SpaceAddRequest implements Serializable {\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间名称","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private String spaceName;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/**","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     * 空间级别：0-普通版 1-专业版 2-旗舰版","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"     */","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"private Integer spaceLevel;\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"    private static final long ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"serialVersionUID ","text_element_style":{"bold":false,"inline_code":false,"italic":true,"strikethrough":false,"underline":false}}},{"text_run":{"content":"= 1L;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"UhEZdj37LoQEL5xo9HWco60Hncc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"空间编辑请求，给用户用，方便用户更改空间名称","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"X9SldWBZRoaN9vxtI4ycuoygnlb","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data\npublic class SpaceEditRequest implements Serializable {\n\n    /**\n     * 空间 id\n     */\n    private Long id;\n\n    /**\n     * 空间名称\n     */\n    private String spaceName;\n\n    private static final long serialVersionUID = 1L;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"W4bSdN54uo56GqxqRWKcPophnme","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"空间更新请求，给管理员用，可以更改空间级别和限额","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"SvCZdms03otiaVxR1g3cmlE3nNH","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data\npublic class SpaceUpdateRequest implements Serializable {\n\n    /**\n     * id\n     */\n    private Long id;\n\n    /**\n     * 空间名称\n     */\n    private String spaceName;\n\n    /**\n     * 空间级别：0-普通版 1-专业版 2-旗舰版\n     */\n    private Integer spaceLevel;\n\n    /**\n     * 空间图片的最大总大小\n     */\n    private Long maxSize;\n\n    /**\n     * 空间图片的最大数量\n     */\n    private Long maxCount;\n\n    private static final long serialVersionUID = 1L;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"KcPZdfCXOo8Pkex1Cb1cy3NVnpd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"空间查询请求，这里给管理员用，因为每个用户都有自己的空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"SszvdNbXgowM0Dx2tfxc6zLMnQb","block_type":14,"code":{"elements":[{"text_run":{"content":"@EqualsAndHashCode(callSuper = true)\n@Data\npublic class SpaceQueryRequest extends PageRequest implements Serializable {\n\n    /**\n     * id\n     */\n    private Long id;\n\n    /**\n     * 用户 id\n     */\n    private Long userId;\n\n    /**\n     * 空间名称\n     */\n    private String spaceName;\n\n    /**\n     * 空间级别：0-普通版 1-专业版 2-旗舰版\n     */\n    private Integer spaceLevel;\n\n    private static final long serialVersionUID = 1L;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Zhb1dVai2ofZlMxzT6Tcnj6OnCu","block_type":13,"ordered":{"elements":[{"text_run":{"content":"在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"model.dto.vo","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 下新建空间的视图包装类，可以额外关联创建空间的用户信息。还可以编写 Space 实体类和该 VO 类的转换方法，便于后续快速传值。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"ItVxdRpOjoV0jFxGKkDcZa1KnGp","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data\npublic class SpaceVO implements Serializable {\n    /**\n     * id\n     */\n    private Long id;\n\n    /**\n     * 空间名称\n     */\n    private String spaceName;\n\n    /**\n     * 空间级别：0-普通版 1-专业版 2-旗舰版\n     */\n    private Integer spaceLevel;\n\n    /**\n     * 空间图片的最大总大小\n     */\n    private Long maxSize;\n\n    /**\n     * 空间图片的最大数量\n     */\n    private Long maxCount;\n\n    /**\n     * 当前空间下图片的总大小\n     */\n    private Long totalSize;\n\n    /**\n     * 当前空间下的图片数量\n     */\n    private Long totalCount;\n\n    /**\n     * 创建用户 id\n     */\n    private Long userId;\n\n    /**\n     * 创建时间\n     */\n    private Date createTime;\n\n    /**\n     * 编辑时间\n     */\n    private Date editTime;\n\n    /**\n     * 更新时间\n     */\n    private Date updateTime;\n\n    /**\n     * 创建用户信息\n     */\n    private UserVO user;\n\n    private static final long serialVersionUID = 1L;\n\n    /**\n     * 封装类转对象\n     *\n     * @param spaceVO\n     * @return\n     */\n    public static Space voToObj(SpaceVO spaceVO) {\n        if (spaceVO == null) {\n            return null;\n        }\n        Space space = new Space();\n        BeanUtils.copyProperties(spaceVO, space);\n        return space;\n    }\n\n    /**\n     * 对象转封装类\n     *\n     * @param space\n     * @return\n     */\n    public static SpaceVO objToVo(Space space) {\n        if (space == null) {\n            return null;\n        }\n        SpaceVO spaceVO = new SpaceVO();\n        BeanUtils.copyProperties(space, spaceVO);\n        return spaceVO;\n    }\n}\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":9,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Fw5EdUNHGo42XrxK8ficJVhEnWb","block_type":13,"ordered":{"elements":[{"text_run":{"content":"在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"model.enums","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 包下新建空间级别枚举，定义每个级别的空间对应的限额：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Q2KVdlYa2oo6Cdxxjihcxz6mnJc","block_type":14,"code":{"elements":[{"text_run":{"content":"@Getter\npublic enum SpaceLevelEnum {\n\n    COMMON(\"普通版\", 0, 100, 100L * 1024 * 1024),\n    PROFESSIONAL(\"专业版\", 1, 1000, 1000L * 1024 * 1024),\n    FLAGSHIP(\"旗舰版\", 2, 10000, 10000L * 1024 * 1024);\n\n    private final String text;\n\n    private final int value;\n\n    private final long maxCount;\n\n    private final long maxSize;\n\n\n    /**\n     * @param text 文本\n     * @param value 值\n     * @param maxSize 最大图片总大小\n     * @param maxCount 最大图片总数量\n     */\n    SpaceLevelEnum(String text, int value, long maxCount, long maxSize) {\n        this.text = text;\n        this.value = value;\n        this.maxCount = maxCount;\n        this.maxSize = maxSize;\n    }\n\n    /**\n     * 根据 value 获取枚举\n     */\n    public static SpaceLevelEnum getEnumByValue(Integer value) {\n        if (ObjUtil.isEmpty(value)) {\n            return null;\n        }\n        for (SpaceLevelEnum spaceLevelEnum : SpaceLevelEnum.values()) {\n            if (spaceLevelEnum.value == value) {\n                return spaceLevelEnum;\n            }\n        }\n        return null;\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"XB3wdP2juo10R0x8CyMcvCSmnve","block_type":5,"heading3":{"elements":[{"text_run":{"content":"基础服务开发","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"EkaddMdxvoELmzx059Kc6DObn1b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"可以参考图؜片服务的开发方法，完成 SpaceService 和实现类，大多数代码可以直接复用。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MLsLdMJg3oQsH9xpo3xcVpmdnIe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"由于创建空؜间的逻辑比较复杂，可以先定义个接口占坑。我们主要开发下列方法","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OYbZdHTBjor9FsxATVpcJ6finXe","block_type":13,"ordered":{"elements":[{"text_run":{"content":"需要开؜发校验空间数据的方法，增加 add 参数用来区分是创建数据时校验还是编辑时校验，判断条件是不一样的：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Kw5PdicObodMTVxzECSc5sLenMg","block_type":34,"children":["Q7wKdaUCDoN5XMxHiZocU8j3nph","MeMfdsd2FomVoPxfBdJcvuDVnqg","CEFzdT9fdovX7sxIgT7cNEzjngc"],"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","quote_container":{}},{"block_id":"Q7wKdaUCDoN5XMxHiZocU8j3nph","block_type":13,"ordered":{"elements":[{"text_run":{"content":"校验参数","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"Kw5PdicObodMTVxzECSc5sLenMg"},{"block_id":"MeMfdsd2FomVoPxfBdJcvuDVnqg","block_type":13,"ordered":{"elements":[{"text_run":{"content":"如果是创建,那么名称和级别不能为空","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"Kw5PdicObodMTVxzECSc5sLenMg"},{"block_id":"CEFzdT9fdovX7sxIgT7cNEzjngc","block_type":13,"ordered":{"elements":[{"text_run":{"content":"如果是编辑,则哦按段空间级别是否存在,再验证长度","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"Kw5PdicObodMTVxzECSc5sLenMg"},{"block_id":"DShjdNxsHoIWamxQreac5qKZnqb","block_type":14,"code":{"elements":[{"text_run":{"content":"@Override\npublic void validSpace(Space space, boolean add) {\n    ThrowUtils.throwIf(space == null, ErrorCode.PARAMS_ERROR);\n    // 从对象中取值\n    String spaceName = space.getSpaceName();\n    Integer spaceLevel = space.getSpaceLevel();\n    SpaceLevelEnum spaceLevelEnum = SpaceLevelEnum.getEnumByValue(spaceLevel);\n    // 要创建\n    if (add) {\n        if (StrUtil.isBlank(spaceName)) {\n            throw new BusinessException(ErrorCode.PARAMS_ERROR, \"空间名称不能为空\");\n        }\n        if (spaceLevel == null) {\n            throw new BusinessException(ErrorCode.PARAMS_ERROR, \"空间级别不能为空\");\n        }\n    }\n    // 修改数据时，如果要改空间级别\n    if (spaceLevel != null && spaceLevelEnum == null) {\n        throw new BusinessException(ErrorCode.PARAMS_ERROR, \"空间级别不存在\");\n    }\n    if (StrUtil.isNotBlank(spaceName) && spaceName.length() > 30) {\n        throw new BusinessException(ErrorCode.PARAMS_ERROR, \"空间名称过长\");\n    }\n}\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"NHyTdQMwEo2FWEx8aJacCdTXn6g","block_type":13,"ordered":{"elements":[{"text_run":{"content":"在创建؜或更新空间时，需要根据空间级别自动填充限额数据，可以在服务中编写方法便于复用：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"PqwbdaqTwo4lPgxyOEkcisPKn7g","block_type":14,"code":{"elements":[{"text_run":{"content":"@Override\npublic void fillSpaceBySpaceLevel(Space space) {\n    // 根据空间级别，自动填充限额\n    SpaceLevelEnum spaceLevelEnum = SpaceLevelEnum.getEnumByValue(space.getSpaceLevel());\n    if (spaceLevelEnum != null) {\n        long maxSize = spaceLevelEnum.getMaxSize();\n        if (space.getMaxSize() == null) {\n            space.setMaxSize(maxSize);\n        }\n        long maxCount = spaceLevelEnum.getMaxCount();\n        if (space.getMaxCount() == null) {\n            space.setMaxCount(maxCount);\n        }\n    }\n}\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"UVZsdJuppoAVIixfFdPcDRMknab","block_type":5,"heading3":{"elements":[{"text_run":{"content":"接口开发","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"DnmXd66jloX6rtxDYN7c2jaUnvd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"参考图片接؜口的开发方法，完成 SpaceController 类，大多数代码可以直接复用。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XQGmdqUHdoUAvSxeYfKc9SCvnkf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"需要重点关注接口的权限：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"IyasdipL0ocb2DxhwHUcotn4nvd","block_type":12,"bullet":{"elements":[{"text_run":{"content":"创建空间：所有用户都可以使用","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"DHeHdldwpo0QXTxHuUicGu2Anig","block_type":12,"bullet":{"elements":[{"text_run":{"content":"删除空间：仅允许空间创建人或管理员删除","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"TVdqd7QYfo4s3IxHt01cWKb6nde","block_type":12,"bullet":{"elements":[{"text_run":{"content":"更新空间：仅管理员可用，允许更新空间级别","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"OruEdcGaHo9HEFxVKt4coiR5n4c","block_type":12,"bullet":{"elements":[{"text_run":{"content":"编辑空间：允许空间创建人使用，但注意可编辑的字段（不能编辑空间级别）","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"DJV3dvELyojAmKxePOYc1kyPni2","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"开发更新接口时，需要调用填充空间限额数据的方法：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"TLixdeDREodvccxCacRckSRMn7e","block_type":14,"code":{"elements":[{"text_run":{"content":"@PostMapping(\"/update\")\n@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)\npublic BaseResponse<Boolean> updateSpace(@RequestBody SpaceUpdateRequest spaceUpdateRequest) {\n    if (spaceUpdateRequest == null || spaceUpdateRequest.getId() <= 0) {\n        throw new BusinessException(ErrorCode.PARAMS_ERROR);\n    }\n    // 将实体类和 DTO 进行转换\n    Space space = new Space();\n    BeanUtils.copyProperties(spaceUpdateRequest, space);\n    // 自动填充数据\n    spaceService.fillSpaceBySpaceLevel(space);\n    // 数据校验\n    spaceService.validSpace(space, false);\n    // 判断是否存在\n    long id = spaceUpdateRequest.getId();\n    Space oldSpace = spaceService.getById(id);\n    ThrowUtils.throwIf(oldSpace == null, ErrorCode.NOT_FOUND_ERROR);\n    // 操作数据库\n    boolean result = spaceService.updateById(space);\n    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);\n    return ResultUtils.success(true);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"XlfTdKL0YoYdvVxmT5ec0QManvd","block_type":4,"heading2":{"elements":[{"text_run":{"content":"用户创建私有空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"QbPEd3VHAojQVZx1nQvcPWKmnIh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"用户可以自主创建私有空间，但是必须要加限制，最多只能创建一个。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"M36IdjTA8oULO7xLYmecaCv5nQc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"需要开发创建空间服务，该服务较为复杂，我们要先整理下流程。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"IxAgd1xUzopQJOxO6k7cP7fznVb","block_type":5,"heading3":{"elements":[{"text_run":{"content":"创建空间流程","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"DcRgd3LqSo8wdlxKNxFcx4GznMd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"流程如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"COo2dBRf4o2Fa4xE5hBc59oOnL7","block_type":13,"ordered":{"elements":[{"text_run":{"content":"填充参数默认值","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"1"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"HJcddJ2mkonmFlx2OUqcjmfWnVf","block_type":13,"ordered":{"elements":[{"text_run":{"content":"校验参数","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"IWaMdSidVo9Lg5xn8v9ce3cAnrc","block_type":13,"ordered":{"elements":[{"text_run":{"content":"校验权限，非管理员只能创建普通级别的空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"EcFKdXYbmofJhxxkEu2cBKognDb","block_type":13,"ordered":{"elements":[{"text_run":{"content":"控制同一用户只能创建一个私有空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false,"sequence":"auto"}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"NEoodObYuoChgRxBufbc2QPSnSe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"如何保证同一用户只能创建一个私有空间呢？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VhUNdxvs6of1hcxSh9Kctkknnhh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"最粗暴的方式是给空间表的 userId 加上唯一索引，但由于后续用户还可以创建团队空间，这种方式不利于扩展。所以我们采用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"加锁 + 事务","text_element_style":{"bold":true,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"  的方式实现。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"QkWLdoz95oZFz1xnS53cf8sunQb","block_type":5,"heading3":{"elements":[{"text_run":{"content":"创建空间服务","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"F3eNd4ydCogVCRxM5Bbcm7Kbn2f","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"按照上述流程编写代码：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WKDUdveA6ofk38xRcvPcPsSlnOf","block_type":14,"code":{"elements":[{"text_run":{"content":"@Resourceprivate TransactionTemplate transactionTemplate;\n\n@Overridepublic long addSpace(SpaceAddRequest spaceAddRequest, User loginUser) {\n    // 在此处将实体类和 DTO 进行转换Space space = new Space();\n    BeanUtils.copyProperties(spaceAddRequest, space);\n    // 默认值if (StrUtil.isBlank(spaceAddRequest.getSpaceName())) {\n        space.setSpaceName(\"默认空间\");\n    }\n    if (spaceAddRequest.getSpaceLevel() == null) {\n        space.setSpaceLevel(SpaceLevelEnum.COMMON.getValue());\n    }\n    // 填充数据this.fillSpaceBySpaceLevel(space);\n    // 数据校验this.validSpace(space, true);\n    Long userId = loginUser.getId();\n    space.setUserId(userId);\n    // 权限校验if (SpaceLevelEnum.COMMON.getValue() != spaceAddRequest.getSpaceLevel() && !userService.isAdmin(loginUser)) {\n        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, \"无权限创建指定级别的空间\");\n    }\n    // 针对用户进行加锁String lock = String.valueOf(userId).intern();\n    synchronized (lock) {\n        Long newSpaceId = transactionTemplate.execute(status -> {\n            boolean exists = this.lambdaQuery().eq(Space::getUserId, userId).exists();\n            ThrowUtils.throwIf(exists, ErrorCode.OPERATION_ERROR, \"每个用户仅能有一个私有空间\");\n            // 写入数据库boolean result = this.save(space);\n            ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);\n            // 返回新写入的数据 idreturn space.getId();\n        });\n        // 返回结果是包装类，可以做一些处理return Optional.ofNullable(newSpaceId).orElse(-1L);\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Zl0pd1jxZoCq4vxRq0CcXgvknTd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"注意，上述代码中，我们使用本地 synchronized 锁对 userId 进行加锁，这样不同的用户可以拿到不同的锁，对性能的影响较低。在加锁的代码中，我们使用 Spring 的 编程式事务管理器 transactionTemplate 封装跟数据库有关的查询和插入操作，而不是使用 @Transactional 注解来控制事务，这样可以保证事务的提交在加锁的范围内。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"L5EDdBk4Joheuvx4xhOc5Cz7nrh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"💡 只要؜涉及到事务操作，建议大家测试时自己 new 个运行时异常来验证是否会回滚。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ek9Od4vVqoiH63xPpFJcQsXGn2m","block_type":5,"heading3":{"elements":[{"text_run":{"content":"扩展知识 - 本地锁优化","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YMnadW5UpoCP5cxPhktcAYM7nSd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"上述代码中，我们是对字符串常量池（intern）进行加锁的，数据并不会及时释放。如果还要使用本地锁，可以按需选用另一种方式 —— 采用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"ConcurrentHashMap","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 来存储锁对象。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BnPldfmGXo7sfUxlMJAcGEQSnLf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"示例代码如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HdTgdtdchoTQkkxPDyjc6ssVnf1","block_type":14,"code":{"elements":[{"text_run":{"content":"Map<Long, Object> lockMap = new ConcurrentHashMap<>();\n\npublic long addSpace(SpaceAddRequest spaceAddRequest, User user) {\n    Long userId = user.getId();\n    Object lock = lockMap.computeIfAbsent(userId, key -> new Object());\n    synchronized (lock) {\n        try {\n            // 数据库操作\n        } finally {\n            // 防止内存泄漏\n            lockMap.remove(userId);\n        }\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Jr3bdVwvAozIDcxIEk1cUSSpnGb","block_type":5,"heading3":{"elements":[{"text_run":{"content":"扩展","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"P8l6ddqJsoIXWVx4c22ccCTnnyc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）用户注؜册成功时，可以自动创建空间。即使创建失败了，也可以手动创建作为兜底。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"F9lMdNuUloa5hWxzQM1cm1cjnld","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）管理员可以为某个用户创建空间（目前没啥必要）","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XS9DdXhF1oXdrXxfXxIcqmqunBe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）本地锁改为分布式锁，可以基于 Redisson 实现。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YJVFdGVcOoK82AxIS2ocpUqGnfg","block_type":4,"heading2":{"elements":[{"text_run":{"content":"私有空间权限控制","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"VS6ud0zaSoQ72vxOXx6cUr8jn7f","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"私有空间的权限和公共图库是不同的，我们需要对之前 所有的图片操作 都添加和空间有关的权限校验逻辑。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BJb4djHBuootGvxOgj8cV89znWh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"图片表新增字段","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"BvAVdGUAXoOfu9xeE5Yc6l6On5d","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"图片表增加؜ spaceId 字段，默认为 null 表示公共图库。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WaEYdvdNgoH6IYxUsIicpmlSnpf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"同步修改 PictureMapper.xml、Picture 实体类、PictureVO 响应视图，补充空间 id 字段：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WxTEdxUQUoSKecxHHZQcazQpncd","block_type":14,"code":{"elements":[{"text_run":{"content":"/**\n * 空间 id\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" */private Long spaceId;","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"QrDBd54U2o6577xX5QTcMIXcnKc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"下面我们依次给 “增删改查” 图片操作增加权限校验逻辑。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LGXbdkdsUo4WPdxnak5caAnPnub","block_type":5,"heading3":{"elements":[{"text_run":{"content":"上传和更新图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Yd59d3TGPoiHX7xMo7Gc3fUrnvf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）上传图؜片时支持指定空间 id，表示要将图片上传到哪个空间。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ijl4dkXYZo5HqZxHehxcfMXAnaf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"给 Pic؜tureUploadRequest 请求封装类补充 spaceId 字段。OTsSx2bzs2C13D2pB4s4on5rzOarAwg0YtGpfccE/pk=","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CnmWddvwwoLI69xkR6FcRRLKn4T","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）修改上传؜图片方法 uploadPicture，校验空间是否存在；如果存在，还要校验是否有空间权限，仅空间的管理员才能上传。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"IlVYdqN8XoFTIOxdCp2c0jcdn4f","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"现阶段空间的管理员就是空间的创建人","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ch4Bd2Vnlom104xE7aIcwDlYnQe","block_type":14,"code":{"elements":[{"text_run":{"content":"ThrowUtils.throwIf(loginUser == null, ErrorCode.NO_AUTH_ERROR);\n// 校验空间是否存在Long spaceId = pictureUploadRequest.getSpaceId();\nif (spaceId != null) {\n    Space space = spaceService.getById(spaceId);\n    ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, \"空间不存在\");\n    // 必须空间创建人（管理员）才能上传if (!loginUser.getId().equals(space.getUserId())) {\n        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, \"没有空间权限\");\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"HkOddzAhAo8tOoxxlxncikHGnBb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）如果是更新图؜片，需要校验更新时传递的 spaceId 和已有图片的 spaceId 是否一致。如果更新时未传递 spaceId，则复用原有图片的 spaceId。代码如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CllpdHk8aoqRvWxox8hcpXXRnje","block_type":14,"code":{"elements":[{"text_run":{"content":"// 如果是更新图片，需要校验图片是否存在if (pictureId != null) {\n    Picture oldPicture = this.getById(pictureId);\n    ThrowUtils.throwIf(oldPicture == null, ErrorCode.NOT_FOUND_ERROR, \"图片不存在\");\n    // 仅本人或管理员可编辑if (!oldPicture.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {\n        throw new BusinessException(ErrorCode.NO_AUTH_ERROR);\n    }\n    // 校验空间是否一致// 没传 spaceId，则复用原有图片的 spaceIdif (spaceId == null) {\n        if (oldPicture.getSpaceId() != null) {\n            spaceId = oldPicture.getSpaceId();\n        }\n    } else {\n        // 传了 spaceId，必须和原有图片一致if (ObjUtil.notEqual(spaceId, oldPicture.getSpaceId())) {\n            throw new BusinessException(ErrorCode.PARAMS_ERROR, \"空间 id 不一致\");\n        }\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"TViZdF5KYomVWNxkWERcWQC7npb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）之前是؜按用户划分图片上传目录的，现在如果有 spaceId，可以按照空间来划分图片上传目录。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VHrjdol6poh8vMxuVgZckS3VnCc","block_type":14,"code":{"elements":[{"text_run":{"content":"// 按照用户 id 划分目录 => 按照空间划分目录\nString uploadPathPrefix;\nif (spaceId == null) {\n    uploadPathPrefix = String.format(\"public/%s\", loginUser.getId());\n} else {\n    uploadPathPrefix = String.format(\"space/%s\", spaceId);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Izq0dN8g4ot8IPxPlSectkNYnch","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"5）插入 ؜/ 更新数据时，将 spaceId 设置到 Picture 对象中：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"NqkRd2w7hok1LtxYwtdcbk0ensR","block_type":14,"code":{"elements":[{"text_run":{"content":"// 构造要入库的图片信息Picture picture = new Picture();\n// 补充设置 spaceId\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"picture.setSpaceId(spaceId);","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YepDdrMKjoxAvyxSG3WcFD62nUh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"删除图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"GTs9dasR8osSM6xAIIfcMHjLnqb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"如果要删除的图؜片有空间 id，表示是用户上传到私有空间中的图片，那么登录用户必须是空间的管理员（也就是创建者），系统管理员也不能随意删除私有空间的图片。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VHBOdqWhLoeII7xXctrczSa3nge","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）因为删؜除图片和编辑图片的权限控制是一样的（有删除权限就有编辑权限）﻿，可以将这段权限校验逻辑封装为一个方法：OTsSx2bzs2C13D2pB4s4on5rzOarAwg0YtGpfccE/pk=","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JRGGdK4prokQHhxQ3A0cjifWnyb","block_type":14,"code":{"elements":[{"text_run":{"content":"@Overridepublic void checkPictureAuth(User loginUser, Picture picture) {\n    Long spaceId = picture.getSpaceId();\n    if (spaceId == null) {\n        // 公共图库，仅本人或管理员可操作if (!picture.getUserId().equals(loginUser.getId()) && !userService.isAdmin(loginUser)) {\n            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);\n        }\n    } else {\n        // 私有空间，仅空间管理员可操作if (!picture.getUserId().equals(loginUser.getId())) {\n            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);\n        }\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YbRFdqJG5otquDxsbpVchhIHnje","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）原本删除图片 d؜eletePicture 逻辑很简单，直接写到了 Controller 中，现在有了更多逻辑，建议封装为 service，并同步修改 Controller 来调用 Service。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KvBrdaUsboDxLoxbVcDc0JdynLb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"删除图片方法代码如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XwxrdsWFQoBAcixaOaRcuNpnn4P","block_type":14,"code":{"elements":[{"text_run":{"content":"@Overridepublic void deletePicture(long pictureId, User loginUser) {\n    ThrowUtils.throwIf(pictureId <= 0, ErrorCode.PARAMS_ERROR);\n    ThrowUtils.throwIf(loginUser == null, ErrorCode.NO_AUTH_ERROR);\n    // 判断是否存在Picture oldPicture = this.getById(pictureId);\n    ThrowUtils.throwIf(oldPicture == null, ErrorCode.NOT_FOUND_ERROR);\n    // 校验权限\n    checkPictureAuth(loginUser, oldPicture);\n    // 操作数据库boolean result = this.removeById(pictureId);\n    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);\n    // 异步清理文件this.clearPictureFile(oldPicture);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"CcqEdUdAVo9cvAxRXolcOwpEn6f","block_type":5,"heading3":{"elements":[{"text_run":{"content":"编辑图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"KLKYdFrYhodJTGxKl89crysan6c","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"跟删除图片的权限校؜验逻辑一样，如果要编辑的图片有空间 id，表示是用户上传到私有空间中的图片，那么登录用户必须是空间的管理员（也就是创建者），系统管理员也不能随意编辑私有空间的图片。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HB3hdSfyaolOADxDznxcDJt1nog","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"将 edit؜Picture 方法抽象到 Service 中，并同步修改 Controller 来调用 Service。代码如下：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HZPvd5mj4owonwxzjhGc75P3nsG","block_type":14,"code":{"elements":[{"text_run":{"content":"@Overridepublic void editPicture(PictureEditRequest pictureEditRequest, User loginUser) {\n    // 在此处将实体类和 DTO 进行转换Picture picture = new Picture();\n    BeanUtils.copyProperties(pictureEditRequest, picture);\n    // 注意将 list 转为 string\n    picture.setTags(JSONUtil.toJsonStr(pictureEditRequest.getTags()));\n    // 设置编辑时间\n    picture.setEditTime(new Date());\n    // 数据校验this.validPicture(picture);\n    // 判断是否存在long id = pictureEditRequest.getId();\n    Picture oldPicture = this.getById(id);\n    ThrowUtils.throwIf(oldPicture == null, ErrorCode.NOT_FOUND_ERROR);\n    // 校验权限\n    checkPictureAuth(loginUser, oldPicture);\n    // 补充审核参数this.fillReviewParams(picture, loginUser);\n    // 操作数据库boolean result = this.updateById(picture);\n    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"UDqXdbEXsokAX2xLId5cFSxrndd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"由于更新图片是给管理员使用的接口，可以暂时不修改。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MCZGdBpk1oL5f6xBsIxc4MNanyh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"查询图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"LE6edXgm9o2Al6xSYqUcekzenLf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"用户无法查؜询到私有空间的图片，只能查询公共图库，单条查询和分页查询都要添加这个逻辑。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"FqYBd5VUroJVY0xY2wmcb08Bnrc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）根据 id 查询接口 getPictureVOByIdea","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"K2Pbd6nluoBummxgQzEcJ69Xn1u","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"如果查询出؜的图片有 spaceId，则运用跟删除图片一样的校验逻辑，仅空间管理员可以查看：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"I9SwdEl4coD62Cx5iRYcW1Q9npa","block_type":14,"code":{"elements":[{"text_run":{"content":"// 查询数据库Picture picture = pictureService.getById(id);\nThrowUtils.throwIf(picture == null, ErrorCode.NOT_FOUND_ERROR);\n// 空间权限校验Long spaceId = picture.getSpaceId();\nif (spaceId != null) {\n    User loginUser = userService.getLoginUser(request);\n    pictureService.checkPictureAuth(loginUser, picture);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"I891dYf8to1EO9xN1LmcZQskndf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）分页查询؜接口 listPictureVOByPage           ﻿           ‍          ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"W0CSdBkbooqNuxxxzFrcTiGHnTf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"查询请求增加 spa؜ceId 参数，不传则表示查公共图库；传参则表示查询特定空间 id 下的图片，此时登录用户必须是空间的管理员（其他用户无法查看别人空间的图片），并且不需要指定审核条件（私有空间没有审核机制）。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KY17d8UHXoR7YrxPAUwcka0gnig","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"先给请求封؜装类 PictureQueryRequest 和 QueryWrapper 补充空间 id 的查询条件。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"TOgrdroXEodew9x53stcpfoAnrg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"PictureQueryRequest 新增代码：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"B1FZdKSC8oWjcPxqrXZcC24dnLg","block_type":14,"code":{"elements":[{"text_run":{"content":"/**\n * 空间 id\n */private Long spaceId;\n\n/**\n * 是否只查询 spaceId 为 null 的数据\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" */private boolean nullSpaceId;","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Fng0dlPwEoMRhfxxAqGc9tbFnuT","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"QueryWrapper 新增代码：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XANxdvJhIoup6WxFCnScE5TFn7b","block_type":14,"code":{"elements":[{"text_run":{"content":"queryWrapper.eq(ObjUtil.isNotEmpty(spaceId), \"spaceId\", spaceId);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"queryWrapper.isNull(nullSpaceId, \"spaceId\");","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Dh48dtF2RoCQGLxtwsOc0sOznKd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"然后给接口؜增加权限校验，针对公开图库和私有空间设置不同的查询条件：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"FJpfdSkAtoxl3Xx8YTzcSGmUnic","block_type":14,"code":{"elements":[{"text_run":{"content":"// 空间权限校验Long spaceId = pictureQueryRequest.getSpaceId();\n// 公开图库if (spaceId == null) {\n    // 普通用户默认只能查看已过审的公开数据\n    pictureQueryRequest.setReviewStatus(PictureReviewStatusEnum.PASS.getValue());\n    pictureQueryRequest.setNullSpaceId(true);\n} else {\n    // 私有空间User loginUser = userService.getLoginUser(request);\n    Space space = spaceService.getById(spaceId);\n    ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, \"空间不存在\");\n    if (!loginUser.getId().equals(space.getUserId())) {\n        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, \"没有空间权限\");\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"GrU7dEbq0oCKbWxhiEEcX8Tkngb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"考虑到私有空间؜的图片更新频率不好把握，之前编写的缓存分页查询图片接口可以暂不使用和修改，可以将该接口标记为 @Deprecated 表示已废弃。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"TfL6dR5jYofFoUxbC99cQ0yJnVh","block_type":4,"heading2":{"elements":[{"text_run":{"content":"空间级别和限额控制","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Lh15dSzjno1H9jxValGchmGuned","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"需求：每次؜上传图片前，都要校验空间剩余额度是否足够；每次上传和删除图片时，都要更新已使用的额度。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"G1CsdrSvHoxzkWxMTDjct1B9nNM","block_type":5,"heading3":{"elements":[{"text_run":{"content":"上传图片时校验和更新额度","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"H3Zidua70oSEA4xQnKmcEcmHnWb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"我们发现，目前上؜传图片的代码已经比较复杂了，如果想要再增加非常严格精确的校验逻辑，需要在上传图片到对象存储前自己解析文件的大小、再计算是否超额，可能还要加锁，想想都头疼！","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VWDAdS7P0o5BTuxh9qZc2LhpnMf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"这时你会怎么做呢？","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LdredS4PdoDmEtxAaTncZPUGnSd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"当技术实现比较复杂时，我们不妨思考一下能否对业务进行优化。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"PzZzdVcZ0o01TMxmyRYcNx1Cnud","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"比如：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"INOXdTiJUohBG2xz7atcYBVunmk","block_type":12,"bullet":{"elements":[{"text_run":{"content":"单张图片最大才 2M，那么即使空间满了再允许上传一张图片，影响也不大","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"L3WrdnlovoqXTaxbdKQcbFDynV7","block_type":12,"bullet":{"elements":[{"text_run":{"content":"即使有用户在超额前的瞬间大量上传图片，对系统的影响也并不大。后续可以通过限流 + 定时任务检测空间等策略，尽早发现这些特殊情况再进行定制处理。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Rj9ldMI15oT8eUxsF3Zc2Q9pnug","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"这样一来，就利用业务设计巧妙节约了开发成本。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DHcfdHlcqorxvmx7q3icolMFn7f","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）修改 ؜uploadPicture 方法，编写校验代码，只需要增加 2 个判断条件：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RxcEdZgqRoKSaTxO1jFcz6n7nod","block_type":14,"code":{"elements":[{"text_run":{"content":"// 空间权限校验Long spaceId = pictureUploadRequest.getSpaceId();\nif (spaceId != null) {\n    Space space = spaceService.getById(spaceId);\n    ThrowUtils.throwIf(space == null, ErrorCode.NOT_FOUND_ERROR, \"空间不存在\");\n    // 必须空间创建人（管理员）才能上传if (!loginUser.getId().equals(space.getUserId())) {\n        throw new BusinessException(ErrorCode.NO_AUTH_ERROR, \"没有空间权限\");\n    }\n    // 校验额度if (space.getTotalCount() >= space.getMaxCount()) {\n        throw new BusinessException(ErrorCode.OPERATION_ERROR, \"空间条数不足\");\n    }\n    if (space.getTotalSize() >= space.getMaxSize()) {\n        throw new BusinessException(ErrorCode.OPERATION_ERROR, \"空间大小不足\");\n    }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"KSE4dt54Vo9o1tx0eeecYCNPndg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）保存图؜片记录时，需要使用事务更新额度，如果额度更新失败，也不用将图片记录保存。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BRlYdd8OLoyt8rxdccJcqcGlnjg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"依然是使用؜ transactionTemplate 事务管理器，将所有数据库操作到一起即可：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YfmsdV6odo6nSzxmR50cK8dWn7c","block_type":14,"code":{"elements":[{"text_run":{"content":"// 开启事务Long finalSpaceId = spaceId;\ntransactionTemplate.execute(status -> {\n    boolean result = this.saveOrUpdate(picture);\n    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR, \"图片上传失败\");\n    if (finalSpaceId != null) {\n        boolean update = spaceService.lambdaUpdate()\n                .eq(Space::getId, finalSpaceId)\n                .setSql(\"totalSize = totalSize + \" + picture.getPicSize())\n                .setSql(\"totalCount = totalCount + 1\")\n                .update();\n        ThrowUtils.throwIf(!update, ErrorCode.OPERATION_ERROR, \"额度更新失败\");\n    }\n    return picture;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"});","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"P9DFdivHHo7DcUx15ULce7Man2g","block_type":5,"heading3":{"elements":[{"text_run":{"content":"删除图片后更新额度","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"K7Pnd9tM1o8BRpxsHALcGhLNnhg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"删除图片时，要释؜放额度。同样使用 transactionTemplate 事务管理器，将删除图片和更新额度的数据库操作视为一个整体，避免删除图片后没释放额度的情况。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Syl1dJgmfo3ZcZxsFZlcSj8in1d","block_type":14,"code":{"elements":[{"text_run":{"content":"// 校验权限\ncheckPictureAuth(loginUser, oldPicture);\n// 开启事务\ntransactionTemplate.execute(status -> {\n    // 操作数据库boolean result = this.removeById(pictureId);\n    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);\n    // 释放额度Long spaceId = oldPicture.getSpaceId();\n    if (spaceId != null) {\n        boolean update = spaceService.lambdaUpdate()\n                .eq(Space::getId, spaceId)\n                .setSql(\"totalSize = totalSize - \" + oldPicture.getPicSize())\n                .setSql(\"totalCount = totalCount - 1\")\n                .update();\n        ThrowUtils.throwIf(!update, ErrorCode.OPERATION_ERROR, \"额度更新失败\");\n    }\n    return true;\n});\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"// 异步清理文件this.clearPictureFile(oldPicture);","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"T2lQdL5HFovMIgxuonVc02gqnS1","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"注意，这里有可能出؜现对象存储上的图片文件实际没被清理的情况。但是对于用户来说，不应该感受到 “删了图片空间却没有增加”，所以没有将这一步添加到事务中。可以通过定时任务检测作为补偿措施。R7zfQ2yjmCwaGmgYTa9cW+7DK0YPbs0kpW2reaJf93o=","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"IfyLdin2bofXEZxZ7SucBtyMnFh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"查询空间级别列表","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Kw7Pd0UNuo3QPyx8qgSc4Aqun4g","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"最后，我们؜再编写一个接口，用于给前端展示所有的空间级别信息。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"D221d7tC7ozGdrxRePscSuQKnxh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）新建 SpaceLevel 封装类：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"TjwfdBfrdoq7X0xRjPwcf4dynLd","block_type":14,"code":{"elements":[{"text_run":{"content":"@Data@AllArgsConstructorpublic class SpaceLevel {\n\n    private int value;\n\n    private String text;\n\n    private long maxCount;\n\n    private long maxSize;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"XHeudH8UtovXNex1I2jcvWmintf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）在 S؜paceController 中编写接口，将枚举转换为空间级别对象列表：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"XlvrdjOw7oeyTax46HbcFJponfx","block_type":14,"code":{"elements":[{"text_run":{"content":"@GetMapping(\"/list/level\")public BaseResponse<List<SpaceLevel>> listSpaceLevel() {\n    List<SpaceLevel> spaceLevelList = Arrays.stream(SpaceLevelEnum.values()) // 获取所有枚举\n            .map(spaceLevelEnum -> new SpaceLevel(\n                    spaceLevelEnum.getValue(),\n                    spaceLevelEnum.getText(),\n                    spaceLevelEnum.getMaxCount(),\n                    spaceLevelEnum.getMaxSize()))\n            .collect(Collectors.toList());\n    return ResultUtils.success(spaceLevelList);\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":29,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"MFGJd32Xao6tfKxuSSucIukKnAe","block_type":4,"heading2":{"elements":[{"text_run":{"content":"扩展","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Q4vrdiZdloveh0xw0B6cbpPqnJd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）删除空间时，关联删除空间内的图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ja7bdrmcgoiiGpxMgWEc1jxJnpd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）管理员创建؜空间：管理员可以为指定用户创建空间。可以在创建空间时多传一个 userId 参数，但是要注意做好权限控制，仅管理员可以为别人创建空间。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"SPtsd0QJTodWioxIDgQcDxVFnmc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）目前更新上传؜图片的逻辑还是存在一些问题的。比如更新图片时，并没有删除原有图片、也没有减少原有图片占用的空间和额度，可以通过事务中补充逻辑或者通过定时任务扫描删除。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"NtszdKSKlo7cTcxX8EPcpPlZnYB","block_type":22,"divider":{},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Zfx8diquaonwQexDArtclTnbn3d","block_type":3,"heading1":{"elements":[{"text_run":{"content":"前端开发","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"QtOEdXQ1Yonrgyx3iowcGgqqnf9","block_type":4,"heading2":{"elements":[{"text_run":{"content":"空间管理页面","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"XaWZdiu6RoU7lnxtK0XcqPU7nHg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"首先从最好؜开发的管理页面做起，流程和其他的管理页面完全一致。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"FyyKd025toj6CDxNr8FcunS0nyW","block_type":5,"heading3":{"elements":[{"text_run":{"content":"新建路由和菜单","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"SpJ8dFuc7oX4VnxXa5Hc7Bpsnzg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"首先新建 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"admin/SpaceManagePage.vue","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 页面文件，在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"router/index.ts","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 中定义路由：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EaKrdqbQporNOtxhyVEcKxR7nrg","block_type":14,"code":{"elements":[{"text_run":{"content":"{\n  path: '/admin/spaceManage',\n  name: '空间管理',\n  component: SpaceManagePage,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"},","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"ScpEdg5ugoiOIuxTl4YcDU64n6b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"在 GlobalHeader 组件中补充菜单：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OHpBdatpLo2RjvxX0LZcsBICnxb","block_type":14,"code":{"elements":[{"text_run":{"content":"{\n  key: '/admin/spaceManage',\n  label: '空间管理',\n  title: '空间管理',\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"},","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Dva2dEL9JoTVuJxI02dcpUnTnSb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"由于之前已经؜编写了权限校验逻辑，地址以 /admin 开头的页面都会限制为仅管理员可见和可用，所以无需再编写额外的权限校验代码。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Tx7td9J8OoPWhTxOPlbcyfOdnbF","block_type":5,"heading3":{"elements":[{"text_run":{"content":"定义空间常量","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"V0KidxgDroT4NqxA6cdcPY1bne6","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"和后端一样؜，前端也有很多地方要用到空间级别信息，可以定义为一个常量。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"GNOdd4DRKo6EIHxTyKFcljgYnxf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"constants","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 目录下新建 space.ts 常量文件，定义枚举信息、对应的中文映射、以及后续筛选空间级别时要用到的选项数组：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VAfRdHzCjog3wdxL20McGUyAnzg","block_type":14,"code":{"elements":[{"text_run":{"content":"// 空间级别枚举export const SPACE_LEVEL_ENUM = {\n  COMMON: 0,\n  PROFESSIONAL: 1,\n  FLAGSHIP: 2,\n} as const;\n\n// 空间级别文本映射export const SPACE_LEVEL_MAP: Record<number, string> = {\n  0: '普通版',\n  1: '专业版',\n  2: '旗舰版',\n};\n\n// 空间级别选项映射export const SPACE_LEVEL_OPTIONS = Object.keys(SPACE_LEVEL_MAP).map((key) => {\n  const value = Number(key); // Convert string key to numberreturn {\n    label: SPACE_LEVEL_MAP[value],\n    value,\n  };\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"});","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"O1t4dDEzwoC3apx1YVFc7lNvn4e","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"💡 这种代码完全可以利用 AI 生成。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RDITdASuQoUl41xzNNTcnYz1nRh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"开发管理页面","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"DOrwd4aCGoFIoXxf43OcY4uYnKd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"跟用户管理؜页面类似，页面的上方是搜索栏，下方是表格，表格需要支持分页。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Q4kjdDS6Wont3xxFTG7ce3v2nhd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"大多数的内؜容可以直接复用其他管理页面的代码，可以先复制过来，再进行修改。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WLQTdk35CoyybNxhTQGcLIS5nQg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）给表格定义展示的列：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DZpedhwVIoLoooxNPvucYSWnnWh","block_type":14,"code":{"elements":[{"text_run":{"content":"const columns = [\n  {\n    title: 'id',\n    dataIndex: 'id',\n    width: 80,\n  },\n  {\n    title: '空间名称',\n    dataIndex: 'spaceName',\n  },\n  {\n    title: '空间级别',\n    dataIndex: 'spaceLevel',\n  },\n  {\n    title: '使用情况',\n    dataIndex: 'spaceUseInfo',\n  },\n  {\n    title: '用户 id',\n    dataIndex: 'userId',\n    width: 80,\n  },\n  {\n    title: '创建时间',\n    dataIndex: 'createTime',\n  },\n  {\n    title: '编辑时间',\n    dataIndex: 'editTime',\n  },\n  {\n    title: '操作',\n    key: 'action',\n  },\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"]","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Q6lndxKmAoCUxcxmYfncm8c4nvh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）从后端获取数据，并支持搜索和分页：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"YS45d4R5eoinBDxdLACcKehAn5e","block_type":14,"code":{"elements":[{"text_run":{"content":"// 数据const dataList = ref([])\nconst total = ref(0)\n\n// 搜索条件const searchParams = reactive<API.SpaceQueryRequest>({\n  current: 1,\n  pageSize: 10,\n  sortField: 'createTime',\n  sortOrder: 'descend',\n})\n\n// 分页参数const pagination = computed(() => {\n  return {\n    current: searchParams.current ?? 1,\n    pageSize: searchParams.pageSize ?? 10,\n    total: total.value,\n    showSizeChanger: true,\n    showTotal: (total) => `共 ${total} 条`,\n  }\n})\n\n// 获取数据const fetchData = async () => {\n  const res = await listSpaceByPageUsingPost({\n    ...searchParams,\n  })\n  if (res.data.data) {\n    dataList.value = res.data.data.records ?? []\n    total.value = res.data.data.total ?? 0\n  } else {\n    message.error('获取数据失败，' + res.data.message)\n  }\n}\n\n// 页面加载时请求一次onMounted(() => {\n  fetchData()\n})\n\n// 获取数据const doSearch = () => {\n  // 重置搜索条件\n  searchParams.current = 1fetchData()\n}\n\n// 表格变化处理const doTableChange = (page: any) => {\n  searchParams.current = page.current\n  searchParams.pageSize = page.pageSizefetchData()\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"WVHbdVgf8oNA4cx5TCvc6MV7nyf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"注意：获取数؜据时，调用的是仅管理员可用的查询接口 listSpaceByPageUsingPost，不是给用户使用的查询包装类接口。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VBQqdSTIOoyoG6xgTcMcPwconbg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）自定义؜列的展示，比如空间级别、使用情况、创建时间、编辑时间等：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"QcZGdiaqqozKtJxkEzOceDb6nRe","block_type":14,"code":{"elements":[{"text_run":{"content":"<template #bodyCell=\"{ column, record }\">\n  <!-- 空间级别 -->\n  <template v-if=\"column.dataIndex === 'spaceLevel'\">\n    <a-tag>{{ SPACE_LEVEL_MAP[record.spaceLevel] }}</a-tag>\n  </template>\n  <!-- 使用情况 -->\n  <template v-if=\"column.dataIndex === 'spaceUseInfo'\">\n    <div>大小：{{ formatSize(record.totalSize) }} / {{ formatSize(record.maxSize) }}</div>\n    <div>数量：{{ record.totalCount }} / {{ record.maxCount }}</div>\n  </template>\n  <template v-else-if=\"column.dataIndex === 'createTime'\">\n    {{ dayjs(record.createTime).format('YYYY-MM-DD HH:mm:ss') }}\n  </template>\n  <template v-else-if=\"column.dataIndex === 'editTime'\">\n    {{ dayjs(record.editTime).format('YYYY-MM-DD HH:mm:ss') }}\n  </template>\n  <template v-else-if=\"column.key === 'action'\">\n    <a-space wrap>\n      <a-button type=\"link\" :href=\"`/add_space?id=${record.id}`\" target=\"_blank\">\n        编辑\n      </a-button>\n      <a-button type=\"link\" danger @click=\"doDelete(record.id)\">删除</a-button>\n    </a-space>\n  </template>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</template>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YkbMdAC4do7jl8xZvOkcwH2anPg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）开发搜؜索表单，支持按照空间名称、空间级别、用户 id 搜索：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"SmfAdEz9kozjOWxaXTJcyE5dnTc","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-form layout=\"inline\" :model=\"searchParams\" @finish=\"doSearch\">\n  <a-form-item label=\"空间名称\" name=\"spaceName\">\n    <a-input v-model:value=\"searchParams.spaceName\" placeholder=\"请输入空间名称\" allow-clear />\n  </a-form-item>\n  <a-form-item label=\"空间级别\" name=\"spaceLevel\">\n    <a-select\n      v-model:value=\"searchParams.spaceLevel\"\n      :options=\"SPACE_LEVEL_OPTIONS\"\n      placeholder=\"请输入空间级别\"\n      style=\"min-width: 180px\"\n      allow-clear\n    />\n  </a-form-item>\n  <a-form-item label=\"用户 id\" name=\"userId\">\n    <a-input v-model:value=\"searchParams.userId\" placeholder=\"请输入用户 id\" allow-clear />\n  </a-form-item>\n  <a-form-item>\n    <a-button type=\"primary\" html-type=\"submit\">搜索</a-button>\n  </a-form-item>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-form>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"N4mcde9TooBE5OxFm0pcHqsmn6e","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"5）补充操作按钮。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Uj3idmka3o9jb5xBJIFcKij9nHh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"可以在搜索؜表单上新增一行，展示标题和创建空间按钮，点击按钮会打开创建空间页面：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"NxamdZs46osqUlxjzbqcu58anCd","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-flex justify=\"space-between\">\n  <h2>空间管理</h2>\n  <a-space>\n    <a-button type=\"primary\" href=\"/add_space\" target=\"_blank\">+ 创建空间</a-button>\n  </a-space>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-flex>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"GJeud5xHroXxtlx5vFNcAZvMnnh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"在表格操作列中，也要补充编辑按钮，点击后打开编辑空间页面：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"DIFAdPxAYo4leWxiR5RcHJEznuc","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-space wrap>\n  <a-button type=\"link\" :href=\"`/add_space?id=${record.id}`\" target=\"_blank\">\n    编辑\n  </a-button>\n  <a-button type=\"link\" danger @click=\"doDelete(record.id)\">删除</a-button>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-space>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"XmXQdbsZdopeYGx9KgSc81HgnCb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"最终页面效果如图：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Ok0sdimYAoiGqfxGxI9cmJE0nQc","block_type":27,"image":{"align":2,"height":833,"token":"ODrNbryUGoRVwqxR5Ovcy6G1n1e","width":2251},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"FWCpdnZWzoC00yxyi03cGbR4nYc","block_type":4,"heading2":{"elements":[{"text_run":{"content":"创؜建空间页面    ‌         ‌         ﻿         ‍ ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"L1C5d0rhzoEcFkxvjiWcB3ydnOh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"1、新建路由","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"LCaZdvUyFoQ0DExvomjct0S3nU0","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"首先新建 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"AddSpacePage.vue","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 页面文件，在 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"router/index.ts","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 中定义路由：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"ElYHdLVaHoeJKwx3TdacN4Xfn1f","block_type":14,"code":{"elements":[{"text_run":{"content":"{\n  path: '/add_space',\n  name: '创建空间',\n  component: AddSpacePage,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"},","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YBFhdSu9ro6uI5xGve6cJTXcnQd","block_type":5,"heading3":{"elements":[{"text_run":{"content":"2、开发表单","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"X8GedUdr4o3SrMxsWgVcsDuxnag","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"该页面的主؜体是表单，可以直接复制批量创建图片页面，略作修改即可。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KjnMdPL01o6YT5xVpaBcx9dcnYf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）先修改表单项，允许填写空间名称、空间级别：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"CZ7bdeZ3YobYvExKkhrczG8TnHe","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-form layout=\"vertical\" :model=\"formData\" @finish=\"handleSubmit\">\n  <a-form-item label=\"空间名称\" name=\"spaceName\">\n    <a-input v-model:value=\"formData.spaceName\" placeholder=\"请输入空间名称\" allow-clear />\n  </a-form-item>\n  <a-form-item label=\"空间级别\" name=\"spaceLevel\">\n    <a-select\n      v-model:value=\"formData.spaceLevel\"\n      :options=\"SPACE_LEVEL_OPTIONS\"\n      placeholder=\"请输入空间级别\"\n      style=\"min-width: 180px\"\n      allow-clear\n    />\n  </a-form-item>\n  <a-form-item>\n    <a-button type=\"primary\" html-type=\"submit\" style=\"width: 100%\" :loading=\"loading\">\n      提交\n    </a-button>\n  </a-form-item>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-form>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"DixRdCWkLoEzhWxDl9lcd65qnjd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）定义表单项结构和 loading 变量：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MEC2dqAteos8AnxUudscpzQknae","block_type":14,"code":{"elements":[{"text_run":{"content":"const formData = reactive<API.SpaceAddRequest | API.SpaceUpdateRequest>({\n  spaceName: '',\n  spaceLevel: SPACE_LEVEL_ENUM.COMMON,\n})\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"const loading = ref(false)","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"L6UXdUl0XoX92fxsVOec4wrJn8f","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）编写提؜交函数，创建成功后会输出信息并跳转到新创建的空间详情页：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"IKtxdeVRCojMLexFsHbcDZOpnAb","block_type":14,"code":{"elements":[{"text_run":{"content":"const handleSubmit = async (values: any) => {\n  loading.value = true;\n  const res = await addSpaceUsingPost({\n    ...formData,\n  })\n  if (res.data.code === 0 && res.data.data) {\n    message.success(\"创建成功\")\n    router.push({\n      path: `/space/${res.data.data}`,\n    })\n  } else {\n    message.error('创建失败，' + res.data.message)\n  }\n  loading.value = false;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"LLrAdJ3MhodCckxuAh3ce0Szn9g","block_type":5,"heading3":{"elements":[{"text_run":{"content":"3、展示空间级别信息","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"NvMfdN0EJoBBNHxHnBZcuoaJnyc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"无论是用户和管理؜员，都需要了解空间级别信息；而且目前用户只能开通普通版空间，这个信息也要同步给用户。由于系统不支持支付，可以先让有需求的用户主动联系管理员，这是最快的盈利方式。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BAU9dzlYsoobolxf9sLcWo35n5c","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"所以可以在表单下新增展示这些信息的卡片。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HHO4dt0NxoUjtbxZ7dIcM3zyn0N","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）先利用组件库的 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"卡片组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Fcard-cn"},"strikethrough":false,"underline":false}}},{"text_run":{"content":" 开发页面内容：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"ANJTdfmoUojiwbxGqkucez6qnsb","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-card title=\"空间级别介绍\">\n  <a-typography-paragraph>\n    * 目前仅支持开通普通版，如需升级空间，请联系\n    <a href=\"https://chengfushi.blog.csdn.net\" target=\"_blank\">耄耄爱哈气</a>。\n  </a-typography-paragraph>\n  <a-typography-paragraph v-for=\"spaceLevel in spaceLevelList\">\n    {{ spaceLevel.text }}： 大小 {{ formatSize(spaceLevel.maxSize) }}， 数量\n    {{ spaceLevel.maxCount }}\n  </a-typography-paragraph>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-card>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":30,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"JM8vd0DaBoj1GqxkySncagQInBc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）请求后端获取空间级别列表：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MOgvdmmMMo2FZwxgeCTcwVarnbf","block_type":14,"code":{"elements":[{"text_run":{"content":"const spaceLevelList = ref<API.SpaceLevel[]>([])\n\n// 获取空间级别const fetchSpaceLevelList = async () => {\n  const res = await listSpaceLevelUsingGet()\n  if (res.data.code === 0 && res.data.data) {\n    spaceLevelList.value = res.data.data\n  } else {\n    message.error('加载空间级别失败，' + res.data.message)\n  }\n}\n\nonMounted(() => {\n  fetchSpaceLevelList()\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Po4ldswq5oC8hLx9RShcvFeqnKf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"效果如图：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BLtPdWAssocR7mxLTyocXflknve","block_type":27,"image":{"align":2,"height":901,"token":"Ke6abcnSoooBPCxrArGcqCPIn3e","width":1377},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"PuuOdKbvXoUXp8xRb7rc9v16ndw","block_type":6,"heading4":{"elements":[{"text_run":{"content":"4、更新空间页面","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"MggYdOdSzoBBzqxOe1Hcoq0unOe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"仅管理员可以؜更新空间，从空间管理页面可以跳转到编辑空间页面。由于编辑页面和创建页面都是表单项，结构一致，可以复用创建页面。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"FBnfd56qioBgKBx0jEecmk1gnUc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）跟之前开发؜的上传图片页面类似，可以利用 url 的 querystring 传递要修改的 spaceId 参数，在页面中获取到已有空间数据并填充表单项。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"HM3IdQVcwo0xCAxPUTmc6EmWnTd","block_type":14,"code":{"elements":[{"text_run":{"content":"const route = useRoute()\nconst oldSpace = ref<API.SpaceVO>()\n\n// 获取老数据const getOldSpace = async () => {\n  // 获取数据const id = route.query?.idif (id) {\n    const res = await getSpaceVoByIdUsingGet({\n      id: id,\n    })\n    if (res.data.code === 0 && res.data.data) {\n      const data = res.data.data\n      oldSpace.value = data\n      formData.spaceName = data.spaceName\n      formData.spaceLevel = data.spaceLevel\n    }\n  }\n}\n\n// 页面加载时，请求老数据onMounted(() => {\n  getOldSpace()\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"HvzPdX1HpofkJVx13l3cIupOnoh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）修改提؜交函数，根据是否有 spaceId 决定是调用更新接口还是创建接口：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OBw9dRWnNodJTmxiK6ycWRrxnDN","block_type":14,"code":{"elements":[{"text_run":{"content":"const handleSubmit = async (values: any) => {\n  const spaceId = oldSpace.value?.id\n  loading.value = truelet res\n  // 更新if (spaceId) {\n    res = await updateSpaceUsingPost({\n      id: spaceId,\n      ...formData,\n    })\n  } else {\n    // 创建\n    res = await addSpaceUsingPost({\n      ...formData,\n    })\n  }\n  if (res.data.code === 0 && res.data.data) {\n    message.success('操作成功')\n    let path = `/space/${spaceId ?? res.data.data}`\n    router.push({\n      path,\n    })\n  } else {\n    message.error('操作失败，' + res.data.message)\n  }\n  loading.value = false\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"PT2idC5R2o9WjAx8pk6ckR18njb","block_type":6,"heading4":{"elements":[{"text_run":{"content":"扩展","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"BWC2dSANdogB28xdQFQcQfBEnPd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）支持管؜理员填写空间大小、空间条数，从而实现类似 “资源扩容包” 的功能。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"QOMvdlCjSotR1dx3lRdczYKGn5d","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）选择空间级别时自动填充空间大小、空间条数这两个表单项。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VY9cdnUocoSCKFx5ZUbcvRGUnpf","block_type":4,"heading2":{"elements":[{"text_run":{"content":"用户创建私有空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"NbVddtFrooEgvdxpO0zccVjanXc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"现在已经有؜了创建空间的页面，只需要补充进入到该页面的入口即可。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LXjudPVRoopokNxfwOWcVBkynXd","block_type":5,"heading3":{"elements":[{"text_run":{"content":"1、展示私有空间入口","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"AKQYdEyNAoL6pYx3w0AcNq2wnDb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"预期效果是：左؜侧新增目录栏，展示 “公共图库” 和 “我的空间” 菜单项，点击 “我的空间” 后，如果没有创建过空间，则自动跳转到创建空间页面。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Arujd3FOxoPA64xStRkc3FJYnke","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）可以基于组件库的 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"Layout Sider 组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Flayout-cn%23components-layout-demo-top-side-2"},"strikethrough":false,"underline":false}}},{"text_run":{"content":" 实现 “顶部 - 侧边布局”：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"AjhCdnwpUoUBv6xkchBc9dyunJw","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"跟 GlobalHeader 全局顶部栏组件一样，我们单独封装一个 GlobalSider 全局侧边栏组件，在 Sider 组件内使用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"内嵌菜单组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Fmenu-cn%23components-menu-demo-inline"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"，先利用 Demo 把页面结构撑起来：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OcrtdIopXoGBt4xXFRrcU4zjn9d","block_type":14,"code":{"elements":[{"text_run":{"content":"<div id=\"globalSider\">\n  <a-layout-sider class=\"sider\" width=\"200\">\n    <a-menu\n      mode=\"inline\"\n      v-model:selectedKeys=\"current\"\n      :items=\"menuItems\"\n      @click=\"doMenuClick\"\n    />\n  </a-layout-sider>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</div>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"FCRgdxArKomdbFxEC7ycLmTCnQg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"在 BasicLayout 全局布局中引入侧边栏组件：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"H1mKdISpOoXzqdxGmFncX7XMnGe","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-layout>\n  <GlobalSider class=\"sider\" />\n  <a-layout-content class=\"content\">\n    <router-view />\n  </a-layout-content>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-layout>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"BpMDd2DlXoko2txRS0wcye91n1e","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"优化一下样؜式，隐藏多余的边框，下列代码仅展示了新增或修改的样式：1jGyT1jdedQgDNFYA8T3BC8Rpod+tQXglYFmkZuCZXA=Dlfw8NwnEDAWu8E/AQcY7dm3A98behgssP1uNM9pOf8=","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KlJmdDNhMoSYHrxufOocpOkznkb","block_type":14,"code":{"elements":[{"text_run":{"content":"#basicLayout .header {\n  margin-bottom: 1px;\n}\n\n#basicLayout .content {\n  padding: 28px;\n}\n\n#basicLayout .sider {\n  background: #fff;\n  padding-top: 20px;\n  border-right: 0.5px solid #eee;\n}\n\n#basicLayout :deep(.ant-menu-root) {\n  border-bottom: none !important;\n  border-inline-end: none !important;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":12,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Cvxhd9rFSog2Psxwz4Qcg3sSnJd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）开发 G؜lobalSider 组件。跟 GlobalHeader 组件一样，需要定义菜单项、实现点击跳转、根据路由自动高亮。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"JjJDdEqyCoksS1xdl25cO6qSnQb","block_type":14,"code":{"elements":[{"text_run":{"content":"// 菜单列表const menuItems = [\n  {\n    key: '/',\n    label: '公共图库',\n    icon: () => h(PictureOutlined),\n  },\n  {\n    key: '/my_space',\n    label: '我的空间',\n    icon: () => h(UserOutlined),\n  },\n]\n\nconst router = useRouter()\n\n// 当前选中菜单const current = ref<string[]>([])\n// 监听路由变化，更新当前选中菜单\nrouter.afterEach((to, from, failure) => {\n  current.value = [to.path]\n})\n\n// 路由跳转事件const doMenuClick = ({ key }: { key: string }) => {\n  router.push({\n    path: key,\n  })\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"RusydbSsyo3yHAxyBTIcVyAFnQc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）优化侧边栏的展示","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"COsMd3eSVoFWilxgKPlcgrPOn6f","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"可以给组件增加条件判断，如果用户未登录，则不用显示侧边栏：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Z1XQdKCkCoxLorxQeVocjajVnpb","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-layout-sider v-if=\"loginUserStore.loginUser.id\" class=\"sider\" width=\"200\">\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-layout-sider>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"F131d4wl0oUmwoxYksOcJ65nnPf","block_type":14,"code":{"elements":[{"text_run":{"content":"const loginUserStore = useLoginUserStore()","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"RKMZdrxkLoCQ4kxkdqhc4QYRnsb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"还可以使用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"响应式布局","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Flayout-cn%23components-layout-demo-responsive"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"，屏幕尺寸小于 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"lg","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 时，自动折叠侧边栏：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"VtmGdwm93oZ3u7x6JqvcBld6nng","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-layout-sider v-if=\"loginUserStore.loginUser.id\" \n  class=\"sider\"\n  width=\"200\" \n  breakpoint=\"lg\"\n  collapsed-width=\"0\"\n>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-layout-sider>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"FbiBdhAyvo3toIxFk5Uc71YUnVd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"效果如图：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RWHYdXOfEokndNxLSLXcgorsnnd","block_type":27,"image":{"align":2,"height":1305,"token":"GoZob7MN8oWMedxcOLMceGAPnod","width":2515},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"JuZsdi1PGo0FCVxVeuZcYvTgnVe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）可以在؜ GlobalHeader 右边头像的下拉菜单中也添加 “我的空间” 跳转：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Fxo1dsZOco4ovsxigyHc9JLYnkb","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-menu-item>\n  <router-link to=\"/my_space\">\n    <UserOutlined />\n    我的空间\n  </router-link>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-menu-item>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Ve9sdWc1ooMRQwxo8iWcO5eFn7f","block_type":5,"heading3":{"elements":[{"text_run":{"content":"2、我的空间页面","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"XR5DdwtXto7DPIx8AITcFoU3nfd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"我的空间页面是一个 “中间页”，作用是根据用户是否已有空间，重定向 到对应的页面。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RJZmdZOV6ozPKFxghv6c4bEJnjh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"先梳理业务流程，跳转到该页面时：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Gs8JdG9NUo4Fuhx4wcvcPmeDnmh","block_type":12,"bullet":{"elements":[{"text_run":{"content":"用户未登录，则直接跳转到登录页面","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"AIUgdMaxSoas7Cx0yTrcsrIgnvf","block_type":12,"bullet":{"elements":[{"text_run":{"content":"如果用户已登录，会获取该用户已创建的空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Rtl8d8c2aoZNwDxblwucHW6XnBe","block_type":12,"bullet":{"elements":[{"text_run":{"content":"如果有，则进入第一个空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"QCkvdiTlCoMzWDxFNEKcpKmgnib","block_type":12,"bullet":{"elements":[{"text_run":{"content":"如果没有，则跳转到创建空间页面","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Rof3dAjIHoLGE1xFoSmcdL3Ynih","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）新建文件和路由：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"AIrDdw2VMoaEetxx8J4c3hDenSg","block_type":14,"code":{"elements":[{"text_run":{"content":"{\n  path: '/my_space',\n  name: '我的空间',\n  component: MySpacePage,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"},","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"ZKlgdE9fSoKyPsxkYVCcya3fnsf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）编写页面：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RMSUduhu5oy8S6xeduHcEFKgnrh","block_type":14,"code":{"elements":[{"text_run":{"content":"<template>\n  <div id=\"mySpace\">\n    <p>正在跳转，请稍候...</p>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { listSpaceVoByPageUsingPost } from '@/api/spaceController'\nimport { message } from 'ant-design-vue'\nimport { useLoginUserStore } from '@/stores/useLoginUserStore'\n\nconst router = useRouter()\nconst loginUserStore = useLoginUserStore()\n\n// 检查用户是否有个人空间\nconst checkUserSpace = async () => {\n  const loginUser = loginUserStore.loginUser\n  if (!loginUser?.id) {\n    router.replace('/user/login')\n    return\n  }\n  // 获取用户空间信息\n  const res = await listSpaceVoByPageUsingPost({\n    userId: loginUser.id,\n    current: 1,\n    pageSize: 1,\n  })\n  if (res.data.code === 0) {\n    if (res.data.data?.records?.length > 0) {\n      const space = res.data.data.records[0]\n      router.replace(`/space/${space.id}`)\n    } else {\n      router.replace('/add_space')\n      message.warn('请先创建空间')\n    }\n  } else {\n    message.error('加载我的空间失败，' + res.data.message)\n  }\n}\n\n// 在页面加载时检查用户空间\nonMounted(() => {\n  checkUserSpace()\n})\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</script>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"OVyFdCSWCocf24xtzUCc8iCWnyh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"上述代码的核心是 checkUserSpace 函数，在页面加载时会检查用户是否登录、是否已有空间，并使用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"router.replace","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 重定向页面，这样点击浏览器的后退按钮时，不会回到中间页。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"NGUjdTIwsoPtQrxXbelcym59nZd","block_type":5,"heading3":{"elements":[{"text_run":{"content":"扩展","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"WcnVdLDdjoKVcyxhZEbcMTo0nqL","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"参考 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"组件库的 Demo","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Flayout-cn%23components-layout-demo-fixed-sider"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"，固定全局侧边栏和全局顶部栏：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"FK9vdmMEmoBHsKxgLJQcr2ALnAc","block_type":27,"image":{"align":2,"height":1305,"token":"O6wKbdu2XoU7Q3xa18jcFRThn0e","width":2515},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"M3IedMPKXozWPHxVoT0cWRsOn3y","block_type":4,"heading2":{"elements":[{"text_run":{"content":"用户使用私有空间（空间详情页）","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"H1TLdXrBConSAHxZ8Pgc7W2NnYc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"空间详情页؜主要是展示空间信息、并展示空间内的图片列表，其结构和公开图库的主页非常相似，可以复用组件。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BYGPd8KtMoiorzxR6n3cNqvln8e","block_type":5,"heading3":{"elements":[{"text_run":{"content":"1、封装图片列表组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"AniVd5Tp0o1bUuxQIurcjdFtntd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"先封装图片؜列表组件 PictureList，该组件只负责数据的展示、不负责数据的查询，因此要把分页组件单独拉出来。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"PEtYdrV3uokzeCx6CQUce7wEnlc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）开发图片؜列表组件，大多数的代码都是从主页复制来的，关键是定义属性，接受 dataList 数据列表和 loading 加载状态：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"GTifdpqdhonL3qxRGZYcEsYindh","block_type":14,"code":{"elements":[{"text_run":{"content":"<template>\n  <div class=\"picture-list\">\n    <!-- 图片列表 -->\n    <a-list\n      :grid=\"{ gutter: 16, xs: 1, sm: 2, md: 3, lg: 4, xl: 5, xxl: 6 }\"\n      :data-source=\"dataList\"\n      :loading=\"loading\"\n    >\n      <template #renderItem=\"{ item: picture }\">\n        <a-list-item style=\"padding: 0\">\n          <!-- 单张图片 -->\n          <a-card hoverable @click=\"doClickPicture(picture)\">\n            <template #cover>\n              <img\n                style=\"height: 180px; object-fit: cover\"\n                :alt=\"picture.name\"\n                :src=\"picture.thumbnailUrl ?? picture.url\"\n                loading=\"lazy\"\n              />\n            </template>\n            <a-card-meta :title=\"picture.name\">\n              <template #description>\n                <a-flex>\n                  <a-tag color=\"green\">\n                    {{ picture.category ?? '默认' }}\n                  </a-tag>\n                  <a-tag v-for=\"tag in picture.tags\" :key=\"tag\">\n                    {{ tag }}\n                  </a-tag>\n                </a-flex>\n              </template>\n            </a-card-meta>\n          </a-card>\n        </a-list-item>\n      </template>\n    </a-list>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useRouter } from 'vue-router'\n\ninterface Props {\n  dataList?: API.PictureVO[]\n  loading?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  dataList: () => [],\n  loading: false,\n})\n\n// 跳转至图片详情\nconst router = useRouter()\nconst doClickPicture = (picture) => {\n  router.push({\n    path: `/picture/${picture.id}`,\n  })\n}\n</script>\n\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"<style scoped></style>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"MLFHd26LwoDcfox8WEwcIRfUnK5","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）修改主页的图片列表代码，使用图片列表组件，并补充 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"分页组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Fpagination-cn"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KU6Zd47J5o3ghlx0B81cf14Enqc","block_type":14,"code":{"elements":[{"text_run":{"content":"<!-- 图片列表 -->\n<PictureList :dataList=\"dataList\" :loading=\"loading\" />\n<a-pagination\n  style=\"text-align: right\"\n  v-model:current=\"searchParams.current\"\n  v-model:pageSize=\"searchParams.pageSize\"\n  :total=\"total\"\n  @change=\"onPageChange\"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"RoU7d3fIvo7eKfxQSygchW0NnOe","block_type":5,"heading3":{"elements":[{"text_run":{"content":"2、开发空间详情页","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"HrMhdT4LWoOO78xUoc1cnR2nn0b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"该页面的结构是：空间信息 + 展示空间下的图片列表","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EqS0dCfZPovsD1xbXXJcBjxHnzg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）新建 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"SpaceDetailPage.vue","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 和路由，跟图片详情页类似，路由要能接受动态参数，表示要加载的空间 id：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"GVWSdYfiGoLDYvx5x1AcfVTgnAc","block_type":14,"code":{"elements":[{"text_run":{"content":"{\n  path: '/space/:id',\n  name: '空间详情',\n  component: SpaceDetailPage,\n  props: true,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"},","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"C1E0dRiPzoEgVdxkcGccWZkinlh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）编写页؜面脚本，主要是获取空间详情数据和获取空间下的图片列表数据：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"H8wNdXEiBod6JQxFNX0cmtcsn0b","block_type":14,"code":{"elements":[{"text_run":{"content":"const props = defineProps<{\n  id: string | number\n}>()\nconst space = ref<API.SpaceVO>({})\n\n// 获取空间详情const fetchSpaceDetail = async () => {\n  try {\n    const res = await getSpaceVoByIdUsingGet({\n      id: props.id,\n    })\n    if (res.data.code === 0 && res.data.data) {\n      space.value = res.data.data\n    } else {\n      message.error('获取空间详情失败，' + res.data.message)\n    }\n  } catch (e: any) {\n    message.error('获取空间详情失败：' + e.message)\n  }\n}\n\nonMounted(() => {\n  fetchSpaceDetail()\n})\n\n// 数据const dataList = ref([])\nconst total = ref(0)\nconst loading = ref(true)\n\n// 搜索条件const searchParams = reactive<API.PictureQueryRequest>({\n  current: 1,\n  pageSize: 12,\n  sortField: 'createTime',\n  sortOrder: 'descend',\n})\n\n// 分页参数const onPageChange = (page, pageSize) => {\n  searchParams.current = page\n  searchParams.pageSize = pageSize\n  fetchData()\n}\n\n// 获取数据const fetchData = async () => {\n  loading.value = true// 转换搜索参数const params = {\n    spaceId: props.id,\n    ...searchParams,\n  }\n  const res = await listPictureVoByPageUsingPost(params)\n  if (res.data.data) {\n    dataList.value = res.data.data.records ?? []\n    total.value = res.data.data.total ?? 0\n  } else {\n    message.error('获取数据失败，' + res.data.message)\n  }\n  loading.value = false\n}\n\n// 页面加载时请求一次onMounted(() => {\n  fetchData()\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Ig1wdDbIjofzGAxqcJ9cKsGYnSh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）开发空间信息展示栏，展示空间名称，并使用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"进度条组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Fprogress-cn%2F%23components-progress-demo-circle-mini"},"strikethrough":false,"underline":false}}},{"text_run":{"content":" 展示空间限额：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KfGNdCQrmoVadAxX1l8cnjMunTe","block_type":14,"code":{"elements":[{"text_run":{"content":"<!-- 空间信息 -->\n<a-flex justify=\"space-between\">\n  <h2>{{ space.spaceName }}（私有空间）</h2>\n  <a-space size=\"middle\">\n    <a-button type=\"primary\" :href=\"`/add_picture?spaceId=${id}`\" target=\"_blank\">\n      + 创建图片\n    </a-button>\n    <a-tooltip\n      :title=\"`占用空间 ${formatSize(space.totalSize)} / ${formatSize(space.maxSize)}`\"\n    >\n      <a-progress\n        type=\"circle\"\n        :percent=\"((space.totalSize * 100) / space.maxSize).toFixed(1)\"\n        :size=\"42\"\n      />\n    </a-tooltip>\n  </a-space>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-flex>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Ytasd7qXAoWiPRxMNoJc6PVbnXe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）开发图片列表和分页，直接使用已封装的组件：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"PV2VdTdhQo6CGVxB5zXcqADinOe","block_type":14,"code":{"elements":[{"text_run":{"content":"<!-- 图片列表 -->\n<PictureList :dataList=\"dataList\" :loading=\"loading\" />\n<a-pagination\n  style=\"text-align: right\"\n  v-model:current=\"searchParams.current\"\n  v-model:pageSize=\"searchParams.pageSize\"\n  :total=\"total\"\n  :show-total=\"() => `图片总数 ${total} / ${space.maxCount}`\"\n  @change=\"onPageChange\"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"IUcJd7N8DotKwkxaaVxc6cRUn5e","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"在分页组件中，我们要展示图片总数和最大数量，让用户知晓。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Lf2wdzJkYoYHldxLTORcBCwQnqf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"效果如图：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"RK4mda0XRoRJ0MxN8wLcjITGn3e","block_type":27,"image":{"align":2,"height":786,"token":"TVRUbpDIcoZL00xcV4Pc1v0jnSE","width":2239},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Dds1dSazmoTpm2xl4fccIA6ZnJh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"已经能够查؜看私有空间详情了，我们再依次开发对空间内图片的 “增删改查” 操作。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"GFr9dqjSZoDCYcxIcJWcC55KnQf","block_type":5,"heading3":{"elements":[{"text_run":{"content":"3、上传图片到私有空间","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"C5eTdxaJIoTBrLxrlB6c5kPwnne","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）修改创؜建图片页面，支持通过 url 查询参数中的 spaceId 传参，在页面中可以获取到 spaceId：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"QHcEdjWjNoZCXCxmo3qcQkoanCb","block_type":14,"code":{"elements":[{"text_run":{"content":"// 空间 idconst spaceId = computed(() => {\n  return route.query?.spaceId\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"LCB2d0CSDondbjx81oCc7cbHn7b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）提交时，补充 spaceId 参数：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"MfdqdAEDwoZugqxqgqYcDH3Un9b","block_type":14,"code":{"elements":[{"text_run":{"content":"const res = await editPictureUsingPost({\n  id: pictureId,\n  spaceId: spaceId.value,\n  ...values,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"AlV4dTYhcoytZFxIb8scSI53nJe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）在页面中展示当前的 spaceId：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KBN4dkhkdojEZGxnEMxcdMl3nyc","block_type":14,"code":{"elements":[{"text_run":{"content":"<a-typography-paragraph v-if=\"spaceId\" type=\"secondary\">\n  保存至空间：<a :href=\"`/space/${spaceId}`\" target=\"_blank\">{{ spaceId }}</a>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</a-typography-paragraph>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"YKNodSTTgokgRAxJ28JcJQQcn2b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）修改图片上传组件","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"（包括本地文件上传和 URL 上传）","text_element_style":{"bold":true,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" ，支持上传时传递 spaceId：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OFhFd6PfcoEJI0x1gUPcCFjinrf","block_type":14,"code":{"elements":[{"text_run":{"content":"interface Props {\n  picture?: API.PictureVO\n  spaceId?: number\n  onSuccess?: (newPicture: API.PictureVO) => void\n}\n\n// 上传时传递 spaceIdconst params: API.PictureUploadRequest = props.picture ? { id: props.picture.id } : {}\nparams.spaceId = props.spaceId;\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"const res = await uploadPictureUsingPost(params, {}, file)","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"SVcfdGG2TotKvXxxZiEcgkfanF5","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"效果如图：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"U0Abdn0VhognYUxZ2AicsFIqn4e","block_type":27,"image":{"align":2,"height":835,"token":"I5pQbeQEaoRPYtxPVJ3cIK47nte","width":2136},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"IA7Fd6p6JoVp7axQpK6czNJJnXb","block_type":5,"heading3":{"elements":[{"text_run":{"content":"4、图片组件增加快捷操作","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"KKp8duyQMoIfYDxVJiKcfFErnFh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"可以给空间详情页的图片卡片的下方增加快捷操作栏，提高管理效率，参考 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"卡片组件示例","text_element_style":{"bold":false,"inline_code":false,"italic":false,"link":{"url":"https%3A%2F%2Fantdv.com%2Fcomponents%2Fcard-cn%23components-card-demo-meta"},"strikethrough":false,"underline":false}}},{"text_run":{"content":"。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"EJ7RdyguEoOmTLxPkpacfUd0njf","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）修改图片列表组件，补充操作栏。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"UN42d2nJYoU7pZxQAYvcfjNsnsb","block_type":14,"code":{"elements":[{"text_run":{"content":"<template #actions>\n  <a-space @click=\"e => doEdit(picture, e)\">\n    <edit-outlined />\n    编辑\n  </a-space>\n  <a-space @click=\"e => doDelete(picture, e)\">\n    <delete-outlined />\n    删除\n  </a-space>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</template>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"OFJJd8T1voISEuxNbslcBSHWnOc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）由于该؜组件是主页和空间详情页公用的，主页不需要展示操作栏、私有空间才展示，所以需要使用 showOp 属性来控制：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"KO55dFBICoTMApxLTZNc52vPncg","block_type":14,"code":{"elements":[{"text_run":{"content":"interface Props {\n  dataList?: API.PictureVO[]\n  loading?: boolean\n  showOp?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  dataList: () => [],\n  loading: false,\n  showOp: false,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"ICtldIoFtotnsZxwimYcz9NNn2e","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"页面结构增加条件：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Uv3ddoM6YoXpYAxFNZTcShiZn3c","block_type":14,"code":{"elements":[{"text_run":{"content":"<template v-if=\"showOp\" #actions>\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"</template>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"M3b8dntE9o1bA4x85uicHKiznGe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）补充编辑和删除函数，doEdit、doDelete 的代码可以直接从图片详情页复制过来，但是需要用 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"e.stopPropagation","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":" 阻止事件传播，否则会同时触发卡片点击事件，跳转到图片详情页。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"QdpYdxVNdoviaSxZaY8c59EanJf","block_type":14,"code":{"elements":[{"text_run":{"content":"// 编辑const doEdit = (picture, e) => {\n  e.stopPropagation()\n  router.push({\n    path: '/add_picture',\n    query: {\n      id: picture.id,\n      spaceId: picture.spaceId,\n    },\n  })\n}\n\n// 删除const doDelete = async (picture, e) => {\n  e.stopPropagation()\n  const id = picture.idif (!id) {\n    return\n  }\n  const res = await deletePictureUsingPost({ id })\n  if (res.data.code === 0) {\n    message.success('删除成功')\n    // 让外层刷新\n    props?.onReload()\n  } else {\n    message.error('删除失败')\n  }\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"IaehdlGiForxsOxsBznc3Zy6nLg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）注意，؜删除图片之后，可以 reload 重新触发数据的加载。给图片列表组件增加 onReload 属性：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"UlbfdFaYGouZDTxcUsOcn09Pnb3","block_type":14,"code":{"elements":[{"text_run":{"content":"interface Props {\n  dataList?: API.PictureVO[]\n  loading?: boolean\n  showOp?: boolean\n  onReload?: () => void\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"BXiPdHrgEo1DjkxS4ZacppxVnyc","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"空间详情页传递属性：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LgOldK5ITov8M2xUZiUcCmH8njd","block_type":14,"code":{"elements":[{"text_run":{"content":"<!-- 图片列表 -->\n<PictureList :dataList=\"dataList\"\n  :loading=\"loading\"\n  showOp \n  :onReload=\"fetchData\"\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"/>","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":1,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"MqbSd4PzFoRMrTxeNRWcEGx9nvb","block_type":5,"heading3":{"elements":[{"text_run":{"content":"5、查看私有空间的图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"PmvNd2pdRoLeBSxIz0dcrQhqnbW","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"直接复用图؜片详情页 + 后端接口的权限校验，就已经实现了，无需开发。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"WjYld9mqco53gOxnEQWc2A65nLh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"6、编辑私有空间的图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"MuV3dZczOoSzimxGGZrcff68nLe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"之前我们已经完成了更؜新图片页面的开发（其实是复用了图片创建页）。从空间详情页或图片详情页进入图片创建页时，只要给 url 查询参数携带 spaceId，图片创建页就能自动识别出 spaceId 并将图片保存到空间。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"V8WkduVfVo1uslxqSb2csLJJn2b","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"修改图片详؜情页的编辑图片函数，跳转页面时携带 spaceId：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Cec2dmukuoIHFrxbvqMcNOQVnaf","block_type":14,"code":{"elements":[{"text_run":{"content":"// 编辑const doEdit = () => {\n  router.push({\n    path: '/add_picture',\n    query: {\n      id: picture.value.id,\n      spaceId: picture.value.spaceId\n    }\n  })\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"}","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"Pwt1dF9FUotBBYxcBhJcmvRgnb5","block_type":5,"heading3":{"elements":[{"text_run":{"content":"7、删除私有空间的图片","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"SrkAdRrtPoneo7xOE0UcjzCbnUh","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"通过后端接口已经实现了权限校验逻辑，无需前端开发。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"BbqvdgNAloUsJvxqMsjcVmXknTg","block_type":5,"heading3":{"elements":[{"text_run":{"content":"8、私有图片的权限控制","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"VQGudvlwXoYekWx9BfqcyQJfnXe","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"大多数权限校验؜已经通过后端实现，比如主页不传 spaceId 默认就查的是公共图库，无需修改前端代码；访问图片详情页时，也会通过后端进行权限校验。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"OiWqdr1BJolceuxPbiMcuOUpnIg","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"但图片管理页面由于调用的是仅管理员可用的获取图片列表接口（listPictureByPage），看到的是全部的图片，其实只需要看公共空间的进行审核，可以给查询条件增加参数 ","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"nullSpaceId: true","text_element_style":{"bold":false,"inline_code":true,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"：","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"De7Od32Wfo3mhZxedmeca3VvnJe","block_type":14,"code":{"elements":[{"text_run":{"content":"const res = await listPictureByPageUsingPost({\n  ...searchParams,\n  nullSpaceId: true,\n","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}},{"text_run":{"content":"})","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"language":63,"wrap":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"GFFkds3xeozYhvxRJgmckLW1nHh","block_type":5,"heading3":{"elements":[{"text_run":{"content":"扩展","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}},"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe"},{"block_id":"H7V3d728ZoSi2ExJbtFcX25PnLd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"1）空间详؜情页增加空间标志的展示，比如尊贵的旗舰版展示个钻石 💎。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"LW2Ydf2LRosbrKxFBUQcEfYVnWd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"2）在空间؜内上传图片时可以使用弹窗组件，而不是打开新页面，更轻量。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"UGvVdZbXLonL4UxiSTvcl78Qnvb","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"3）上传图؜片到空间时，上传页面可以展示出空间名称、容量等信息，并且前端也可以判断是否具有权限，优化用户体验。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"M1utd2MDNo7kgVxPXaGcGN1fnNd","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"4）除了图؜片列表组件外，还可以封装单个图片的组件，复用更灵活。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}},{"block_id":"Kp5zd8M5QoKIF0xwDhRcnCN0nG3","block_type":2,"parent_id":"U6rydIHWBoBc06xw6kWcEiY9nFe","text":{"elements":[{"text_run":{"content":"5）图片详؜情页、空间详情页前端增加权限判断逻辑，相比单纯靠后端进行权限校验，可以给用户更好的体验。","text_element_style":{"bold":false,"inline_code":false,"italic":false,"strikethrough":false,"underline":false}}}],"style":{"align":1,"folded":false}}}],"type":"docx"}
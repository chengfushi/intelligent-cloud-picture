# ç”¨æˆ·æ¨¡å—

# éœ€æ±‚åˆ†æ

å¯¹äºç”¨æˆ·æ¨¡å—ï¼Œé€šå¸¸è¦å…·æœ‰ä¸‹åˆ—åŠŸèƒ½ï¼š

* ç”¨æˆ·æ³¨å†Œ
* ç”¨æˆ·ç™»å½•
* è·å–å½“å‰ç™»å½•ç”¨æˆ·
* ç”¨æˆ·æ³¨é”€
* ç”¨æˆ·æƒé™æ§åˆ¶
* ã€ç®¡ç†å‘˜ã€‘ç®¡ç†ç”¨æˆ·



å…·ä½“åˆ†ææ¯ä¸ªéœ€æ±‚ï¼š

1ï¼‰ç”¨æˆ·æ³¨å†Œï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·ã€å¯†ç ã€ç¡®è®¤å¯†ç è¿›è¡Œæ³¨å†Œ

2ï¼‰ç”¨æˆ·ç™»å½•ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥è´¦å·å’Œå¯†ç ç™»å½•

3ï¼‰è·å–å½“å‰çš„ç™»å½•ç”¨æˆ·ï¼šå¾—åˆ°å½“å‰å·²ç»ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸ç”¨é‡å¤ç™»å½•ï¼‰

4ï¼‰ç”¨æˆ·æ³¨é”€ï¼šç”¨æˆ·å¯ä»¥é€€å‡ºç™»å½•

5ï¼‰ç”¨æˆ·æƒé™æ§åˆ¶ï¼šç”¨æˆ·åˆåˆ†ä¸ºæ™®é€šç”¨æˆ·å’Œç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜æ‹¥æœ‰æ•´ä¸ªç³»ç»Ÿçš„æœ€é«˜æƒé™ï¼Œæ¯”å¦‚å¯ä»¥ç®¡ç†å…¶ä»–ç”¨æˆ·

6ï¼‰ç”¨æˆ·ç®¡ç†ï¼šä»…ç®¡ç†å‘˜å¯ç”¨ï¼Œå¯ä»¥å¯¹æ•´ä¸ªç³»ç»Ÿä¸­çš„ç”¨æˆ·è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚æœç´¢ç”¨æˆ·ã€åˆ é™¤ç”¨æˆ·



# æ–¹æ¡ˆè®¾è®¡

å®ç°ç”¨æˆ·æ¨¡å—çš„éš¾åº¦ä¸å¤§ï¼Œæ–¹æ¡ˆè®¾è®¡é˜¶æ®µæˆ‘ä»¬éœ€è¦ç¡®è®¤ï¼š

* åº“è¡¨è®¾è®¡
* ç”¨æˆ·ç™»å½•æµç¨‹
* å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ

## åº“è¡¨è®¾è®¡

### æ ¸å¿ƒè®¾è®¡

åº“åï¼šyu_picture

è¡¨åï¼šuserï¼ˆç”¨æˆ·è¡¨ï¼‰


```SQL
-- ç”¨æˆ·è¡¨
create table if not exists user
(
    id          bigint auto_increment comment 'id' primary key,
    userAccount varchar(256)         not null comment 'è´¦å·',
    userPassword varchar(512)         not null comment 'å¯†ç ',
    userName    varchar(256)         null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar  varchar(1824)        null comment 'ç”¨æˆ·å¤´åƒ',
    userProfile varchar(512)         null comment 'ç”¨æˆ·ç®€ä»‹',
    userRole    varchar(256) default 'user' not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin',
    editTime    datetime             default CURRENT_TIMESTAMP not null comment 'ç¼–è¾‘æ—¶é—´',
    createTime  datetime             default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime             default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete    tinyint 0            default 0 not null comment 'æ˜¯å¦åˆ é™¤',
    UNIQUE KEY idx_userAccount (userAccount),
    INDEX idx_userName (userName)
) comment 'ç”¨æˆ·è¡¨' collate = utf8mb4_unicode_ci;
```

å‡ ä¸ªæ³¨æ„äº‹é¡¹ï¼š

1ï¼‰editTime å’Œ updateTime çš„åŒºåˆ«ï¼šeditTime è¡¨ç¤ºç”¨æˆ·ç¼–è¾‘ä¸ªäººä¿¡æ¯çš„æ—¶é—´ï¼ˆéœ€è¦ä¸šåŠ¡ä»£ç æ¥æ›´æ–°ï¼‰ï¼Œè€Œ updateTime è¡¨ç¤ºè¿™æ¡è®°å½•ä»»ä½•å­—æ®µå‘ç”Ÿä¿®æ”¹çš„æ—¶é—´ï¼ˆç”±æ•°æ®åº“è‡ªåŠ¨æ›´æ–°ï¼‰ã€‚

2ï¼‰ç»™å”¯ä¸€å€¼æ·»åŠ å”¯ä¸€é”®ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼Œæ¯”å¦‚è´¦å· userAccountï¼Œåˆ©ç”¨æ•°æ®åº“å¤©ç„¶é˜²é‡å¤ï¼ŒåŒæ—¶å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚

3ï¼‰ç»™ç»å¸¸ç”¨äºæŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•ï¼Œæ¯”å¦‚ç”¨æˆ·æ˜µç§° userNameï¼Œå¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ã€‚

ğŸ‘‡ å»ºè®®å…»æˆå¥½ä¹ æƒ¯ï¼Œå°†åº“è¡¨è®¾è®¡ SQL ä¿å­˜åˆ°é¡¹ç›®çš„ç›®å½•ä¸­ï¼Œæ¯”å¦‚æ–°å»º sql/create_table.sql æ–‡ä»¶ï¼Œè¿™æ ·å…¶ä»–å¼€å‘è€…å°±èƒ½æ›´å¿«åœ°äº†è§£é¡¹ç›®ã€‚



### æ‰©å±•è®¾è®¡

1ï¼‰å¦‚æœè¦å®ç°ä¼šå‘˜åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

1. ç»™ userRole å­—æ®µæ–°å¢æšä¸¾å€¼ vipï¼Œè¡¨ç¤ºä¼šå‘˜ç”¨æˆ·ï¼Œå¯æ ¹æ®è¯¥å€¼åˆ¤æ–­ç”¨æˆ·æƒé™
2. æ–°å¢ä¼šå‘˜è¿‡æœŸæ—¶é—´å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜æœ‰æ•ˆæœŸ
3. æ–°å¢ä¼šå‘˜å…‘æ¢ç å­—æ®µï¼Œå¯ç”¨äºè®°å½•ä¼šå‘˜çš„å¼€é€šæ–¹å¼
4. æ–°å¢ä¼šå‘˜ç¼–å·å­—æ®µï¼Œå¯ç”¨äºå®šä½ç”¨æˆ·å¹¶æä¾›é¢å¤–æœåŠ¡ï¼Œå¹¶å¢åŠ ä¼šå‘˜å½’å±æ„Ÿ

å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š




```SQL
vipExpireTime datetime         null comment 'ä¼šå‘˜è¿‡æœŸæ—¶é—´',
vipCode       varchar(128)     null comment 'ä¼šå‘˜å…‘æ¢ç ',
vipNumber      bigint           null comment 'ä¼šå‘˜ç¼–å·'
```



2ï¼‰å¦‚æœè¦å®ç°ç”¨æˆ·é‚€è¯·åŠŸèƒ½ï¼Œå¯ä»¥å¯¹è¡¨è¿›è¡Œå¦‚ä¸‹æ‰©å±•ï¼š

1. æ–°å¢ shareCode åˆ†äº«ç å­—æ®µï¼Œç”¨äºè®°å½•æ¯ä¸ªç”¨æˆ·çš„å”¯ä¸€é‚€è¯·æ ‡è¯†ï¼Œå¯æ‹¼æ¥åˆ°é‚€è¯·ç½‘å€åé¢ï¼Œæ¯”å¦‚ https://mianshiyuan/shareCode=xxx
2. æ–°å¢ inviteUser å­—æ®µï¼Œç”¨äºè®°å½•è¯¥ç”¨æˆ·è¢«å“ªä¸ªç”¨æˆ·é‚€è¯·äº†ï¼Œå¯é€šè¿‡è¿™ä¸ªå­—æ®µæŸ¥è¯¢æŸç”¨æˆ·é‚€è¯·çš„ç”¨æˆ·åˆ—è¡¨ã€‚

å¯¹åº”çš„ SQL å¦‚ä¸‹ï¼š


```SQL
shareCode     varchar(28) DEFAULT NULL COMMENT 'åˆ†äº«ç ',
inviteUser     bigint          DEFAULT NULL COMMENT 'é‚€è¯·ç”¨æˆ· id'
```



## ç”¨æˆ·ç™»å½•æµç¨‹

1ï¼‰å»ºç«‹åˆå§‹ä¼šè¯ï¼šå‰ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥åï¼ŒæœåŠ¡å™¨ä¼šä¸ºè¯¥å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªåˆå§‹çš„åŒ¿å Sessionï¼Œå¹¶å°†å…¶çŠ¶æ€ä¿å­˜ä¸‹æ¥ã€‚è¿™ä¸ª Session çš„ ID ä¼šä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè¿”å›ç»™å‰ç«¯ã€‚

2ï¼‰ç™»å½•æˆåŠŸï¼Œæ›´æ–°ä¼šè¯ä¿¡æ¯ï¼šå½“ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥æ­£ç¡®çš„è´¦å·å¯†ç å¹¶æäº¤åˆ°åç«¯éªŒè¯æˆåŠŸåï¼Œåç«¯ä¼šæ›´æ–°è¯¥ç”¨æˆ·çš„ Sessionï¼Œå°†ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ· IDã€ç”¨æˆ·åç­‰ï¼‰ä¿å­˜åˆ°ä¸è¯¥ Session å…³è”çš„å­˜å‚¨ä¸­ã€‚åŒæ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ª Set-Cookie çš„å“åº”å¤´ï¼ŒæŒ‡ç¤ºå‰ç«¯ä¿å­˜è¯¥ç”¨æˆ·çš„ Session IDã€‚

3ï¼‰å‰ç«¯ä¿å­˜ Cookieï¼šå‰ç«¯æ¥æ”¶åˆ°åç«¯çš„å“åº”åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æ ¹æ® Set-Cookie æŒ‡ä»¤ï¼Œå°† Session ID å­˜å‚¨åˆ°æµè§ˆå™¨çš„ Cookie ä¸­ï¼Œä¸è¯¥åŸŸåç»‘å®šã€‚

4ï¼‰å¸¦ Cookie çš„åç»­è¯·æ±‚ï¼šå½“å‰ç«¯å†æ¬¡å‘ç›¸åŒåŸŸåçš„æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚å¤´ä¸­é™„å¸¦ä¹‹å‰ä¿å­˜çš„ Cookieï¼Œå…¶ä¸­åŒ…å« Session IDã€‚

5ï¼‰åç«¯éªŒè¯ä¼šè¯ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä»è¯·æ±‚å¤´ä¸­æå– Session IDï¼Œæ‰¾åˆ°å¯¹åº”çš„ Session æ•°æ®ã€‚

6ï¼‰è·å–ä¼šè¯ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼šåç«¯é€šè¿‡è¯¥ Session è·å–ä¹‹å‰å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚ç™»å½•åã€æƒé™ç­‰ï¼‰ï¼Œä»è€Œè¯†åˆ«ç”¨æˆ·èº«ä»½å¹¶æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚



## å¦‚ä½•å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ§åˆ¶ï¼Ÿ

å¯ä»¥å°†æ¥å£åˆ†ä¸º 4 ç§æƒé™ï¼š

1. æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨
2. ç™»å½•ç”¨æˆ·æ‰èƒ½ä½¿ç”¨
3. æœªç™»å½•ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç™»å½•ç”¨æˆ·èƒ½è¿›è¡Œæ›´å¤šæ“ä½œï¼ˆæ¯”å¦‚ç™»å½•åæŸ¥çœ‹å…¨æ–‡ï¼‰
4. ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨

ä¼ ç»Ÿçš„æƒé™æ§åˆ¶æ–¹æ³•æ˜¯ï¼Œåœ¨æ¯ä¸ªæ¥å£å†…å•ç‹¬ç¼–å†™é€»è¾‘ï¼šå…ˆè·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶ååˆ¤æ–­ç”¨æˆ·çš„æƒé™æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚è¿™ç§æ–¹æ³•æœ€çµæ´»ï¼Œä½†æ˜¯ä¼šå†™å¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œè€Œä¸”å…¶ä»–å¼€å‘è€…æ— æ³•ä¸€çœ¼å¾—çŸ¥æ¥å£æ‰€éœ€è¦çš„æƒé™ã€‚

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡ **Spring AOP åˆ‡é¢ + è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£ **å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

ğŸ‘‡ å¦‚æœéœ€è¦æ›´å¤æ‚æ›´çµæ´»çš„æƒé™æ§åˆ¶ï¼Œå¯ä»¥å¼•å…¥ Shiro / Spring Security / Sa-Token ç­‰ä¸“é—¨çš„æƒé™ç®¡ç†æ¡†æ¶

è¿”å›å¤„ç†ç»“æœï¼ˆå¦‚é¡µé¢æˆ–æ•°æ®ï¼‰

---

# åç«¯å¼€å‘

æ•´ä¸ªé¡¹ç›®é‡‡ç”¨mvcæ¨¡å¼ï¼Œè¿™é‡Œæˆ‘åœ¨controllerå±‚å’Œmodelå±‚ä¹‹é—´åŠ ä¸€å±‚service



![](assets/DTbfb7LbwoI7U9xNDBQc67hMnfd.png)

## æ•°æ®æ¨¡å‹å¼€å‘

### å®ä½“ç±»

ç”Ÿæˆçš„ä»£ç ä¹Ÿè®¸ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œæ¯”å¦‚æ•°æ®åº“å®ä½“ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ›´æ”¹å…¶å­—æ®µé…ç½®ï¼ŒæŒ‡å®šä¸»é”®ç­–ç•¥å’Œé€»è¾‘åˆ é™¤ã€‚

1. idé»˜è®¤æ˜¯è¿ç»­ç”Ÿæˆçš„ï¼Œå®¹æ˜“è¢«çˆ¬è™«æŠ“å–ï¼Œæ‰€ä»¥æ›´æ¢ç­–ç•¥ä¸ºASSIGN_IDé›ªèŠ±ç®—æ³•ç”Ÿæˆã€‚
2. æ•°æ®åˆ é™¤æ—¶é»˜è®¤ä¸ºå½»åº•åˆ é™¤è®°å½•ï¼Œå¦‚æœå‡ºç°è¯¯åˆ ï¼Œå°†éš¾ä»¥æ¢å¤ï¼Œæ‰€ä»¥é‡‡ç”¨é€»è¾‘åˆ é™¤â€”â€”é€šè¿‡ä¿®æ”¹isDeleteå­—æ®µä¸º1è¡¨ç¤ºå·²å¤±æ•ˆçš„æ•°æ®ã€‚


```Java
@TableName(value ="user")
@Data
public class User implements Serializable {
    /**
     * idï¼ˆè¦æŒ‡å®šä¸»é”®ç­–ç•¥ï¼‰
     */
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;

    // ...
    
    /**
     * æ˜¯å¦åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
     */
    @TableLogic
    private Integer isDelete;
}
```

### æšä¸¾ç±»

å¯¹äºç”¨æˆ·è§’è‰²è¿™æ ·å€¼çš„æ•°é‡æœ‰é™çš„ã€å¯æšä¸¾çš„å­—æ®µï¼Œæœ€å¥½å®šä¹‰ä¸€ä¸ªæšä¸¾ç±»ï¼Œä¾¿äºåœ¨é¡¹ç›®ä¸­è·å–å€¼ã€å‡å°‘æšä¸¾å€¼è¾“å…¥é”™è¯¯çš„

æƒ…å†µã€‚åœ¨model.enumsåŒ…ä¸‹æ–°å»ºUserRoleEnum:


```TypeScript
@Getter
public enum UserRoleEnum {

    USER("ç”¨æˆ·", "user"),
    ADMIN("ç®¡ç†å‘˜", "admin");

    private final String text;

    private final String value;

    UserRoleEnum(String text, String value) {
        this.text = text;
        this.value = value;
    }

    /**
     * æ ¹æ® value è·å–æšä¸¾
     *
     * @param value æšä¸¾å€¼çš„value
     * @return æšä¸¾å€¼
     */
    public static UserRoleEnum getEnumByValue(String value) {
        if (ObjUtil.isEmpty(value)) {
            return null;
        }
        for (UserRoleEnum anEnum : UserRoleEnum.values()) {
            if (anEnum.value.equals(value)) {
                return anEnum;
            }
        }
        return null;
    }
}
```

å…¶ä¸­ï¼ŒgetEnumByValue æ˜¯é€šè¿‡ value æ‰¾åˆ°å…·ä½“çš„æšä¸¾å¯¹è±¡ã€‚

å¦‚æœæšä¸¾å€¼ç‰¹åˆ«å¤šï¼Œå¯ä»¥Mapç¼“å­˜æ‰€æœ‰æšä¸¾å€¼æ¥åŠ é€ŸæŸ¥æ‰¾ï¼Œè€Œä¸æ˜¯éå†åˆ—è¡¨ã€‚

---

ä¸‹é¢ä¾æ¬¡è¿›è¡Œå„åŠŸèƒ½æ¥å£çš„å¼€å‘ã€‚



## ç”¨æˆ·æ³¨å†Œ

### æ•°æ®æ¨¡å‹


```C++
@Data
public class UserRegisterRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;

    /**
     * ç¡®è®¤å¯†ç 
     */
    private String checkPassword;
}
```

åœ¨Javaæ¥å£å¼€å‘ä¸­ï¼Œä¸ºæ¯ä¸ªæ¥å£å®šä¹‰ä¸€ä¸ªä¸“é—¨çš„ç±»æ¥æ¥æ”¶è¯·æ±‚å‚æ•°ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œä¾¿äºå¯¹å‚è¿›è¡Œç»Ÿä¸€éªŒè¯å’Œæ‰©å±•ï¼ŒåŒæ—¶å‡å°‘æ¥å£æ–¹æ³•å‚æ•°è¿‡å¤šå¯¼è‡´çš„å¤æ‚æ€§ï¼Œæœ‰åŠ©äºåœ¨å¤æ‚åœºæ™¯ä¸‹æ›´æ¸…æ™°åœ°ç®¡ç†å’Œä¼ é€’æ•°æ®ã€‚

### æœåŠ¡å¼€å‘

åœ¨serviceåŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š


```JavaScript
/**
 * ç”¨æˆ·æ³¨å†Œ
 *
 * @param userAccount   ç”¨æˆ·è´¦æˆ·
 * @param userPassword  ç”¨æˆ·å¯†ç 
 * @param checkPassword æ ¡éªŒå¯†ç 
 * @return æ–°ç”¨æˆ· id
 */
long userRegister(String userAccount, String userPassword, String checkPassword);
```

åœ¨UserServicelmplä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›æ ¡éªŒæ¡ä»¶ï¼š


```Java
@Override
public long userRegister(String userAccount, String userPassword, String checkPassword) {
    // 1. æ ¡éªŒ
    if (StrUtil.hasBlank(userAccount, userPassword, checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
    }
    if (userAccount.length() < 4) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·è´¦å·è¿‡çŸ­");
    }
    if (userPassword.length() < 8 || checkPassword.length() < 8) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·å¯†ç è¿‡çŸ­");
    }
    if (!userPassword.equals(checkPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´");
    }
    // 2. æ£€æŸ¥æ˜¯å¦é‡å¤
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq("userAccount", userAccount);
    long count = this.baseMapper.selectCount(queryWrapper);
    if (count > 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é‡å¤");
    }
    // 3. åŠ å¯†
    String encryptPassword = getEncryptPassword(userPassword);
    // 4. æ’å…¥æ•°æ®
    User user = new User();
    user.setUserAccount(userAccount);
    user.setUserPassword(encryptPassword);
    user.setUserName("æ— å");
    user.setUserRole(UserRoleEnum.USER.getValue());
    boolean saveResult = this.save(user);
    if (!saveResult) {
        throw new BusinessException(ErrorCode.SYSTEM_ERROR, "æ³¨å†Œå¤±è´¥ï¼Œæ•°æ®åº“é”™è¯¯");
    }
    return user.getId();
}
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†ç”¨æˆ·å¯†ç åŠ å¯†åè¿›è¡Œå­˜å‚¨ã€‚å¯ä»¥å°è£…ä¸€ä¸ªæ–¹æ³•ï¼Œä¾¿äºåç»­å¤ç”¨ï¼š


```TypeScript
@Override
public String getEncryptPassword(String userPassword) {
    // ç›å€¼ï¼Œæ··æ·†å¯†ç 
    final String SALT = "chengfu";
    return DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
}
```

### æ¥å£å¼€å‘

åœ¨controlleråŒ…ä¸­æ–°å»ºUserControllerï¼Œæ–°å¢ç”¨æˆ·æ³¨å†Œæ¥å£ï¼š


```Java
@RestController
@RequestMapping("/user")
public class UserController {

    @Resource
    private UserService userService;

    /**
     * ç”¨æˆ·æ³¨å†Œ
     */
    @PostMapping("/register")
    public BaseResponse<Long> userRegister(@RequestBody UserRegisterRequest userRegisterRequest) {
        ThrowUtils.throwIf(userRegisterRequest == null, ErrorCode.PARAMS_ERROR);
        String userAccount = userRegisterRequest.getUserAccount();
        String userPassword = userRegisterRequest.getUserPassword();
        String checkPassword = userRegisterRequest.getCheckPassword();
        long result = userService.userRegister(userAccount, userPassword, checkPassword);
        return ResultUtils.success(result);
    }
}
```

## ç”¨æˆ·ç™»å½•

### æ•°æ®æ¨¡å‹


```Java
@Data
public class UserLoginRequest implements Serializable {

    private static final long serialVersionUID = 3191241716373120793L;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * å¯†ç 
     */
    private String userPassword;
}
```

### æœåŠ¡å¼€å‘


```Java
/**
 * ç”¨æˆ·ç™»å½•
 *
 * @param userAccount  ç”¨æˆ·è´¦æˆ·
 * @param userPassword ç”¨æˆ·å¯†ç 
 * @param request
 * @return è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯
 */
LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request);
```

åœ¨UserServicelmplä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ³¨æ„å¤šè¡¥å……ä¸€äº›æ ¡éªŒæ¡ä»¶ï¼Œåœ¨ç”¨æˆ·ç™»å½•æˆåŠŸåï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨å½“å‰çš„Sessionä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š


```TypeScript
@Override
public LoginUserVO userLogin(String userAccount, String userPassword, HttpServletRequest request) {
    // 1. æ ¡éªŒ
    if (StrUtil.hasBlank(userAccount, userPassword)) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å‚æ•°ä¸ºç©º");
    }
    if (userAccount.length() < 4) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è´¦å·é”™è¯¯");
    }
    if (userPassword.length() < 8) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "å¯†ç é”™è¯¯");
    }
    // 2. åŠ å¯†
    String encryptPassword = getEncryptPassword(userPassword);
    // æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å­˜åœ¨
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq("userAccount", userAccount);
    queryWrapper.eq("userPassword", encryptPassword);
    User user = this.baseMapper.selectOne(queryWrapper);
    // ç”¨æˆ·ä¸å­˜åœ¨
    if (user == null) {
        log.info("user login failed, userAccount cannot match userPassword");
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯");
    }
    // 3. è®°å½•ç”¨æˆ·çš„ç™»å½•æ€
    request.getSession().setAttribute(USER_LOGIN_STATE, user);
    return this.getLoginUserVO(user);
}
```

æ³¨æ„ï¼Œç”±äºæ³¨å†Œç”¨æˆ·æ—¶å­˜å…¥æ•°æ®åº“çš„å¯†ç æ˜¯åŠ å¯†åçš„ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä¹Ÿè¦å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŒæ ·ç®—æ³•çš„åŠ å¯†ï¼Œæ‰èƒ½è·Ÿæ•°æ®åº“çš„ä¿¡æ¯å¯¹åº”ä¸Šã€‚

å¯ä»¥æŠŠä¸Šè¿°çš„ Sessionç†è§£ä¸ºä¸€ä¸ªMapï¼Œå¯ä»¥ç»™ Mapè®¾ç½® key å’Œ valueï¼Œæ¯ä¸ªä¸åŒçš„ SessionID å¯¹åº”çš„ Sessionå­˜å‚¨éƒ½æ˜¯ä¸åŒçš„ï¼Œä¸ç”¨æ‹…å¿ƒä¼šæ±¡æŸ“ã€‚æ‰€ä»¥ä¸Šè¿°ä»£ç ä¸­ï¼Œç»™Sessionè®¾ç½®äº†å›ºå®šçš„key(USER_LOGIN_STATE)ï¼Œå¯ä»¥å°†è¿™ä¸ªkeyå€¼æå–ä¸ºå¸¸é‡ï¼Œä¾¿äºåç»­è·å–ã€‚

åœ¨constantåŒ…ä¸‹æ–°å»ºUserConstant ç±»ï¼Œç»Ÿä¸€å£°æ˜ç”¨æˆ·ç›¸å…³çš„å¸¸é‡ï¼š


```Java
public interface UserConstant {

    /**
     * ç”¨æˆ·ç™»å½•æ€é”®
     */
    String USER_LOGIN_STATE = "user_login";

    //  region æƒé™

    /**
     * é»˜è®¤è§’è‰²
     */
    String DEFAULT_ROLE = "user";

    /**
     * ç®¡ç†å‘˜è§’è‰²
     */
    String ADMIN_ROLE = "admin";
    
    // endregion
}
```

### æ¥å£å¼€å‘


```Java
@PostMapping("/login")
public BaseResponse<LoginUserVO> userLogin(@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request) {
    ThrowUtils.throwIf(userLoginRequest == null, ErrorCode.PARAMS_ERROR);
    String userAccount = userLoginRequest.getUserAccount();
    String userPassword = userLoginRequest.getUserPassword();
    LoginUserVO loginUserVO = userService.userLogin(userAccount, userPassword, request);
    return ResultUtils.success(loginUserVO);
}
```

## è·å–å½“å‰ç”¨æˆ·

å¯ä»¥ä»requestè¯·æ±‚å¯¹è±¡å¯¹åº”çš„Sessionä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

### æœåŠ¡å¼€å‘

åœ¨serviceåŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜ï¼š


```Java
/**
 * è·å–å½“å‰ç™»å½•ç”¨æˆ·
 *
 * @param request
 * @return
 */
User getLoginUser(HttpServletRequest request);
```

åœ¨UserServicelmplä¸­å¢åŠ å®ç°ä»£ç ï¼Œæ­¤å¤„ä¸ºäº†ä¿è¯è·å–åˆ°çš„æ•°æ®å§‹ç»ˆæ˜¯æœ€æ–°çš„ï¼Œå…ˆä»Sessionä¸­è·å–ç™»å½•ç”¨æˆ·çš„idï¼Œç„¶åä»æ•°æ®åº“ä¸­æŸ¥è¯¢æœ€æ–°çš„ç»“æœã€‚ä»£ç å¦‚ä¸‹ï¼š


```Java
@Override
public User getLoginUser(HttpServletRequest request) {
    // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
    Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
    User currentUser = (User) userObj;
    if (currentUser == null || currentUser.getId() == null) {
        throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
    }
    // ä»æ•°æ®åº“æŸ¥è¯¢ï¼ˆè¿½æ±‚æ€§èƒ½çš„è¯å¯ä»¥æ³¨é‡Šï¼Œç›´æ¥è¿”å›ä¸Šè¿°ç»“æœï¼‰
    long userId = currentUser.getId();
    currentUser = this.getById(userId);
    if (currentUser == null) {
        throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
    }
    return currentUser;
}
```

### æ¥å£å¼€å‘


```Java
@GetMapping("/get/login")
public BaseResponse<LoginUserVO> getLoginUser(HttpServletRequest request) {
    User loginUser = userService.getLoginUser(request);
    return ResultUtils.success(userService.getLoginUserVO(loginUser));
}
```

æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ç›´æ¥å°†æ•°æ®åº“æŸ¥åˆ°çš„æ‰€æœ‰ä¿¡æ¯éƒ½è¿”å›ç»™äº†å‰ç«¯ï¼ˆåŒ…æ‹¬å¯†ç ï¼‰ï¼Œå¯èƒ½å­˜åœ¨ä¿¡æ¯æ³„éœ²çš„å®‰å…¨é£é™©ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è¿”å›ç»“æœè¿›è¡Œè„±æ•å¤„ç†ã€‚

### æ•°æ®è„±æ•

åœ¨model.voåŒ…ä¸‹æ–°å»ºLoginUserVoç±»ï¼Œè¡¨ç¤ºè„±æ•åçš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼š


```C++
@Data
public class LoginUserVO implements Serializable {

    /**
     * ç”¨æˆ· id
     */
    private Long id;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    private Date updateTime;

    private static final long serialVersionUID = 1L;
}
```

åœ¨UserServiceä¸­æ–°å¢è·å–è„±æ•åçš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯æ–¹æ³•ï¼š


```Java
/**
 * è·å–è„±æ•çš„å·²ç™»å½•ç”¨æˆ·ä¿¡æ¯
 *
 * @return
 */
LoginUserVO getLoginUserVO(User user);
```

ç¼–å†™æ–¹æ³•å¯¹åº”çš„å®ç°ç±»ï¼Œå…¶å®å°±æ˜¯å°†Userç±»çš„å±æ€§å¤åˆ¶åˆ°LoginUserVOä¸­ï¼Œä¸å­˜åœ¨çš„å­—æ®µå°±è¢«è¿‡æ»¤æ‰äº†ï¼š


```SQL
@Override
public LoginUserVO getLoginUserVO(User user) {
    if (user == null) {
        return null;
    }
    LoginUserVO loginUserVO = new LoginUserVO();
    BeanUtils.copyProperties(user, loginUserVO);
    return loginUserVO;
}
```

ä¿®æ”¹Controller çš„ getLoginUseræ¥å£ï¼Œæ”¹ä¸ºè¿”å›è„±æ•åçš„ç”¨æˆ·ä¿¡æ¯ï¼š


```Java
@GetMapping("/get/login")
public BaseResponse<LoginUserVO> getLoginUser(HttpServletRequest request) {
    User user = userService.getLoginUser(request);
    return ResultUtils.success(userService.getLoginUserVO(user));
}
```

## ç”¨æˆ·æ³¨é”€

å¯ä»¥ä»requestè¯·æ±‚å¯¹è±¡å¯¹åº”çš„Sessionä¸­ç›´æ¥è·å–åˆ°ä¹‹å‰ä¿å­˜çš„ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥å®Œæˆæ³¨é”€ï¼Œæ— éœ€å…¶ä»–è¯·æ±‚å‚æ•°ã€‚

### æœåŠ¡å¼€å‘

åœ¨serviceåŒ…çš„ UserService ä¸­å¢åŠ æ–¹æ³•å£°æ˜:


```Java
/**
 * ç”¨æˆ·æ³¨é”€
 *
 * @param request
 * @return
 */
boolean userLogout(HttpServletRequest request);
```

åœ¨UserServicelmplä¸­å¢åŠ å®ç°ä»£ç ï¼Œä»Sessionä¸­ç§»é™¤æ‰å½“å‰ç”¨æˆ·çš„ç™»å½•æ€å³å¯ï¼š


```TypeScript
@Override
public boolean userLogout(HttpServletRequest request) {
    // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
    Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
    if (userObj == null) {
        throw new BusinessException(ErrorCode.OPERATION_ERROR, "æœªç™»å½•");
    }
    // ç§»é™¤ç™»å½•æ€
    request.getSession().removeAttribute(USER_LOGIN_STATE);
    return true;
}
```

### æ¥å£å¼€å‘

åœ¨UserControllerä¸­æ–°å¢ç”¨æˆ·æ³¨é”€æ¥å£:


```TypeScript
@PostMapping("/logout")
public BaseResponse<Boolean> userLogout(HttpServletRequest request) {
    ThrowUtils.throwIf(request == null, ErrorCode.PARAMS_ERROR);
    boolean result = userService.userLogout(request);
    return ResultUtils.success(result);
}
```

## ç”¨æˆ·æƒé™æ§åˆ¶

æƒé™æ ¡éªŒå…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒé€šç”¨çš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸€èˆ¬ä¼šé€šè¿‡**SpringAOPåˆ‡é¢+è‡ªå®šä¹‰æƒé™æ ¡éªŒæ³¨è§£** å®ç°ç»Ÿä¸€çš„æ¥å£æ‹¦æˆªå’Œæƒé™æ ¡éªŒï¼›å¦‚æœæœ‰ç‰¹æ®Šçš„æƒé™æ ¡éªŒé€»è¾‘ï¼Œå†å•ç‹¬åœ¨æ¥å£ä¸­ç¼–ç ã€‚

### æƒé™æ ¡éªŒæ³¨è§£

é¦–å…ˆç¼–å†™æƒé™æ ¡éªŒæ³¨è§£ï¼Œæ”¾åˆ°annotationåŒ…ä¸‹:


```Java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface AuthCheck {

    /**
     * å¿…é¡»æœ‰æŸä¸ªè§’è‰²
     */
    String mustRole() default "";
}
```

### æƒé™æ ¡éªŒåˆ‡é¢

ç¼–å†™æƒé™æ ¡éªŒAOPï¼Œé‡‡ç”¨ç¯ç»•é€šçŸ¥ï¼Œåœ¨**æ‰“ä¸Šè¯¥æ³¨è§£çš„æ–¹æ³•**æ‰§è¡Œå‰åè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ¯”å¦‚æ ¡éªŒæƒé™ã€‚

ä»£ç å¦‚ä¸‹ï¼Œæ”¾åˆ°aopåŒ…ä¸‹ï¼š


```Java
@Aspect
@Component
public class AuthInterceptor {

    @Resource
    private UserService userService;

    /**
     * æ‰§è¡Œæ‹¦æˆª
     *
     * @param joinPoint åˆ‡å…¥ç‚¹
     * @param authCheck æƒé™æ ¡éªŒæ³¨è§£
     */
    @Around("@annotation(authCheck)")
    public Object doInterceptor(ProceedingJoinPoint joinPoint, AuthCheck authCheck) throws Throwable {
        String mustRole = authCheck.mustRole();
        RequestAttributes requestAttributes = RequestContextHolder.currentRequestAttributes();
        HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();
        // å½“å‰ç™»å½•ç”¨æˆ·
        User loginUser = userService.getLoginUser(request);
        UserRoleEnum mustRoleEnum = UserRoleEnum.getEnumByValue(mustRole);
        // ä¸éœ€è¦æƒé™ï¼Œæ”¾è¡Œ
        if (mustRoleEnum == null) {
            return joinPoint.proceed();
        }
        // ä»¥ä¸‹ä¸ºï¼šå¿…é¡»æœ‰è¯¥æƒé™æ‰é€šè¿‡
        // è·å–å½“å‰ç”¨æˆ·å…·æœ‰çš„æƒé™
        UserRoleEnum userRoleEnum = UserRoleEnum.getEnumByValue(loginUser.getUserRole());
        // æ²¡æœ‰æƒé™ï¼Œæ‹’ç»
        if (userRoleEnum == null) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // è¦æ±‚å¿…é¡»æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä½†ç”¨æˆ·æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼Œæ‹’ç»
        if (UserRoleEnum.ADMIN.equals(mustRoleEnum) && !UserRoleEnum.ADMIN.equals(userRoleEnum)) {
            throw new BusinessException(ErrorCode.NO_AUTH_ERROR);
        }
        // é€šè¿‡æƒé™æ ¡éªŒï¼Œæ”¾è¡Œ
        return joinPoint.proceed();
    }
}
```

### ä½¿ç”¨æ³¨è§£

åªè¦ç»™æ–¹æ³•æ·»åŠ äº†@AuthCheckæ³¨è§£ï¼Œå°±å¿…é¡»è¦ç™»å½•ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

å¯ä»¥è®¾ç½®mustRoleä¸ºç®¡ç†å‘˜ï¼Œè¿™æ ·ä»…ç®¡ç†å‘˜æ‰èƒ½ä½¿ç”¨è¯¥æ¥å£ï¼š


```Java
AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
```

å¯¹äºä¸éœ€è¦ç™»å½•å°±èƒ½ä½¿ç”¨çš„æ¥å£ï¼Œä¸éœ€è¦ä½¿ç”¨è¯¥æ³¨è§£ã€‚

## ç”¨æˆ·ç®¡ç†

ç”¨æˆ·ç®¡ç†åŠŸèƒ½å…·ä½“å¯ä»¥æ‹†åˆ†ä¸ºï¼š

* ã€ç®¡ç†å‘˜ã€‘åˆ›å»ºç”¨æˆ·
* ã€ç®¡ç†å‘˜ã€‘æ ¹æ®idåˆ é™¤ç”¨æˆ·
* ã€ç®¡ç†å‘˜ã€‘æ›´æ–°ç”¨æˆ·
* ã€ç®¡ç†å‘˜ã€‘åˆ†é¡µè·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆéœ€è¦è„±æ•ï¼‰
* ã€ç®¡ç†å‘˜ã€‘æ ¹æ®idè·å–ç”¨æˆ·ï¼ˆæœªè„±æ•ï¼‰
* æ ¹æ® idè·å–ç”¨æˆ·(è„±æ•)

### æ•°æ®æ¨¡å‹

1. æ¯ä¸ªæ“ä½œéƒ½éœ€è¦æä¾›ä¸€ä¸ªè¯·æ±‚ç±»ï¼Œéƒ½æ”¾åœ¨dto.useråŒ…ä¸‹ã€‚

ç”¨æˆ·åˆ›å»ºè¯·æ±‚


```C++
@Data
public class UserAddRequest implements Serializable {

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²: user, admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```

ç”¨æˆ·æ›´æ–°è¯·æ±‚


```C++
@Data
public class UserUpdateRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```

ç”¨æˆ·æŸ¥è¯¢è¯·æ±‚


```C++
@EqualsAndHashCode(callSuper = true)
@Data
public class UserQueryRequest extends PageRequest implements Serializable {

    /**
     * id
     */
    private Long id;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban
     */
    private String userRole;

    private static final long serialVersionUID = 1L;
}
```

1. ç”±äºè¦æä¾›è·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ï¼Œéœ€è¦å’Œè·å–å½“å‰ç™»å½•ç”¨æˆ·æ¥å£ä¸€æ ·å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè„±æ•ã€‚

åœ¨model.voåŒ…ä¸‹æ–°å»ºUserVOï¼Œè¡¨ç¤ºè„±æ•åçš„ç”¨æˆ·ï¼š


```C++
@Data
public class UserVO implements Serializable {

    /**
     * id
     */
    private Long id;
    
    /**
     * è´¦å·
     */
    private String userAccount;

    /**
     * ç”¨æˆ·æ˜µç§°
     */
    private String userName;

    /**
     * ç”¨æˆ·å¤´åƒ
     */
    private String userAvatar;

    /**
     * ç”¨æˆ·ç®€ä»‹
     */
    private String userProfile;

    /**
     * ç”¨æˆ·è§’è‰²ï¼šuser/admin
     */
    private String userRole;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private Date createTime;

    private static final long serialVersionUID = 1L;
}
```

### æœåŠ¡å¼€å‘

1. åœ¨UserServiceä¸­ç¼–å†™è·å–è„±æ•åçš„å•ä¸ªç”¨æˆ·ä¿¡æ¯ã€è·å–è„±æ•åçš„ç”¨æˆ·åˆ—è¡¨æ–¹æ³•ï¼š


```SQL
@Override
public UserVO getUserVO(User user) {
    if (user == null) {
        return null;
    }
    UserVO userVO = new UserVO();
    BeanUtils.copyProperties(user, userVO);
    return userVO;
}

@Override
public List<UserVO> getUserVOList(List<User> userList) {
    if (CollUtil.isEmpty(userList)) {
        return new ArrayList<>();
    }
    return userList.stream().map(this::getUserVO).collect(Collectors.toList());
}
```

1. é™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œå¯¹äºåˆ†é¡µæŸ¥è¯¢æ¥å£ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å‚æ•°æ¥æ„é€ SQLæŸ¥è¯¢ã€‚ç”±äºä½¿ç”¨MyBatisPlusæ¡†æ¶ï¼Œä¸ç”¨è‡ªå·±æ‹¼æ¥SQLäº†ï¼Œè€Œæ˜¯é€šè¿‡æ„é€ QueryWrapper å¯¹è±¡æ¥ç”ŸæˆSQLæŸ¥è¯¢ã€‚

å¯ä»¥åœ¨UserServiceä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œä¸“é—¨ç”¨äºå°†æŸ¥è¯¢è¯·æ±‚è½¬ä¸ºQueryWrapper å¯¹è±¡ï¼š


```Java
@Override
public QueryWrapper<User> getQueryWrapper(UserQueryRequest userQueryRequest) {
    if (userQueryRequest == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR, "è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
    Long id = userQueryRequest.getId();
    String userAccount = userQueryRequest.getUserAccount();
    String userName = userQueryRequest.getUserName();
    String userProfile = userQueryRequest.getUserProfile();
    String userRole = userQueryRequest.getUserRole();
    String sortField = userQueryRequest.getSortField();
    String sortOrder = userQueryRequest.getSortOrder();
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq(ObjUtil.isNotNull(id), "id", id);
    queryWrapper.eq(StrUtil.isNotBlank(userRole), "userRole", userRole);
    queryWrapper.like(StrUtil.isNotBlank(userAccount), "userAccount", userAccount);
    queryWrapper.like(StrUtil.isNotBlank(userName), "userName", userName);
    queryWrapper.like(StrUtil.isNotBlank(userProfile), "userProfile", userProfile);
    queryWrapper.orderBy(StrUtil.isNotEmpty(sortField), sortOrder.equals("ascend"), sortField);
    return queryWrapper;
}
```

### æ¥å£å¼€å‘

ä¸Šè¿°åŠŸèƒ½å…¶å®éƒ½æ˜¯æ ·æ¿ä»£ç ï¼Œä¿—ç§°â€œå¢åˆ æ”¹æŸ¥â€ã€‚

ä»£ç å®ç°æ¯”è¾ƒç®€å•ï¼Œæ³¨æ„æ·»åŠ å¯¹åº”çš„æƒé™æ³¨è§£ã€åšå¥½å‚æ•°æ ¡éªŒå³å¯ï¼š


```Java
/**
 * åˆ›å»ºç”¨æˆ·
 */
@PostMapping("/add")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Long> addUser(@RequestBody UserAddRequest userAddRequest) {
    ThrowUtils.throwIf(userAddRequest == null, ErrorCode.PARAMS_ERROR);
    User user = new User();
    BeanUtils.copyProperties(userAddRequest, user);
    // é»˜è®¤å¯†ç  12345678
    final String DEFAULT_PASSWORD = "12345678";
    String encryptPassword = userService.getEncryptPassword(DEFAULT_PASSWORD);
    user.setUserPassword(encryptPassword);
    boolean result = userService.save(user);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(user.getId());
}

/**
 * æ ¹æ® id è·å–ç”¨æˆ·ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
 */
@GetMapping("/get")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<User> getUserById(long id) {
    ThrowUtils.throwIf(id <= 0, ErrorCode.PARAMS_ERROR);
    User user = userService.getById(id);
    ThrowUtils.throwIf(user == null, ErrorCode.NOT_FOUND_ERROR);
    return ResultUtils.success(user);
}

/**
 * æ ¹æ® id è·å–åŒ…è£…ç±»
 */
@GetMapping("/get/vo")
public BaseResponse<UserVO> getUserVOById(long id) {
    BaseResponse<User> response = getUserById(id);
    User user = response.getData();
    return ResultUtils.success(userService.getUserVO(user));
}

/**
 * åˆ é™¤ç”¨æˆ·
 */
@PostMapping("/delete")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> deleteUser(@RequestBody DeleteRequest deleteRequest) {
    if (deleteRequest == null || deleteRequest.getId() <= 0) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    boolean b = userService.removeById(deleteRequest.getId());
    return ResultUtils.success(b);
}

/**
 * æ›´æ–°ç”¨æˆ·
 */
@PostMapping("/update")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Boolean> updateUser(@RequestBody UserUpdateRequest userUpdateRequest) {
    if (userUpdateRequest == null || userUpdateRequest.getId() == null) {
        throw new BusinessException(ErrorCode.PARAMS_ERROR);
    }
    User user = new User();
    BeanUtils.copyProperties(userUpdateRequest, user);
    boolean result = userService.updateById(user);
    ThrowUtils.throwIf(!result, ErrorCode.OPERATION_ERROR);
    return ResultUtils.success(true);
}

/**
 * åˆ†é¡µè·å–ç”¨æˆ·å°è£…åˆ—è¡¨ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
 *
 * @param userQueryRequest æŸ¥è¯¢è¯·æ±‚å‚æ•°
 */
@PostMapping("/list/page/vo")
@AuthCheck(mustRole = UserConstant.ADMIN_ROLE)
public BaseResponse<Page<UserVO>> listUserVOByPage(@RequestBody UserQueryRequest userQueryRequest) {
    ThrowUtils.throwIf(userQueryRequest == null, ErrorCode.PARAMS_ERROR);
    long current = userQueryRequest.getCurrent();
    long pageSize = userQueryRequest.getPageSize();
    Page<User> userPage = userService.page(new Page<>(current, pageSize),
            userService.getQueryWrapper(userQueryRequest));
    Page<UserVO> userVOPage = new Page<>(current, pageSize, userPage.getTotal());
    List<UserVO> userVOList = userService.getUserVOList(userPage.getRecords());
    userVOPage.setRecords(userVOList);
    return ResultUtils.success(userVOPage);
}
```

### åˆ†é¡µåŠŸèƒ½ä¿®å¤

**å¿…é¡»è¦æ³¨æ„ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨çš„v3.5.9ç‰ˆæœ¬å¼•å…¥åˆ†é¡µæ’ä»¶çš„æ–¹å¼å’Œä¹‹å‰ä¸åŒï¼3.5.9ç‰ˆæœ¬åéœ€è¦ç‹¬ç«‹å®‰è£…åˆ†é¡µæ’ä»¶ä¾èµ–ï¼ï¼ï¼**

å¼•å…¥æ’ä»¶ä¾èµ–


```XML
<!-- MyBatis Plus åˆ†é¡µæ’ä»¶ -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-jsqlparser-4.9</artifactId>
</dependency>

```

å…‰å¼•å…¥è¿™ä¸€æ¡ï¼Œå¤§æ¦‚ç‡æ˜¯æ— æ³•æˆåŠŸ


```XML
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>${spring-boot.version}</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
        <dependency>
            <groupId>com.baomidou</groupId>
            <artifactId>mybatis-plus-bom</artifactId>
            <version>3.5.9</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

ä¾èµ–ä¸‹è½½æˆåŠŸåï¼Œåœ¨configåŒ…ä¸‹æ–°å»ºMyBatisPlusæ‹¦æˆªå™¨é…ç½®ï¼Œæ·»åŠ åˆ†é¡µæ’ä»¶ï¼š


```Java
@Configuration
@MapperScan("com.yupi.yupicturebackend.mapper")
public class MyBatisPlusConfig {

    /**
     * æ‹¦æˆªå™¨é…ç½®
     *
     * @return {@link MybatisPlusInterceptor}
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        // åˆ†é¡µæ’ä»¶
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```

### æ•°æ®ç²¾åº¦ä¿®å¤

ä½†æ˜¯ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œå¦‚æœä½ æ‰“å¼€F12æ§åˆ¶å°ï¼Œåˆ©ç”¨é¢„è§ˆæ¥æŸ¥çœ‹å“åº”æ•°æ®ï¼Œå°±ä¼šå‘ç°å¦ä¸€ä¸ªé—®é¢˜ï¼šidçš„æœ€åä¸¤ä½å¥½åƒéƒ½å˜æˆ0äº†ï¼

è¿™æ˜¯ç”±äºå‰ç«¯JSçš„ç²¾åº¦èŒƒå›´æœ‰é™ï¼Œæˆ‘ä»¬åç«¯è¿”å›çš„idèŒƒå›´è¿‡å¤§ï¼Œå¯¼è‡´å‰ç«¯ç²¾åº¦ä¸¢å¤±ï¼Œä¼šå½±å“å‰ç«¯é¡µé¢è·å–åˆ°çš„æ•°æ®ç»“æœã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨åç«¯configåŒ…ä¸‹æ–°å»ºä¸€ä¸ªå…¨å±€JSONé…ç½®ï¼Œå°†æ•´ä¸ªåç«¯SpringMVCæ¥å£è¿”å›å€¼çš„é•¿æ•´å‹æ•°

å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œè¿”å›ï¼Œä»è€Œé›†ä¸­è§£å†³é—®é¢˜ã€‚


```Java
/**
 * Spring MVC Json é…ç½®
 */
@JsonComponent
public class JsonConfig {

    /**
     * æ·»åŠ  Long è½¬ json ç²¾åº¦ä¸¢å¤±çš„é…ç½®
     */
    @Bean
    public ObjectMapper jacksonObjectMapper(Jackson2ObjectMapperBuilder builder) {
        ObjectMapper objectMapper = builder.createXmlMapper(false).build();
        SimpleModule module = new SimpleModule();
        module.addSerializer(Long.class, ToStringSerializer.instance);
        module.addSerializer(Long.TYPE, ToStringSerializer.instance);
        objectMapper.registerModule(module);
        return objectMapper;
    }
}
```

# å‰ç«¯å¼€å‘

## ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½

### é¡µé¢ä»£ç 


```HTML
<template>
  <div class="center">
    <h1>Sign in/ Sign up</h1>
    <div class="logon">
      <div :class="overlaylong">
        <div class="overlaylong-Signup" v-if="disfiex == 1">
          <h2 class="overlaylongH2">Registered Account</h2>
          <a-form
            style="max-width: 700px; margin: 0 auto"
            label-align="left"
            :label-col="{ span: 7 }"
            :wrapper-col="{ span: 20 }"
            :model="form2"
            @finish="handleRegister"
          >
            <a-form-item
              name="userAccount"
              label="è´¦å·"
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥è´¦å·' },
                { min: 4, message: 'è´¦å·ä¸å°‘äº 4 ä½' },
                { max: 20, message: 'è´¦å·ä¸è¶…è¿‡ 20 ä½' },
              ]"
            >
              <a-input
                style="width: 200px"
                v-model:value="form2.userAccount"
                placeholder="è¯·è¾“å…¥è´¦å·"
              />
            </a-form-item>
            <a-form-item
              name="userPassword"
              label="å¯†ç "
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
                { min: 8, message: 'å¯†ç ä¸å°‘äº 8 ä½' },
                { max: 20, message: 'å¯†ç ä¸è¶…è¿‡ 20 ä½' },
                {
                  pattern: passwordPattern,
                  message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·',
                },
              ]"
            >
              <a-input-password
                style="width: 200px"
                v-model:value="form2.userPassword"
                placeholder="è¯·è¾“å…¥å¯†ç "
              />
            </a-form-item>
            <a-form-item
              name="checkPassword"
              label="ç¡®è®¤å¯†ç "
              :rules="[
                { required: true, message: 'è¯·å†æ¬¡è¾“å…¥å¯†ç ' },
                { min: 8, message: 'å¯†ç ä¸å°‘äº 8 ä½' },
                { max: 20, message: 'å¯†ç ä¸è¶…è¿‡ 20 ä½' },
                {
                  pattern: passwordPattern,
                  message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·',
                },
              ]"
            >
              <a-input-password
                style="width: 200px"
                v-model:value="form2.checkPassword"
                placeholder="è¯·è¾“å…¥ç¡®è®¤å¯†ç "
              />
            </a-form-item>
            <a-form-item :wrapper-col="{ offset: 4, span: 20 }">
              <a-button type="primary" html-type="submit" class="inupbutton">æ³¨å†Œ</a-button>
            </a-form-item>
          </a-form>
        </div>
      </div>
      <div :class="overlaytitle">
        <div class="overlaytitle-Signup" v-if="disfiex == 1">
          <h2 class="overlaytitleH2">Welcome Back!</h2>
          <p class="overlaytitleP">
            To keep connected with us please login with your personal info
          </p>
          <div class="buttongohs" @click="Signup">Sign in</div>
        </div>
      </div>
    </div>
  </div>
</template>
```

### JSä»£ç 


```JavaScript
import { reactive } from 'vue'
import { useLoginUserStore } from '@/stores/useLoginUserStore'
import { useRouter } from 'vue-router'
import { userRegisterUsingPost } from '@/api/userController'
import { message } from 'ant-design-vue'

// å¯†ç å¼ºåº¦éªŒè¯è§„åˆ™ï¼šè¦æ±‚è‡³å°‘åŒ…å«3ç§å­—ç¬¦ç±»å‹ï¼ˆå¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šç¬¦å·ï¼‰
const passwordPattern = /^((?=.*[a-z])(?=.*[A-Z])(?=.*\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9])|(?=.*[a-z])(?=.*\d)(?=.*[^A-Za-z0-9])|(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9])).*$/

// æ³¨å†Œè¡¨å•æ•°æ®æ¨¡å‹
const form2 = reactive({
  userAccount: '',
  userPassword: '',
  checkPassword: '',
})

// æ³¨å†Œå¤„ç†å‡½æ•°
const handleRegister = async () => {
  // éªŒè¯ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
  if (form2.checkPassword !== form2.userPassword) {
    message.error('äºŒæ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´')
    return
  }

  try {
    // è°ƒç”¨åç«¯æ³¨å†ŒAPI
    const res = await userRegisterUsingPost(form2)
    if (res.data.code === 0 && res.data.data) {
      message.success('æ³¨å†ŒæˆåŠŸ')
      // æ³¨å†ŒæˆåŠŸåé‡ç½®è¡¨å•
      Object.assign(form2, {
        userAccount: '',
        userPassword: '',
        checkPassword: '',
      })
      // åˆ‡æ¢åˆ°ç™»å½•ç•Œé¢
      disfiex.value = 0
    } else {
      message.error('æ³¨å†Œå¤±è´¥: ' + (res.data.description || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Registration error:', error)
  }
}

// ç•Œé¢åˆ‡æ¢é€»è¾‘
const disfiex = ref(0)
const Signin = () => {
  // åˆ‡æ¢åˆ°ç™»å½•ç•Œé¢çš„åŠ¨ç”»æ•ˆæœ
  overlaylong.value = 'overlaylongleft'
  overlaytitle.value = 'overlaytitleright'
  disfiex.value = 1
}

const Signup = () => {
  // åˆ‡æ¢åˆ°æ³¨å†Œç•Œé¢çš„åŠ¨ç”»æ•ˆæœ
  overlaylong.value = 'overlaylongright'
  overlaytitle.value = 'overlaytitleleft'
  disfiex.value = 0
}
```

### æŠ€æœ¯è¯¦è§£

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹

* **è¡¨å•éªŒè¯æœºåˆ¶**ï¼šå®ç°è´¦å·é•¿åº¦æ ¡éªŒï¼ˆ4-20ä½ï¼‰å’Œå¯†ç å¼ºåº¦æ ¡éªŒï¼ˆ8-20ä½ï¼Œè‡³å°‘åŒ…å«3ç§å­—ç¬¦ç±»å‹ï¼‰ã€‚  
* **åŒå¯†ç ä¸€è‡´æ€§éªŒè¯**ï¼šæ³¨å†Œæ—¶è¦æ±‚ä¸¤æ¬¡è¾“å…¥å¯†ç ä¸€è‡´ï¼Œé¿å…ç”¨æˆ·è¾“å…¥é”™è¯¯ã€‚  
* **åç«¯APIé›†æˆ**ï¼šé€šè¿‡`userRegisterUsingPost`æ¥å£æäº¤æ³¨å†Œæ•°æ®ï¼Œå¹¶å¤„ç†å“åº”ç»“æœã€‚  
* **ç•Œé¢äº¤äº’åˆ‡æ¢**ï¼šæ³¨å†ŒæˆåŠŸåè‡ªåŠ¨åˆ‡æ¢åˆ°ç™»å½•ç•Œé¢ï¼Œå¹¶é‡ç½®è¡¨å•æ•°æ®ã€‚  

#### æŠ€æœ¯è¦ç‚¹

* **å¯†ç å¼ºåº¦è§„åˆ™è®¾è®¡**ï¼šæ­£åˆ™è¡¨è¾¾å¼`passwordPattern`è¦æ±‚å¯†ç è‡³å°‘åŒ…å«ä»¥ä¸‹ç»„åˆä¸­çš„ä¸€ç§ï¼š  
  * å°å†™å­—æ¯+å¤§å†™å­—æ¯+æ•°å­—  
  * å°å†™å­—æ¯+å¤§å†™å­—æ¯+ç‰¹æ®Šç¬¦å·  
  * å°å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·  
  * å¤§å†™å­—æ¯+æ•°å­—+ç‰¹æ®Šç¬¦å·  
* **å“åº”å¼è¡¨å•å¤„ç†**ï¼šä½¿ç”¨Ant Design Vueçš„`a-form`ç»„ä»¶ï¼Œé€šè¿‡`rules`å±æ€§å®šä¹‰å®æ—¶éªŒè¯è§„åˆ™ï¼Œé”™è¯¯æç¤ºç”±ç»„ä»¶è‡ªåŠ¨ç”Ÿæˆã€‚  
* **çŠ¶æ€ç®¡ç†é›†æˆ**ï¼šæ³¨å†ŒæˆåŠŸåæœªç›´æ¥æ“ä½œå…¨å±€çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡è·¯ç”±å’Œç•Œé¢åˆ‡æ¢å®ç°æµç¨‹é—­ç¯ï¼ŒçŠ¶æ€æ›´æ–°ç”±`useLoginUserStore`ç»Ÿä¸€ç®¡ç†ã€‚  
* **åŠ¨ç”»äº¤äº’å®ç°**ï¼šé€šè¿‡`overlaylong`å’Œ`overlaytitle`ç±»åçš„åŠ¨æ€åˆ‡æ¢ï¼Œç»“åˆCSSçš„`transform`å’Œ`transition`å±æ€§å®ç°ç•Œé¢æ»‘åŠ¨æ•ˆæœã€‚  

## ç”¨æˆ·ç™»å½•åŠŸèƒ½

### é¡µé¢ä»£ç 


```HTML
<template>
  <div class="center">
    <h1>Sign in/ Sign up</h1>
    <div class="logon">
      <div :class="overlaylong">
        <div class="overlaylong-Signin" v-if="disfiex == 0">
          <h2 class="overlaylongH2">Sign in</h2>
          <a-form
            style="max-width: 700px; margin: 0 auto"
            label-align="left"
            :label-col="{ span: 4 }"
            :wrapper-col="{ span: 20 }"
            :model="form1"
            @finish="handleLogin"
          >
            <a-form-item
              name="userAccount"
              label="è´¦å·"
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥è´¦å·' },
                { min: 4, message: 'è´¦å·ä¸å°‘äº 4 ä½' },
                { max: 20, message: 'è´¦å·ä¸è¶…è¿‡ 20 ä½' },
              ]"
            >
              <a-input
                style="width: 250px"
                v-model:value="form1.userAccount"
                placeholder="è¯·è¾“å…¥è´¦å·"
              />
            </a-form-item>
            <a-form-item
              name="userPassword"
              label="å¯†ç "
              :rules="[
                { required: true, message: 'è¯·è¾“å…¥å¯†ç ' },
                { min: 8, message: 'å¯†ç ä¸å°‘äº 8 ä½' },
                { max: 20, message: 'å¯†ç ä¸è¶…è¿‡ 20 ä½' },
                {
                  pattern: passwordPattern,
                  message: 'å¯†ç å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šç¬¦å·',
                },
              ]"
            >
              <a-input-password
                style="width: 250px"
                v-model:value="form1.userPassword"
                placeholder="è¯·è¾“å…¥å¯†ç "
              />
              <h3 @click="message.info('è¯·è”ç³»ç®¡ç†å‘˜')">Forgot your password?</h3>
            </a-form-item>
            <a-form-item :wrapper-col="{ offset: 4, span: 20 }">
              <a-button type="primary" html-type="submit" class="inupbutton">ç™»å½•</a-button>
            </a-form-item>
          </a-form>
        </div>
      </div>
      <div :class="overlaytitle">
        <div class="overlaytitle-Signin" v-if="disfiex == 0">
          <h2 class="overlaytitleH2">Hello,Friend!</h2>
          <p class="overlaytitleP">Enter your personal details and start journey with us</p>
          <div class="buttongohs" @click="Signin">Sign up</div>
        </div>
      </div>
    </div>
  </div>
</template>
```

### JSä»£ç 


```JavaScript
import { reactive, ref } from 'vue'
import { useLoginUserStore } from '@/stores/useLoginUserStore'
import { useRouter } from 'vue-router'
import { userLoginUsingPost } from '@/api/userController'
import { message } from 'ant-design-vue'

const router = useRouter()
const loginUserStore = useLoginUserStore()
const passwordPattern = /^((?=.*[a-z])(?=.*[A-Z])(?=.*\d)|(?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9])|(?=.*[a-z])(?=.*\d)(?=.*[^A-Za-z0-9])|(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9])).*$/

// ç™»å½•è¡¨å•æ•°æ®æ¨¡å‹
const form1 = reactive({
  userAccount: '',
  userPassword: '',
})

// ç™»å½•å¤„ç†å‡½æ•°
const handleLogin = async () => {
  try {
    // è°ƒç”¨åç«¯ç™»å½•API
    const res = await userLoginUsingPost(form1)
    if (res.data.code === 0 && res.data.data) {
      // åˆ·æ–°ç™»å½•ç”¨æˆ·çŠ¶æ€
      await loginUserStore.fetchLoginUser()
      message.success('ç™»å½•æˆåŠŸ')
      // è·³è½¬é¦–é¡µå¹¶æ›¿æ¢å†å²è®°å½•
      router.push({
        path: '/',
        replace: true,
      })
    } else {
      message.error('ç™»å½•å¤±è´¥: ' + (res.data.description || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Login error:', error)
  }
}

// ç•Œé¢åˆ‡æ¢é€»è¾‘ï¼ˆåŒæ³¨å†ŒåŠŸèƒ½ï¼‰
const disfiex = ref(0)
const overlaylong = ref('overlaylong')
const overlaytitle = ref('overlaytitle')

const Signin = () => {
  overlaylong.value = 'overlaylongleft'
  overlaytitle.value = 'overlaytitleright'
  disfiex.value = 1
}

const Signup = () => {
  overlaylong.value = 'overlaylongright'
  overlaytitle.value = 'overlaytitleleft'
  disfiex.value = 0
}
```

### æŠ€æœ¯è¯¦è§£

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹

* **ç™»å½•è®¤è¯æµç¨‹**ï¼šéªŒè¯è´¦å·å¯†ç åˆæ³•æ€§ï¼Œè°ƒç”¨APIå®Œæˆç™»å½•ï¼Œå¹¶è·³è½¬é¦–é¡µã€‚  
* **çŠ¶æ€ç®¡ç†é›†æˆ**ï¼šé€šè¿‡`useLoginUserStore`è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå®ç°å…¨å±€çŠ¶æ€å…±äº«ã€‚  
* **è·¯ç”±å¯¼èˆªæ§åˆ¶**ï¼šä½¿ç”¨`router.push`å®ç°é¡µé¢è·³è½¬ï¼Œ`replace: true`é¿å…å†å²è®°å½•å†—ä½™ã€‚  
* **é”™è¯¯å¤„ç†æœºåˆ¶**ï¼šåŒºåˆ†ç½‘ç»œé”™è¯¯ã€è®¤è¯å¤±è´¥ç­‰åœºæ™¯ï¼Œæä¾›æ˜ç¡®çš„ç”¨æˆ·æç¤ºã€‚  

#### æŠ€æœ¯è¦ç‚¹

* **APIè°ƒç”¨ä¸çŠ¶æ€åŒæ­¥**ï¼š  
  1. ç™»å½•æˆåŠŸåé€šè¿‡`loginUserStore.fetchLoginUser()`åˆ·æ–°ç”¨æˆ·çŠ¶æ€ï¼Œç¡®ä¿å…¨å±€æ•°æ®ä¸€è‡´æ€§ã€‚  
  1. ä½¿ç”¨`async/await`å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼Œé¿å…å›è°ƒåœ°ç‹±ï¼Œæå‡ä»£ç å¯è¯»æ€§ã€‚  
* **å®‰å…¨ç­–ç•¥è®¾è®¡**ï¼š  
  * å¯†ç è¾“å…¥ä½¿ç”¨`a-input-password`ç»„ä»¶éšè—æ˜æ–‡ï¼Œé˜²æ­¢çª¥å±æ³„éœ²ã€‚  
  * é”™è¯¯æç¤ºä¸æš´éœ²å…·ä½“å¤±è´¥åŸå› ï¼ˆå¦‚â€œè´¦å·ä¸å­˜åœ¨â€æˆ–â€œå¯†ç é”™è¯¯â€ï¼‰ï¼Œé¿å…å®‰å…¨æ¼æ´ã€‚  
* **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼š  
  * ç™»å½•æˆåŠŸåè‡ªåŠ¨è·³è½¬é¦–é¡µï¼Œæå‡æ“ä½œæµç•…æ€§ã€‚  
  * æä¾›â€œå¿˜è®°å¯†ç â€äº¤äº’å…¥å£ï¼ˆè™½æœªå®ç°å®Œæ•´é€»è¾‘ï¼Œä½†é¢„ç•™äº¤äº’ç‚¹ï¼‰ã€‚  
* **ç•Œé¢åˆ‡æ¢åŠ¨ç”»**ï¼šé€šè¿‡CSSå˜æ¢å®ç°å·¦å³åˆ†æ çš„æ»‘åŠ¨æ•ˆæœï¼Œ`transition: transform 0.6s ease-in-out`ä¿è¯åŠ¨ç”»å¹³æ»‘è¿‡æ¸¡ã€‚  

## ç”¨æˆ·æ³¨é”€åŠŸèƒ½

### é¡µé¢ä»£ç 


```HTML
<template>
  <div id="globalHeader">
   
      <a-col flex="200px">
                <a-avatar v-else style="background-color: #1890ff">
                  {{ loginUserStore.loginUser.userName?.charAt(0) || 'U' }}
                </a-avatar>
                {{ loginUserStore.loginUser.userName ?? 'æ— å' }}
              </ASpace>
              <template #overlay>
                <a-menu>
                  <a-menu-item @click="doLogout">
                    <LogoutOutlined />
                    é€€å‡ºç™»å½•
                  </a-menu-item>
                </a-menu>
              </template>
            </a-dropdown>
          </div>
        </div>
  </div>
</template>
```

###  JSä»£ç 


```JavaScript
import { computed, ref } from 'vue'
import { useRouter } from 'vue-router'
import { message } from 'ant-design-vue'
import { useLoginUserStore } from '@/stores/useLoginUserStore'
import { userLogoutUsingPost } from '@/api/userController'

const loginUserStore = useLoginUserStore()
const router = useRouter()

// ç”¨æˆ·æ³¨é”€æ ¸å¿ƒå‡½æ•°
const doLogout = async () => {
  try {
    const res = await userLogoutUsingPost()
    if (res.data.code === 0) {
      // æ¸…ç©ºç™»å½•çŠ¶æ€
      loginUserStore.setLoginUser({ userName: 'æœªç™»å½•' })
      message.success('é€€å‡ºç™»å½•æˆåŠŸ')
      // è·³è½¬ç™»å½•é¡µ
      await router.push('/user/login')
    } else {
      message.error('é€€å‡ºç™»å½•å¤±è´¥ï¼š' + res.data.message)
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Logout error:', error)
  }
}
```

### æŠ€æœ¯è¯¦è§£

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹

* **æ³¨é”€æµç¨‹æ§åˆ¶**ï¼šè°ƒç”¨åç«¯æ³¨é”€æ¥å£`userLogoutUsingPost`ï¼Œæ¸…é™¤å®¢æˆ·ç«¯ç™»å½•çŠ¶æ€å¹¶è·³è½¬ç™»å½•é¡µã€‚  
* **æƒé™åŠ¨æ€è¿‡æ»¤**ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²ï¼ˆ`userRole`ï¼‰åŠ¨æ€è¿‡æ»¤èœå•ï¼Œéç®¡ç†å‘˜éšè—`/admin`ç›¸å…³é€‰é¡¹ã€‚  
* **çŠ¶æ€åŒæ­¥æœºåˆ¶**ï¼šé€šè¿‡`useLoginUserStore`å…¨å±€çŠ¶æ€ç®¡ç†ï¼Œç¡®ä¿æ³¨é”€åæ‰€æœ‰é¡µé¢ç™»å½•çŠ¶æ€ä¸€è‡´æ›´æ–°ã€‚  

#### æŠ€æœ¯è¦ç‚¹

* **æ³¨é”€æ¥å£äº¤äº’**ï¼š  
  * é‡‡ç”¨POSTè¯·æ±‚æ–¹å¼è°ƒç”¨`userLogoutUsingPost`ï¼Œç¬¦åˆRESTfulæ¥å£è§„èŒƒã€‚  
  * å“åº”ç»“æœé€šè¿‡`res.data.code === 0`åˆ¤æ–­è¯·æ±‚æˆåŠŸï¼Œé¿å…å¼ºä¾èµ–HTTPçŠ¶æ€ç ã€‚  
* **çŠ¶æ€ç®¡ç†è®¾è®¡**ï¼š  
  * `loginUserStore.setLoginUser`æ–¹æ³•ç”¨äºæ¸…ç©ºç”¨æˆ·ä¿¡æ¯ï¼Œè§¦å‘å…¨å±€çŠ¶æ€æ›´æ–°ã€‚  
  * ä½¿ç”¨`async/await`ç¡®ä¿æ³¨é”€æµç¨‹å®Œæˆåå†æ‰§è¡Œé¡µé¢è·³è½¬ï¼Œé¿å…çŠ¶æ€ä¸ä¸€è‡´ã€‚  
* **å®‰å…¨ç­–ç•¥å®ç°**ï¼š  
  * æ³¨é”€åå¼ºåˆ¶è·³è½¬ç™»å½•é¡µï¼Œé˜²æ­¢ç”¨æˆ·é€šè¿‡æµè§ˆå™¨å†å²è®°å½•è®¿é—®å—ä¿æŠ¤é¡µé¢ã€‚  
  * èœå•è¿‡æ»¤æœºåˆ¶é¿å…æœªæˆæƒç”¨æˆ·çœ‹åˆ°ç®¡ç†åŠŸèƒ½å…¥å£ï¼Œå‡å°‘å®‰å…¨æ¼æ´é£é™©ã€‚  
* **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**ï¼š  
  * æ³¨é”€æ“ä½œé€šè¿‡ä¸‹æ‹‰èœå•è§¦å‘ï¼Œç¬¦åˆå¸¸è§Webåº”ç”¨äº¤äº’ä¹ æƒ¯ã€‚  
  * æ“ä½œç»“æœé€šè¿‡`message.success/error`æä¾›æ˜ç¡®åé¦ˆï¼Œæå‡æ“ä½œæ„ŸçŸ¥åº¦ã€‚  

## ç”¨æˆ·ä¸ªäººç®€ä»‹

### é¡µé¢ä»£ç 


```HTML
<template>
  <div class="userProfilePage">
    <a-card :bordered="false" class="profile-card">
      <div class="profile-header">
        <a-avatar :size="120" class="user-avatar">
          <template v-if="userData.userAvatar">
            <a-image :src="userData.userAvatar" :width="120" />
          </template>
          <template v-else>
            {{ userData.userName?.charAt(0) || 'U' }}
          </template>
        </a-avatar>
        <div class="profile-info">
          <h2>{{ userData.userName }}</h2>
          <p class="account-info">@{{ userData.userAccount }}</p>
          <a-tag :color="userData.userRole === 'admin' ? 'red' : 'blue'">
            {{ userData.userRole === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·' }}
          </a-tag>
        </div>
      </div>

      <a-divider />

      <div class="profile-details">
        <a-descriptions :column="1" bordered>
          <a-descriptions-item label="è´¦å·ID">{{ userData.id }}</a-descriptions-item>
          <a-descriptions-item label="ä¸ªäººç®€ä»‹">
            {{ userData.userProfile || 'æš‚æ— ç®€ä»‹' }}
          </a-descriptions-item>
          <a-descriptions-item label="åˆ›å»ºæ—¶é—´">
            {{ formatDate(userData.createTime) }}
          </a-descriptions-item>
          <a-descriptions-item label="æœ€åæ›´æ–°æ—¶é—´">
            {{ formatDate(userData.updateTime) }}
          </a-descriptions-item>
        </a-descriptions>
      </div>

      <div class="profile-actions">
        <a-button type="primary" @click="showEditModal">ç¼–è¾‘èµ„æ–™</a-button>
        <a-button v-if="userData.userRole === 'admin'" style="margin-left: 10px" @click="goManage">
          ç®¡ç†åå°
        </a-button>
      </div>
    </a-card>
    <a-modal
      v-model:visible="editModalVisible"
      title="ç¼–è¾‘èµ„æ–™"
      ok-text="ä¿å­˜"
      cancel-text="å–æ¶ˆ"
      @ok="handleEdit"
      @cancel="handleCancel"
    >
      <a-form :model="updateUserForm" layout="vertical">
        <a-form-item label="ç”¨æˆ·å">
          <a-input v-model:value="updateUserForm.userName" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
        </a-form-item>
        <a-form-item label="å¤´åƒURL">
          <a-input v-model:value="updateUserForm.userAvatar" placeholder="è¯·è¾“å…¥å¤´åƒURL" />
        </a-form-item>
        <a-form-item label="ä¸ªäººç®€ä»‹">
          <a-textarea
            v-model:value="updateUserForm.userProfile"
            placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹"
            :auto-size="{ minRows: 3, maxRows: 5 }"
          />
        </a-form-item>
      </a-form>
    </a-modal>
  </div>
</template>
```

### JSä»£ç 


```JavaScript
import { ref, onMounted, reactive } from 'vue'
import { message } from 'ant-design-vue'
import { getLoginUserUsingGet } from '@/api/userController'
import router from '@/router'
import { updateUserSelfUsingPost } from '@/api/userController'

const editModalVisible = ref(false)
const userData = ref({
  id: '',
  userAccount: '',
  userName: '',
  userAvatar: null,
  userProfile: null,
  userRole: '',
  createTime: '',
  updateTime: '',
})

const updateUserForm = reactive({
  id: '',
  userName: '',
  userAvatar: '',
  userProfile: '',
})

// æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°
const formatDate = (dateString: string) => {
  if (!dateString) return 'æœªçŸ¥æ—¶é—´'
  return new Date(dateString).toLocaleString()
}

// è·å–ç”¨æˆ·èµ„æ–™
const fetchUserProfile = async () => {
  try {
    const res = await getLoginUserUsingGet()
    if (res.data.code === 0 && res.data.data) {
      userData.value = res.data.data
    } else {
      message.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥: ' + (res.data.message || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Fetch profile error:', error)
  }
}

// æ˜¾ç¤ºç¼–è¾‘æ¨¡æ€æ¡†
const showEditModal = () => {
  updateUserForm.id = userData.value.id
  updateUserForm.userName = userData.value.userName || ''
  updateUserForm.userAvatar = userData.value.userAvatar || ''
  updateUserForm.userProfile = userData.value.userProfile || ''
  editModalVisible.value = true
}

// å¤„ç†ç¼–è¾‘æäº¤
const handleEdit = async () => {
  try {
    const res = await updateUserSelfUsingPost(updateUserForm)
    if (res.data.code === 0) {
      message.success('èµ„æ–™æ›´æ–°æˆåŠŸ')
      editModalVisible.value = false
      fetchUserProfile() // åˆ·æ–°ç”¨æˆ·æ•°æ®
    } else {
      message.error('æ›´æ–°å¤±è´¥: ' + (res.data.message || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Update profile error:', error)
  }
}

// å–æ¶ˆç¼–è¾‘
const handleCancel = () => {
  editModalVisible.value = false
}

// è·³è½¬ç®¡ç†åå°
const goManage = () => {
  router.push('/admin/user')
}

onMounted(() => {
  fetchUserProfile()
})
```

### æŠ€æœ¯è¯¦è§£

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹

* **ç”¨æˆ·èµ„æ–™å±•ç¤º**ï¼šå‘ˆç°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆå¤´åƒã€ç”¨æˆ·åã€è´¦å·IDç­‰ï¼‰å’Œå…ƒæ•°æ®ï¼ˆåˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ï¼‰ã€‚  
* **èµ„æ–™ç¼–è¾‘åŠŸèƒ½**ï¼šé€šè¿‡æ¨¡æ€æ¡†å®ç°ç”¨æˆ·åã€å¤´åƒURLã€ä¸ªäººç®€ä»‹çš„ä¿®æ”¹ä¸æäº¤ã€‚  
* **æƒé™å·®å¼‚åŒ–å±•ç¤º**ï¼šæ ¹æ®ç”¨æˆ·è§’è‰²ï¼ˆ`userRole`ï¼‰æ˜¾ç¤ºâ€œç®¡ç†åå°â€å…¥å£ï¼Œä»…ç®¡ç†å‘˜å¯è§ã€‚  

#### æŠ€æœ¯è¦ç‚¹

* **æ•°æ®è·å–ä¸æ¸²æŸ“**ï¼š  
  * ä½¿ç”¨`getLoginUserUsingGet`æ¥å£è·å–å½“å‰ç™»å½•ç”¨æˆ·èµ„æ–™ï¼Œé¡µé¢æŒ‚è½½æ—¶è‡ªåŠ¨è°ƒç”¨`fetchUserProfile`ã€‚  
  * é€šè¿‡å“åº”å¼æ•°æ®`userData`ç»‘å®šé¡µé¢å…ƒç´ ï¼Œå®ç°æ•°æ®åŠ¨æ€æ¸²æŸ“ã€‚  
* **è¡¨å•äº¤äº’è®¾è®¡**ï¼š  
  * ç¼–è¾‘æ¨¡æ€æ¡†ä½¿ç”¨Ant Design Vueçš„`a-form`ç»„ä»¶ï¼Œæ”¯æŒå®æ—¶è¡¨å•éªŒè¯ï¼ˆè™½æœªæ˜¾å¼å®šä¹‰è§„åˆ™ï¼Œä½†ç»„ä»¶é»˜è®¤æ ¡éªŒéç©ºï¼‰ã€‚  
  * `updateUserForm`é€šè¿‡`reactive`å®šä¹‰å“åº”å¼å¯¹è±¡ï¼Œä¸è¡¨å•è¾“å…¥åŒå‘ç»‘å®šï¼Œç®€åŒ–æ•°æ®åŒæ­¥é€»è¾‘ã€‚  
* **çŠ¶æ€æ›´æ–°æœºåˆ¶**ï¼š  
  * èµ„æ–™æ›´æ–°æˆåŠŸåè°ƒç”¨`fetchUserProfile`é‡æ–°è·å–æ•°æ®ï¼Œç¡®ä¿é¡µé¢ä¸åç«¯æ•°æ®ä¸€è‡´ã€‚  
  * ä½¿ç”¨`editModalVisible`æ§åˆ¶æ¨¡æ€æ¡†æ˜¾ç¤º/éšè—ï¼Œé…åˆ`@ok`å’Œ`@cancel`äº‹ä»¶å¤„ç†äº¤äº’æµç¨‹ã€‚  
* **å“åº”å¼å¸ƒå±€å®ç°**ï¼š  
  * é€šè¿‡CSSåª’ä½“æŸ¥è¯¢`@media (max-width: 768px)`å®ç°ç§»åŠ¨ç«¯é€‚é…ï¼Œå°†å¤´åƒä¸ä¿¡æ¯æ æ”¹ä¸ºå‚ç›´æ’åˆ—ã€‚  
  * `a-descriptions`ç»„ä»¶çš„`column="1"`å±æ€§åœ¨å°å±å¹•ä¸‹ä¼˜åŒ–ä¿¡æ¯å±•ç¤ºç»“æ„ã€‚  

## ç”¨æˆ·å¢åˆ æ”¹æŸ¥

### é¡µé¢ä»£ç 


```HTML
<template>
  <div id="userManagePage">
    <!-- æœç´¢è¡¨å• -->
    <a-form layout="inline" :model="searchParams" @finish="doSearch">
      <a-form-item label="è´¦å·">
        <a-input v-model:value="searchParams.userAccount" placeholder="è¾“å…¥è´¦å·" allow-clear />
      </a-form-item>
      <a-form-item label="ç”¨æˆ·å">
        <a-input v-model:value="searchParams.userName" placeholder="è¾“å…¥ç”¨æˆ·å" allow-clear />
      </a-form-item>
      <a-form-item label="ç”¨æˆ·è§’è‰²">
        <a-select
          v-model:value="searchParams.userRole"
          placeholder="é€‰æ‹©è§’è‰²"
          style="width: 120px"
          allow-clear
        >
          <a-select-option value="admin">ç®¡ç†å‘˜</a-select-option>
          <a-select-option value="user">æ™®é€šç”¨æˆ·</a-select-option>
        </a-select>
      </a-form-item>
      <a-form-item>
        <a-button :icon="h(SearchOutlined)" type="primary" html-type="submit">æœç´¢</a-button>
        <a-button style="margin-left: 8px" @click="resetSearch">é‡ç½®</a-button>
        <a-button type="dashed" style="margin-left: 8px" @click="showAddModal">æ·»åŠ ç”¨æˆ·</a-button>
      </a-form-item>
    </a-form>
    
    <!-- æ·»åŠ ç”¨æˆ·æ¨¡æ€æ¡† -->
    <a-modal
      v-model:visible="addModalVisible"
      title="æ·»åŠ æ–°ç”¨æˆ·"
      :confirm-loading="addLoading"
      ok-text="ç¡®è®¤"
      cancel-text="å–æ¶ˆ"
      @ok="handleAdd"
      @cancel="handleAddCancel"
    >
      <a-form :model="addUserForm" layout="vertical" ref="addFormRef">
        <a-form-item
          label="è´¦å·"
          name="userAccount"
          :rules="[{ required: true, message: 'è¯·è¾“å…¥è´¦å·' }]"
        >
          <a-input v-model:value="addUserForm.userAccount" placeholder="è¯·è¾“å…¥è´¦å·" />
        </a-form-item>
        <a-form-item
          label="ç”¨æˆ·å"
          name="userName"
          :rules="[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å' }]"
        >
          <a-input v-model:value="addUserForm.userName" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
        </a-form-item>
        <a-form-item label="å¤´åƒURL" name="userAvatar">
          <a-input v-model:value="addUserForm.userAvatar" placeholder="è¯·è¾“å…¥å¤´åƒURL" />
        </a-form-item>
        <a-form-item label="ä¸ªäººç®€ä»‹" name="userProfile">
          <a-textarea
            v-model:value="addUserForm.userProfile"
            placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹"
            :auto-size="{ minRows: 3, maxRows: 5 }"
          />
        </a-form-item>
        <a-form-item
          label="ç”¨æˆ·è§’è‰²"
          name="userRole"
          :rules="[{ required: true, message: 'è¯·é€‰æ‹©ç”¨æˆ·è§’è‰²' }]"
        >
          <a-select v-model:value="addUserForm.userRole" placeholder="è¯·é€‰æ‹©è§’è‰²">
            <a-select-option value="admin">ç®¡ç†å‘˜</a-select-option>
            <a-select-option value="user">æ™®é€šç”¨æˆ·</a-select-option>
          </a-select>
        </a-form-item>
      </a-form>
    </a-modal>

    <div style="margin-bottom: 16px" />
    
    <!-- è¡¨æ ¼ -->
    <a-table
      :columns="columns"
      :data-source="dataList"
      :pagination="pagination"
      :loading="loading"
      @change="doTableChange"
    >
      <template #bodyCell="{ column, record }">
        <template v-if="column.dataIndex === 'userAvatar'">
          <a-image v-if="record.userAvatar" :src="record.userAvatar" :width="80" />
          <a-avatar v-else :size="80" style="background-color: #1890ff">
            {{ record.userName?.charAt(0) || 'U' }}
          </a-avatar>
        </template>
        <template v-else-if="column.dataIndex === 'userRole'">
          <a-tag :color="record.userRole === 'admin' ? 'green' : 'blue'">
            {{ record.userRole === 'admin' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·' }}
          </a-tag>
        </template>
        <template v-else-if="column.dataIndex === 'createTime'">
          {{ dayjs(record.createTime).format('YYYY-MM-DD HH:mm:ss') }}
        </template>
        <template v-else-if="column.key === 'action'">
          <a-space>
            <a-button type="dashed" size="small" @click="showEditModal(record)">ç¼–è¾‘</a-button>
            <a-button danger size="small" @click="showDeleteConfirm(record.id)">åˆ é™¤</a-button>
          </a-space>
        </template>
      </template>
    </a-table>

    <!-- ç¼–è¾‘ç”¨æˆ·æ¨¡æ€æ¡† -->
    <a-modal
      v-model:visible="editModalVisible"
      :title="editModalTitle"
      :confirm-loading="editLoading"
      ok-text="ä¿å­˜"
      cancel-text="å–æ¶ˆ"
      @ok="handleEdit"
      @cancel="handleCancel"
    >
      <a-form :model="updateUserForm" layout="vertical" ref="editFormRef">
        <a-form-item
          label="ç”¨æˆ·å"
          name="userName"
          :rules="[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å' }]"
        >
          <a-input v-model:value="updateUserForm.userName" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
        </a-form-item>
        <a-form-item label="å¤´åƒURL" name="userAvatar">
          <a-input v-model:value="updateUserForm.userAvatar" placeholder="è¯·è¾“å…¥å¤´åƒURL" />
        </a-form-item>
        <a-form-item label="ä¸ªäººç®€ä»‹" name="userProfile">
          <a-textarea
            v-model:value="updateUserForm.userProfile"
            placeholder="è¯·è¾“å…¥ä¸ªäººç®€ä»‹"
            :auto-size="{ minRows: 3, maxRows: 5 }"
          />
        </a-form-item>
        <a-form-item
          label="ç”¨æˆ·è§’è‰²"
          name="userRole"
          :rules="[{ required: true, message: 'è¯·é€‰æ‹©ç”¨æˆ·è§’è‰²' }]"
        >
          <a-select v-model:value="updateUserForm.userRole" placeholder="è¯·é€‰æ‹©è§’è‰²">
            <a-select-option value="admin">ç®¡ç†å‘˜</a-select-option>
            <a-select-option value="user">æ™®é€šç”¨æˆ·</a-select-option>
          </a-select>
        </a-form-item>
      </a-form>
    </a-modal>
  </div>
</template>
```

### JSä»£ç 


```JavaScript
import { computed, onMounted, reactive, ref } from 'vue'
import {
  deleteUserUsingPost,
  getUserVoListPageUsingPost,
  updateUserUsingPost,
  addUserUsingPost,
} from '@/api/userController'
import { message, Modal } from 'ant-design-vue'
import dayjs from 'dayjs'
import type { FormInstance } from 'ant-design-vue'
import { h } from 'vue'
import { SearchOutlined } from '@ant-design/icons-vue'

// æ¨¡æ€æ¡†çŠ¶æ€
const addModalVisible = ref(false)
const addLoading = ref(false)
const addFormRef = ref<FormInstance>()
const editModalVisible = ref(false)
const editModalTitle = ref('ç¼–è¾‘ç”¨æˆ·')
const editLoading = ref(false)
const editFormRef = ref<FormInstance>()
const loading = ref(false)

// è¡¨æ ¼åˆ—å®šä¹‰
const columns = [
  { title: 'ID', dataIndex: 'id', width: 200 },
  { title: 'è´¦å·', dataIndex: 'userAccount', width: 200 },
  { title: 'ç”¨æˆ·å', dataIndex: 'userName', width: 150 },
  { title: 'å¤´åƒ', dataIndex: 'userAvatar', width: 120 },
  { title: 'ç®€ä»‹', dataIndex: 'userProfile', ellipsis: true },
  { title: 'ç”¨æˆ·è§’è‰²', dataIndex: 'userRole', width: 120 },
  { title: 'åˆ›å»ºæ—¶é—´', dataIndex: 'createTime', width: 180 },
  { title: 'æ“ä½œ', key: 'action', width: 150 }
]

// æ•°æ®çŠ¶æ€
const dataList = ref([])
const total = ref(0)
const searchParams = reactive({
  current: 1,
  pageSize: 10,
  sortField: 'createTime',
  sortOrder: 'descend',
  userAccount: '',
  userName: '',
  userRole: ''
})

// è¡¨å•æ•°æ®æ¨¡å‹
const updateUserForm = reactive({
  id: '',
  userName: '',
  userAvatar: '',
  userProfile: '',
  userRole: ''
})

const addUserForm = reactive({
  userName: '',
  userAccount: '',
  userAvatar: '',
  userProfile: '',
  userRole: ''
})

// è·å–ç”¨æˆ·åˆ—è¡¨æ•°æ®
const fetchData = async () => {
  try {
    loading.value = true
    const res = await getUserVoListPageUsingPost(searchParams)
    if (res.data.code === 0 && res.data.data) {
      dataList.value = res.data.data.records || []
      total.value = res.data.data.total || 0
    } else {
      message.error('è·å–æ•°æ®å¤±è´¥: ' + (res.data.message || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Fetch data error:', error)
  } finally {
    loading.value = false
  }
}

// æ˜¾ç¤ºæ·»åŠ ç”¨æˆ·æ¨¡æ€æ¡†
const showAddModal = () => {
  addModalVisible.value = true
}

// å¤„ç†æ·»åŠ ç”¨æˆ·
const handleAdd = async () => {
  try {
    await addFormRef.value?.validate()
    addLoading.value = true
    const res = await addUserUsingPost(addUserForm)
    if (res.data.code === 0) {
      message.success('æ·»åŠ ç”¨æˆ·æˆåŠŸ')
      addModalVisible.value = false
      addFormRef.value?.resetFields()
      fetchData()
    } else {
      message.error('æ·»åŠ å¤±è´¥: ' + (res.data.message || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    console.error('Add user error:', error)
    if (error instanceof Error) {
      message.error('æ·»åŠ å¤±è´¥: ' + error.message)
    }
  } finally {
    addLoading.value = false
  }
}

// å–æ¶ˆæ·»åŠ 
const handleAddCancel = () => {
  addModalVisible.value = false
  addFormRef.value?.resetFields()
}

// æ˜¾ç¤ºç¼–è¾‘ç”¨æˆ·æ¨¡æ€æ¡†
const showEditModal = (record) => {
  editModalTitle.value = `ç¼–è¾‘ç”¨æˆ· - ${record.userName}`
  Object.assign(updateUserForm, {
    id: record.id,
    userName: record.userName,
    userAvatar: record.userAvatar,
    userProfile: record.userProfile,
    userRole: record.userRole
  })
  editModalVisible.value = true
}

// å¤„ç†ç¼–è¾‘ç”¨æˆ·
const handleEdit = async () => {
  try {
    await editFormRef.value?.validate()
    editLoading.value = true
    const res = await updateUserUsingPost(updateUserForm)
    if (res.data.code === 0) {
      message.success('æ›´æ–°æˆåŠŸ')
      editModalVisible.value = false
      fetchData()
    } else {
      message.error('æ›´æ–°å¤±è´¥: ' + (res.data.message || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    console.error('Update error:', error)
  } finally {
    editLoading.value = false
  }
}

// å–æ¶ˆç¼–è¾‘
const handleCancel = () => {
  editModalVisible.value = false
  editFormRef.value?.resetFields()
}

// æ˜¾ç¤ºåˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
const showDeleteConfirm = (id) => {
  Modal.confirm({
    title: 'ç¡®è®¤åˆ é™¤',
    content: 'ç¡®å®šè¦åˆ é™¤è¯¥ç”¨æˆ·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼',
    okText: 'ç¡®è®¤',
    okType: 'danger',
    cancelText: 'å–æ¶ˆ',
    onOk: () => doDelete(id)
  })
}

// å¤„ç†åˆ é™¤ç”¨æˆ·
const doDelete = async (id) => {
  try {
    loading.value = true
    const res = await deleteUserUsingPost({ id })
    if (res.data.code === 0) {
      message.success('åˆ é™¤æˆåŠŸ')
      fetchData()
    } else {
      message.error('åˆ é™¤å¤±è´¥: ' + (res.data.message || 'æœªçŸ¥é”™è¯¯'))
    }
  } catch (error) {
    message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•')
    console.error('Delete error:', error)
  } finally {
    loading.value = false
  }
}

// æœç´¢ç”¨æˆ·
const doSearch = () => {
  searchParams.current = 1
  fetchData()
}

// é‡ç½®æœç´¢æ¡ä»¶
const resetSearch = () => {
  Object.assign(searchParams, {
    userAccount: undefined,
    userName: undefined,
    userRole: undefined,
    current: 1
  })
  fetchData()
}

// è¡¨æ ¼åˆ†é¡µæ’åºå¤„ç†
const doTableChange = (page) => {
  searchParams.current = page.current
  searchParams.pageSize = page.pageSize
  fetchData()
}

// è®¡ç®—åˆ†é¡µé…ç½®
const pagination = computed(() => ({
  current: searchParams.current,
  pageSize: searchParams.pageSize,
  total: total.value,
  showSizeChanger: true,
  showQuickJumper: true,
  showTotal: (total) => `å…± ${total} æ¡`
}))

// é¡µé¢æŒ‚è½½æ—¶è·å–æ•°æ®
onMounted(() => {
  fetchData()
})
```

### æŠ€æœ¯è¯¦è§£

#### æ ¸å¿ƒåŠŸèƒ½ç‚¹

* **ç”¨æˆ·åˆ—è¡¨å±•ç¤º**ï¼šé€šè¿‡è¡¨æ ¼å±•ç¤ºç”¨æˆ·ä¿¡æ¯ï¼Œæ”¯æŒåˆ†é¡µã€æ’åºå’Œæ¡ä»¶æœç´¢  
* **ç”¨æˆ·æ·»åŠ **ï¼šé€šè¿‡æ¨¡æ€æ¡†è¡¨å•æ·»åŠ æ–°ç”¨æˆ·ï¼ŒåŒ…å«å¿…å¡«å­—æ®µéªŒè¯  
* **ç”¨æˆ·ç¼–è¾‘**ï¼šæ”¯æŒä¿®æ”¹ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¤´åƒã€ç®€ä»‹ã€è§’è‰²ï¼‰  
* **ç”¨æˆ·åˆ é™¤**ï¼šé€šè¿‡ç¡®è®¤å¯¹è¯æ¡†åˆ é™¤ç”¨æˆ·ï¼Œæ“ä½œä¸å¯é€†  
* **æ¡ä»¶æœç´¢**ï¼šæ”¯æŒæŒ‰è´¦å·ã€ç”¨æˆ·åã€ç”¨æˆ·è§’è‰²ç­›é€‰ç”¨æˆ·åˆ—è¡¨  



#### æŠ€æœ¯è¦ç‚¹

* **æ•°æ®è·å–ä¸åˆ†é¡µ**ï¼š  
  * ä½¿ç”¨`getUserVoListPageUsingPost`æ¥å£è·å–ç”¨æˆ·åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µã€æ’åºå’Œæ¡ä»¶æŸ¥è¯¢  
  * é€šè¿‡`searchParams`å“åº”å¼å¯¹è±¡ç®¡ç†æœç´¢æ¡ä»¶å’Œåˆ†é¡µå‚æ•°  
  * ä½¿ç”¨`computed`è®¡ç®—å±æ€§åŠ¨æ€ç”Ÿæˆè¡¨æ ¼åˆ†é¡µé…ç½®  



* **è¡¨å•éªŒè¯ä¸å¤„ç†**ï¼š  
  * æ·»åŠ å’Œç¼–è¾‘è¡¨å•ä½¿ç”¨Ant Design Vueçš„`a-form`ç»„ä»¶ï¼Œé€šè¿‡`rules`å±æ€§å®šä¹‰å¿…å¡«å­—æ®µéªŒè¯  
  * è¡¨å•æäº¤å‰è°ƒç”¨`validate()`æ–¹æ³•è¿›è¡Œå­—æ®µæ ¡éªŒï¼Œé¿å…æ— æ•ˆæ•°æ®æäº¤  
  * æäº¤æˆåŠŸåé‡ç½®è¡¨å•å¹¶åˆ·æ–°æ•°æ®åˆ—è¡¨  



* **æ¨¡æ€æ¡†äº¤äº’**ï¼š  
  * æ·»åŠ å’Œç¼–è¾‘åŠŸèƒ½é€šè¿‡æ¨¡æ€æ¡†å®ç°ï¼Œé¿å…é¡µé¢è·³è½¬å½±å“ç”¨æˆ·ä½“éªŒ  
  * ä½¿ç”¨`v-model:visible`æ§åˆ¶æ¨¡æ€æ¡†æ˜¾ç¤º/éšè—ï¼Œé€šè¿‡`ref`å¼•ç”¨æ“ä½œè¡¨å•å®ä¾‹  
  * ç¼–è¾‘æ¨¡æ€æ¡†æ ¹æ®å½“å‰ç”¨æˆ·æ•°æ®åŠ¨æ€è®¾ç½®æ ‡é¢˜å’Œè¡¨å•åˆå§‹å€¼  



* **è¡¨æ ¼æ•°æ®æ¸²æŸ“**ï¼š  
  * é€šè¿‡`columns`æ•°ç»„å®šä¹‰è¡¨æ ¼åˆ—ï¼Œä½¿ç”¨æ¨¡æ¿æ’æ§½è‡ªå®šä¹‰ç‰¹æ®Šåˆ—æ¸²æŸ“  
  * å¤´åƒåˆ—æ ¹æ®æ˜¯å¦å­˜åœ¨å¤´åƒURLæ˜¾ç¤ºå›¾ç‰‡æˆ–é»˜è®¤å¤´åƒ  
  * è§’è‰²åˆ—ä½¿ç”¨æ ‡ç­¾ç»„ä»¶æ ¹æ®è§’è‰²ç±»å‹æ˜¾ç¤ºä¸åŒé¢œè‰²  
  * æ—¶é—´åˆ—ä½¿ç”¨dayjsåº“æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºå¯è¯»æ ¼å¼  



* **ç”¨æˆ·æ“ä½œå®‰å…¨**ï¼š  
  * åˆ é™¤æ“ä½œé€šè¿‡ç¡®è®¤å¯¹è¯æ¡†äºŒæ¬¡ç¡®è®¤ï¼Œé˜²æ­¢è¯¯æ“ä½œ  
  * æ‰€æœ‰APIæ“ä½œéƒ½åŒ…å«é”™è¯¯å¤„ç†ï¼Œé€šè¿‡`message`ç»„ä»¶åé¦ˆæ“ä½œç»“æœ  
  * åŠ è½½çŠ¶æ€æ§åˆ¶ï¼ˆ`loading`ï¼‰é˜²æ­¢é‡å¤æäº¤å’Œæå‡ç”¨æˆ·ä½“éªŒ  



* **å“åº”å¼è®¾è®¡**ï¼š  
  * æœç´¢è¡¨å•ä½¿ç”¨`layout="inline"`åœ¨å°å±å¹•ä¸‹è‡ªåŠ¨æ¢è¡Œ  
  * è¡¨æ ¼åˆ—å®šä¹‰å®½åº¦å’Œ`ellipsis`å±æ€§ä¼˜åŒ–ä¸åŒå±å¹•ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ  
  * é¡µé¢æ•´ä½“ä½¿ç”¨å†…è¾¹è·å’Œé—´è·ä¿è¯å†…å®¹å¯è¯»æ€§  



